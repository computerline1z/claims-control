function ArrayIndexOf(e,t){if(!t||"function"!=typeof t)return-1;if(!e||!e.length||1>e.length)return-1;for(var i=0;e.length>i;i++)if(t(e[i]))return i;return-1}JQ=Ember.Namespace.create(),JQ.Widget=Ember.Mixin.create({didInsertElement:function(){var e=this._gatherOptions();this._gatherEvents(e);var t=jQuery.ui[this.get("uiType")](e,this.get("element"));this.set("ui",t)},willDestroyElement:function(){var e=this.get("ui");if(e){var t=this._observers;for(var i in t)t.hasOwnProperty(i)&&this.removeObserver(i,t[i]);e._destroy()}},_gatherOptions:function(){var e=this.get("uiOptions"),t={};return e.forEach(function(e){t[e]=this.get(e);var i=function(){var t=this.get(e);this.get("ui")._setOption(e,t)};this.addObserver(e,i),this._observers=this._observers||{},this._observers[e]=i},this),t},_gatherEvents:function(e){var t=this.get("uiEvents")||[],i=this;t.forEach(function(t){var n=i[t];n&&(e[t]=function(e,t){n.call(i,e,t)})})}}),JQ.Dialog=Ember.View.extend(JQ.Widget,{init:function(){this._super(),this.dialogID&&(this.elementId=this.dialogID)},elementId:"openItemDialog",uiType:"dialog",didInsertElement:function(){this._super(),this.pars&&this.pars.input&&(t=this.pars.input.offset().top-200+"px",this.$().parent().css("top",t))},uiOptions:"autoOpen width close title resizable modal position buttons".w(),autoOpen:!0,width:400,resizable:!1,modal:!0,position:"top",close:function(){$(this).dialog("destroy"),$(this).remove();var e=$(this).attr("id"),t="openItemDialog"!==e?MY[e]:MY.dialog;t&&(t.removeOnCloseView&&t.removeOnCloseView.remove(),t.remove()),$("div.validity-tooltip").remove()},open:function(){$(this).dialog("open")}}),function(e){e.fn.spinner=function(t){var i=e.extend({},e.fn.spinner.defaults,t);return this.each(function(){var n,a=0,r=0,o=0,s=0,l=0,c=e(this);if("remove"==t||"close"==t){var n=c.data("spinner"),d=c.data("opts");if(n!==void 0)return n.remove(),c.removeData("spinner").removeData("opts"),d.hide&&c.css("visibility","visible"),d.onFinish.call(this),void 0}c.is("body")&&c.height()<e(document).height()&&c.height(e(document).height()),"spinnerBig.gif"===i.img&&(i.height=66,i.width=66);var u=c.offset();if(o=c.outerWidth(),s=c.outerHeight(),s>i.height?l=Math.round((s-i.height)/2):i.height>s&&(l=0-Math.round((i.height-s)/2)),r=u.top+l+"px","right"==i.position)a=u.left+o+10+"px";else if("left"==i.position)a=u.left-i.width-10+"px";else{var p=0;if(c.is("body")){var f=e("body").css("margin-left");p=parseInt(f.replace("px",""),10)}a=p+u.left+Math.round(.5*o)-Math.round(.5*i.width)+"px"}i.onStart.call(this),i.hide&&c.css("visibility","hidden"),n=e('<img class="spinner" src="/Content/images/'+i.img+'" style="position: absolute; left: '+a+"; top: "+r+"; width: "+i.width+"px; height: "+i.height+"px; z-index: "+i.zIndex+';" />').appendTo("body"),c.data("spinner",n).data("opts",i)})},e.fn.spinner.defaults={position:"right",img:"spinner.gif",height:16,width:16,zIndex:1001,hide:!1,onStart:function(){},onFinish:function(){}}}(jQuery),$("div.content:visible:first").length>0?$("div.content:visible:first").spinner({centerOnBody:!0,position:"center",img:"spinnerBig.gif"}):$("body").spinner({centerOnBody:!0,position:"center",img:"spinnerBig.gif"}),window.console||(console={}),console.log=console.log||function(){},console.warn=console.warn||function(){},console.error=console.error||function(){},console.info=console.info||function(){},jQuery.fn.log=function(e){return e=e||"log",console.log("%s: %o",e,this),this.each(function(e){id=this.id?"ID: "+this.id:"",console.log("%d: %s.%s %s",e,this.tagName,this.className,id)}),this};var MY={change:{onlyNumbers:function(e){return(""+e).replace(/[^\d.]/g,"")}}};String.prototype.toRowObject=function(e){var t=this.split(" ");retObj={};for(var i=0;t.length>i;i++)e[i]&&(retObj[e[i]]=$.trim(t[i]));return retObj},String.prototype.firstSmall=function(){return this.slice(0,1).toLowerCase()+this.slice(1)},String.prototype.firstBig=function(){return this.slice(0,1).toUpperCase()+this.slice(1)},Array.prototype.filterByTbl=function(e){if(fTbl=[],me=this,!me.length)return fTbl;me[0].iD||console.error("No iD for filter");var t=e.filterTbl.filter(function(t){return t[e.filterField]===e.filterValue});return t.forEach(function(t){for(var i=0;me.length>i;i++)if(me[i].iD===t[e.joinField]){fTbl[fTbl.length]=me[i];break}}),fTbl},Em.Object.prototype.MapArrToString=function(e,t,i){for(var n,a=[],r=0;e.length>r;r++)n=$.trim(this[e[r]]),""!==n&&(a[a.length]=n);return i?this.notUnique?a.join(" ")+", "+this.dateBorn:a.join(" "):t?a.join(" "):a.join(", ")},Em.Object.prototype.updateTo=function(e){for(var t in this)this.hasOwnProperty(t)&&e[t]&&this[t]!==e[t]&&this.set(t,e[t])},Array.prototype.getColByFName=function(e){for(var t="",i=0;this.length>i;i++)if(this[i].FName.toLowerCase()==e.toLowerCase())return this[i];return t},Array.prototype.FNameIndex=function(e){for(var t="",i=0;this.length>i;i++)if(this[i].FName.toLowerCase()==e.toLowerCase())return i;return t},Array.prototype.findIndexByVal=function(e,t){var i="";t&&(e=e.toLowerCase());for(var n=0;this.length>n;n++){if(t&&this[n].toLowerCase()==e)return n;if(this[n]==e)return n}return i},Array.prototype.findValueByID=function(e){for(var t=0;this.length>t;t++)if(this[t][0]===e)return this[t];return!1},Array.prototype.findObjectByProperty=function(e,t){for(var i=0;this.length>i;i++)if(this[i][e]===t)return this[i]},Array.prototype.findColValuesByID=function(e,t){for(var i="",n=0;this.length>n;n++)if(this[n][0]===e){for(var a="",r=0;t.length>r;r++)a+=this[n][t[r]]+", ";return a.slice(0,-2)}return i},Array.prototype.findColValueByID=function(e,t){for(var i="",n=0;this.length>n;n++)if(this[n][0]===e)return this[n][t];return i},Array.prototype.removeRowByProperty=function(e,t){for(var i=0;this.length>i;i++)if(this[i][e]===t)return this.splice(i,1),i;return!1},Array.prototype.removeRowByID=function(e){for(var t="",i=0;this.length>i;i++)if(this[i][0]===e)return this.splice(i,1),i;return t},Array.prototype.AddArray=function(e){for(var t=0;e.length>t;t++)this[this.length]=e[t]},Array.prototype.IndexOfFunc=function(e){for(var t=0;this.length>t;t++)if(e(this[t]))return t;return-1},Array.prototype.ValueInMe=function(e){for(var t=0;this.length>t;t++)if(this[t]===e)return!0;return!1},Array.prototype.findColValByColVal=function(e,t,i){for(var n=0;this.length>n;n++)if(this[n][t]==e)return this[n][i];return""},String.prototype.endsWith=function(e){return this.substr(this.length-e.length)===e},String.prototype.startsWith=function(e){return this.substr(0,e.length)===e},Array.prototype.MapArrToString=function(e,t){for(var i,n=[],a=0;e.length>a;a++)i=$.trim(this[e[a]]),""!==i&&(n[n.length]=i);return t?n.join(" "):n.join(", ")},Array.prototype.UpdateArrToNew=function(e,t){if(t)for(var i=0;t.length>i;i++)e[t[i]]=parseInt(e[t[i]],10);for(var i=0;this.length>i;i++)if(this[i][0]===e[0])return this[i]=e,!0;return!1},Array.prototype.arrElementToInt=function(e){for(var t=0;e.length>t;t++)this[e[t]]=parseInt(this[e[t]],10)},String.prototype.IsImage=function(){var e=this.substring(this.search("\\.")+1).toUpperCase();return"PNG"===e||"JPG"===e||"GIF"===e||"JPEG"===e||"BMP"===e?!0:!1},String.prototype.format=function(){for(var e=this,t=arguments.length;t--;)e=e.replace(RegExp("\\{"+t+"\\}","gm"),arguments[t]);return e};var jscss_filesadded="";String.prototype.GetIcon=function(e){var t=this.search("\\."),i="<span style='display:inline-block;' class='{0} ui-button-icon-primary'>",n="img32-Help";if(t>0){var a=this.substring(this.search("\\.")+1).toLowerCase();i="<a href='/Uploads/"+e+"."+a+"' target='_blank'>"+i+"</a>","png"===a||"jpg"===a||"gif"===a||"jpg"===a||"jpeg"===a||"bmp"===a?n="img32-Img":"xls"===a||"xlsx"===a?n="img32-Excel":"pdf"===a?n="img32-Pdf":"ppt"===a||"pptx"===a?n="img32-ppt":("doc"===a||"docx"===a)&&(n="img32-Word")}else"Add"===this&&(n="img32-"+(""+this));return i.format(n)};var oSIZES={DoneSizes:0};oGLOBAL.Start={fnSetNewData:function(e,t){var i=0,n=t.RenderNew&&oGLOBAL.Start[t.Ctrl]?oGLOBAL.Start[t.Ctrl]:"";n?($("#"+t.Ctrl).empty(),$("#"+t.Ctrl).replaceWith(oGLOBAL.Start[t.Ctrl])):!oGLOBAL.Start[t.Ctrl];for(var a in e)if("Render"===a){var r=e[a];for(var o in r)if(r[o]){$("#"+o).html(r[o]);for(var s=$("#"+o+" div.inputForm"),l=0;s.length>l;l++){var c;"AccidentForm"===$(s)[l].id&&(c=$("#btnSaveAccident")),oCONTROLS.UpdatableForm({frm:$(s)[l],btnSaveToDisable:c})}}}else"ExecFn"===a?i=e[a]:e[a]&&oDATA.SET(a,e[a]);if(i)for(var d in i)i[d]&&$("#"+d)[i[d]]();if("tabMessages"==t.Ctrl);else if("tabAccidents"==t.Ctrl){var u=Tab_AccidentsList(t.Ctrl);oGLOBAL.Start.fnApplyLayout(t.Ctrl,u,20)}else"tabClaims"==t.Ctrl||"tabMap"==t.Ctrl||"tabReports"==t.Ctrl||"tabLists"==t.Ctrl;t.fnCallBack!==void 0&&t.fnCallBack(e),oGLOBAL.Start.FormLoaded(void 0,t.Ctrl),console.log("oGLOBAL.Start.fnSetNewData,#"+t.Ctrl+" height:"+$("#"+t.Ctrl).height())},FormLoaded:function(){$("img.spinner").remove()}},oGLOBAL.date={dateFormat:"yyyy.mm.dd",dateDelimiter:".",getTodayString:function(){var e=new Date;return this.checkFormat(),e.getFullYear()+this.dateDelimiter+(9>e.getMonth()?"0"+(e.getMonth()+1):e.getMonth()+1)+this.dateDelimiter+(9>e.getDate()?"0"+e.getDate():e.getDate())},getDate:function(e){var t=RegExp("([^-]*)"+this.dateDelimiter+"([^-]*)"+this.dateDelimiter+"([^-]*)");this.checkFormat();var i=e.match(t),n=i?new Date(i[2]+"/"+i[3]+"/"+i[1]):"";return n},isDate:function(e){return!isNaN(Date.parse(this.getDate(e)))},firstBigger:function(e,t){return 1===arguments.length&&(t=this.getTodayString()),this.getDate(e)>this.getDate(t)},checkFormat:function(){if("yyyy.mm.dd"!==this.dateFormat)throw Error(err+"no such format in General.js date obj.")}},oGLOBAL.helper={emData_fromDataToSave:function(e,t){return ret={},e.Fields.forEach(function(t,i){ret[t.firstSmall()]=e.Data[i]}),t&&(ret.iD=t),Em.Object.create(ret)},getData_fromDataToSave:function(e,t){return ret="",e.Fields.forEach(function(i,n){i===t&&(ret=e.Data[n])}),ret},executeFunctionByName:function(e,t){for(var i=Array.prototype.slice.call(arguments,2),n=e.split("."),a=n.pop(),r=0;n.length>r;r++)t=t[n[r]];return t[a].apply(t,i)},existsFunctionByName:function(e,t){for(var i=(Array.prototype.slice.call(arguments,2),e.split(".")),n=i.pop(),a=0;i.length>a;a++)if(t=t[i[a]],!t)return!1;return t[n]||!1}};var oCONTROLS={UpdatableForm_reset:function(e){$(e).find(".UpdateField").each(function(){var e=$(this),t=e.data("ctrl"),i="List"===e.data("ctrl").Type?!0:!1,n=t.Value;"checkbox"===e.attr("type")?e.attr("checked",n):e.is("textarea")?e.html(n):i?$.isNumeric(n)&&(e.data("newval",n),e.val(oDATA.GET(e.data("ctrl").Source).Data.findColValuesByID(n,t.iText))):e.val(n)})},UpdatableForm_toSaved:function(e,t,i){i&&SERVER.update({Action:"Edit",DataToSave:i}),e&&$.extend(t.data("ctrl"),{NewRec:0,id:e}),t.find(".UpdateField").each(function(){var e,t=$(this);t.data("ctrl"),e="checkbox"===t.attr("type")?t.attr("checked")?1:0:t.is("input")&&"List"===t.data("ctrl").Type?t.data("newval"):t.val(),$.extend(t.data("ctrl"),{Value:e})})},getValFromRow:function(e,t){var i=e.slice(0,1).toLowerCase()+e.slice(1);return t[i]},UpdatableForm:function(e){var t,i="",n=$(e.frm).data("ctrl"),a=this;e.row&&e.row.iD&&(n.NewRec=0,n.id=e.row.iD),"0"===n.NewRec&&(n.NewRec=0);var r="NoData"===n.Source?"NoData":oDATA.GET(n.Source),o=function(){t.removeAttr("disabled","disabled")};n.NewRec||(e.btnSaveToDisable?1===e.btnSaveToDisable.length?(t=e.btnSaveToDisable,t.is("button")?t.attr("disabled","disabled"):console.error("btnSaveToDisable not button")):console.error("wrong btnSaveToDisable no: "+e.btnSaveToDisable.length):console.warn("no btnSaveToDisable")),$(e.frm).find("div.ExtendIt, span.ExtendIt").each(function(){var s=$(this),l=s.data("ctrl"),c="",d=-1,u={};if(!l)return!0;if(l.Control!==void 0)return"swfUpload"===l.Control&&n.id===void 0?!0:(s[l.Control](l),!0);if("NoData"!==r){var p=r.Cols;if(l.Field){for(var f=0;p.length>f;f++)if(p[f].FName===l.Field){d=f,i=r.Grid.aoColumns[f].sTitle;break}-1===d&&console.error("Wrong Field indicated "+l.Field+" in UpdatableForm(objFunc:84)!")}}i=l.sTitle?l.sTitle:i;var m,h={};"NoData"!==r&&(h=$.extend({},r.Cols[d])),h=$.extend(!0,h,l);var g=h.Type?h.Type:h.List?"List":"";if(void 0===g)return alert("Nesusiparsino ctrl elemento objFunc.js-UpdatableForm (n�ra Type)"),!0;var v="ui-widget-content ";v+=s.hasClass("NotUpdateField")?" NotUpdateField":" UpdateField","Integer"===g||"Decimal"===g?v+=" number":"List"===g?h.Type="List":g&&-1!==g.search("Date")&&(v+=" date"),h.classes=h.classes?h.classes+" "+v:v,"number"!=typeof h.Value&&"boolean"!=typeof h.Value&&(h.Value=h.Value?h.Value.replace(/'/g,'"'):"");for(var b in h)"List"===b?$.extend(u,h[b]):("Value"===b||"Validity"===b||"AgrValidity"===b||"Tip"===b||"Field"===b||"Type"===b||"Ext"===b||"UpdateField"===b||"Editable"===b)&&(u[b]=h[b]);if(e.row){var D=a.getValFromRow(h.FName,e.row);D&&(u.Value=D,h.Value=D)}if("Integer"===g||"Decimal"===g?"number"==typeof D?(u.Value=D,h.Value=D):null!==D&&D!==void 0&&(u.Value=D,h.Value=D):D&&(u.Value=D,h.Value=D),u=JSON.stringify(u),"Integer"===g||"Decimal"===g?u=u.replace("match('integer')","match(integer)").replace("match('number')","match(number)"):-1!==g.search("Date")&&(u=u.replace("match('date')","match(date)").replace("lessThanOrEqualTo(new Date())","lessThanOrEqualTo(new Date(),\\&quot;Data negali būti didesnė už šiandieną.\\&quot;)")),$.extend(h,{data_ctrl:u},{label:{txt:i,type:h.labelType}}),"Boolean"===g||"checkbox"===g)c=oCONTROLS.chk(h),$(c).prependTo(s);else if("String"===g||"Email"===g||"text"===g||"Textarea"===g||"hidden"===g){var y=h.LenMax===void 0?0:h.LenMax;"hidden"===g?(c+=oCONTROLS.hidden(h),m=$(c).prependTo(s).parent().find("input:first")):101>y&&"Textarea"!==g?(c+=oCONTROLS.txt(h),m=$(c).prependTo(s).parent().find("input:first")):(c+=oCONTROLS.txtarea(h),m=$(c).prependTo(s).parent().find("Textarea:first").autosize())}else if("Integer"===g||"Decimal"===g)c+=oCONTROLS.txt(h),m=$(c).prependTo(s).parent().find("input:first");else if(-1!==g.search("Date")){var w=0;if(h.Value||"Today"!==h.Default||(h.Value=oGLOBAL.date.getTodayString()),-1!==g.search("Time")){var C=h.Value.length>=16?h.Value.substring(11,16):"00:00";w=1}h.Value=h.Value.substring(0,11),c+=oCONTROLS.txt(h),w&&(c+=oCONTROLS.txt({Value:C,style:"margin:0 20px;",title:"Laikas",classes:"time ui-widget-content ui-corner-all"})),m=$(c).prependTo(s).parent().find("input:first")}h.List&&(m?m.ComboBox():(c+=oCONTROLS.txt(h),m=$(c).prependTo(s).parent().find("input").ComboBox())),h.Plugin&&$.each(h.Plugin,function(e,t){m[e](t)}),t&&("Boolean"===g||"checkbox"===g?s.find("input:checkbox").on("change",o):h.List?m.data("autocomplete").fnItemChanged=function(){o()}:m&&(m.hasClass("hasDatepicker")?(m.on("keyup",o).datepicker("option","onSelect",o),m.closest("div.ExtendIt").find("input.time").on("keyup",o)):m.on("keyup",o))),m!==void 0&&(m.val($.trim(m.val())),("Integer"===g||"Decimal"===g||"Date"===g)&&m.ValidateOnBlur({Allow:g}),h.Tip!==void 0&&m.attr("placeholder",h.Tip))})},ValidateForm:function(frm,DataToSaveAppend){$("div.validity-modal-msg").remove();var c=frm.data("ctrl"),id=parseInt(c.id,10),NewRec=parseInt(c.NewRec,10),DataTable=c.tblUpdate?c.tblUpdate:oDATA.GET(c.Source).Config.tblUpdate;!id&!NewRec&&console.error("Nėra nurodyta id formos data(ctrl)!"),$.validity.start();var DataToSave={Data:[],Fields:[],DataTable:DataTable};if($.each(frm.find(".UpdateField:visible"),function(i,v){var e=$(v),elDesc=e[0].tagName+", id-"+e.attr("id"),Value,UpdateField=e.data("ctrl").UpdateField?e.data("ctrl").UpdateField:!1;if(void 0===e.data("ctrl"))return console.error("Nerasta data(ctrl),el: "+elDesc),!0;var Type,FName=e.data("ctrl").Field,OldVal=NewRec?"":$.trim(e.data("ctrl").Value),val="";if("checkbox"===e.attr("type"))NewRec||(OldVal=OldVal&&"False"!==OldVal&&"0"!==OldVal?1:0),val=e.attr("checked")?1:0;else{if(e.data("ctrl").Type===void 0)console.error("Nerastas elemento Tipas!");else{Type=e.data("ctrl").Type;var Validity=e.data("ctrl").Validity?e.data("ctrl").Validity:"";if("hidden"===Type)val=e.val();else if("Date"==Type.substring(0,4)){if(Validity=Validity.replace(/match\(date\)/g,"match('date')"),val=$.trim(e.val()),"-"===val&&(val=""),(-1!==Validity.indexOf("require")||""!==e.val())&&(eval("$(this)."+Validity),Type.search(/time/i)>-1)){var TimeCtrl=e.parent().next();TimeCtrl.require().match(/^\d{2}[:]\d{2}$/,"Turi būti laiko formatas - valandos:minutės, pvz.12:30"),val=val+" "+TimeCtrl.val()+":00"}}else if("List"===Type)$.isNumeric(e.data("newval"))?val=e.data("newval"):e.hasClass("notRequired")?e.val(""):(e.val(""),e.require("Parinkite reikšmę iš sąrašo."));else{("Decimal"===Type||"Integer"===Type)&&(e.val(e.val().replace(/,/g,".")),Validity=Validity.replace(/match\(number\)/g,"match('number')").replace(/match\(integer\)/g,"match('integer')")),val=e.val();var CheckIt=id?OldVal!=val?!0:!1:!0,Require=Validity.search(/require/i)>-1,NotEmpty=""===val?!1:!0;CheckIt&&(Require||NotEmpty)&&Validity&&eval("$(this)."+Validity)}}if(e.data("ctrl").AgrValidity!==void 0){var aVal=e.data("ctrl").AgrValidity;if("require"===aVal.Validity){var Empty=$.map($(aVal.Selector),function(e){return $(e).val()?null:1});Empty.length===$(aVal.Selector).length&&e.require(aVal.Msg)}}}(OldVal!=val||0===val&&""===OldVal)&&(UpdateField?DataToSave[UpdateField]=val:(DataToSave.Data.push(val),DataToSave.Fields.push(FName)))}),DataToSaveAppend!==void 0)for(var i=0;DataToSaveAppend.length>i;i++)DataToSave.Data.push(DataToSaveAppend[i].Data),DataToSave.Fields.push(DataToSaveAppend[i].Fields);var ValRes=$.validity.end();return ValRes.valid&&DataToSave.Data.length?(NewRec||(DataToSave.id=id),DataToSave):ValRes.valid?0:!1},lbl:function(e){return"<label class='dialog-form-label'>"+e+"</label>"},AddToProperty:function(e,t,i){return e[t]=e[t]?e[t]+" "+i:i,e},basic:function(e){return(e.attr?e.attr+" ":"")+(e.id?"id='"+e.id+"' ":"")+(e.style?'style="'+e.style+'" ':"")+(e.notabstop?"tabindex='-1' ":"")+(e.title?"title='"+e.title+"' ":"")+(e.data_ctrl?"data-ctrl='"+e.data_ctrl+"' ":"")+(e.classes?"class='"+e.classes+"' ":"")},appendLabel:function(e,t){return e.label?e.label.txt&&"None"!==e.label.type?e.label===void 0||"None"===e.label?t:"Top"===e.label.type?"<label class='toplabel'><span>"+e.label.txt+"</span>"+t+"</label>":"<label class='leftlabel'><span>"+e.label.txt+":</span>"+t+"</label>":t:t},txt:function(e){return("Integer"==e.Type||"Decimal"==e.Type)&&(e.Value=e.Value+""),this.appendLabel(e,"<input type='text' "+this.basic(e)+(e.Value?'value="'+$.trim(e.Value).replace(/"/g,"&quot;")+'" ':"")+"/>")},hidden:function(e){return this.appendLabel(e,"<input type='hidden' "+this.basic(e)+(e.Value?'value="'+$.trim(e.Value).replace(/"/g,"&quot;")+'" ':"")+"/>")},a:function(e){return"<a "+this.basic(e)+" href='javascript:void(0);return false;'>"+$.trim(e.Value).replace(/"/g,"&quot;")+"</a>"},txtarea:function(e){return this.appendLabel(e,"<textarea cols='100' rows='"+(e.textAreaRows?e.textAreaRows:4)+"' "+this.basic(e)+">"+(e.Value?e.Value.replace(/"/g,"&quot;"):"")+"</textarea>")},chk:function(e){return"string"==typeof e.Value&&(e.Value=e.Value.toLowerCase().search(/false/i)>-1||""===e.Value||0==e.Value?0:1),"<label "+(e.label.classes?" class='"+e.label.classes+"'":"")+(e.attr?e.attr+" ":"")+"><input type='checkbox' "+this.basic(e)+(e.Value?"checked='checked'":"")+"/>"+(e.label.txt?e.label.txt:"")+"</label>"},img:function(e){return"<img src='"+e.src+"' alt='"+e.alt+"' onclick='"+e.onclickfn+"'/>"},ui_img:function(e){return"<span class='ui-icon "+e.name+"' style='"+e.style+";margin-top:.5em;' onclick=\""+e.onclickfn+'"/>'},txt_imgINtxt:function(e,t,i){t.classes=t.classes?t.classes+" InputInWraper":"InputInWraper";var n="width:"+(e.width-20)+"px;";return t.style=t.style?t.style+n:n,"<div "+this.basic(e)+"width:"+e.width+"px;"+"'>"+this.txt(t)+this.ui_img(i)+"</div>"},btnOKimg:function(e){return"<button tabindex='-1' title='"+e+"' class='ui-button ui-widget ui-state-default ui-button-icon-only ui-corner-all ui-button-icon' role='button'><span class='ui-button-icon-primary ui-icon ui-icon-circle-check'></span><span class='ui-button-text'>&nbsp;</span></button></div>"},lbltxt_inline_btnConfirm:function(e,t,i,n,a){return"<div id="+e+"><label class='dialog-form-r'>"+t+"</label><input type='text' data-ctrl=\""+i+"\" value='"+n+"' class='validate-dialog ui-widget-content ui-corner-left'/><button tabindex='-1' title='"+a+"' class='ui-button ui-widget ui-state-default ui-button-icon-only ui-corner-right ui-button-icon' role='button'><span class='ui-button-icon-primary ui-icon ui-icon-circle-check'></span><span class='ui-button-text'>&nbsp;</span></button></div>"},lbla_inline:function(e,t,i,n){return"<div id="+e+"><label class='dialog-form-label'>"+t+'</label><a data-ctrl="'+n+"\" href='javascript:void(0);'>"+i+"</a></div>"},btnTextOnly:function(e){return oCONTROLS.AddToProperty(e,"classes","ui-button ui-corner-all ui-button-text-icon-primary"),"<button "+oCONTROLS.basic(e)+'" role="button"><span class="ui-button-text">'+e.text+"</span></button>"},btnImgOnly:function(e){return oCONTROLS.AddToProperty(e,"classes","ui-button ui-corner-all ui-icon-only"),"<button "+oCONTROLS.basic(e)+'" role="button"><span class="ui-button-icon-primary ui-icon '+e.icon+'"></span></button>'},btnTextImg:function(e){return oCONTROLS.AddToProperty(e,"classes","ui-button ui-corner-all ui-button-text-icon-primary"),"<button "+oCONTROLS.basic(e)+'" role="button"><span class="ui-button-icon-primary ui-icon '+e.icon+'"></span><span class="ui-button-text">'+e.text+"</span></button>"},OptionList:function(e){for(var t="<select id='"+e.id+"' name= id='"+e.id+"'>",i=0;e.Arr.length>i;i++){for(var n=[],a=0;e.TextI.length>a;a++)n.push(e.Arr[i][e.TextI[a]]);if(e.ReplaceArr!==void 0)for(var r=0;e.ReplaceArr.length>r;r++)for(var o=e.ReplaceArr[r].obj.Data,s=e.ReplaceArr[r].Ix,l=e.ReplaceArr[r].txtIx,c=0;o.length>c;c++)if(n[s]===o[c][0]){n[s]=o[c][l];break}n=n.join(", "),t+=e.SelectedID?'<option value="'+e.Arr[i][e.ValI]+(+e.Arr[i][0]==e.SelectedID?'" selected="selected"':'"')+">"+n+"</option>":'<option value="'+e.Arr[i][e.ValI]+'">'+n+"</option>"}return t+"</select>"},Set_Updatable_HTML:{mega_select_list:function(e){var t="<div tabindex='0' class='container medium' style='background-color:#d3d1ba;margin-top:0px;font-weight:bold;'><div class='left'>"+e.opt.SelectText+"<span style='cursor:pointer;color: #3366CC;text-decoration: underline;'></span></div>"+"<div class='right'><a id='aCancelSelectOpt' class='floatright' href='#'>Atšaukti</a></div></div>";t+="<div class='megaselectlistoptions'>";for(var i="",n=1;e.oDATA.emData.length>n;n+=3)i+="<div class='megaselectlistcolumn'><ul>",i+="<li 'tabindex=-1' data-val="+e.oDATA.emData[n][e.opt.val]+">"+e.oDATA.emData[n][e.opt.text]+"</li>",i+="<li 'tabindex=-1' data-val="+e.oDATA.emData[n+1][e.opt.val]+">"+e.oDATA.emData[n+1][e.opt.text]+"</li>",i+="<li 'tabindex=-1' data-val="+e.oDATA.emData[n+2][e.opt.val]+">"+e.oDATA.emData[n+2][e.opt.text]+"</li></ul></div>";t+=i+"<div style='clear: both;'></div></div></hr>",$(e.ctrl).append(t);var a=e.ctrl.find("div.megaselectlistoptions");a.data("height",a.height()),e.ctrl.find("a.floatright").bind("click",function(){return e.fnCancel(),!1}),e.ctrl.find("li").bind("click",function(){$("#aCancelSelectOpt").remove(),li=$(this),e.ctrl.find("span:eq(0)").html(li.html()),e.ctrl.data("ctrl")[e.opt.FieldName]=li.data("val"),e.ctrl.attr("data-ctrl",JSON.stringify(e.ctrl.data("ctrl"))),"function"==typeof e.fnAfterOptClick&&e.fnAfterOptClick($(this)),e.ctrl.find("div.megaselectlistoptions").height("0px")}),e.ctrl.find("span").bind("click",function(){var t=e.ctrl.find(".megaselectlistoptions");0==t.height()?t.animate({height:t.data("height")+"px"}):t.animate({height:"0px"})})},lbltxt_inline_btnConfirm:function(e){e.ctrl.html(oCONTROLS.lbl(e.lblTitle)+oCONTROLS.txt(e.txt.Title,e.txt.Value,'{"Validity":"'+e.Data.Validity+'"}')+oCONTROLS.btnOKimg(e.btnTitle)),e.fnPostInit!==void 0&&e.fnPostInit(),e.ctrl.find("button").bind("click",function(t){return t.preventDefault(),oGLOBAL.ValidateCtrlsArr([e.ctrl.find("input")])&&(e.DataToSave.Data[0]=e.ctrl.find("input").val(),SERVER.update("Edit",e.DataToSave,e.Data.tblToUpdate,e.fnCallBack,"")),e.ctrl.block("Siunčiami duomenys.."),!1})},lbla_inline:function(e){e.ctrl.html(oCONTROLS.lbla_inline("divID"+e.DataToSave.id,e.lblTitle,e.Value,"")),e.ctrl.find("a").bind("click",function(t){return t.preventDefault(),SERVER.update("Edit",e.DataToSave,e.Data.tblToUpdate,e.fnCallBack,""),e.ctrl.block("Siunčiami duomenys.."),!1})}},dialog:{opt:{title:"",msg:"",autoOpen:!1,height:"auto",width:350,minWidth:300,modal:!0,show:"clip",hide:"clip",close:function(){oCONTROLS.dialog.destroy(this)}},destroy:function(e){$(e).dialog("destroy"),$("#dialog_form_tmp_id").remove()},Alert:function(e){buttons={Gerai:function(){oCONTROLS.dialog.destroy(this)}},this.showDialog(e,buttons)},Confirm:function(e,t){oCONTROLS.dialog.fnCallBack=t,buttons={Taip:function(){d=oCONTROLS.dialog,d.fnCallBack(),d.destroy(this)},Ne:function(){oCONTROLS.dialog.destroy(this)}},this.showDialog(e,buttons)},showDialog:function(e,t){var i=$.extend(!0,{},this.opt,{buttons:t},e);$('<div id="dialog_form_tmp_id">').html(e.msg).dialog(i).dialog("open")}}};$(window).load(function(){oGLOBAL.logFromStart("All finished."),$("body").spinner("remove")}),$(oGLOBAL.logFromStart("DOM ready."));var oDATA=Ember.Object.create({me:this,Obj:{},objNames:[],listTemplates:{},SET:function(e,t){this.Obj[e]=t,this.objNames.contains(e)||this.objNames.push(e)},GET:function(e){return this.Obj[e]?this.Obj[e]:(console.warn("Object "+e+" not downloaded yet."),!1)},GetRow:function(e,t){return this.GET(t).emData.findProperty("iD",e)},execWhenLoaded:function(e,t,i){var n=i?i:0,a=this,r=!1;return e.forEach(function(e){"tmp"===e.slice(0,3)?Em.TEMPLATES[e]||(console.log("template "+e+" not exists"),r=!0):this.get("exists").call(this,e)||(console.log("obj "+e+" not exists"),r=!0)},a),r?(n=setTimeout(function(){oDATA.execWhenLoaded(e,t,n)},200),!1):(0!==n&&clearTimeout(n),t(),void 0)},emBuilder:function(e){if(oData=oDATA.GET(e.tblName),oData.emData||(oData.emData=[]),e.newData){var t,i,n,a=e.newData,r=oData.Cols,o=[],s=oData.emData;for(i=0;r.length>i;i++)t=r[i].FName,o[o.length]=t.slice(0,1).toLowerCase()+t.slice(1);if(e.toAppend)for(i=0;a.length>i;i++){var l={};for(n=0;r.length>n;n++)l[o[n]]=a[i][n];l.visible=!0,e.toAppend.sort?oDATA.setToPlace(e.toAppend,l,s):s.pushObject(Em.Object.create(l))}else for(i=0;a.length>i;i++){var c=s.findProperty("iD",a[i][0]);for(n=1;r.length>n;n++)c.set(o[n],a[i][n])}return e.toAppend&&(oData.Data.length=0),s}},setToPlace:function(e,t,i){var n,a,r=e.col;n="desc"===e.sort?function(e,i){return i.get(r)<=t[r]?(a=e,!1):void 0}:function(e,i){return i.get(r)>=t[r]?(a=e,!1):void 0},$.each(i,n),i.insertAt(a,Em.Object.create(t))},load:function(e,t){if(this.get("exists").call(this,e))throw Error(e+"  already loaded");var i=this.get("SET"),n=this.get("emBuilder"),a=this;$.ajax({url:this.get("listUrl")[e],dataType:"json",type:"POST",success:function(r){i.call(a,e,r[e]);var o=n.call(a,{newData:r[e].Data,tblName:e,toAppend:!0});t(o)}})},exists:function(e){return this.Obj[e]!==void 0},fnErr:function(e,t){throw t?Error(t):Error("No object '"+e+"' in oDATA.listUrl;")},fnLoadMain:function(){this.fnLoad2({url:"Main/tabMain"})},executed:{},fnLoad2:function(e){if(!localStorage)throw Error("No localStorage in Browser");var t=(new Date).getTime(),i=this.get("SET"),n=this.get("emBuilder"),a=this,r=function(t,i){console.warn("fnLoad2 started '"+e.url+"'. "+i+". Time,ms:"+((new Date).getTime()-t)),e.callBack&&e.callBack()};if(this.executed[e.url]&&!e.runAllways)r(t,"Second click no need to load.");else{var o=e.url,s={ver:localStorage[o],tmp:localStorage[o]?!1:!0,obj:oDATA.GET(e.checkObj)?!1:!0};$.ajax({url:e.url,dataType:"json",type:"POST",data:s,success:function(e){e.jsonObj&&$.each(e.jsonObj,function(e,t){console.log("New jsonObj:"+e),i.call(a,e,t),i.call(a,e,t),n.call(a,{newData:t.Data,tblName:e,toAppend:!0})}),e.templates&&$.each(e.templates,function(e,t){console.log("New template:"+e),t?localStorage[e]=t:t=localStorage[e],t||console.error("No template "+e),"tmp2"===e.slice(0,4)?$("body").append('<script id="'+e+'" type="text/x-tmpl">'+t+"</script>"):Em.TEMPLATES[e]||(Em.TEMPLATES[e]=Em.Handlebars.compile(t))}),e.Script?e.Script.File&&(console.log("Downloading js file - "+e.Script.File),$.ajaxSetup({cache:!0}),$.getScript(e.Script.File,function(){r(t,"First click, script loaded.")})):r(t,"First click, no script."),localStorage[o]=e.ver,oDATA.executed[o]=(new Date).getTime()},error:function(){window.location="/Account/Logon"},complete:function(){$("img.spinner").remove()}})}}});Ember.ResourceController=Ember.ArrayController.extend(Ember.ResourceAdapter,{init:function(){this._super();var e=this,t=e.get("url");t&&oDATA.fnLoad2({url:t,callBack:function(){e.tableName&&e.set("content",oDATA.GET(e.tableName).emData)}})},content:[],tableName:null,cols:null,config:null,grid:null,path:null,loadStatus:null,getByID:function(e){var t=this.get("content").findValueByID(e);if(!t)throw Error("Didn't found arr value in getById, id -"+e);return t},setNewVal:function(e){"array"!==Em.typeOf(e.newVal[0])&&(e.newVal=[e.newVal]);var t=this;return e.fieldsToInt&&e.newVal.forEach(function(t){t.arrElementToInt(e.fieldsToInt)}),oDATA.emBuilder.call(t,{newData:e.newVal,tblName:t.tableName,toAppend:e.toAppend}),e.newVal},refreshContent:function(){this.get("content").length?alert("Not populated"):this.getAll(url)},getAll:function(e){var t=this;return this._resourceRequest({type:"POST",url:e}).done(function(e){t.set("loadStatus","ok");var i=e[t.get("tableName")];i.Data&&t.set("content",i.Data),i.cols&&t.set("cols",i.cols),i.config&&t.set("config",i.config),i.grid&&t.set("grid",i.grid),console.log("data loaded")})}});var SERVER={update3:function(e){updData=e.ctrl?$.extend({},e.pars,e.ctrl):e.pars,this.send(e.pars,e.CallBack,updData,e.url)},update2:function(e){if(!e.DataToSave)return!1;var t={Success:function(t,i){var n=oDATA.GET(e.source);if(id="Add"===i.Action?t.ResponseMsg.ID:e.DataToSave.id,obj="Add"===i.Action?oGLOBAL.helper.emData_fromDataToSave(e.DataToSave,id):n.emData.findProperty("iD",id),"proc_Drivers"===e.source){var a=n.emData.filter(function(e){return e.firstName===obj.firstName&&e.lastName===obj.lastName});2===a.length&&a.map(function(e){e.notUnique=!1})}if("Delete"===i.Action)src.removeObject(obj);else{var r="Add"===e.Action?!0:!1,o=r?Em.Object.create({}):e.row;if(!o)throw Error("p.Row is empty");var s=n.Cols;if(!n)throw Error("p.oData is empty");if(r&&(o.iD=t.ResponseMsg.ID),s.forEach(function(e){var t=!1,n=e.FName.firstSmall();i.DataToSave.Fields.forEach(function(a,r){if(n==a.firstSmall()){var l=i.DataToSave.Data[r];if(o.set(n,l),t=!0,e.List){var c=s.findObjectByProperty("IdField",n);if(c){var d=oDATA.GET(e.List.Source).emData.findObjectByProperty("iD",l).MapArrToString(e.List.iText,!0);o.set(c.FName.firstSmall(),d)}else console.warn("List field '"+a+"' without IdField")}}}),!t&&r&&"iD"!==n&&(e.Default?"Today"===e.Default?o.set(n,oGLOBAL.date.getTodayString()):"UserName"===e.Default?o.set(n,UserData.Name()):"UserId"===e.Default?o.set(n,UserData.Id()):o.set(n,e.Default):"docs"==n?o.set("docs","(0)"):o.set(n,"")),console.log("col: "+n+", ok: "+t+", fieldValue:"+o[n])}),"proc_Drivers"===e.source){var l;a=n.emData.filter(function(e){return e.firstName===o.firstName&&e.lastName===o.lastName}),l=2>a.length?!1:!0,a.map(function(e){e.notUnique=l}),o.notUnique=l}r?(o.set("visible",!0),n.emData.pushObject(o)):n.emData.findProperty("iD",o.iD).updateTo(o);var c=i.controller,d=i.emObject?i.emObject:"content";c&&r&&App[c][d].pushObject(o)}Em.run.next(function(){$("img.spinner").remove()}),e.CallBackAfter&&e.CallBackAfter(o,i.Action)}};$.extend(e,{CallBack:t}),this.update(e)},update:function(e){var t="/Update/"+e.Action,i=e;SERVER.send(e.DataToSave,this.fnUpdated,i,t)},send:function(e,t,i,n,a){a||(a="json"),"string"!=typeof e&&(e=JSON.stringify(e)),i.Ctrl?$(i.Ctrl).spinner({position:"center",img:"spinnerBig.gif"}):$("div.content:first").spinner({position:"center",img:"spinnerBig.gif"}),a||(a="json"),oGLOBAL.notify.msg("","Siunčiami duomenys.."),$.ajax({type:"POST",contentType:"charset=utf-8",url:n,beforeSend:function(e){e.setRequestHeader("Content-type","application/json; charset=utf-8")
},data:e,contentType:"application/json; charset=utf-8",dataType:a,error:function(e){console.warn(e),window.location="/Account/Logon"},success:function(e){t(e,i)},complete:function(){$("img.spinner").remove()}})},fnUpdated:function(e,t){var i=t.source?oDATA.GET(t.source).Config.titleFields:!1,n="Duomenų keitimas.";i&&t.row&&(n=t.row.iD?t.row.MapArrToString(i,!0):"Duomenų keitimas."),DefMsg={Title:n||t.Title||"Duomenų keitimas",Error:{Add:"Nepavyko išsaugot naujų duomenų.",Edit:"Nepavyko pakeisti duomenų.",Delete:"Nepavyko ištrinti duomenų."},Success:{Add:"Duomenys sėkmingai pridėti.",Edit:"Duomenys sėkmingai pakeisti.",Delete:"Duomenys ištrinti."}};var a,r,o,s;return e.ErrorMsg?(o="Error",r="img32-warning",s=!0):(o="Success",r="img32-check",s=!1),a=t.Msg?t.Msg[o]:DefMsg[o][t.Action],"Error"===o&&(a+=" Klaida:\n"+e.ErrorMsg),t.CallBack&&"function"==typeof t.CallBack[o]&&t.CallBack[o](e,t),oGLOBAL.notify.withIcon(DefMsg.Title,a,r,s),!1}};(function(e){"use strict";var t=function(e,i){var n=/[^\w\-\.:]/.test(e)?Function(t.arg+",tmpl","var _e=tmpl.encode"+t.helper+",_s='"+e.replace(t.regexp,t.func)+"';return _s;"):t.cache[e]=t.cache[e]||t(t.load(e));return i?n(i,t):function(e){return n(e,t)}};t.cache={},t.load=function(e){return document.getElementById(e).innerHTML},t.regexp=/([\s'\\])(?![^%]*%\})|(?:\{%(=|#)([\s\S]+?)%\})|(\{%)|(%\})/g,t.func=function(e,t,i,n,a,r){return t?{"\n":"\\n","\r":"\\r","	":"\\t"," ":" "}[e]||"\\"+e:i?"="===i?"'+_e("+n+")+'":"'+("+n+"||'')+'":a?"';":r?"_s+='":void 0},t.encReg=/[<>&"'\x00]/g,t.encMap={"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;","'":"&#39;"},t.encode=function(e){return((e||"")+"").replace(t.encReg,function(e){return t.encMap[e]||""})},t.arg="o",t.helper=",print=function(s,e){_s+=e&&(s||'')||_e(s);},include=function(s,d){_s+=tmpl(s,d);}","function"==typeof define&&define.amd?define(function(){return t}):e.tmpl=t})(this),function(e){"use strict";var t=function(e,i,n){var a,r,o=document.createElement("img");return o.onerror=i,o.onload=function(){r&&(!n||!n.noRevoke)&&t.revokeObjectURL(r),i(t.scale(o,n))},a=window.Blob&&e instanceof Blob||window.File&&e instanceof File?r=t.createObjectURL(e):e,a?(o.src=a,o):t.readFile(e,function(e){o.src=e})},i=window.createObjectURL&&window||window.URL&&URL.revokeObjectURL&&URL||window.webkitURL&&webkitURL;t.scale=function(e,t){t=t||{};var i=document.createElement("canvas"),n=e.width,a=e.height,r=Math.max((t.minWidth||n)/n,(t.minHeight||a)/a);return r>1&&(n=parseInt(n*r,10),a=parseInt(a*r,10)),r=Math.min((t.maxWidth||n)/n,(t.maxHeight||a)/a),1>r&&(n=parseInt(n*r,10),a=parseInt(a*r,10)),e.getContext||t.canvas&&i.getContext?(i.width=n,i.height=a,i.getContext("2d").drawImage(e,0,0,n,a),i):(e.width=n,e.height=a,e)},t.createObjectURL=function(e){return i?i.createObjectURL(e):!1},t.revokeObjectURL=function(e){return i?i.revokeObjectURL(e):!1},t.readFile=function(e,t){if(window.FileReader&&FileReader.prototype.readAsDataURL){var i=new FileReader;return i.onload=function(e){t(e.target.result)},i.readAsDataURL(e),i}return!1},"function"==typeof define&&define.amd?define(function(){return t}):e.loadImage=t}(this),function(e){"use strict";var t=e.HTMLCanvasElement&&e.HTMLCanvasElement.prototype,i=e.Blob&&function(){try{return Boolean(new Blob)}catch(e){return!1}}(),n=i&&e.Uint8Array&&function(){try{return 100===new Blob([new Uint8Array(100)]).size}catch(e){return!1}}(),a=e.BlobBuilder||e.WebKitBlobBuilder||e.MozBlobBuilder||e.MSBlobBuilder,r=(i||a)&&e.atob&&e.ArrayBuffer&&e.Uint8Array&&function(e){var t,r,o,s,l,c;for(t=e.split(",")[0].indexOf("base64")>=0?atob(e.split(",")[1]):decodeURIComponent(e.split(",")[1]),r=new ArrayBuffer(t.length),o=new Uint8Array(r),s=0;t.length>s;s+=1)o[s]=t.charCodeAt(s);return l=e.split(",")[0].split(":")[1].split(";")[0],i?new Blob([n?o:r],{type:l}):(c=new a,c.append(r),c.getBlob(l))};e.HTMLCanvasElement&&!t.toBlob&&(t.mozGetAsFile?t.toBlob=function(e,i,n){n&&t.toDataURL&&r?e(r(this.toDataURL(i,n))):e(this.mozGetAsFile("blob",i))}:t.toDataURL&&r&&(t.toBlob=function(e,t,i){e(r(this.toDataURL(t,i)))})),"function"==typeof define&&define.amd?define(function(){return r}):e.dataURLtoBlob=r}(this),function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery","load-image","bootstrap"],e):e(window.jQuery,window.loadImage)}(function(e,t){"use strict";e.extend(e.fn.modal.defaults,{delegate:document,selector:null,filter:"*",index:0,href:null,preloadRange:2,offsetWidth:100,offsetHeight:200,canvas:!1,slideshow:0,imageClickDivision:.5});var i=e.fn.modal.Constructor.prototype.show,n=e.fn.modal.Constructor.prototype.hide;e.extend(e.fn.modal.Constructor.prototype,{initLinks:function(){var t=this,i=this.options,n=i.selector||"a[data-target="+i.target+"]";this.$links=e(i.delegate).find(n).filter(i.filter).each(function(e){t.getUrl(this)===i.href&&(i.index=e)}),this.$links[i.index]||(i.index=0)},getUrl:function(t){return t.href||e(t).data("href")},getDownloadUrl:function(t){return e(t).data("download")},startSlideShow:function(){var e=this;this.options.slideshow&&(this._slideShow=window.setTimeout(function(){e.next()},this.options.slideshow))},stopSlideShow:function(){window.clearTimeout(this._slideShow)},toggleSlideShow:function(){var e=this.$element.find(".modal-slideshow");this.options.slideshow?(this.options.slideshow=0,this.stopSlideShow()):(this.options.slideshow=e.data("slideshow")||5e3,this.startSlideShow()),e.find("i").toggleClass("icon-play icon-pause")},preloadImages:function(){var t,i,n=this.options,a=n.index+n.preloadRange+1;for(i=n.index-n.preloadRange;a>i;i+=1)t=this.$links[i],t&&i!==n.index&&e("<img>").prop("src",this.getUrl(t))},loadImage:function(){var e,i=this,n=this.$element,a=this.options.index,r=this.getUrl(this.$links[a]),o=this.getDownloadUrl(this.$links[a]);this.abortLoad(),this.stopSlideShow(),n.trigger("beforeLoad"),this._loadingTimeout=window.setTimeout(function(){n.addClass("modal-loading")},100),e=n.find(".modal-image").children().removeClass("in"),window.setTimeout(function(){e.remove()},3e3),n.find(".modal-title").text(this.$links[a].title),n.find(".modal-download").prop("href",o||r),this._loadingImage=t(r,function(e){i.img=e,window.clearTimeout(i._loadingTimeout),n.removeClass("modal-loading"),n.trigger("load"),i.showImage(e),i.startSlideShow()},this._loadImageOptions),this.preloadImages()},showImage:function(t){var i,n,a=this.$element,r=e.support.transition&&a.hasClass("fade"),o=r?a.animate:a.css,s=a.find(".modal-image");s.css({width:t.width,height:t.height}),a.find(".modal-title").css({width:Math.max(t.width,380)}),r&&(i=a.clone().hide().appendTo(document.body)),e(window).width()>767?o.call(a.stop(),{"margin-top":-((i||a).outerHeight()/2),"margin-left":-((i||a).outerWidth()/2)}):a.css({top:(e(window).height()-(i||a).outerHeight())/2}),i&&i.remove(),s.append(t),n=t.offsetWidth,a.trigger("display"),r?a.is(":visible")?e(t).on(e.support.transition.end,function(i){i.target===t&&(e(t).off(e.support.transition.end),a.trigger("displayed"))}).addClass("in"):(e(t).addClass("in"),a.one("shown",function(){a.trigger("displayed")})):(e(t).addClass("in"),a.trigger("displayed"))},abortLoad:function(){this._loadingImage&&(this._loadingImage.onload=this._loadingImage.onerror=null),window.clearTimeout(this._loadingTimeout)},prev:function(){var e=this.options;e.index-=1,0>e.index&&(e.index=this.$links.length-1),this.loadImage()},next:function(){var e=this.options;e.index+=1,e.index>this.$links.length-1&&(e.index=0),this.loadImage()},keyHandler:function(e){switch(e.which){case 37:case 38:e.preventDefault(),this.prev();break;case 39:case 40:e.preventDefault(),this.next()}},wheelHandler:function(e){e.preventDefault(),e=e.originalEvent,this._wheelCounter=this._wheelCounter||0,this._wheelCounter+=e.wheelDelta||e.detail||0,e.wheelDelta&&this._wheelCounter>=120||!e.wheelDelta&&0>this._wheelCounter?(this.prev(),this._wheelCounter=0):(e.wheelDelta&&-120>=this._wheelCounter||!e.wheelDelta&&this._wheelCounter>0)&&(this.next(),this._wheelCounter=0)},initGalleryEvents:function(){var t=this,i=this.$element;i.find(".modal-image").on("click.modal-gallery",function(i){var n=e(this);1===t.$links.length?t.hide():(i.pageX-n.offset().left)/n.width()<t.options.imageClickDivision?t.prev(i):t.next(i)}),i.find(".modal-prev").on("click.modal-gallery",function(e){t.prev(e)}),i.find(".modal-next").on("click.modal-gallery",function(e){t.next(e)}),i.find(".modal-slideshow").on("click.modal-gallery",function(e){t.toggleSlideShow(e)}),e(document).on("keydown.modal-gallery",function(e){t.keyHandler(e)}).on("mousewheel.modal-gallery, DOMMouseScroll.modal-gallery",function(e){t.wheelHandler(e)})},destroyGalleryEvents:function(){var t=this.$element;this.abortLoad(),this.stopSlideShow(),t.find(".modal-image, .modal-prev, .modal-next, .modal-slideshow").off("click.modal-gallery"),e(document).off("keydown.modal-gallery").off("mousewheel.modal-gallery, DOMMouseScroll.modal-gallery")},show:function(){if(!this.isShown&&this.$element.hasClass("modal-gallery")){var t=this.$element,n=this.options,a=e(window).width(),r=e(window).height();t.hasClass("modal-fullscreen")?(this._loadImageOptions={maxWidth:a,maxHeight:r,canvas:n.canvas},t.hasClass("modal-fullscreen-stretch")&&(this._loadImageOptions.minWidth=a,this._loadImageOptions.minHeight=r)):this._loadImageOptions={maxWidth:a-n.offsetWidth,maxHeight:r-n.offsetHeight,canvas:n.canvas},a>767?t.css({"margin-top":-(t.outerHeight()/2),"margin-left":-(t.outerWidth()/2)}):t.css({top:(e(window).height()-t.outerHeight())/2}),this.initGalleryEvents(),this.initLinks(),this.$links.length&&(t.find(".modal-slideshow, .modal-prev, .modal-next").toggle(1!==this.$links.length),t.toggleClass("modal-single",1===this.$links.length),this.loadImage())}i.apply(this,arguments)},hide:function(){this.isShown&&this.$element.hasClass("modal-gallery")&&(this.options.delegate=document,this.options.href=null,this.destroyGalleryEvents()),n.apply(this,arguments)}}),e(function(){e(document.body).on("click.modal-gallery.data-api",'[data-toggle="modal-gallery"]',function(t){var i,n=e(this),a=n.data(),r=e(a.target),o=r.data("modal");o||(a=e.extend(r.data(),a)),a.selector||(a.selector="a[data-gallery=gallery]"),i=e(t.target).closest(a.selector),i.length&&r.length&&(t.preventDefault(),a.href=i.prop("href")||i.data("href"),a.delegate=i[0]!==this?this:document,o&&e.extend(o.options,a),r.modal(a))})})}),function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery"],e):e(window.jQuery)}(function(e){"use strict";var t=0;e.ajaxTransport("iframe",function(i){if(i.async&&("POST"===i.type||"GET"===i.type)){var n,a;return{send:function(r,o){n=e('<form style="display:none;"></form>'),n.attr("accept-charset",i.formAcceptCharset),a=e('<iframe src="javascript:false;" name="iframe-transport-'+(t+=1)+'"></iframe>').bind("load",function(){var t,r=e.isArray(i.paramName)?i.paramName:[i.paramName];a.unbind("load").bind("load",function(){var t;try{if(t=a.contents(),!t.length||!t[0].firstChild)throw Error()}catch(i){t=void 0}o(200,"success",{iframe:t}),e('<iframe src="javascript:false;"></iframe>').appendTo(n),n.remove()}),n.prop("target",a.prop("name")).prop("action",i.url).prop("method",i.type),i.formData&&e.each(i.formData,function(t,i){e('<input type="hidden"/>').prop("name",i.name).val(i.value).appendTo(n)}),i.fileInput&&i.fileInput.length&&"POST"===i.type&&(t=i.fileInput.clone(),i.fileInput.after(function(e){return t[e]}),i.paramName&&i.fileInput.each(function(t){e(this).prop("name",r[t]||i.paramName)}),n.append(i.fileInput).prop("enctype","multipart/form-data").prop("encoding","multipart/form-data")),n.submit(),t&&t.length&&i.fileInput.each(function(i,n){var a=e(t[i]);e(n).prop("name",a.prop("name")),a.replaceWith(n)})}),n.append(a).appendTo(document.body)},abort:function(){a&&a.unbind("load").prop("src","javascript".concat(":false;")),n&&n.remove()}}}}),e.ajaxSetup({converters:{"iframe text":function(t){return e(t[0].body).text()},"iframe json":function(t){return e.parseJSON(e(t[0].body).text())},"iframe html":function(t){return e(t[0].body).html()},"iframe script":function(t){return e.globalEval(e(t[0].body).text())}}})}),function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery","jquery.ui.widget"],e):e(window.jQuery)}(function(e){"use strict";e.support.xhrFileUpload=!(!window.XMLHttpRequestUpload||!window.FileReader),e.support.xhrFormDataFileUpload=!!window.FormData,e.widget("blueimp.fileupload",{options:{namespace:void 0,dropZone:e(document),pasteZone:e(document),fileInput:void 0,replaceFileInput:!0,paramName:void 0,singleFileUploads:!0,limitMultiFileUploads:void 0,sequentialUploads:!1,limitConcurrentUploads:void 0,forceIframeTransport:!1,redirect:void 0,redirectParamName:void 0,postMessage:void 0,multipart:!0,maxChunkSize:void 0,uploadedBytes:void 0,recalculateProgress:!0,progressInterval:100,bitrateInterval:500,formData:function(e){return e.serializeArray()},add:function(e,t){t.submit()},processData:!1,contentType:!1,cache:!1},_refreshOptionsList:["namespace","fileInput","dropZone","pasteZone","multipart","forceIframeTransport"],_BitrateTimer:function(){this.timestamp=+new Date,this.loaded=0,this.bitrate=0,this.getBitrate=function(e,t,i){var n=e-this.timestamp;return(!this.bitrate||!i||n>i)&&(this.bitrate=8*(t-this.loaded)*(1e3/n),this.loaded=t,this.timestamp=e),this.bitrate}},_isXHRUpload:function(t){return!t.forceIframeTransport&&(!t.multipart&&e.support.xhrFileUpload||e.support.xhrFormDataFileUpload)},_getFormData:function(t){var i;return"function"==typeof t.formData?t.formData(t.form):e.isArray(t.formData)?t.formData:t.formData?(i=[],e.each(t.formData,function(e,t){i.push({name:e,value:t})}),i):[]},_getTotal:function(t){var i=0;return e.each(t,function(e,t){i+=t.size||1}),i},_onProgress:function(e,t){if(e.lengthComputable){var i,n,a=+new Date;if(t._time&&t.progressInterval&&a-t._time<t.progressInterval&&e.loaded!==e.total)return;t._time=a,i=t.total||this._getTotal(t.files),n=parseInt(e.loaded/e.total*(t.chunkSize||i),10)+(t.uploadedBytes||0),this._loaded+=n-(t.loaded||t.uploadedBytes||0),t.lengthComputable=!0,t.loaded=n,t.total=i,t.bitrate=t._bitrateTimer.getBitrate(a,n,t.bitrateInterval),this._trigger("progress",e,t),this._trigger("progressall",e,{lengthComputable:!0,loaded:this._loaded,total:this._total,bitrate:this._bitrateTimer.getBitrate(a,this._loaded,t.bitrateInterval)})}},_initProgressListener:function(t){var i=this,n=t.xhr?t.xhr():e.ajaxSettings.xhr();n.upload&&(e(n.upload).bind("progress",function(e){var n=e.originalEvent;e.lengthComputable=n.lengthComputable,e.loaded=n.loaded,e.total=n.total,i._onProgress(e,t)}),t.xhr=function(){return n})},_initXHRData:function(t){var i,n=t.files[0],a=t.multipart||!e.support.xhrFileUpload,r=t.paramName[0];(!a||t.blob)&&(t.headers=e.extend(t.headers,{"X-File-Name":n.name,"X-File-Type":n.type,"X-File-Size":n.size}),t.blob?a||(t.contentType="application/octet-stream",t.data=t.blob):(t.contentType=n.type,t.data=n)),a&&e.support.xhrFormDataFileUpload&&(t.postMessage?(i=this._getFormData(t),t.blob?i.push({name:r,value:t.blob}):e.each(t.files,function(e,n){i.push({name:t.paramName[e]||r,value:n})})):(t.formData instanceof FormData?i=t.formData:(i=new FormData,e.each(this._getFormData(t),function(e,t){i.append(t.name,t.value)})),t.blob?i.append(r,t.blob,n.name):e.each(t.files,function(e,n){n instanceof Blob&&i.append(t.paramName[e]||r,n,n.name)})),t.data=i),t.blob=null},_initIframeSettings:function(t){t.dataType="iframe "+(t.dataType||""),t.formData=this._getFormData(t),t.redirect&&e("<a></a>").prop("href",t.url).prop("host")!==location.host&&t.formData.push({name:t.redirectParamName||"redirect",value:t.redirect})},_initDataSettings:function(e){this._isXHRUpload(e)?(this._chunkedUpload(e,!0)||(e.data||this._initXHRData(e),this._initProgressListener(e)),e.postMessage&&(e.dataType="postmessage "+(e.dataType||""))):this._initIframeSettings(e,"iframe")},_getParamName:function(t){var i=e(t.fileInput),n=t.paramName;return n?e.isArray(n)||(n=[n]):(n=[],i.each(function(){for(var t=e(this),i=t.prop("name")||"files[]",a=(t.prop("files")||[1]).length;a;)n.push(i),a-=1}),n.length||(n=[i.prop("name")||"files[]"])),n},_initFormSettings:function(t){t.form&&t.form.length||(t.form=e(t.fileInput.prop("form")),t.form.length||(t.form=e(this.options.fileInput.prop("form")))),t.paramName=this._getParamName(t),t.url||(t.url=t.form.prop("action")||location.href),t.type=(t.type||t.form.prop("method")||"").toUpperCase(),"POST"!==t.type&&"PUT"!==t.type&&(t.type="POST"),t.formAcceptCharset||(t.formAcceptCharset=t.form.attr("accept-charset"))},_getAJAXSettings:function(t){var i=e.extend({},this.options,t);return this._initFormSettings(i),this._initDataSettings(i),i},_enhancePromise:function(e){return e.success=e.done,e.error=e.fail,e.complete=e.always,e},_getXHRPromise:function(t,i,n){var a=e.Deferred(),r=a.promise();return i=i||this.options.context||r,t===!0?a.resolveWith(i,n):t===!1&&a.rejectWith(i,n),r.abort=a.promise,this._enhancePromise(r)},_chunkedUpload:function(t,i){var n,a,r,o,s=this,l=t.files[0],c=l.size,d=t.uploadedBytes=t.uploadedBytes||0,u=t.maxChunkSize||c,p=l.webkitSlice||l.mozSlice||l.slice;return this._isXHRUpload(t)&&p&&(d||c>u)&&!t.data?i?!0:d>=c?(l.error="uploadedBytes",this._getXHRPromise(!1,t.context,[null,"error",l.error])):(a=Math.ceil((c-d)/u),n=function(i){return i?n(i-=1).pipe(function(){var n=e.extend({},t);return n.blob=p.call(l,d+i*u,d+(i+1)*u),n.chunkIndex=i,n.chunksNumber=a,n.chunkSize=n.blob.size,s._initXHRData(n),s._initProgressListener(n),r=(e.ajax(n)||s._getXHRPromise(!1,n.context)).done(function(){n.loaded||s._onProgress(e.Event("progress",{lengthComputable:!0,loaded:n.chunkSize,total:n.chunkSize}),n),t.uploadedBytes=n.uploadedBytes+=n.chunkSize})}):s._getXHRPromise(!0,t.context)},o=n(a),o.abort=function(){return r.abort()},this._enhancePromise(o)):!1},_beforeSend:function(e,t){0===this._active&&(this._trigger("start"),this._bitrateTimer=new this._BitrateTimer),this._active+=1,this._loaded+=t.uploadedBytes||0,this._total+=this._getTotal(t.files)},_onDone:function(t,i,n,a){this._isXHRUpload(a)||this._onProgress(e.Event("progress",{lengthComputable:!0,loaded:1,total:1}),a),a.result=t,a.textStatus=i,a.jqXHR=n,this._trigger("done",null,a)},_onFail:function(e,t,i,n){"parsererror"===t&&(window.location="/Account/Logon"),n.jqXHR=e,n.textStatus=t,n.errorThrown=i,this._trigger("fail",null,n),n.recalculateProgress&&(this._loaded-=n.loaded||n.uploadedBytes||0,this._total-=n.total||this._getTotal(n.files))},_onAlways:function(e,t,i,n){this._active-=1,n.textStatus=t,i&&i.always?(n.jqXHR=i,n.result=e):(n.jqXHR=e,n.errorThrown=i),this._trigger("always",null,n),0===this._active&&(this._trigger("stop"),this._loaded=this._total=0,this._bitrateTimer=null)},_onSend:function(t,i){var n,a,r,o=this,s=o._getAJAXSettings(i),l=function(i,a){return o._sending+=1,s._bitrateTimer=new o._BitrateTimer,n=n||(i!==!1&&o._trigger("send",t,s)!==!1&&(o._chunkedUpload(s)||e.ajax(s))||o._getXHRPromise(!1,s.context,a)).done(function(e,t,i){o._onDone(e,t,i,s)}).fail(function(e,t,i){o._onFail(e,t,i,s)}).always(function(e,t,i){if(o._sending-=1,o._onAlways(e,t,i,s),s.limitConcurrentUploads&&s.limitConcurrentUploads>o._sending)for(var n,a=o._slots.shift();a;){if(n=a.state?"pending"===a.state():!a.isRejected()){a.resolve();break}a=o._slots.shift()}})};return this._beforeSend(t,s),this.options.sequentialUploads||this.options.limitConcurrentUploads&&this.options.limitConcurrentUploads<=this._sending?(this.options.limitConcurrentUploads>1?(a=e.Deferred(),this._slots.push(a),r=a.pipe(l)):r=this._sequence=this._sequence.pipe(l,l),r.abort=function(){var e=[void 0,"abort","abort"];return n?n.abort():(a&&a.rejectWith(r,e),l(!1,e))},this._enhancePromise(r)):l()},_onAdd:function(t,i){var n,a,r,o,s=this,l=!0,c=e.extend({},this.options,i),d=c.limitMultiFileUploads,u=this._getParamName(c);if((c.singleFileUploads||d)&&this._isXHRUpload(c))if(!c.singleFileUploads&&d)for(r=[],n=[],o=0;i.files.length>o;o+=d)r.push(i.files.slice(o,o+d)),a=u.slice(o,o+d),a.length||(a=u),n.push(a);else n=u;else r=[i.files],n=[u];return i.originalFiles=i.files,e.each(r||i.files,function(a,o){var c=e.extend({},i);return c.files=r?o:[o],c.paramName=n[a],c.submit=function(){return c.jqXHR=this.jqXHR=s._trigger("submit",t,this)!==!1&&s._onSend(t,this),this.jqXHR},l=s._trigger("add",t,c)}),l},_replaceFileInput:function(t){var i=t.clone(!0);e("<form></form>").append(i)[0].reset(),t.after(i).detach(),e.cleanData(t.unbind("remove")),this.options.fileInput=this.options.fileInput.map(function(e,n){return n===t[0]?i[0]:n}),t[0]===this.element[0]&&(this.element=i)},_handleFileTreeEntry:function(t,i){var n,a=this,r=e.Deferred(),o=function(e){e&&!e.entry&&(e.entry=t),r.resolve([e])};return i=i||"",t.isFile?t.file(function(e){e.relativePath=i,r.resolve(e)},o):t.isDirectory?(n=t.createReader(),n.readEntries(function(e){a._handleFileTreeEntries(e,i+t.name+"/").done(function(e){r.resolve(e)}).fail(o)},o)):r.resolve([]),r.promise()},_handleFileTreeEntries:function(t,i){var n=this;return e.when.apply(e,e.map(t,function(e){return n._handleFileTreeEntry(e,i)})).pipe(function(){return Array.prototype.concat.apply([],arguments)})},_getDroppedFiles:function(t){t=t||{};var i=t.items;return i&&i.length&&(i[0].webkitGetAsEntry||i[0].getAsEntry)?this._handleFileTreeEntries(e.map(i,function(e){return e.webkitGetAsEntry?e.webkitGetAsEntry():e.getAsEntry()})):e.Deferred().resolve(e.makeArray(t.files)).promise()},_getSingleFileInputFiles:function(t){t=e(t);var i,n,a=t.prop("webkitEntries")||t.prop("entries");if(a&&a.length)return this._handleFileTreeEntries(a);if(i=e.makeArray(t.prop("files")),!i.length){if(n=t.prop("value"),!n)return e.Deferred().resolve([]).promise();i=[{name:n.replace(/^.*\\/,"")}]}return e.Deferred().resolve(i).promise()},_getFileInputFiles:function(t){return t instanceof e&&1!==t.length?e.when.apply(e,e.map(t,this._getSingleFileInputFiles)).pipe(function(){return Array.prototype.concat.apply([],arguments)}):this._getSingleFileInputFiles(t)},_onChange:function(t){var i=t.data.fileupload,n={fileInput:e(t.target),form:e(t.target.form)};i._getFileInputFiles(n.fileInput).always(function(e){n.files=e,i.options.replaceFileInput&&i._replaceFileInput(n.fileInput),i._trigger("change",t,n)!==!1&&i._onAdd(t,n)})},_onPaste:function(t){var i=t.data.fileupload,n=t.originalEvent.clipboardData,a=n&&n.items||[],r={files:[]};return e.each(a,function(e,t){var i=t.getAsFile&&t.getAsFile();i&&r.files.push(i)}),i._trigger("paste",t,r)===!1||i._onAdd(t,r)===!1?!1:void 0},_onDrop:function(e){e.preventDefault();var t=e.data.fileupload,i=e.dataTransfer=e.originalEvent.dataTransfer,n={};t._getDroppedFiles(i).always(function(i){n.files=i,t._trigger("drop",e,n)!==!1&&t._onAdd(e,n)})},_onDragOver:function(e){var t=e.data.fileupload,i=e.dataTransfer=e.originalEvent.dataTransfer;return t._trigger("dragover",e)===!1?!1:(i&&(i.dropEffect="copy"),e.preventDefault(),void 0)},_initEventHandlers:function(){var e=this.options.namespace;this._isXHRUpload(this.options)&&(this.options.dropZone.bind("dragover."+e,{fileupload:this},this._onDragOver).bind("drop."+e,{fileupload:this},this._onDrop),this.options.pasteZone.bind("paste."+e,{fileupload:this},this._onPaste)),this.options.fileInput.bind("change."+e,{fileupload:this},this._onChange)},_destroyEventHandlers:function(){var e=this.options.namespace;this.options.dropZone.unbind("dragover."+e,this._onDragOver).unbind("drop."+e,this._onDrop),this.options.pasteZone.unbind("paste."+e,this._onPaste),this.options.fileInput.unbind("change."+e,this._onChange)},_setOption:function(t,i){var n=-1!==e.inArray(t,this._refreshOptionsList);n&&this._destroyEventHandlers(),e.Widget.prototype._setOption.call(this,t,i),n&&(this._initSpecialOptions(),this._initEventHandlers())},_initSpecialOptions:function(){var t=this.options;void 0===t.fileInput?t.fileInput=this.element.is('input[type="file"]')?this.element:this.element.find('input[type="file"]'):t.fileInput instanceof e||(t.fileInput=e(t.fileInput)),t.dropZone instanceof e||(t.dropZone=e(t.dropZone)),t.pasteZone instanceof e||(t.pasteZone=e(t.pasteZone))},_create:function(){var t=this.options;e.extend(t,e(this.element[0].cloneNode(!1)).data()),t.namespace=t.namespace||this.widgetName,this._initSpecialOptions(),this._slots=[],this._sequence=this._getXHRPromise(!0),this._sending=this._active=this._loaded=this._total=0,this._initEventHandlers()},destroy:function(){this._destroyEventHandlers(),e.Widget.prototype.destroy.call(this)},enable:function(){var t=!1;this.options.disabled&&(t=!0),e.Widget.prototype.enable.call(this),t&&this._initEventHandlers()},disable:function(){this.options.disabled||this._destroyEventHandlers(),e.Widget.prototype.disable.call(this)},add:function(t){var i=this;t&&!this.options.disabled&&(t.fileInput&&!t.files?this._getFileInputFiles(t.fileInput).always(function(e){t.files=e,i._onAdd(null,t)}):(t.files=e.makeArray(t.files),this._onAdd(null,t)))},send:function(t){if(t&&!this.options.disabled){if(t.fileInput&&!t.files){var i,n,a=this,r=e.Deferred(),o=r.promise();return o.abort=function(){return n=!0,i?i.abort():(r.reject(null,"abort","abort"),o)},this._getFileInputFiles(t.fileInput).always(function(e){n||(t.files=e,i=a._onSend(null,t).then(function(e,t,i){r.resolve(e,t,i)},function(e,t,i){r.reject(e,t,i)}))}),this._enhancePromise(o)}if(t.files=e.makeArray(t.files),t.files.length)return this._onSend(null,t)}return this._getXHRPromise(!1,t&&t.context)}})}),function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery","load-image","canvas-to-blob","./jquery.fileupload"],e):e(window.jQuery,window.loadImage)}(function(e,t){"use strict";e.widget("blueimpFP.fileupload",e.blueimp.fileupload,{options:{process:[],add:function(t,i){e(this).fileupload("process",i).done(function(){i.submit()})}},processActions:{load:function(i,n){var a=this,r=i.files[i.index],o=e.Deferred();return window.HTMLCanvasElement&&window.HTMLCanvasElement.prototype.toBlob&&("number"!==e.type(n.maxFileSize)||r.size<n.maxFileSize)&&(!n.fileTypes||n.fileTypes.test(r.type))?t(r,function(e){i.canvas=e,o.resolveWith(a,[i])},{canvas:!0}):o.rejectWith(a,[i]),o.promise()},resize:function(e,i){if(e.canvas){var n=t.scale(e.canvas,i);(n.width!==e.canvas.width||n.height!==e.canvas.height)&&(e.canvas=n,e.processed=!0)}return e},save:function(t){if(!t.canvas||!t.processed)return t;var i=this,n=t.files[t.index],a=n.name,r=e.Deferred(),o=function(e){e.name||(n.type===e.type?e.name=n.name:n.name&&(e.name=n.name.replace(/\..+$/,"."+e.type.substr(6)))),t.files[t.index]=e,r.resolveWith(i,[t])};return t.canvas.mozGetAsFile?o(t.canvas.mozGetAsFile(/^image\/(jpeg|png)$/.test(n.type)&&a||(a&&a.replace(/\..+$/,"")||"blob")+".png",n.type)):t.canvas.toBlob(o,n.type),r.promise()}},_processFile:function(t,i,n){var a=this,r=e.Deferred().resolveWith(a,[{files:t,index:i}]),o=r.promise();return a._processing+=1,e.each(n.process,function(e,t){o=o.pipe(function(e){return a.processActions[t.action].call(this,e,t)})}),o.always(function(){a._processing-=1,0===a._processing&&a.element.removeClass("fileupload-processing")}),1===a._processing&&a.element.addClass("fileupload-processing"),o},process:function(t){var i=this,n=e.extend({},this.options,t);return n.process&&n.process.length&&this._isXHRUpload(n)&&e.each(t.files,function(a){i._processingQueue=i._processingQueue.pipe(function(){var r=e.Deferred();return i._processFile(t.files,a,n).always(function(){r.resolveWith(i)}),r.promise()})}),this._processingQueue},_create:function(){e.blueimp.fileupload.prototype._create.call(this),this._processing=0,this._processingQueue=e.Deferred().resolveWith(this).promise()}})}),function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery","tmpl","load-image","./jquery.fileupload-fp"],e):e(window.jQuery,window.tmpl,window.loadImage)}(function(e,t,i){"use strict";var n=(e.blueimpFP||e.blueimp).fileupload;e.widget("blueimpUI.fileupload",n,{options:{autoUpload:!1,maxNumberOfFiles:void 0,maxFileSize:void 0,minFileSize:void 0,acceptFileTypes:/.+$/i,previewSourceFileTypes:/^image\/(gif|jpeg|png)$/,previewSourceMaxFileSize:5e6,previewMaxWidth:80,previewMaxHeight:80,previewAsCanvas:!0,uploadTemplateId:"template-upload",downloadTemplateId:"template-download",filesContainer:void 0,prependFiles:!1,dataType:"json",add:function(t,i){var n=e(this).data("fileupload"),a=n.options,r=i.files;e(this).fileupload("process",i).done(function(){n._adjustMaxNumberOfFiles(-r.length),i.maxNumberOfFilesAdjusted=!0,i.files.valid=i.isValidated=n._validate(r),i.context=n._renderUpload(r).data("data",i),a.filesContainer[a.prependFiles?"prepend":"append"](i.context),n._renderPreviews(r,i.context),n._forceReflow(i.context),n._transition(i.context).done(function(){n._trigger("added",t,i)!==!1&&(a.autoUpload||i.autoUpload)&&i.autoUpload!==!1&&i.isValidated&&i.submit()})})},send:function(t,i){var n=e(this).data("fileupload");return i.isValidated||(i.maxNumberOfFilesAdjusted||(n._adjustMaxNumberOfFiles(-i.files.length),i.maxNumberOfFilesAdjusted=!0),n._validate(i.files))?(i.context&&i.dataType&&"iframe"===i.dataType.substr(0,6)&&i.context.find(".progress").addClass(!e.support.transition&&"progress-animated").attr("aria-valuenow",100).find(".bar").css("width","100%"),n._trigger("sent",t,i)):!1},done:function(t,i){var n,a=e(this).data("fileupload");i.context?i.context.each(function(r){var o=e.isArray(i.result)&&i.result[r]||{error:"emptyResult"};o.error&&a._adjustMaxNumberOfFiles(1),a._transition(e(this)).done(function(){var r=e(this);n=a._renderDownload([o]).replaceAll(r),a._forceReflow(n),a._transition(n).done(function(){i.context=e(this),a._trigger("completed",t,i)})})}):(e.isArray(i.result)&&(e.each(i.result,function(e,t){i.maxNumberOfFilesAdjusted&&t.error?a._adjustMaxNumberOfFiles(1):i.maxNumberOfFilesAdjusted||t.error||a._adjustMaxNumberOfFiles(-1)}),i.maxNumberOfFilesAdjusted=!0),n=a._renderDownload(i.result).appendTo(a.options.filesContainer),a._forceReflow(n),a._transition(n).done(function(){i.context=e(this),a._trigger("completed",t,i)}))},fail:function(t,i){var n,a=e(this).data("fileupload");i.maxNumberOfFilesAdjusted&&a._adjustMaxNumberOfFiles(i.files.length),i.context?i.context.each(function(r){if("abort"!==i.errorThrown){var o=i.files[r];o.error=o.error||i.errorThrown||!0,a._transition(e(this)).done(function(){var r=e(this);n=a._renderDownload([o]).replaceAll(r),a._forceReflow(n),a._transition(n).done(function(){i.context=e(this),a._trigger("failed",t,i)})})}else a._transition(e(this)).done(function(){e(this).remove(),a._trigger("failed",t,i)})}):"abort"!==i.errorThrown?(i.context=a._renderUpload(i.files).appendTo(a.options.filesContainer).data("data",i),a._forceReflow(i.context),a._transition(i.context).done(function(){i.context=e(this),a._trigger("failed",t,i)})):a._trigger("failed",t,i)},progress:function(e,t){if(t.context){var i=parseInt(100*(t.loaded/t.total),10);t.context.find(".progress").attr("aria-valuenow",i).find(".bar").css("width",i+"%")}},progressall:function(t,i){var n=e(this),a=parseInt(100*(i.loaded/i.total),10),r=n.find(".fileupload-progress"),o=r.find(".progress-extended");o.length&&o.html(n.data("fileupload")._renderExtendedProgress(i)),r.find(".progress").attr("aria-valuenow",a).find(".bar").css("width",a+"%")},start:function(t){var i=e(this).data("fileupload");i._transition(e(this).find(".fileupload-progress")).done(function(){i._trigger("started",t)})},stop:function(t){var i=e(this).data("fileupload");i._transition(e(this).find(".fileupload-progress")).done(function(){e(this).find(".progress").attr("aria-valuenow","0").find(".bar").css("width","0%"),e(this).find(".progress-extended").html("&nbsp;"),i._trigger("stopped",t)})},destroy:function(t,i){var n=e(this).data("fileupload");i.url&&(e.ajax(i),n._adjustMaxNumberOfFiles(1)),n._transition(i.context).done(function(){e(this).remove(),n._trigger("destroyed",t,i)})}},_enableDragToDesktop:function(){var t=e(this),i=t.prop("href"),n=t.prop("download"),a="application/octet-stream";
t.bind("dragstart",function(e){try{e.originalEvent.dataTransfer.setData("DownloadURL",[a,n,i].join(":"))}catch(t){}})},_adjustMaxNumberOfFiles:function(e){"number"==typeof this.options.maxNumberOfFiles&&(this.options.maxNumberOfFiles+=e,1>this.options.maxNumberOfFiles?this._disableFileInputButton():this._enableFileInputButton())},_formatFileSize:function(e){return"number"!=typeof e?"":e>=1e9?(e/1e9).toFixed(2)+" GB":e>=1e6?(e/1e6).toFixed(2)+" MB":(e/1e3).toFixed(2)+" KB"},_formatBitrate:function(e){return"number"!=typeof e?"":e>=1e9?(e/1e9).toFixed(2)+" Gbit/s":e>=1e6?(e/1e6).toFixed(2)+" Mbit/s":e>=1e3?(e/1e3).toFixed(2)+" kbit/s":e+" bit/s"},_formatTime:function(e){var t=new Date(1e3*e),i=parseInt(e/86400,10);return i=i?i+"d ":"",i+("0"+t.getUTCHours()).slice(-2)+":"+("0"+t.getUTCMinutes()).slice(-2)+":"+("0"+t.getUTCSeconds()).slice(-2)},_formatPercentage:function(e){return(100*e).toFixed(2)+" %"},_renderExtendedProgress:function(e){return this._formatBitrate(e.bitrate)+" | "+this._formatTime(8*(e.total-e.loaded)/e.bitrate)+" | "+this._formatPercentage(e.loaded/e.total)+" | "+this._formatFileSize(e.loaded)+" / "+this._formatFileSize(e.total)},_hasError:function(e){return e.error?e.error:0>this.options.maxNumberOfFiles?"maxNumberOfFiles":this.options.acceptFileTypes.test(e.type)||this.options.acceptFileTypes.test(e.name)?this.options.maxFileSize&&e.size>this.options.maxFileSize?"maxFileSize":"number"==typeof e.size&&e.size<this.options.minFileSize?"minFileSize":null:"acceptFileTypes"},_validate:function(t){var i=this,n=!!t.length;return e.each(t,function(e,t){t.error=i._hasError(t),t.error&&(n=!1)}),n},_renderTemplate:function(t,i){if(!t)return e();var n=t({files:i,formatFileSize:this._formatFileSize,options:this.options});return n instanceof e?n:e(this.options.templatesContainer).html(n).children()},_renderPreview:function(t,n){var a=this,r=this.options,o=e.Deferred();return(i&&i(t,function(t){n.append(t),a._forceReflow(n),a._transition(n).done(function(){o.resolveWith(n)}),e.contains(document.body,n[0])||o.resolveWith(n)},{maxWidth:r.previewMaxWidth,maxHeight:r.previewMaxHeight,canvas:r.previewAsCanvas})||o.resolveWith(n))&&o},_renderPreviews:function(t,i){var n=this,a=this.options;return i.find(".preview span").each(function(i,r){var o=t[i];a.previewSourceFileTypes.test(o.type)&&("number"!==e.type(a.previewSourceMaxFileSize)||o.size<a.previewSourceMaxFileSize)&&(n._processingQueue=n._processingQueue.pipe(function(){var t=e.Deferred();return n._renderPreview(o,e(r)).done(function(){t.resolveWith(n)}),t.promise()}))}),this._processingQueue},_renderUpload:function(e){return this._renderTemplate(this.options.uploadTemplate,e)},_renderDownload:function(e){return this._renderTemplate(this.options.downloadTemplate,e).find("a[download]").each(this._enableDragToDesktop).end()},_startHandler:function(t){t.preventDefault();var i=e(this),n=i.closest(".template-upload"),a=n.data("data");a&&a.submit&&!a.jqXHR&&a.submit()&&i.prop("disabled",!0)},_cancelHandler:function(t){t.preventDefault();var i=e(this).closest(".template-upload"),n=i.data("data")||{};n.jqXHR?n.jqXHR.abort():(n.errorThrown="abort",t.data.fileupload._trigger("fail",t,n))},_deleteHandler:function(t){t.preventDefault();var i=e(this);t.data.fileupload._trigger("destroy",t,{context:i.closest(".template-download"),url:i.attr("data-url"),type:i.attr("data-type")||"DELETE",dataType:t.data.fileupload.options.dataType})},_forceReflow:function(t){return e.support.transition&&t.length&&t[0].offsetWidth},_transition:function(t){var i=e.Deferred();return e.support.transition&&t.hasClass("fade")?t.bind(e.support.transition.end,function(n){n.target===t[0]&&(t.unbind(e.support.transition.end),i.resolveWith(t))}).toggleClass("in"):(t.toggleClass("in"),i.resolveWith(t)),i},_initButtonBarEventHandlers:function(){var t=this.element.find(".fileupload-buttonbar"),i=this.options.filesContainer,n=this.options.namespace;t.find(".start").bind("click."+n,function(e){e.preventDefault(),i.find(".start button").click()}),t.find(".cancel").bind("click."+n,function(e){e.preventDefault(),i.find(".cancel button").click()}),t.find(".delete").bind("click."+n,function(e){e.preventDefault(),i.find(".delete input:checked").siblings("button").click(),t.find(".toggle").prop("checked",!1)}),t.find(".toggle").bind("change."+n,function(){i.find(".delete input").prop("checked",e(this).is(":checked"))})},_destroyButtonBarEventHandlers:function(){this.element.find(".fileupload-buttonbar button").unbind("click."+this.options.namespace),this.element.find(".fileupload-buttonbar .toggle").unbind("change."+this.options.namespace)},_initEventHandlers:function(){n.prototype._initEventHandlers.call(this);var e={fileupload:this};this.options.filesContainer.delegate(".start button","click."+this.options.namespace,e,this._startHandler).delegate(".cancel button","click."+this.options.namespace,e,this._cancelHandler).delegate(".delete button","click."+this.options.namespace,e,this._deleteHandler),this._initButtonBarEventHandlers()},_destroyEventHandlers:function(){var e=this.options;this._destroyButtonBarEventHandlers(),e.filesContainer.undelegate(".start button","click."+e.namespace).undelegate(".cancel button","click."+e.namespace).undelegate(".delete button","click."+e.namespace),n.prototype._destroyEventHandlers.call(this)},_enableFileInputButton:function(){this.element.find(".fileinput-button input").prop("disabled",!1).parent().removeClass("disabled")},_disableFileInputButton:function(){this.element.find(".fileinput-button input").prop("disabled",!0).parent().addClass("disabled")},_initTemplates:function(){var e=this.options;e.templatesContainer=document.createElement(e.filesContainer.prop("nodeName")),t&&(e.uploadTemplateId&&(e.uploadTemplate=t(e.uploadTemplateId)),e.downloadTemplateId&&(e.downloadTemplate=t(e.downloadTemplateId)))},_initFilesContainer:function(){var t=this.options;void 0===t.filesContainer?t.filesContainer=this.element.find(".files"):t.filesContainer instanceof e||(t.filesContainer=e(t.filesContainer))},_stringToRegExp:function(e){var t=e.split("/"),i=t.pop();return t.shift(),RegExp(t.join("/"),i)},_initRegExpOptions:function(){var t=this.options;"string"===e.type(t.acceptFileTypes)&&(t.acceptFileTypes=this._stringToRegExp(t.acceptFileTypes)),"string"===e.type(t.previewSourceFileTypes)&&(t.previewSourceFileTypes=this._stringToRegExp(t.previewSourceFileTypes))},_initSpecialOptions:function(){n.prototype._initSpecialOptions.call(this),this._initFilesContainer(),this._initTemplates(),this._initRegExpOptions()},_create:function(){n.prototype._create.call(this),this._refreshOptionsList.push("filesContainer","uploadTemplateId","downloadTemplateId"),e.blueimpFP||(this._processingQueue=e.Deferred().resolveWith(this).promise(),this.process=function(){return this._processingQueue})},enable:function(){var e=!1;this.options.disabled&&(e=!0),n.prototype.enable.call(this),e&&(this.element.find("input, button").prop("disabled",!1),this._enableFileInputButton())},disable:function(){this.options.disabled||(this.element.find("input, button").prop("disabled",!0),this._disableFileInputButton()),n.prototype.disable.call(this)}})}),App=Em.Application.create(),App.ApplicationController=Em.Controller.extend(),App.ApplicationView=Em.View.extend({templateName:"tmpApplication"}),App.HidePreviousWindow=Ember.Mixin.create({init:function(){this._super(),$(this.previuosWindow).hide().parent().spinner({position:"center",img:"spinnerBig.gif"}),$(this.thisWindow).show()},didInsertElement:function(){this._super(),$("body").find("img.spinner").remove()},goBack:function(){$(this.thisWindow).hide().parent().spinner({position:"center",img:"spinnerBig.gif"}),$(this.previuosWindow).show(),$("body").find("img.spinner").remove()}}),App.NavbarController=Em.Controller.extend({currentState:null,fnSetNewTab:function(e){var t=this,i=this.get("currentState");i?($("#ulMainMenu a.selected").removeClass("selected").addClass("notactive"),"tabEmpty"===t.get("currentOutlet")&&$("tabEmpty").empty(),$("body").find("div.validity-tooltip").remove()):t.set("currentOutlet","tabAccidents"),oDATA.GET("userData")||oDATA.fnLoadMain();var n=function(e,t,i){Em.run.next({outlet:e,viewIx:t},function(){var e=$("#"+this.outlet);e.removeClass("hidden"),i?e.addClass("transparent"):e.removeClass("transparent"),this.viewIx>-1&&$("#ulMainMenu a:eq("+this.viewIx+")").removeClass("notactive").addClass("selected")})};return $("#"+t.get("currentOutlet")).addClass("hidden"),e.newOutlet||(e.newOutlet=e.newState),t.currentState||e.newOutlet===e.newState?(t.set("currentState",e.newState).set("currentOutlet",e.newOutlet),console.log("fnSetNewTab1:"+e.newOutlet+";"+e.viewIx),n(e.newOutlet,e.viewIx,e.transparent),!0):(e.newOutlet="tabEmpty"===e.newOutlet?"tabAccidents":e.newOutlet,t.set("currentState",e.newOutlet).set("currentOutlet",e.newOutlet),App.router.transitionTo(e.newOutlet),console.log("fnSetNewTab2:"+e.newOutlet+";"+e.viewIx),n("",e.iewIx,e.transparent),!1)}}),MY.NavbarController=App.NavbarController.create(),App.NavbarView=Em.View.extend({templateName:"tmpNavbar"}),App.mainMenuView=Em.View.extend({didInsertElement:function(){return"number"!=typeof this.get("viewIx")?!1:($("#ulMainMenu a.selected").removeClass("selected").addClass("notactive"),$("#ulMainMenu a:eq("+this.get("viewIx")+")").removeClass("notactive").addClass("selected ui-corner-top"),void 0)}}),function(){var e=window,t=e.jQuery,i=e.App,n=e.Em;t.widget("ui.UploadFiles",{options:{uploadTemplateId:"tmp2templateUpload",downloadTemplateId:"tmp2templateDownload",formTemplate:"tmpUploadForm",showPhoto:!0,docsController:"treeDocController",url:"Files/Start",fileuploaddone:function(){return console.log("opa")},categoryOpts:{editList:!0},ListType:"List",Source:"tblDocTypes",iVal:"iD",iText:["name"]},_create:function(){var e;return e="",n.View.create({templateName:this.options.formTemplate,showPhoto:this.options.showPhoto}).appendTo(this.element),n.run.next(this,function(){return e=this.element.find("form").data("opts",this.options),e.fileupload(this.options)}),n.run.next(this,function(){return e.bind("fileuploadadded",function(e,t){var i,n,a;return a=t.context,t.form.find(".submitButtons").removeClass("hidden"),i=a.find("input[name='category[]']"),n=t.form.data("opts"),(t.paramName="docs[]")?i.ComboBoxCategory(n):console.log("paveikslai")}).bind("fileuploadadd",function(e,t){var i;return t.files[0].paramName=t.paramName,i=t.files[0].name.split(".").pop().substring(0,3),t.files[0].extension="xls"===i||"doc"===i||"pdf"===i?i:"unknown",t.files[0].type2=t.files[0].type.split("/")[0]}).bind("fileuploadsubmit",function(e,t){var i,n,a,r,o,s,l,c,d;return d=t.context,o=t.files[0],s=t.form.data("opts"),l=s.categoryOpts.accident,r=d.find("input[name='category[]']"),i=l?l.iD:null,a=r.data("refID"),a=a?a:i,r.length?(n=r.data("categoryID"),n=n?n:5):n=1,s.requireCategory&&"number"!=typeof r.data("newval")?(oGLOBAL.notify.withIcon("Ne visi dokumentai išsaugoti","Dokumentas '"+t.files[0].name+"'  neturi priskirtos kategorijos..","img32-warning",!0),!1):(t.formData={FileName:o.name,FileSize:o.size,DocTypeID:r.data("newval"),RefID:a,GroupID:n,Description:d.find("textarea[name='description[]']").val(),AccidentID:i},c=s.lastUpload?oDATA.GET("tblDocGroup").emData.findProperty("iD",s.lastUpload.GroupID).ref:{},5===t.formData.GroupID?s.lastUpload=t.formData:5!==c&&2!==c?s.lastUpload=t.formData:void 0)}).bind("fileuploaddone",function(e,a){var r,o,s,l,c,d,u,p,f,m,h,g;return a.result.success?(console.log("Upload result for file '"+a.files[0].name+"':"),console.log(a.result),d=n.Object.create(a.result.tblDoc),oDATA.GET("tblDocs").emData.pushObject(d),p=oDATA.GET("tblDocGroup").emData.findProperty("iD",d.groupID).ref,3===p?(l=oDATA.GET("proc_Drivers").emData.findProperty("iD",d.refID),r=parseInt(l.docs.slice(1,-1),10),isNaN(r)&&(r=0),r++,s="("+r+")",l.set("docs",s),f=oDATA.GET("proc_topDrivers"),f&&(c=f.emData.findProperty("iD",d.refID),c&&c.set("docs",s))):4===p&&(h=oDATA.GET("proc_Vehicles").emData.findProperty("iD",d.refID),r=parseInt(h.docs.slice(1,-1),10),isNaN(r)&&(r=0),r++,s="("+r+")",h.set("docs",s),m=oDATA.GET("proc_topVehicles"),m&&(g=m.emData.findProperty("iD",d.refID),g&&g.set("docs",s))),a.context.remove(),!a.form.find("table tbody tr").length&&(a.form.find(".submitButtons, table").addClass("hidden"),u=a.form.data("opts"),o=u.docsController,i[o].refreshDocs(),u.lastUpload.AccidentID)?(i.docsTypesController.refreshTree(),n.run.next({opts:u},function(){var e,i,n;return i=this.opts.lastUpload,p=oDATA.GET("tblDocGroup").emData.findProperty("iD",i.GroupID).ref,e=i.DocTypeID,n=t("#dynamicTree>div>ul").children("li[data-category-id='"+i.GroupID+"']"),4===p&&(n=n.find("ul").children("li.isGroup[data-ref-id='"+i.RefID+"']")),this.opts.lastUpload=null,n.trigger("click")})):void 0):console.warn("upload error")}).find(".fileinput-button").on("click",function(){return t(this).closest("form").find("table").removeClass("hidden").end().find("a.cancel").on("click",function(){return t(this).closest("form").find(".submitButtons, table").addClass("hidden"),t(this).closest("form").find("table tbody tr").remove()})})})}}),i.editDocsController=n.Object.create({getOpts:function(e){var t;return t=e.closest("ul").parent().find("form"),t.length||(t=e.closest("ul").closest("table").parent().parent().find("form:first")),t.data("opts")},editDoc:function(e){var i;return i=t(e.target).parent().parent(),i.addClass("docs-selected"),e.context.set("editMode",!0),n.run.next(this,function(){return i.find("input.docType").ComboBoxCategory(this.getOpts(i))})},cancelSaveDoc:function(e){var i;return i=t(e.target).parent().parent().find("input.docType"),t(".docs-selected").removeClass("docs-selected"),i.autocomplete("destroy").removeData("autocomplete"),e.context.set("editMode",!1)},SaveEditedDoc:function(e){var n,a,r,o,s,l,c,d,u;return u=t(e.target).parent().parent(),r=u.find("input.description").val(),l=u.find("input.docType").data("newval"),a=i[this.getOpts(u).docsController],c=u.find("input.docType").val(),n=e.context,s=n.docID,o=oDATA.GET("tblDocs").emData.findProperty("iD",s),l=l?l:o.docTypeID,d=oDATA.GET("tblDocTypes").emData.findProperty("iD",l).docGroupID,SERVER.update2({Action:"Edit",Ctrl:u,source:"tblDocs",row:o,DataToSave:{id:s,Data:[d,l,r],Fields:["groupID","docTypeID","description"],DataTable:"tblDocs"},CallBackAfter:function(){return a.refreshDocs(),t(".docs-selected").removeClass("docs-selected")}})},deleteDoc:function(e){var n,a,r;return r=t(e.target).parent().parent(),n=e.context,a=i[this.getOpts(r).docsController],oCONTROLS.dialog.Confirm({title:"Dokumento pašalinimas",msg:"Ištrinti dokumentą '"+n.docName+"'?"},function(){return SERVER.update2({Action:"Delete",Ctrl:r,source:"tblDocs",DataToSave:{id:n.docID,DataTable:"tblDocs"},Msg:{Title:"Duokumento pašalinimas",Success:"Dokumentas '"+n.docName+"' pašalintas.",Error:"Nepavyko pašalinti dokumento '"+n.docName+"'."},CallBackAfter:function(){return a.refreshDocs(),t(".docs-selected").removeClass("docs-selected")}})})}})}.call(this),Handlebars.registerHelper("highlight",function(e){var t=Ember.getPath(this,e);return new Handlebars.SafeString('<span class="highlight">'+t+"</span>")}),Handlebars.registerHelper("checkOut_trinti",function(e){var t=Ember.getPath(this,e);return new Handlebars.SafeString('<span class="highlight">'+t+"</span>")}),Handlebars.registerHelper("currency",function(e){var t=Ember.getPath(this,e)+"",i=t.length-3;return i>0&&(t=t.slice(0,i)+"."+t.slice(i)),t+=" "+App.accidentsController.currency,new Handlebars.SafeString(t)}),Handlebars.registerHelper("updatableField",function(e,t){e||console.error("No prop");var i=e,n=t.hash,a=this[i];!a&&this.content&&(a=this.content[0][i]),a||(a=""),"string"==typeof a&&(a=a.replace(/'/g,"\\&quot;").replace(/"/g,"\\&quot;")),n.classes?n.classes:"";var r=n.style?"style='"+n.style+"'":"",o=n.id;o=o?'"id":"'+o+'",':"";var s=n.labelType;s=s?'"labelType":"'+s+'",':"";var l=n.sTitle;l=l?'"sTitle":"'+l+'",':"";var c=n.attr;c=c?'"attr":"'+c+'",':"";var d=n.List;d=d?'"List":'+d+",":"";var u=n.Editable;u=u?'"Editable":'+u+",":"";var p=" class='ExtendIt "+(n.classes?n.classes:"")+"' "+r+' data-ctrl=\'{"Value":"'+a+'","Field":"'+i.firstBig()+'","classes":"UpdateField",'+o+s+l+c+d+u;return","===p.charAt(p.length-1)&&(p=p.slice(0,-1)),p=n.tag?"<"+n.tag+p+"}'></"+n.tag+">":"<div"+p+"}'></div>",new Handlebars.SafeString(p)}),Handlebars.registerHelper("eachArr",function(e,t){for(var i="",n=0,a=e.length;a>n;n++)i+=t(e[n]);return i}),Handlebars.registerHelper("each11",function(e,t){for(var i="",n=0,a=e.length;a>n;n++)i+=t.fn(e[n]);return i}),Handlebars.registerHelper("compare",function(e,t,i,n){var a,r,o=this;if(3>arguments.length)throw Error("Handlerbars Helper 'compare' needs 2 parameters");return void 0===n&&(n=i,i=t,t="==="),getVal=function(e){if(!isNaN(e))return parseInt(e,10);var t=e.split("."),i=o;return t.forEach(function(e){i=i[e]}),i},e=getVal(e),i=getVal(i),a={"==":function(e,t){return e==t},"===":function(e,t){return e===t},"!=":function(e,t){return e!=t},"!==":function(e,t){return e!==t},"<":function(e,t){return t>e},">":function(e,t){return e>t},"<=":function(e,t){return t>=e},">=":function(e,t){return e>=t},"typeof":function(e,t){return typeof e==t}},a[t]||console.error("No such operator "+t),r=a[t](e,i),r?n.fn(this):n.inverse(this)}),App.SearchField=Ember.View.extend({context:null,tagName:"",template:Em.Handlebars.compile('<form class="topSearchForm" onsubmit="return false;" ><input  {{action "valueDidChange" on="keyUp" target="parentView"}} type="text" class="searchField" placeholder="Ieškoti.."/><div class="divSearch"><span {{action "clear" target="parentView"}} class="spanToClearText"><img src="Content/images/icon-cancel.png"></span></div></form>'),clear:function(e){$(e.target).closest("form").find("input").val(""),this.get("valueDidChange").call(this,"")},valueDidChange:function(e){if(13===(e.keyCode||e.which))return!1;var t=e?$(e.target).val():"";if(this.get("context"),controller=this.get("controller")){var i=App[controller].filterValue,n=i?i.length:0,a=t?t.length:0,r=n>a?!0:!1;App[controller].set("filterReduced",r).set("filterValue",t.toLowerCase())}}}),App.FormBottomView=Em.View.extend({init:function(){var e=["deleteForm","saveForm","cancelForm"];target=this.get("target"),targetObj=Ember.getPath(target),targetObj||console.error("no target");var t=function(t,n){if("function"==typeof t){var a=function(e){t.call(n,e)};this.set(e[i],a)}else console.warn("No target for "+e[i])};for(thisContext=Em.get(target),i=0;e.length>i;i++)t.call(this,targetObj[e[i]],thisContext);this._super()},templateName:"tmpFormBottom"}),function(){var e,t,i=window,n=i.App,a=i.Em,r=i.oGLOBAL,o=i.oDATA,s=i.oCONTROLS,l=i.MY;n.tabAccidentsView=n.mainMenuView.extend({content:null,viewIx:0,templateName:"tmpAccidentsMain",didInsertElement:function(){}}),n.AccidentView=a.View.extend({templateName:"tmpAccidentRow",tagName:""}),n.SelectedAccidentView=a.View.extend({templateName:"tmpAccident_Claims",init:function(){var e,t,i,a,r=[],o=[];if(console.log("init selected accident"),this._super(),e=this.get("claims_C").replace(RegExp("{{(.*?)}}","gm"),"").split("#||"),t=this.get("claims_C2").split("#||"),""!==e[0])for(a=e.length-1,i=-1;a>i++;)r[i]={Claims:e[i].split("#|"),Claims2:t[i].split("#|")},o[i]={finished:"2"===e[i][0]?!0:!1,no:r[i].Claims[1],type:r[i].Claims[2],autoNo:r[i].Claims[3],insurer:r[i].Claims[4],loss:r[i].Claims[5],Claims2:r[i].Claims2,accidentID:this.get("iD"),accidentDate:this.date};return n.thisAccidentController.set("content",o),n.thisAccidentController.set("accidentID",this.get("iD"))},tbodyClick:function(e){var t,i,r;return r=$(e.target).closest("tr"),t=$("#ClaimWraper"),t.length>0&&(l.tabAccidents.SelectedClaimView.remove(),t.remove()),r.parent().find("tr.selectedClaim").removeClass("selectedClaim title"),i=e.context,l.tabAccidents.SelectedClaimView=n.SelectedClaimView.create({rowContext:{Claims2:i.Claims2,newClaim:!1,LossAmount:i.loss,InsuranceType:i.type,accidentID:i.accidentID,accidentDate:i.accidentDate},elementId:"ClaimDetailsContent",contentBinding:"App.claimEditController.content"}),r.addClass("selectedClaim title").after("<tr><td id='ClaimWraper' colspan='7' class='selectedClaim content'></td></tr>"),l.tabAccidents.SelectedClaimView.appendTo("#ClaimWraper"),a.run.next(function(){return $("#ClaimDetailsContent").slideDown()}),!1},newClaim:function(e){var t,i,r;return r=$(e.target).closest("div.tr"),$(e.target).closest("div.rightFooterBig").hide(),r.append('<div id=\'divNewClaimCard\' data-ctrl=\'{"id":"0","NewRec":"1","Source":"tblClaims","ClaimTypeID":"0"}\'></div>'),i=function(){return $("#divNewClaimCard").remove(),$("#AccDetailsContent").find("div.rightFooterBig").show()},t={ctrl:$("#divNewClaimCard"),oDATA:o.GET("tblClaimTypes"),opt:{val:"iD",text:"name",FieldName:"ClaimTypeID",SelectText:"Pasirinkite žalos tipą:"},fnAfterOptClick:function(){return $("#divNewClaimCard").find("#divNewClaimCard_Content,div.frmbottom").remove(),l.tabAccidents.NewClaimView&&(l.tabAccidents.NewClaimView.remove(),$("#newClaimDetailsContent").remove()),l.tabAccidents.NewClaimView=n.SelectedClaimView.create({rowContext:{newClaim:!0,accidentID:n.thisAccidentController.get("accidentID")},elementId:"newClaimDetailsContent",contentBinding:"App.newClaimController.content"}),l.tabAccidents.NewClaimView.appendTo("#divNewClaimCard"),a.run.next(function(){return $("#newClaimDetailsContent").slideDown()}),{fnCancel:function(){return i()}}},fnCancel:function(){return i()}},s.Set_Updatable_HTML.mega_select_list(t),!1},elementId:"AccDetailsContent",contentBinding:"App.thisAccidentController.content",destroyElement:function(){return l.tabAccidents.SelectedClaimView?l.tabAccidents.SelectedClaimView.remove():void 0}}),n.SelectedClaimView=a.View.extend({didInsertElement:function(){var e,t,i,n,a,r,o,l;return i=this.content[0],r=i.newClaim?"#divNewClaimCard":"#divClaimCard_Content",t=i.newClaim?$(r).find("button.btnSave"):$(r).next().find("button.btnSave"),s.UpdatableForm({frm:r,btnSaveToDisable:t}),2===i.typeID&&(e=$("#InsuranceClaimAmount").parent().parent(),e.find("span").html("Žalos suma asmeniui"),$("#LossAmount").parent().find("span").html("Žalos suma turtui"),a=function(){return this.attr("checked")?e.css("display","block").find("input").data("ctrl").Validity=e.find("input").data("ctrl").Validity.replace("require().",""):e.css("display","none").find("input").val("").data("ctrl").Validity="require()."+e.find("input").data("ctrl").Validity},a.call($("#IsInjuredPersons")),$("#IsInjuredPersons").on("click",function(){return a.call($("#IsInjuredPersons"))})),6===i.typeID?(o=$(r).find(".inputSum input"),n=$(r).find(".days input"),l=$(r).find(".perDay input"),$(r).find(".days input,.perDay input").on("keyup",function(){return o.val(n.val()*l.val())})):void 0},init:function(){var e,t,i,r;return this._super(),r=this.get("rowContext"),r.newClaim?(i=$("#divNewClaimCard").data("ctrl").ClaimTypeID,t=a.Object.create({iD:0,vehicleID:"",insPolicyID:"",insuranceClaimAmount:0,insurerClaimID:"",isTotalLoss:0,isInjuredPersons:0,days:5,perDay:500,lossAmount:6===i?2500:0,newClaim:!0,typeID:i}),n.newClaimController.set("content",[t])):(e=r.Claims2,i=o.GET("tblClaimTypes").emData.findProperty("name",r.InsuranceType).iD,t=a.Object.create({iD:e[0],vehicleID:e[1],insPolicyID:e[2],insuranceClaimAmount:e[3],insurerClaimID:e[4].slice(1).slice(0,-1),isTotalLoss:e[5],isInjuredPersons:parseInt(e[6],10),days:e[7],perDay:e[8],lossAmount:r.LossAmount,newClaim:!1,typeID:i,deleteButton:!0}),n.claimEditController.set("content",[t])),console.log("init Claim.Type - "+i)},templateName:"tmpClaimEdit"}),n.claimEditController=a.Controller.create({deleteForm:function(e){var t,i;return i=o.GET("tblClaims"),t=e.view._parentView.templateData.view.rowContext,console.log("Žalos ID: "+t.Claims2[0]),s.dialog.Confirm({title:"",msg:"Ištrinti pasirinktą žalą?"},function(){return SERVER.update({Action:"Delete",DataToSave:{id:t.Claims2[0],DataTable:i.Config.tblUpdate,Ext:t.accidentID},Msg:{Title:"Duomenų ištrynimas",Success:"Pasirinkta žala buvo pašalinta.",Error:"Nepavyko pašalinti šios žalos"},CallBack:{Success:function(e,t){var a;return a=e.ResponseMsg.Ext.replace(/#\|#\|/g,":::").split("|#|"),a[13]=a[13].replace(/:::/g,"#|#|"),n.accidentsController.get("setNewVal").call(n.accidentsController,{newVal:a,toAppend:!1,fieldsToInt:[0,1,5,6,7,8]})[0],i.Data.removeRowByID(parseInt(t.DataToSave.id,10)),$("#accidentsTable").find("div.selectedAccident").trigger("click")}}})})},saveForm:function(e){var t,i,a,r,o,l,c;return l=e.view._context.newClaim,r=e.view._parentView.templateData.view.rowContext.accidentID,l?(o=$("#divNewClaimCard"),t="Add",a={Title:"Naujos žalos sukūrimas",Success:"Nauja žala sukurta.",Error:"Nepavyko išsaugot naujos žalos."}):(o=$("#divClaimCard_Content"),t="Edit",a={Title:"Žalos redagavimas",Success:"Žalos duomenys pakeisti.",Error:"Nepavyko pakeisti žalos duomenų."}),i=s.ValidateForm(o),i?(l&&(i.Fields.push("ClaimTypeID"),i.Data.push(e.view._context.typeID),i.Fields.push("AccidentID"),i.Data.push(r)),i.Ext=r,c={Action:t,DataToSave:i,CallBack:{Success:function(e){var t,i;return t=e.ResponseMsg.Ext.replace(/#\|#\|/g,":::").split("|#|"),t[13]=t[13].replace(/:::/g,"#|#|"),n.accidentsController.get("setNewVal").call(n.accidentsController,{newVal:t,toAppend:!1,fieldsToInt:[0,1,5,6,7,8]})[0],i=$("#accidentsTable").find("div.selectedAccident"),i.trigger("click").trigger("click")}},Msg:a},SERVER.update(c)):void 0},cancelForm:function(e){var t,i;return t=$(e.target),i=t.closest("tr"),i.find("td.selectedClaim").length?(l.tabAccidents.SelectedClaimView.remove(),i.parent().find("tr.selectedClaim").removeClass("selectedClaim title").next("tr").remove()):(l.tabAccidents.NewClaimView&&l.tabAccidents.NewClaimView.remove(),$("#divNewClaimCard").remove(),$("#AccDetailsContent").find("div.rightFooterBig").show())}}),n.accidentsController=a.ResourceController.create({url:"Accident/AccidentsList",tableName:"proc_Accidents",currency:"Lt",animationSpeedEnd:400,animationSpeedStart:400,setAnimationSpeed:function(e){var t,i;return t=parseInt($(e.target).val(),10),i="start"===$(e.target).data("action")?"animationSpeedStart":"animationSpeedEnd",$.isNumeric(t)?this.set(i,t):alert("turi būti skaičius")},removeClaims:function(e,t,i,a){var r,o;return $("div.validity-tooltip").remove(),r=e.parent().find("div.dividers"),r.slideUp(n.accidentsController.animationSpeedEnd,function(){return r.remove()}),e.length>0?(l.tabAccidents.AcccidentdetailsView.remove(),o=this,e.slideUp(n.accidentsController.animationSpeedEnd,function(){return i.hasClass("selectedAccident")?i.removeClass("selectedAccident"):(a.find("div.selectedAccident").removeClass("selectedAccident"),e.remove(),o.addClaim(t,i))})):l.tabAccidents.AcccidentdetailsView?(l.tabAccidents.AcccidentdetailsView.destroy(),l.tabAccidents.AcccidentdetailsView=null,$("div.dividers").remove()):this.addClaim(t,i)},addClaim:function(e,t){return t.hasClass("selectedAccident")||t.addClass("selectedAccident"),l.tabAccidents.AcccidentdetailsView=n.SelectedAccidentView.create(e.context),t.after("<div id='AccDetailsWraper'></div><div class='dividers'></div>"),l.tabAccidents.AcccidentdetailsView.appendTo("#AccDetailsWraper"),e.isTrigger?a.run.next(function(){return $("#AccDetailsContent, div.dividers").show()}):a.run.next(function(){return $("#AccDetailsContent, div.dividers").slideDown(n.accidentsController.animationSpeedStart)})},tbodyClick:function(e){var t,i,n;if(n=$(e.target).closest("div.tr"),this.setfilteredPolicies(e.context.date),t=$("#AccDetailsWraper"),i=n.parent(),n.hasClass("selectedAccident")&&!e.isTrigger){if(i.find("div.dividers").length)return this.removeClaims(t,e,n,i),!1}else this.removeClaims(t,e,n,i);return!1},setfilteredPolicies:function(e){var t,i;return i=$.map(o.GET("proc_InsPolicies").Data,function(t){return r.date.firstBigger(t[4],e)?[t]:null}),t=$.extend({},o.GET("proc_InsPolicies"),{Data:i}),o.SET("proc_InsPolicies_forThisAccident",t)},editAccident:function(e){return this.openAccident(e.context.no)},addNewAccident:function(){return this.openAccident(null)},openAccident:function(e){var t;return $("#tabAccidents").removeClass("colmask"),$("#divAccidentsList").hide(),t=$("#divAccidentEdit").show(),t.spinner({position:"center",img:"spinnerBig.gif"}),r.LoadAccident_Card(e),$("body").spinner("remove"),!1},filterDidChange:function(e,t){var i;return console.log("filterDidChange"),i="All"===t?void 0:e[t],"filterValue"===t?this.textFilterIsActive=""===i?!1:!0:(this.panelFilterIsActive=this.chkDocs||this.chkOpen||this.chkData||this.chkClaim?!0:!1,this.filterByPanel=this.get_filterByPanel()),this.filterItems(t,i,e),a.run.next(function(){var e;return e=$("#accidentsTable"),e.find("div.selectedAccident").length?void 0:e.find("div.dividers").remove()})}.observes("chkDocs","chkOpen","chkData","chkClaim","filterValue")},t=!1,e=!1,{filterCols:["accType","driver","shortNote","userName","place","claims_C"],filterValue:null,chkDocs:null,chkOpen:null,chkData:null,chkClaim:null,filterByField:function(e){var t,i,n,a,r,o,s;if(!this.filterReduced&&e.filterToHide)return!1;for(a=this,r=!1,t=JSON.parse(JSON.stringify(a.filterCols)),i=function(i){return e[t[i]].toLowerCase().indexOf(a.filterValue)>-1?!0:!1},console.log("---Start filtering----"),n=o=0,s=t.length;s>o;n=o+=1){if(i(n)){console.log("true - "+e[t[n]]),r=!0;break}console.log("false - "+e[t[n]]),r=!1}return console.log("---End filtering----"),e.set("filterToHide",!r),r},get_filterByPanel:function(){var e;return e="",this.chkOpen&&(e+="chkWithOpen"===this.chkOpen?"if (row.cNo_NotF===0) return false;":"if (row.cNo_NotF>0) return false;"),this.chkDocs&&(e+="chkWithDocs"===this.chkDocs?"if (row.docNo===0) return false;":"if (row.docNo>0) return false;"),this.chkData&&(e+="12month"===this.chkData?"if (row.daysFrom>365) return false;":"if (row.date.indexOf("+this.chkData+")===-1) return false;"),this.chkClaim&&(e+="if (row.claims_TypeID.indexOf('"+this.chkClaim+"')===-1) return false;"),e+="return true;",Function("row",e)},filterByPanel:null,filterItems:function(e,t){var i,n=this;return"filterValue"===e?(i=""===t?this.panelFilterIsActive?function(e){return e.filterToHide=!1,n.filterByPanel(e)}:function(e){return e.filterToHide=!1,!0}:this.panelFilterIsActive?function(e){var t;return t=n.filterByField(e)?n.filterByPanel(e):!1}:function(e){return n.filterByField(e)},console.log("Filtro pradžia - tekstas---------------")):(i=this.textFilterIsActive||this.panelFilterIsActive?function(e){return e.filterToHide?!1:n.filterByPanel(e)}:function(){return!0},console.log("Filtro pradžia - kiti filtrai---------------")),this.content.forEach(function(e){var t;return t=i(e),e.set("visible",t)})}}),n.thisAccidentController=a.ResourceController.create({content:[],tableName:"?"}),n.newClaimController=a.ResourceController.create(),n.sidePanelController=a.ResourceController.create({tableName:"?",chkHandler:function(e,t){var i;return e.parent().find("label").not(e).removeClass("ui-state-active"),i=e.hasClass("ui-state-active")?e.attr("for").replace("chk_claimTypes","").replace("chk_date",""):null,n.accidentsController.set(t,i)},init:function(){var e=this;return this._super(),o.execWhenLoaded(["tblClaimTypes"],function(){return e.set("years",o.GET("proc_Years").emData.map(function(e){return e.chkId="chk_date"+e.year,e})),e.set("claimTypes",o.GET("tblClaimTypes").emData.map(function(e){return e.chkId="chk_claimTypes"+e.iD,e})),e.claimTypes.findProperty("iD",0).visible=!1,a.run.next(e,function(){var e;return e=this,$("#chkYears").buttonsetv().on("click",function(t){var i;return t.preventDefault(),i=$(t.target).closest("label"),e.chkHandler(i,"chkData"),!1}),$("#chkClaimsTypes").buttonsetv().on("click",function(t){var i;return i=$(t.target).closest("label"),e.chkHandler(i,"chkClaim"),!1})})})},years:[],claimTypes:[]}),n.SidePanelView=a.View.extend({templateName:"tmpSidePanel",didInsertElement:function(){return this._super(),a.run.next(function(){return $("#sidePanel").closest("div.col2").stickyPanel(),$("#chkOpen").buttonset().on("click",function(e){var t,i;
return t=$(e.target).closest("label").prev(),i=t.next().hasClass("ui-state-active")?t.attr("id"):null,$("#chkOpen").find("label").not(t.next()).removeClass("ui-state-active").end().prev().not(t).removeAttr("checked"),n.accidentsController.set("chkOpen",i),e.preventDefault()}),$("#chkDocs").buttonset().on("click",function(e){var t,i;return t=$(e.target).closest("label").prev(),i=t.next().hasClass("ui-state-active")?t.attr("id"):null,$("#chkDocs").find("label").not(t.next()).removeClass("ui-state-active").end().prev().not(t).removeAttr("checked"),n.accidentsController.set("chkDocs",i),e.preventDefault()})})},showAll:function(){var e;return $("#chkOpen,#chkDocs").find("label").removeClass("ui-state-active").end().prev().removeAttr("checked"),$("#sidePanel").find("input:checkbox").removeAttr("checked").parent().next().next().find("span.ui-checkbox-icon").removeClass("ui-icon ui-icon-check").attr("aria-checked","false"),e=n.accidentsController,e.chkOpen=null,e.chkDocs=null,e.chkData=null,e.chkClaim=null,e.filterDidChange(this,"All")}}),l.tabAccidents={}}.call(this),function(){var e;e=function(){function e(e){var t,i,n,a,r,o,s,l;$("body").css("cursor","wait"),l={DialogFormId:"divDialogForm",fnAddNewForm:"Dialog",CallBackAfter:0,aRowData:0,Title:0},$.extend(l,e),r=null!=l.aRowData?l.aRowData.iD:0,s=oDATA.GET(l.objData),t=l.Action,null==s&&alert("Neradau objekto "+l.objData+" clsEditableForm klaseje"),a={Cols:s.Cols,Grid:s.Grid,Data:l.aRowData},r&&null==a.Data&&(a.Data=s.emData.findProperty("iD",r)),l.Title||(n=s.Config,l.Title="Add"===t?n.Msg.AddNew:n.Msg.Edit,n.Msg.AddToTitle&&"Edit"===t&&(i=function(){var e,t,i,r;for(i=n.Msg.AddToTitle,r=[],e=0,t=i.length;t>e;e++)o=i[e],r.push(a.Data[o]);return r}(),l.Title+=" - "+i.join(" "))),this.fnLoadEditableForm(l,r,s,a),$("body").css("cursor","default")}var t,i;return e.prototype.fnLoadEditableForm=function(e,n,a,r){var o,s,l,c;return o=$.extend(!0,{},{Source:e.objData},a.Config),e.form&&"Dialog"!==e.form?(c=e.RenderHTML?e.RenderHTML:this.fnGenerateHTML(r,n,o,e),$(c).append('<button style="float:right;" title="Atšaukti">Atšaukti</button>').find("button:last").button().click(function(){return t(e)}).end().append('<button style="float:right;" title="Išsaugoti">Išsaugoti</button>').find("button:last").button().click(function(){return i(e,a,r)}).end().appendTo(e.form).append('<div style="clear:both;"></div>').prepend("<h3>"+e.Title+"</h3>")):(s={autoOpen:!1,minWidth:"35em",minHeight:"40em",width:"50em",modal:!0,title:e.Title,draggable:!0,buttons:{"Išsaugoti pakeitimus":function(){return i(e,a,r)},"Ištrinti":function(){return $(this).dialog("close")},"Atšaukti":function(){return $(this).dialog("close")}},close:function(){return $("div.validity-tooltip").remove(),$(this).remove()},dragStart:function(){return $("div.validity-tooltip").remove()}},c=e.RenderHTML?e.RenderHTML:this.fnGenerateHTML(r,n,o,e),$("#"+e.DialogFormId).parent().dialog("destroy"),$("<div id='"+e.DialogFormId+"'></div>").html(c).dialog(s).dialog("open")),oCONTROLS.UpdatableForm({frm:$("#divEditableForm")}),l=$("#"+e.DialogFormId).parent(),l.find("button:contains('Išsaugoti')").attr("disabled","disabled").addClass("ui-state-disabled"),l.find("input, textarea").bind("click keyup",function(){return l.find("button:contains('Išsaugoti')").removeAttr("disabled").removeClass("ui-state-disabled")}),l.find("div.ExtendIt button").click(function(){return l.find("button:contains('Išsaugoti')").removeAttr("disabled").removeClass("ui-state-disabled")}),l.find("button:contains('Ištrinti')").css("display","none")},t=function(e){return e.target&&e.target.css("display","block"),e.form.empty()},i=function(e,i,n){var a;return a=oCONTROLS.ValidateForm($("#divEditableForm")),a?SERVER.update({Action:e.Action,DataToSave:a,CallBack:{Success:function(i,a){return"Add"===e.Action&&(n.Data=Em.Object.create({}),n.Data.iD=i.ResponseMsg.ID),n.Cols.forEach(function(t){var i,r,o,s,l,c;return l=!1,r=t.FName.slice(0,1).toLowerCase()+t.FName.slice(1),a.DataToSave.Fields.forEach(function(e,i){return t.FName===e?(n.Data.set(r,a.DataToSave.Data[i]),l=!0):void 0},l||"Add"!==e.Action||"iD"===r?void 0:t.IdField?(s=n.Cols[t.IdField],c=s.List.Source,i=s.FName,o=oGLOBAL.helper.getData_fromDataToSave(a.DataToSave,i),n.Data.set(r,oDATA.GET(c).emData.findProperty("iD",o).MapArrToString(s.List.iText,!1))):t.Default?"Today"===t.Default?n.Data.set(r,oGLOBAL.date.getTodayString()):"UserName"===t.Default?n.Data.set(r,UserData.Name()):"UserId"===t.Default?n.Data.set(r,UserData.Id()):n.Data[r]=t.Default:(n.Data[r]="",n.Data.set(r,""))),console.log("col: "+t.FName+", ok: "+l+", fieldValue:"+n.Data[r])}),"Add"===e.Action&&oDATA.GET(e.objData).emData.pushObject(n.Data),e.CallBackAfter&&e.CallBackAfter(n.Data,e),e.form&&"Dialog"!==e.form?t(e):$("#"+e.DialogFormId).dialog("close")}},Msg:"",BlockCtrl:$("#divEditableForm")}):0===a?$("#"+e.DialogFormId).dialog("close"):void 0},e.prototype.fnGenerateHTML=function(e,t,i,n){var a,r,o,s,l,c,d,u,p,f;for(o=e.Cols.length,c=0,l="",r="",d=0,n.newVals&&(n.newVals.vals=n.newVals.vals instanceof Array?n.newVals.vals:n.newVals.vals.split(" "));o>c;)a="",u=e.Cols[c].FName,u=u.slice(0,1).toLowerCase()+u.slice(1),s=e.Data[u],null==e.Grid.aoColumns[c].sTitle||e.Cols[c].IdField||e.Cols[c].NotEditable||(null!=s&&s?"number"==typeof s?f=s:(p=e.Cols[c].Type?e.Cols[c].Type:"",f="String"===p||"Email"===p||"Date"===p.substring(0,4)?'"'+s.replace(/"/g,"\\u0027")+'"':s):null!=n.newVals?u===n.newVals.cols[d]?(f=n.newVals.vals[d]?'"'+n.newVals.vals[d].replace(/"/g,"\\u0027")+'"':'""',d++):f='""':f='""',a+='"Value":'+f+",",l+="<div class='ExtendIt' data-ctrl='{"+a+'"Field":"'+e.Cols[c].FName+'","classes":"UpdateField","labelType":"Left"}\'></div>'),c++;return r=null!=t?'"NewRec":0,"id":'+t+",":'"NewRec":1,',r+='"Source":"'+i.Source+'","tblUpdate":"'+i.tblUpdate+'"',"<div id='divEditableForm' class='inputform' style='margin:0 2em;' data-ctrl='{"+r+"}'>"+l+"</div>"},e}(),window.oGLOBAL.clsEditableForm=e}.call(this),function(){var e=window,t=e.jQuery,i=e.App,n=e.Em;i.create_docsTypesController=function(e){return i.docsTypesController=n.ResourceController.create({init:function(){var t,i;return this._super(),i=this,t=oDATA.GET("tblDocTypes").emData,this.set("docTypes",t),e?this.refreshTree(e):void 0},refreshTree:function(e){var t,i,n,a,r,o;return oGLOBAL.logFromStart("Started refreshTree"),e?this.set("categoryOpts",e):e=this.categoryOpts,i=e,n=oDATA.GET("tblDocGroup").emData,a=oDATA.GET("tblDocs").emData,t=[],r=this,o="",i.driver&&n.findProperty("ref",3).set("name",i.driver.title),n.forEach(function(e){var n,s,l,c,d,u;return c={categoryId:e.iD,title:e.name},d=e.ref,1!==d&&5!==d&&(c.isTree="isTree"),c.isGroup="isGroup",4!==d&&(c.isSelectable=!0),l=function(t,i){var n;return n=a.filter(function(i){return i.refID===t&&i.groupID===e.iD}),i.title+=n.length?" ("+n.length+")":"",n},4===d?(n=0,c.items=i.vehicles.map(function(t){return{isGroup:"isGroup",refID:t.iD,categoryId:e.iD,title:t.title,isTree:"isTree",isSelectable:!0}}),c.items.forEach(function(t){var i;return i=l(t.refID,t),n+=i.length,t.items=r.setDocTypes(r.docTypes,e.iD,t.refID,i)}),c.title+=n?" ("+n+")":""):(u=3===d?i.driver.iD:i.accident.iD,s=l(u,c),c.items=r.setDocTypes(r.docTypes,e.iD,u,s)),5===d?o=c:t[t.length]=c}),t[t.length]=o,this.set("content",t),oGLOBAL.logFromStart("Finished refreshTree")},setDocTypes:function(e,t,i,n){var a;return a="",n=n,e.filter(function(e){return e.docGroupID===t}).map(function(e){return a=n.filter(function(t){return t.docTypeID===e.iD}).length,a=a?" ("+a+")":"",{categoryId:e.iD,title:e.name+a,refID:i}})},content:[],docTypes:[],filterTypes:function(){var e,t;return console.log("Start filterTypes fn"),t=this.get("docTypes"),e=oDATA.GET("tblDocGroup").emData,this.set("docTypes_accident",t.filterProperty("docGroupID",e.findProperty("ref",2).iD)),this.set("docTypes_driver",t.filterProperty("docGroupID",e.findProperty("ref",3).iD)),this.set("docTypes_vehicle",t.filterProperty("docGroupID",e.findProperty("ref",4).iD))}.observes("docTypes.length")})},t.widget("ui.Tree",{options:{treeId:"dynamicTree",docViewForTreeId:"docViewForTree",formTemplate:"tmpUploadForm",docsUpdateCallBack:null,categoryOpts:{},docsTypesController:"docsTypesController",TreeDocController:"treeDocController"},_create:function(){return t('<table width="100%;"><tr style="vertical-align:top"><td style="width:28em"><div id="'+this.options.treeId+'" ></div></td>'+'<td style="vertical-align:top;padding:10px;"><div id="'+this.options.docViewForTreeId+'"></div></td></tr></table>').appendTo(this.element),i.docsTypesController?i.docsTypesController.refreshTree(this.options.categoryOpts):i.create_docsTypesController(this.options.categoryOpts),i.DocTreeView=n.View.extend(this.DocTreeViewOpt),this.TreeViewOpts.opts=this.options,this.TreeDocControllerOpts.opts=this.options,this.DocTreeViewOpt.opts=this.options,i.TreeView=n.View.extend(this.TreeViewOpts),i[this.options.TreeDocController]=n.Object.create(this.TreeDocControllerOpts),MY.accidentCard.TreeView=n.View.create({templateName:"tmpDocsTree"}).appendTo("#"+this.options.treeId),this.docViewForTreeOpts.controller=i[this.options.TreeDocController],this.docViewForTreeOpts.opts=this.options,MY.accidentCard.DocsView=n.View.create(this.docViewForTreeOpts).appendTo("#"+this.options.docViewForTreeId)},DocTreeViewOpt:{templateName:"tmpDocsNodes",tagName:"",opts:null,didInsertElement:function(){var e;return e||(t("#dynamicTree ul").each(function(){return t(this).find("div.treeContent").animate({paddingLeft:"+=5px"},100)}),e=!0),t("li.treeItem").droppable({accept:"#gallery > li",accept:"#"+this.opts.docViewForTreeId+" li",over:function(){var e,i,n;return t(this).hasClass("isTree")||t(this).addClass("treeItemHover"),i=t("ul",this),i.size()>0&&(e=i.eq(0),"none"===e.css("display"))?(n=e.get(0),window.setTimeout(function(){return t(n).show(),t("img.expandImage",n.parentNode).eq(0).attr("src","Content/less/images/toggle_minus.png")},200)):void 0},out:function(){return t(this).removeClass("treeItemHover")},drop:function(e,n){var a,r,o;return t(this).removeClass("treeItemHover"),r=t("ul",this),0===r.size()?(o=t(this).find("span.textHolder").eq(0),a=t(this).closest("tr").find("td:eq(1) ul").data("opts"),i[a.TreeDocController].deleteDocument(n.draggable,this)):void 0}})}},TreeViewOpts:{docs:null,opts:null,templateName:"tmpDocsCategory",tagName:"",classNames:[],getDocs:function(e){var a,r,o,s,l,c,d,u,p,f,m,h,g;return i.treeDocController.set("selectedCategoryId",e.view.bindingContext.categoryId),t("div.treeContent").removeClass("selected selectNeighbor"),m=t(e.target),(m.is("li")?m.find("div:first"):m.closest("div")).addClass("selected"),console.log("categoryId: "+e.view.bindingContext.categoryId),console.log("context: "),console.log(this._context),r=[],a=this._context,l=a.isGroup?a.refID?function(e){return e.groupID===a.categoryId&&e.refID===a.refID}:function(e){return e.groupID===a.categoryId}:a.refID?function(e){return e.docTypeID===a.categoryId&&e.refID===a.refID}:function(e){return e.docTypeID===a.categoryId},r=i[this.opts.TreeDocController].AllDocs.filter(l),r.forEach(function(e){return console.log("iD: "+e.iD+", docName: "+e.docName+", docTypeID:"+e.docTypeID+", groupID:"+e.groupID)}),s=oDATA.GET("userData").emData[0].docsPath,h="Uploads/"+s,g=oDATA.GET("tblUsers").emData,o=oDATA.GET("tblDocTypes").emData,d=function(e){return e=e.slice(0,3),"img32-doc_"+("xls"===e||"doc"===e||"pdf"===e?e:"unknown")},u=function(e){var t;return t=g.find(function(t){return t.iD===e}),t.firstName+" "+t.surname},c=function(e){return o.find(function(t){return t.iD===e}).name},p=a.isGroup&&1===a.categoryId?!0:!1,f=r.map(function(e){var t,i;return i=u(e.userID),t="/"+e.iD+"."+e.fileType,n.Object.create({docID:e.iD,hasThumb:e.hasThumb,urlThumb:h+"/Thumbs"+t,urlDoc:h+t,docType:c(e.docTypeID),description:e.description,docName:e.docName,userName:i,fileDate:e.fileDate,fileName:e.docName+"."+e.fileType,fileIcon:e.hasThumb?"img32-doc_unknown":d(e.fileType),docDetails:p?"":"Įkėlė "+i+" "+e.fileDate+", dydis - "+Math.ceil(e.fileSize/1e4)/100+"Mb"})}),i[this.opts.TreeDocController].set("isPhoto",p),console.log("showDocs:"),console.log(f),i[this.opts.TreeDocController].set("docs",f),!1},expandCollapse:function(e){var i,n,a;return n=e.target,-1===n.src.indexOf("spacer")?(a=t("ul",n.parentNode.parentNode),i="hide","none"===a.eq(0).css("display")&&(i="show"),t(a).each(function(){return"show"===i?(t(this).show(),t(this).parent().find("img.expandImage").attr("src","Content/less/images/toggle_minus.png")):(t(this).hide(),t(this).parent().find("img.expandImage").attr("src","Content/less/images/toggle_plus.png"))})):void 0}},TreeDocControllerOpts:{init:function(){var e;return this._super(),this.refreshDocs(),e=t("#"+this.opts.treeId),n.run.next(this,function(){return this.AllDocs.filter(function(e){return 5===e.groupID}).length?e.find("ul>li:last").trigger("click"):this.AllDocs.filter(function(e){return 1===e.groupID}).length?e.find("li:first").trigger("click"):e.find("li:nth(1)").trigger("click")})},refreshDocs:function(){var e,t,i,n,a,r,o,s;return oGLOBAL.logFromStart("Started refreshDocs"),n=oDATA.GET("tblDocs").emData,t=this.opts.categoryOpts,i=oDATA.GET("tblDocGroup").emData,t.accident?(e=t.accident.iD,s=t.vehicles,r=t.driver.iD,a=i.findProperty("ref",3).iD,o=i.findProperty("ref",4).iD,this.AllDocs=n.filter(function(t){var i,n;if(n=t.refID,i=t.groupID,i===a){if(n===r)return!0}else{if(i!==o)return n===e?!0:!1;if(s.findProperty("iD",n))return!0}})):this.AllDocs=n,oGLOBAL.logFromStart("Finished refreshDocs")},docs:[],opts:null,AllDocs:[],selectedCategoryId:null,deleteDocument:function(e,i){var n,a,r,o,s,l,c,d,u,p,f,m;return m=t(i),f=m.data("ref-id"),l=m.hasClass("isGroup"),o=e.data("doc-id"),u=t(i).data("category-id"),s=oDATA.GET("tblDocTypes").emData.find(function(e){return e.iD===u}),c=s.docGroupID,d=s.name,l&&(1===u&&(c=1,u=0),5===u&&(c=5,u=11)),console.log("docID:"+o+", new type:"+u+", new group:"+c),n=[u,c],a=["DocTypeID","GroupID"],f&&(n.push(f),a.push("RefID")),r=this.AllDocs.findProperty("iD",o),p=this.opts,SERVER.update2({Action:"Edit",Ctrl:t("#"+p.treeId),source:"tblDocs",row:r,DataToSave:{id:o,Data:n,Fields:a,DataTable:"tblDocs"},Msg:{Title:"Duokumento tipo priskyrimas",Success:"Dokumentas '"+r.docName+"' priskirtas tipui '"+d+"'.",Error:"Nepavyko pakeisti dokumento '"+r.docName+"' tipo."},CallBackAfter:function(){}}),e.fadeOut()}},docViewForTreeOpts:{opts:null,templateName:"tmpDocsView",tagName:"ul",attributeBindings:["data-toggle","data-target"],"data-toggle":"modal-gallery","data-target":"#modal-gallery",classNames:["gallery","ui-helper-reset","ui-helper-clearfix"],didInsertElement:function(){return this.$().data("opts",this.opts),this.$().sortable({revert:!0,opacity:.2,refreshPositions:!0}),this.$().disableSelection()}}}),MY.accidentCard={}}.call(this),function(){var e=window.jQuery;e.widget("ui.ComboBox",{options:{ListType:"List",Editable:{EditThis:!1,EditList:!1},selectFirst:!1,Value:"",mapWithNoCommas:!1,addNewIfNotExists:!1},_create:function(){var t,i,n,a,r,o;return r=e(this.element[0]),0===r.length&&console.error("Input not found for ComboBox!"),o=e.extend(!0,this.options,r.data("ctrl")),"proc_Drivers"===o.Source&&(o.mapWithNoCommas=!0),i=function(t,i,n){var a,r,s;return t=parseInt(t,10),a=t?"Edit":"Add",s="proc_InsPolicies_forThisAccident"===o.Source?"tmp_InsPolicies":o.Source.replace("proc_","tmp_"),r={source:o.Source,template:s,row:t?oDATA.GET(o.Source).emData.findProperty("iD",t):0,Action:t?"Edit":"Add",newVals:i?{vals:i,cols:o.iText}:null,input:n?e(n.target):null,CallBackAfter:function(){return dialogFrm.dialog("close")}},App.listAllController.openItem(r),!1},t=void 0,n=function(){var i,n;return i=parseInt(o.Value,10),o.data?t=o.data():(n=function(e){return o.excludeFromList&&o.excludeFromList.ValueInMe(e.iD)?null:(e.iD===i&&r.val(e.MapArrToString(o.iText,o.mapWithNoCommas,o.Source)),{id:e[o.iVal],label:e.MapArrToString(o.iText,o.mapWithNoCommas,o.Source)})},t=e.map(oDATA.GET(o.Source).emData,function(e){return n(e)})),o.Editable.EditList&&(t[t.length]={id:-1,value:"Redaguoti sąrašą",label:"Redaguoti sąrašą"}),o.Editable.AddNew?t[t.length]={id:-2,value:"Įvesti naują",label:"Įvesti naują"}:void 0},n(),e(r).on("keyup",function(){return e(this).parent().find("span.ui-menu-icon").remove()}).data("newval",o.Value).autocomplete({selectFirst:o.selectFirst,delay:0,minLength:"None"===this.options.ListType?2:0,autoFocus:!0,fnRefresh:function(){return r.data("newval")&&(o.Value=r.data("newval")),n(),o.Editable.EditThis&&r.data("newval")&&"None"===o.ListType?r.after("<span title='redaguoti..' class='ui-icon ui-icon-pencil ui-menu-icon'>&nbsp;</span>"):void 0},source:function(i,n){return n(e.ui.autocomplete.filter(t,i.term))},select:function(t,n){var a,s;if("function"==typeof n.item.id)return n.item.id(),!1;if(-1===n.item.id)App.listAllController.editListItems(r,t);else if(-2===n.item.id)return i(0,null,t),!1;return a=r.next().next("span"),s=a.hasClass("ui-icon-pencil"),0===n.item.id&&s?a.css("display","none"):s&&a.css("display","block"),e(t.srcElement).hasClass("ui-menu-icon")?(r.data("autocomplete").fnClickOnBtn({id:n.item.id,elm:e(t.srcElement),fromInput:!1}),!1):n.item&&(!e(t.target).parent().find("span.ui-menu-icon").length&&o.appendToList&&e(t.target).parent().append(o.appendToList),n.item.id!==e(this).data("newval")&&(e(this).data("newval",n.item.id).val(n.item.value),o.fnChangeCallBack&&MY.execByName(o.fnChangeCallBack,MY,this,n.item),r.data("autocomplete").fnItemChanged&&r.data("autocomplete").fnItemChanged(n.item.id)),n.item.refID)?(e(this).data("refID",n.item.refID),e(this).data("categoryID",n.item.categoryID),!1):void 0},change:function(t,n){var a;return n.item?void 0:(i(0,r.val(),t),o.fnChangeCallBack&&MY.execByName(o.fnChangeCallBack,MY,this,null),a=e(this),a.data("newval",""),"List"===o.Type&&a.val(""),r.data("autocomplete")!==void 0&&(r.data("autocomplete").term=""),!1)},close:function(){return!1},open:function(){var t,i;return(o.Editable.EditList||o.Editable.AddNew)&&e("ul.ui-autocomplete:visible").find("a:last").addClass("actionLink"),"None"===o.ListType||"Combo"===o.ListType?(t=e(this).data("autocomplete"),i='<span style="color:red">%s</span>',t.menu.element.find("a").each(function(){var n,a;return n=e(this),a=RegExp(t.term,"gi"),n.html(n.text().replace(a,function(e){return i.replace("%s",e)}))})):void 0}}),e(".ui-autocomplete-input").live("autocompleteopen",function(){var t,i;return t=e(this).data("autocomplete"),i=t.menu,t.options.selectFirst?i.activate(e.Event({type:"mouseenter"}),i.element.children().first()):void 0}),o.Editable.EditThis&&(a=e(this).data("newval"),a=a?a:0,o.appendToList="<span title='redaguoti..' class='ui-icon ui-icon-pencil ui-menu-icon'>&nbsp;</span>",r.after(o.appendToList),r.data("autocomplete").fnClickOnBtn=function(e){var n,a,s,l,c;return n=e.elm.hasClass("ui-icon-pencil")?"Edit":"Delete",l=oDATA.GET(o.Source),e.elm.hasClass("ui-icon-pencil")?i(e.id):(c=l.Data.findValueByID(e.id).MapArrToString(r.data("ctrl").iText,!0),a=l.Config.Msg.Delete,s=a+' <b>"'+c+'"</b>?',oCONTROLS.dialog.Confirm({title:a,msg:s},function(){return SERVER.update({Action:"Delete",DataToSave:{id:e.id,DataTable:l.Config.tblUpdate},Msg:{Title:"Duomenų ištrynimas",Success:l.Config.Msg.GenName+" "+c+" buvo pašalintas.",Error:l.Config.Msg.Delete+" "+c+" nepavyko."},CallBack:{Success:function(){return t.findObjectByProperty("id",e.id).label===r.val()&&r.val("").parent().find("span.ui-menu-icon").remove(),l.Data.removeRowByID(e.id),t.removeRowByProperty("id",e.id),r.autocomplete("search",r.val())}}})}))},r.parent().on("click","span.ui-menu-icon",function(){var t;return t=e(this),a=t.parent().find("input").data("newval"),r.data("autocomplete").fnClickOnBtn({id:a,elm:t,fromInput:!0})})),"None"!==o.ListType&&this.addButton({Editable:o.Editable,title:"Parodyti visus",icon:"ui-icon-triangle-1-s",fn:function(){return r.autocomplete("widget").is(":visible")?(r.autocomplete("close"),void 0):(r.autocomplete("search",""),r.focus(),!1)}},r),"List"===o.ListType?(r.attr("readonly",!0),r.click(function(){return r.autocomplete("widget").is(":visible")?(r.autocomplete("close"),!1):(r.autocomplete("search",""),r.focus(),!1)})):r.click(function(){return this.select()})},addButton:function(t,i){var n;return this.button=e("<button style='height:"+i.outerHeight()+"px;' class='drop-down'>&nbsp;</button>").attr("tabIndex",-1).attr("title",t.title).insertAfter(i).button({icons:{primary:t.icon},text:!1}).click(function(){return t.fn(),!1}).removeClass("ui-corner-all").find("span").attr("class",""),"img18-plus"===t.icon&&this.button.removeClass("ui-button-icon-primary ui-icon").css("margin","-2px 0 0 -8px"),console.log("opa opa"),t.Editable.EditThis?(n=i.prev().width()-26+"px",i.css("width",n)):void 0},destroy:function(){return e.Widget.prototype.destroy.call(this)}}),e.widget("ui.ComboBoxCategory",e.ui.ComboBox,{_create:function(){var t,i,n,a,r,o,s;return r=this.options,r.element=this.element,t=r.categoryOpts,n=t.showCategories?t.showCategories:oDATA.GET("tblDocGroup").emData,a=function(){var t;return t=oDATA.GET("tblDocTypes").emData,e.map.call(this,t,function(e){return{id:e[r.iVal],label:e.MapArrToString(r.iText,r.mapWithNoCommas),categoryID:e.docGroupID}})},i=function(t){var i;return i="dialog"+ +new Date,MY[i]=JQ.Dialog.create({dialogID:i,title:"Redaguoti sąrašą",title2:"Dokumentų tipai",saveData:function(i){var n,a;return n=App.docsTypesController.docTypes,a=i.row.docGroupID,e.extend(i,{Ctrl:e("#"+this.dialogID),source:"tblDocTypes",CallBackAfter:function(e){return"Edit"===i.Action&&n.findProperty("iD",e.iD).set("edit",!1),"Add"===i.Action&&MY.dialog.set("addNewType"+e.docGroupID,!1),App.docsTypesController.init(),t.element.closest("table").find("input").autocomplete("option","source",t.data()),console.log("New Row"),console.log(e)}}),SERVER.update2(i),!1},editDocType:function(e){return e.context.set("edit",e.context.name)},cancelDocType:function(e){return e.context.set("edit",!1)},saveDocType:function(t){var i,n,a,r,o;return r=t.context.name,n=e(t.target).prev(),o=n.val(),a=t.context,a.name=o,r.length>2?(i={Title:this.title2,Success:"Dokumento tipas '"+r+"' pakeistas.",Error:"Nepavyko pakeisti tipo '"+r+"'."},this.saveData({DataToSave:{id:a.iD,Data:[a.name],Fields:["Name"],DataTable:"tblDocTypes"},Msg:i,row:a,Action:"Edit"})):t.context.set("name",t.context.edit).set("edit",!1)},deleteDocType:function(e){var t,i;return i=e.context.name,t=this,oCONTROLS.dialog.Confirm({title:this.title2,msg:"Ištrinti tipą '"+i+"'?"},function(){var n,a;return n={Title:t.title2,Success:"Dokumento tipas '"+i+"' ištrintas.",Error:"Nepavyko ištrinti tipo '"+i+"'."},a=e.context,t.saveData({DataToSave:{id:a.iD,DataTable:"tblDocTypes"},Msg:n,row:a,Action:"Delete"})})},addNewDocType:function(t){return this.set("addNewType"+e(t.target).data("category-id"),!0)},cancelNewDocType:function(t){return this.set("addNewType"+e(t.target).data("category-id"),!1)},saveNewDocType:function(t){var i,n,a,r;return a=e(t.target).prev(),r=a.val(),n=a.data("category-id"),i={Title:this.title2,Success:"Dokumento tipas '"+r+"' pridėtas.",Error:"Nepavyko pridėt tipo '"+r+"'"},this.saveData({DataToSave:{Data:[r,n],Fields:["Name","DocGroupID"],DataTable:"tblDocTypes"},Msg:i,row:[r,n],Action:"Add"})},closeDialog:function(){return e("#"+this.dialogID).dialog("close"),!1},width:600,templateName:"tmpDocTypes"}).append()},e.extend(!0,this.options,{data:a,editList:i}),this._super(),o=function(t,i,n,a,r){var o;return o=a.filter(function(e){return e.categoryID===r}),n.forEach(function(n){return i.append("<li class='ui-autocomplete-category'>"+n.title+"</li>"),o.forEach(function(a){var r;return r=e.extend({},a,{refID:n.iD}),t._renderItemData(i,r)})})},s=this,this.element.data("autocomplete")._renderMenu=function(e,i){var a,r;return r=this,a="",n.forEach(function(n){if(0===n.ref);else{if(1===n.ref)return r._renderItemData(e,{id:0,label:"Nuotrauka",value:"Nuotrauka",categoryID:1,refID:t.accident.iD});if(3===n.ref&&t.driver)return o(r,e,[t.driver],i,n.iD);if(4===n.ref&&t.vehicles)return o(r,e,t.vehicles,i,n.iD);if(2===n.ref&&t.accident)return o(r,e,[t.accident],i,n.iD)}}),t.editList?(r._renderItemData(e,{id:function(){return s.options.editList(s.options)},label:"Redaguoti sarašą",value:"Redaguoti sarašą"}),e.find("li:last a").addClass("actionLink")):void 0}}})}.call(this),function(e){e.fn.extend({ValidateOnBlur:function(t){var i={ValidArray:[],Allow:"Integer",Trim:!0},n=e.extend(i,t);return this.each(function(){var t=e(this);t.blur(function(){var i=t.val(),a=/^(\s*)([\W\w]*)(\b\s*$)/;if(a.test(i)&&(i=i.replace(a,"$2")),n.ValidArray.length){var r=jQuery.inArray(i,ValidArray);if(-1===r)return t.val(""),void 0}else if("Integer"===n.Allow){if(a=/\D*(\d+)\D*/,!a.test(i))return t.val(""),void 0;i=i.replace(a,"$1")}else if("Decimal"===n.Allow){if(i=i.replace(",","."),a=/\D*(\d\d*\.\d+|\d+)\D*/,!a.test(i))return t.val(""),void 0;i=i.replace(a,"$1")}else if("Date"===n.Allow||"DateCtrl"===n.Allow||"DateNotLessCtrl"===n.Allow||"DateNotMoreCtrl"===n.Allow)i=i.replace("-",".").replace("/",".").replace("\\",".");else if("Year"===n.Allow||"YearNotMore"===n.Allow||"YearNotLess"===n.Allow){if(i=i.replace(".","-").replace("/","-").replace("\\","-"),a=/\.*(19|20\d{2})\.*/,a.test(i)&&(i=i.replace(a,"$1")),e.isNumeric(i)&&"YearNotMore"===n.Allow&&parseInt(i,10)>=(new Date).getFullYear()&&(i=(new Date).getFullYear()),!e.isNumeric(i)||"YearNotLess"!==n.Allow)return t.val(""),void 0;parseInt(i,10)<=(new Date).getFullYear()&&(i=(new Date).getFullYear())}t.val(i)})})}})}(jQuery),jQuery(function(e){e.datepicker.regional.lt={closeText:"Uždaryti",prevText:"&#x3c;Atgal",nextText:"Pirmyn&#x3e;",currentText:"Šiandien",monthNames:["Sausis","Vasaris","Kovas","Balandis","Gegužė","Birželis","Liepa","Rugpjūtis","Rugsėjis","Spalis","Lapkritis","Gruodis"],monthNamesShort:["Sau","Vas","Kov","Bal","Geg","Bir","Lie","Rugp","Rugs","Spa","Lap","Gru"],dayNames:["sekmadienis","pirmadienis","antradienis","trečiadienis","ketvirtadienis","penktadienis","šeštadienis"],dayNamesShort:["sek","pir","ant","tre","ket","pen","šeš"],dayNamesMin:["Se","Pr","An","Tr","Ke","Pe","Še"],weekHeader:"Sv",dateFormat:"yy.mm.dd",firstDay:1,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},e.datepicker.setDefaults(e.datepicker.regional.lt),e.datepicker.setDefaults({duration:"fast",changeMonth:!0,changeYear:!0,showOtherMonths:!0})}),function(e){e.fn.extend({tblSortable:function(t){var i={cols:[],controller:null,sortedCol:1},n=e.extend(i,t);return this.each(function(){e(this).find("th").each(function(t){n.cols[t]&&(e(this).addClass("clickable").on("click",function(i){var a,r="TH"===i.target.tagName.toUpperCase()?e(i.target):e(i.target).closest("th"),o=r.find("span").attr("class"),s="ui-icon-carat-1-n",l="ui-icon-carat-1-s",c="ui-icon-carat-2-n-s";if(o.indexOf(c)>-1)a=l;else if(o.indexOf(s)>-1)a=l;else{if(!(o.indexOf(l)>-1))throw Error("no needed class found");a=s}r.closest("tr").find("span."+s).toggleClass(s+" "+c),r.closest("tr").find("span."+l).toggleClass(l+" "+c),r.find("span").toggleClass(c+" "+a);var d=App[n.controller];a===l?d.set("sortAscending",!0):d.set("sortAscending",!1),d.set("sortProperties",[n.cols[t]]),d.set("content",d.get("arrangedContent"))}).append('<span class="ui-icon ui-icon-carat-2-n-s ui-tblHead-icon"></span>'),t===n.sortedCol&&e(this).trigger("click"))})})}})}(jQuery),function(e){var t={options:{topPadding:0,afterDetachCSSClass:"",savePanelSpace:!1,onDetached:null,onReAttached:null,parentSelector:null},init:function(i){var i=e.extend({element:e(this)},t.options,i);return this.each(function(){var n=Math.ceil(9999*Math.random());if(e(this).data("stickyPanel.state",{stickyPanelId:n,isDetached:!1,parentContainer:e(i.parentSelector?i.parentSelector:window),options:i}),i.parentSelector){var a=e(this).data("stickyPanel.state").parentContainer.css("position");switch(a){case"inherit":case"static":e(this).data("stickyPanel.state").parentContainer.css("position","relative")}}e(this).data("stickyPanel.state").parentContainer.bind("scroll.stickyPanel_"+n,{selected:e(this)},t.scroll),e(window).resize(function(){t.unstick(i.element),Em.run.next(t,function(){this.scroll(i.element)})})})},scroll:function(i){var n=i.originalEvent?i.data.selected:i,a=n.data("stickyPanel.state").options,r=n.data("stickyPanel.state").parentContainer,o=r.height(),s=n.outerHeight(!0),l=a.parentSelector?r.scrollTop():e(document).scrollTop(),c=a.parentSelector?r.height():e(document).height(),d=a.parentSelector?o:c-o,u=n.position().top-a.topPadding,p=0>u?0:u,f=n.data("stickyPanel.state").isDetached;if(d>=l&&l>p&&!f){n.data("stickyPanel.state").isDetached=!0;var m=0;"undefined"!=a.topPadding&&(m+=a.topPadding);var h=a.parentSelector?n.position().left:n.offset().left,g=a.parentSelector?n.position().top:n.offset().top;n.data("PanelsTop",g-m);var v=null;if(1==a.savePanelSpace){var b=n.outerWidth(!0),D=n.css("float"),y=n.css("display"),w=Math.ceil(9999*Math.random());n.data("stickyPanel.PanelSpaceID","stickyPanelSpace"+w),v=e("<div id='"+n.data("stickyPanel.PanelSpaceID")+"' style='width:"+b+"px;height:"+s+"px;float:"+D+";display:"+y+";'>&#20;</div>"),n.before(v)}""!=a.afterDetachCSSClass&&n.addClass(a.afterDetachCSSClass),n.data("Original_Inline_CSS",n.attr("style")?n.attr("style"):""),n.css({margin:0,left:h,top:m,position:a.parentSelector?"absolute":"fixed",width:n.outerWidth(!1)}),a.onDetached&&a.onDetached(n,v)}a.parentSelector&&f&&n.css({top:a.topPadding?l+a.topPadding:l}),n.data("PanelsTop")>=l&&"auto"!=n.css("top")&&f&&t.unstick(n)},unstick:function(i){var n=i?i:this;n.data("stickyPanel.state").isDetached=!1;var a=n.data("stickyPanel.state").options;1==a.savePanelSpace&&e("#"+n.data("stickyPanel.PanelSpaceID")).remove(),n.attr("style",n.data("Original_Inline_CSS")),""!=a.afterDetachCSSClass&&n.removeClass(a.afterDetachCSSClass),a.onReAttached&&a.onReAttached(n),i||t._unstick(n)},_unstick:function(e){e.data("stickyPanel.state").parentContainer.unbind("scroll.stickyPanel_"+e.data("stickyPanel.state").stickyPanelId)}};e.fn.stickyPanel=function(i){return t[i]?t[i].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof i&&i?(e.error("Method "+i+" does not exist on jQuery.stickyPanel"),void 0):t.init.apply(this,arguments)}}(jQuery),function(e){e.fn.buttonsetv=function(){e(":radio, :checkbox",this).wrap("<div/>");var t=e(this).buttonset();return e("label:first",this).removeClass("ui-corner-left").addClass("ui-corner-top"),e("label:last",this).removeClass("ui-corner-right").addClass("ui-corner-bottom"),e("label:first",this).css("border-bottom","none"),e("label:last",this).css("border-bottom","solid 1px #ccc"),mw=0,t}}(jQuery),jQuery.loadScript=function(e,t,i){var n=!1,a=null;$.isFunction(t)?(a=t,n=i||n):(n=t||n,a=i||a);var r=!0;jQuery('script[type="text/javascript"]').each(function(){return r=e!=$(this).attr("src")}),r?jQuery.ajax({type:"GET",url:e,success:a,dataType:"script",cache:n}):jQuery.isFunction(a)&&a.call(this)},function(e){var t,i,n={className:"autosizejs",append:"",callback:!1},a="hidden",r="border-box",o="lineHeight",s='<textarea tabindex="-1" style="position:absolute; top:-999px; left:0; right:auto; bottom:auto; border:0; -moz-box-sizing:content-box; -webkit-box-sizing:content-box; box-sizing:content-box; word-wrap:break-word; height:0 !important; width: 0; min-height:0 !important; overflow:hidden;"/>',l=["fontFamily","fontSize","fontWeight","fontStyle","letterSpacing","textTransform","wordSpacing","textIndent"],c="oninput",d="onpropertychange",u=e(s).data("autosize",!0)[0];u.style.lineHeight="99px","99px"===e(u).css(o)&&l.push(o),u.style.lineHeight="",e.fn.autosize=function(o){return o=e.extend({},n,o||{}),u.parentNode!==document.body&&(e(document.body).append(u),u.value="\n\n\n",u.scrollTop=9e4,t=u.scrollHeight===u.scrollTop+u.clientHeight),this.each(function(){function n(){i=h,u.className=o.className,e.each(l,function(e,t){u.style[t]=g.css(t)})}function s(){var e,r,s;if(i!==h&&n(),!f){f=!0,u.value=h.value+o.append,u.style.overflowY=h.style.overflowY,s=parseInt(h.style.height,10),u.style.width=Math.max(g.width(),0)+"px",t?e=u.scrollHeight:(u.scrollTop=0,u.scrollTop=9e4,e=u.scrollTop);
var l=parseInt(g.css("maxHeight"),10);l=l&&l>0?l:9e4,e>l?(e=l,r="scroll"):p>e&&(e=p),e+=v,h.style.overflowY=r||a,s!==e&&(h.style.height=e+"px",b&&o.callback.call(h)),setTimeout(function(){f=!1},1)}}var p,f,m,h=this,g=e(h),v=0,b=e.isFunction(o.callback);g.data("autosize")||((g.css("box-sizing")===r||g.css("-moz-box-sizing")===r||g.css("-webkit-box-sizing")===r)&&(v=g.outerHeight()-g.height()),p=Math.max(parseInt(g.css("minHeight"),10)-v,g.height()),m="none"===g.css("resize")||"vertical"===g.css("resize")?"none":"horizontal",g.css({overflow:a,overflowY:a,wordWrap:"break-word",resize:m}).data("autosize",!0),d in h?c in h?h[c]=h.onkeyup=s:h[d]=s:h[c]=s,e(window).on("resize",function(){f=!1,s()}),g.on("autosize",function(){f=!1,s()}),s())})}}(window.jQuery||window.Zepto),function(e,t){function i(t,i,n){var r=[];return(t.reduction||t).filter(e.validity.settings.elementSupport).each(function(){i(this)?r.push(this):a(this,s(n,{field:l(this)}))}),t.reduction=e(r),t}function n(){e.validity.isValidating()&&(e.validity.report.errors++,e.validity.report.valid=!1)}function a(t,i){n(),e.validity.out.raise(e(t),i)}function r(t,i){n(),e.validity.out.raiseAggregate(t,i)}function o(e){var t=0;return e.each(function(){var e=parseFloat(this.value);t+=isNaN(e)?0:e}),t}function s(e,t){for(var i in t)t.hasOwnProperty(i)&&(e=e.replace(RegExp("#\\{"+i+"\\}","g"),t[i]));return c(e)}function l(t){var t=e(t),i=t.prop("id"),n=e.validity.settings.defaultFieldName;if(t.prop("title").length)n=t.prop("title");else if(/^([A-Z0-9][a-z]*)+$/.test(i))n=i.replace(/([A-Z0-9])[a-z]*/g," $&");else if(/^[a-z0-9]+(_[a-z0-9]+)*$/.test(i)){for(t=i.split("_"),i=0;t.length>i;++i)t[i]=c(t[i]);n=t.join(" ")}return e.trim(n)}function c(e){return e.substring?e.substring(0,1).toUpperCase()+e.substring(1,e.length):e}var d;e.validity={settings:e.extend({outputMode:"tooltip",scrollTo:!1,modalErrorsClickable:!0,defaultFieldName:"This field",elementSupport:":text, :password, textarea, select, :radio, :checkbox",argToString:function(e){return e.getDate?e.getMonth()+1+"/"+e.getDate()+"/"+e.getFullYear():e},debugPrivates:!1},{}),patterns:{integer:/^\d+$/,date:/^((0?\d)|(1[012]))\/([012]?\d|30|31)\/\d{1,4}$/,email:/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i,usd:/^\$?((\d{1,3}(,\d{3})*)|\d+)(\.(\d{2})?)?$/,url:/^(https?|ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i,number:/^[+-]?(\d+(\.\d*)?|\.\d+)([Ee]-?\d+)?$/,zip:/^\d{5}(-\d{4})?$/,phone:/^[2-9]\d{2}-\d{3}-\d{4}$/,guid:/^(\{?([0-9a-fA-F]){8}-(([0-9a-fA-F]){4}-){3}([0-9a-fA-F]){12}\}?)$/,time12:/^((0?\d)|(1[12])):[0-5]\d?\s?[aApP]\.?[mM]\.?$/,time24:/^(20|21|22|23|[01]\d|\d)(([:][0-5]\d){1,2})$/,nonHtml:/^[^<>]*$/},messages:{require:"#{field} is required.",match:"#{field} is in an invalid format.",integer:"#{field} must be a positive, whole number.",date:"#{field} must be formatted as a date. (mm/dd/yyyy)",email:"#{field} must be formatted as an email.",usd:"#{field} must be formatted as a US Dollar amount.",url:"#{field} must be formatted as a URL.",number:"#{field} must be formatted as a number.",zip:"#{field} must be formatted as a zipcode ##### or #####-####.",phone:"#{field} must be formatted as a phone number ###-###-####.",guid:"#{field} must be formatted as a guid like {3F2504E0-4F89-11D3-9A0C-0305E82C3301}.",time24:"#{field} must be formatted as a 24 hour time: 23:00.",time12:"#{field} must be formatted as a 12 hour time: 12:00 AM/PM",lessThan:"#{field} must be less than #{max}.",lessThanOrEqualTo:"#{field} must be less than or equal to #{max}.",greaterThan:"#{field} must be greater than #{min}.",greaterThanOrEqualTo:"#{field} must be greater than or equal to #{min}.",range:"#{field} must be between #{min} and #{max}.",tooLong:"#{field} cannot be longer than #{max} characters.",tooShort:"#{field} cannot be shorter than #{min} characters.",nonHtml:"#{field} cannot contain HTML characters.",alphabet:"#{field} contains disallowed characters.",minCharClass:"#{field} cannot have more than #{min} #{charClass} characters.",maxCharClass:"#{field} cannot have less than #{min} #{charClass} characters.",equal:"Values don't match.",distinct:"A value was repeated.",sum:"Values don't add to #{sum}.",sumMax:"The sum of the values must be less than #{max}.",sumMin:"The sum of the values must be greater than #{min}.",radioChecked:"The selected value is not valid.",generic:"Invalid."},out:{start:function(){this.defer("start")},end:function(e){this.defer("end",e)},raise:function(e,t){this.defer("raise",e,t)},raiseAggregate:function(e,t){this.defer("raiseAggregate",e,t)},defer:function(t){var i=e.validity,i=i.outputs[i.settings.outputMode];i[t].apply(i,Array.prototype.slice.call(arguments,1))}},charClasses:{alphabetical:/\w/g,numeric:/\d/g,alphanumeric:/[A-Za-z0-9]/g,symbol:/[^A-Za-z0-9]/g},outputs:{},__private:t,setup:function(i){this.settings=e.extend(this.settings,i),this.__private=this.settings.debugPrivates?d:t},report:null,isValidating:function(){return!!this.report},start:function(){this.out.start(),this.report={errors:0,valid:!0}},end:function(){var e=this.report||{errors:0,valid:!0};return this.report=null,this.out.end(e),e},clear:function(){this.start(),this.end()}},e.fn.extend({validity:function(t){return this.each(function(){if("form"==this.tagName.toLowerCase()){var i=null;"string"==typeof t?i=function(){e(t).require()}:e.isFunction(t)&&(i=t),t&&e(this).bind("submit",function(){return e.validity.start(),i(),e.validity.end().valid})}})},require:function(t){return i(this,function(t){return e(t).val().length},t||e.validity.messages.require)},match:function(t,n){return n||(n=e.validity.messages.match,"string"==typeof t&&e.validity.messages[t]&&(n=e.validity.messages[t])),"string"==typeof t&&(t=e.validity.patterns[t]),i(this,e.isFunction(t)?function(e){return!e.value.length||t(e.value)}:function(e){return t.global&&(t.lastIndex=0),!e.value.length||t.test(e.value)},n)},range:function(t,n,a){return i(this,t.getTime&&n.getTime?function(e){return e=new Date(e.value),e>=new Date(t)&&new Date(n)>=e}:t.substring&&n.substring&&Big?function(e){return e=new Big(e.value),e.greaterThanOrEqualTo(new Big(t))&&e.lessThanOrEqualTo(new Big(n))}:function(e){return e=parseFloat(e.value),e>=t&&n>=e},a||s(e.validity.messages.range,{min:e.validity.settings.argToString(t),max:e.validity.settings.argToString(n)}))},greaterThan:function(t,n){return i(this,t.getTime?function(e){return new Date(e.value)>t}:t.substring&&Big?function(e){return new Big(e.value).greaterThan(new Big(t))}:function(e){return parseFloat(e.value)>t},n||s(e.validity.messages.greaterThan,{min:e.validity.settings.argToString(t)}))},greaterThanOrEqualTo:function(t,n){return i(this,t.getTime?function(e){return new Date(e.value)>=t}:t.substring&&Big?function(e){return new Big(e.value).greaterThanOrEqualTo(new Big(t))}:function(e){return parseFloat(e.value)>=t},n||s(e.validity.messages.greaterThanOrEqualTo,{min:e.validity.settings.argToString(t)}))},lessThan:function(t,n){return i(this,t.getTime?function(e){return t>new Date(e.value)}:t.substring&&Big?function(e){return new Big(e.value).lessThan(new Big(t))}:function(e){return t>parseFloat(e.value)},n||s(e.validity.messages.lessThan,{max:e.validity.settings.argToString(t)}))},lessThanOrEqualTo:function(t,n){return i(this,t.getTime?function(e){return t>=new Date(e.value)}:t.substring&&Big?function(e){return new Big(e.value).lessThanOrEqualTo(new Big(t))}:function(e){return t>=parseFloat(e.value)},n||s(e.validity.messages.lessThanOrEqualTo,{max:e.validity.settings.argToString(t)}))},maxLength:function(t,n){return i(this,function(e){return t>=e.value.length},n||s(e.validity.messages.tooLong,{max:t}))},minLength:function(t,n){return i(this,function(e){return e.value.length>=t},n||s(e.validity.messages.tooShort,{min:t}))},alphabet:function(t,n){var a=[];return i(this,function(e){for(var i=0;e.value.length>i;++i)if(-1==t.indexOf(e.value.charAt(i)))return a.push(e.value.charAt(i)),!1;return!0},n||s(e.validity.messages.alphabet,{chars:a.join(", ")}))},minCharClass:function(t,n,a){return"string"==typeof t&&(t=t.toLowerCase(),e.validity.charClasses[t]&&(t=e.validity.charClasses[t])),i(this,function(e){return(e.value.match(t)||[]).length>=n},a||s(e.validity.messages.minCharClass,{min:n,charClass:t}))},maxCharClass:function(t,n,a){return"string"==typeof t&&(t=t.toLowerCase(),e.validity.charClasses[t]&&(t=e.validity.charClasses[t])),i(this,function(e){return n>=(e.value.match(t)||[]).length},a||s(e.validity.messages.maxCharClass,{max:n,charClass:t}))},nonHtml:function(t){return i(this,function(t){return e.validity.patterns.nonHtml.test(t.value)},t||e.validity.messages.nonHtml)},equal:function(t,i){var n=(this.reduction||this).filter(e.validity.settings.elementSupport),a=function(e){return e},o=e.validity.messages.equal;if(n.length){e.isFunction(t)?(a=t,"string"==typeof i&&(o=i)):"string"==typeof t&&(o=t);var s,l=e.map(n,function(e){return a(e.value)}),c=l[0],d=!0;for(s in l)l[s]!=c&&(d=!1);d||(r(n,o),this.reduction=e([]))}return this},distinct:function(t,i){var n=(this.reduction||this).filter(e.validity.settings.elementSupport),a=function(e){return e},o=e.validity.messages.distinct,s=[],l=!0;if(n.length){e.isFunction(t)?(a=t,"string"==typeof i&&(o=i)):"string"==typeof t&&(o=t);for(var c=e.map(n,function(e){return a(e.value)}),d=0;c.length>d;++d)if(c[d].length){for(var u=0;s.length>u;++u)s[u]==c[d]&&(l=!1);s.push(c[d])}l||(r(n,o),this.reduction=e([]))}return this},sum:function(t,i){var n=(this.reduction||this).filter(e.validity.settings.elementSupport);return n.length&&t!=o(n)&&(r(n,i||s(e.validity.messages.sum,{sum:t})),this.reduction=e([])),this},sumMax:function(t,i){var n=(this.reduction||this).filter(e.validity.settings.elementSupport);return n.length&&o(n)>t&&(r(n,i||s(e.validity.messages.sumMax,{max:t})),this.reduction=e([])),this},sumMin:function(t,i){var n=(this.reduction||this).filter(e.validity.settings.elementSupport);return n.length&&o(n)>t&&(r(n,i||s(e.validity.messages.sumMin,{min:t})),this.reduction=e([])),this},radioChecked:function(t,i){var n=(this.reduction||this).filter(e.validity.settings.elementSupport);n.is(":radio")&&n.find(":checked").val()!=t&&r(n,i||e.validity.messages.radioChecked)},radioNotChecked:function(t,i){var n=(this.reduction||this).filter(e.validity.settings.elementSupport);n.is(":radio")&&n.filter(":checked").val()==t&&r(n,i||e.validity.messages.radioChecked)},checkboxChecked:function(t){var i=(this.reduction||this).filter(e.validity.settings.elementSupport);i.is(":checkbox")&&!i.is(":checked")&&r(i,t||e.validity.messages.radioChecked)},assert:function(t,n){var a=this.reduction||this;if(a.length){if(e.isFunction(t))return i(this,t,n||e.validity.messages.generic);t||(r(a,n||e.validity.messages.generic),this.reduction=e([]))}return this},fail:function(e){return this.assert(!1,e)}}),d={validate:i,addToReport:n,raiseError:a,raiseAggregateError:r,numericSum:o,format:s,infer:l,capitalize:c}}(jQuery),function(e){e.validity.outputs.tooltip={tooltipClass:"validity-tooltip",start:function(){e("."+e.validity.outputs.tooltip.tooltipClass).remove()},end:function(){},raise:function(t,i){var n=t.offset();n.left+=t.width()+18,n.top+=8,e('<div class="validity-tooltip">'+i+'<div class="validity-tooltip-outer"><div class="validity-tooltip-inner"></div></div></div>').click(function(){t.focus(),e(this).fadeOut()}).css(n).hide().appendTo("body").fadeIn()},raiseAggregate:function(e,t){e.length&&this.raise(e.filter(":last"),t)}}}(jQuery),function(e){function t(e){return e.attr("id").length?e.attr("id"):e.attr("name")}e.validity.outputs.label={cssClass:"error",start:function(){e("."+e.validity.settings.cssClass).remove()},end:function(t){!t.valid&&e.validity.settings.scrollTo&&(location.hash=e("."+e.validity.outputs.label.cssClass+":eq(0)").attr("for"))},raise:function(i,n){var a="."+e.validity.outputs.label.cssClass+"[for='"+t(i)+"']";e(a).length?e(a).text(n):e("<label/>").attr("for",t(i)).addClass(e.validity.outputs.label.cssClass).text(n).click(function(){i.length&&i[0].select()}).insertAfter(i)},raiseAggregate:function(t,i){t.length&&this.raise(e(t.get(t.length-1)),i)}}}(jQuery),function(e){e.validity.outputs.modal={start:function(){e(".validity-modal-msg").remove()},end:function(t){!t.valid&&e.validity.settings.scrollTo&&(location.hash=e(".validity-modal-msg:eq(0)").attr("id"))},raise:function(t,i){if(t.length){var n=t.offset();t.get(0),n={left:parseInt(n.left+t.width()+4,10)+"px",top:parseInt(n.top-10,10)+"px"},e("<div/>").addClass("validity-modal-msg").css(n).text(i).click(e.validity.settings.modalErrorsClickable?function(){e(this).remove()}:null).appendTo("body")}},raiseAggregate:function(t,i){t.length&&this.raise(e(t.get(t.length-1)),i)}}}(jQuery),function(e){var t=[];e.validity.outputs.summary={start:function(){e(".validity-erroneous").removeClass("validity-erroneous"),t=[]},end:function(){if(e(".validity-summary-container").hide().find("ul").html(""),t.length){for(var i=0;t.length>i;++i)e("<li/>").text(t[i]).appendTo(".validity-summary-container ul");e(".validity-summary-container").show(),e.validity.settings.scrollTo&&(location.hash=e(".validity-erroneous:eq(0)").attr("id"))}},raise:function(e,i){t.push(i),e.addClass("validity-erroneous")},raiseAggregate:function(e,t){this.raise(e,t)},container:function(){document.write('<div class="validity-summary-container">The form didn\'t submit for the following reason(s):<ul></ul></div>')}}}(jQuery),$.extend($.validity.messages,{require:"Šis langelis turi būti užpildytas",match:"Netinkamo formato laukas #{field}",integer:"#{field} turi būti teigiamas, sveikas skaičius",dateUS:"#{field} must be formatted as US date (mm/dd/yyyy).",date:"#{field} turi būt datos formato - (yyyy/mm/dd)",email:"#{field} turi būt e-pašto formato.",emailList:"#{field} turi būti e-pašto formato ir atskirtas ';'.",usd:"#{field} must be formatted as a US Dollar amount.",url:"#{field} must be formatted as a URL.",number:"#{field} turi būti numerio formato.",zip:"#{field} must be formatted as a zipcode ##### or #####-####.",phone:"#{field} must be formatted as a phone number ###-###-####.",guid:"#{field} must be formatted as a guid like {3F2504E0-4F89-11D3-9A0C-0305E82C3301}.",time24:"#{field} must be formatted as a 24 hour time: 23:00.",time12:"#{field} must be formatted as a 12 hour time: 12:00 AM/PM",lessThan:"#{field} turi būti mažiau negu #{max}.",lessThanOrEqualTo:"#{field} turi būti mažiau arba lygu #{max}.",greaterThan:"#{field} turi būti daugiau negu #{min}.",greaterThanOrEqualTo:"#{field} turi būti daugiau arba lygu #{min}.",range:"#{field} turi būti tarp #{min} ir #{max}.",tooLong:"#{field} negali būti ilgesnis negu #{max} raidžių.",tooShort:"#{field} negali būti ilgesnis negu #{min} raidžių.",nonHtml:"#{field} negali turėti HTML raidžių.",alphabet:"#{field} turi būti tik raidės.",minCharClass:"#{field} cannot have more than #{min} #{charClass} characters.",maxCharClass:"#{field} cannot have less than #{min} #{charClass} characters.",equal:"Values don't match.",distinct:"A value was repeated.",sum:"Values don't add to #{sum}.",sumMax:"The sum of the values must be less than #{max}.",sumMin:"The sum of the values must be greater than #{min}.",radioChecked:"The selected value is not valid.",textWithPoint:"Turi būti raidė, skaičius - arba _",textOrNumber:"Turi būti raidės arba skaičiai",generic:"Neteisinga."}),$.extend($.validity.patterns,{date:/^(19|20)[0-9]{2}[\s\.\/-]((0?\d)|(1[012]))[\s\.\/-]([012]?\d|30|31)$/,number:/^[+-]?(\d+(\.\d*)?|\.\d+)([Ee]-?\d+)?$/,textWithPoint:/^[A-Za-z0-9\-\.\_]+$/,textOrNumber:/^[A-Za-z0-9]+$/}),$.extend($.validity.settings,{defaultFieldName:"Šis laukas"}),function(e){e.widget("ech.notify",{options:{speed:300,expires:1500,stack:"below",custom:!1,queue:!1},_create:function(){var t=this;this.templates={},this.keys=[],this.element.addClass("ui-notify").children().addClass("ui-notify-message ui-notify-message-style").each(function(i){i=this.id||i,t.keys.push(i),t.templates[i]=e(this).removeAttr("id").wrap("<div></div>").parent().html()}).end().empty().show()},create:function(t,i,n){return"object"==typeof t&&(n=i,i=t,t=null),t=this.templates[t||this.keys[0]],n&&n.custom&&(t=e(t).removeClass("ui-notify-message-style").wrap("<div></div>").parent().html()),this.openNotifications=this.openNotifications||0,new e.ech.notify.instance(this)._create(i,e.extend({},this.options,n),t)}}),e.extend(e.ech.notify,{instance:function(e){this.__super=e,this.isOpen=!1}}),e.extend(e.ech.notify.instance.prototype,{_create:function(t,i,n){this.options=i;var a=this,n=n.replace(/#(?:\{|%7B)(.*?)(?:\}|%7D)/g,function(e,i){return i in t?t[i]:""}),n=this.element=e(n),r=n.find(".ui-notify-close");return"function"==typeof this.options.click&&n.addClass("ui-notify-click").bind("click",function(e){a._trigger("click",e,a)}),r.length&&r.bind("click",function(){return a.close(),!1}),this.__super.element.queue("notify",function(){a.open(),"number"==typeof i.expires&&i.expires>0&&setTimeout(e.proxy(a.close,a),i.expires)}),(!this.options.queue||this.__super.openNotifications<=this.options.queue-1)&&this.__super.element.dequeue("notify"),this},close:function(){var t=this.options.speed;return this.element.fadeTo(t,0).slideUp(t,e.proxy(function(){this._trigger("close"),this.isOpen=!1,this.element.remove(),this.__super.openNotifications-=1,this.__super.element.dequeue("notify")},this)),this},open:function(){if(this.isOpen||!1===this._trigger("beforeopen"))return this;var e=this;return this.__super.openNotifications+=1,this.element["above"===this.options.stack?"prependTo":"appendTo"](this.__super.element).css({display:"none",opacity:""}).fadeIn(this.options.speed,function(){e._trigger("open"),e.isOpen=!0}),this},widget:function(){return this.element},_trigger:function(e,t,i){return this.__super._trigger.call(this,e,t,i)}})}(jQuery),$(function(){$container=$("#container").notify(),oGLOBAL.message=function(e,t){var i=function(e,t,i){return $container.notify("create",e,t,i)},n=$("#container").notify();i("default",{title:e,text:t},{click:function(){n.close()}})},oGLOBAL.notify={notifyIt:function(e,t,i){return $container.notify("create",e,t,i)},msg:function(e,t){var i=this.notifyIt;$("#container").notify(),i("default",{title:e,text:t},{click:function(e,t){t.close()}})},withIcon:function(e,t,i,n){var a=this.notifyIt;$("#container").notify(),expire=n?!1:1500,a("withIcon",{title:e,text:t,icon:i},{expires:expire,click:function(e,t){t.close()}})}}}),function(){var e=window,t=e.App,i=e.Em,n=(e.oGLOBAL,e.oDATA);e.oCONTROLS,e.MY;var a,r;t.claimsStart=function(){return n.execWhenLoaded(["tblClaims"],function(){return t.claimsController.set("content",n.GET("tblClaims").emData)})},t.TabClaimsView=t.mainMenuView.extend({templateName:"tmpClaimsMain"}),t.ClaimView=i.View.extend({init:function(){var e;return this._super(),e=this.bindingContext,e.set("accident",n.GET("proc_Accidents").emData.findProperty("iD",e.accidentID)),e.set("claimType",n.GET("tblClaimTypes").emData.findProperty("iD",e.claimTypeID)),e.set("vehicle",n.GET("proc_Vehicles").emData.findProperty("iD",e.vehicleID)),e.set("insPolicy",n.GET("proc_InsPolicies").emData.findProperty("iD",e.insPolicyID)),$.extend(e,{insurerID:e.insPolicy.insurerID,daysFrom:e.accident.daysFrom,date:e.accident.date})},templateName:"tmpClaimView",tagName:""}),t.claimsController=i.ArrayController.create({addNewAccident:function(){return this.openAccident(null)},openClaim:function(e){var t;return console.log(e),$("#tabClaims").removeClass("colmask"),$("#divClaimsList").hide(),t=$("#divClaimEdit").show(),t.spinner({position:"center",img:"spinnerBig.gif"}),$("body").find("img.spinner").remove(),!1},content:[],filterDidChange:function(e,t){var i;return console.log("filterDidChange"),i="All"===t?void 0:e[t],"filterValue"===t?this.textFilterIsActive=""===i?!1:!0:(this.panelFilterIsActive=this.chkCriteria||this.chkInsurers||this.chkData||this.chkClaim?!0:!1,this.filterByPanel=this.get_filterByPanel()),this.filterItems(t,i,e)}.observes("chkCriteria","chkInsurers","chkData","chkClaim","filterValue")},r=!1,a=!1,{filterCols:[["accident","place"],["accident","shortNote"],["vehicle","plate"],"insurerClaimID"],filterByField:function(e){var t,i,n,a,r,o,s,l,c,d,u;if(!this.filterReduced&&e.filterToHide)return!1;if(!e.accident)return!1;for(s=this,l=!1,n=s.filterCols,a=s.filterValue,r=function(e){return e.toLowerCase().indexOf(a)>-1?!0:!1},console.log("---Start filtering----"),o=d=0,u=n.length;u>d;o=d+=1){if(t=n[o],i="string"==typeof t?e[t]:e[t[0]][t[1]],c=i?r(i):!1){console.log("true - "+e[n[o]]),l=!0;break}console.log("false - "+e[n[o]]),l=!1}return console.log("---End filtering----"),e.set("filterToHide",!l),l},get_filterByPanel:function(){var e;return e="",this.chkCriteria&&(e+="return true;"),this.chkInsurers&&(e+="console.log('chkInsurers result:'+row.insurerID+', '+(('+row.insurerID+'==='+this.chkInsurers+')?true:false));",e+="if (row.insurerID!=="+this.chkInsurers+") return false;"),this.chkData&&(e+="console.log('chkData result:'+row.date+', dienų:'+row.daysFrom);",e+="if (!row.date) return false;",e+="12month"===this.chkData?"if (row.daysFrom>365) return false;":"if (row.date.indexOf("+this.chkData+")===-1) return false;"),this.chkClaim&&(e+="console.log('claimTypeID:'+row.claimTypeID);",e+="console.log('chkClaim option:"+this.chkClaim+"');",e+="if (row.claimTypeID!=="+this.chkClaim+") return false;"),e+="return true;",Function("row",e)},filterByPanel:null,filterItems:function(e,t){var i,n=this;return"filterValue"===e?(i=""===t?this.panelFilterIsActive?function(e){return e.filterToHide=!1,n.filterByPanel(e)}:function(e){return e.filterToHide=!1,!0}:this.panelFilterIsActive?function(e){var t;return t=n.filterByField(e)?n.filterByPanel(e):!1}:function(e){return n.filterByField(e)},console.log("Filtro pradžia - tekstas---------------")):(i=this.textFilterIsActive||this.panelFilterIsActive?function(e){return e.filterToHide?!1:n.filterByPanel(e)}:function(){return!0},console.log("Filtro pradžia - kiti filtrai---------------")),this.content.forEach(function(e){var t;return t=i(e),e.set("visible",t)})}}),t.sidePanelForClaimsController=i.ResourceController.create({chkHandler:function(e,i){var n;return e.parent().find("label").not(e).removeClass("ui-state-active"),n=e.hasClass("ui-state-active")?e.attr("for").replace("chkInsurers_","").replace("chkDate_","").replace("chkClaimTypes_",""):null,console.log("NewOption: "+i+"; New val: "+n),t.claimsController.set(i,n)},init:function(){var e=this;return this._super(),n.execWhenLoaded(["tblClaimTypes"],function(){return e.set("insurers",n.GET("tblInsurers").emData.map(function(e){return e.chkId="chkInsurers_"+e.iD,e})),e.set("years",n.GET("proc_Years").emData.map(function(e){return e.chkId2="chkDate_"+e.year,e})),e.set("claimTypes",n.GET("tblClaimTypes").emData.map(function(e){return e.chkId2="chkClaimTypes_"+e.iD,(0===e.iD||6===e.iD)&&(e.visible=!1),e}))})},insurers:[],years:[],claimTypes:[]}),t.SidePanelForClaimsView=i.View.extend({templateName:"tmpSidePanelForClaims",controller:t.sidePanelForClaimsController,didInsertElement:function(){return this._super(),i.run.next(this,function(){var e;return $("#sidePanelCl").closest("div.col2").stickyPanel(),e=this.controller,$("#chkCriteria").buttonsetv().on("click",function(t){var i;return t.preventDefault(),i=$(t.target).closest("label"),e.chkHandler(i,"chkCriteria"),!1}),$("#chkInsurers").buttonsetv().on("click",function(t){var i;return t.preventDefault(),i=$(t.target).closest("label"),e.chkHandler(i,"chkInsurers"),!1}),$("#chkYearsCl").buttonsetv().on("click",function(t){var i;return t.preventDefault(),i=$(t.target).closest("label"),e.chkHandler(i,"chkData"),!1}),$("#chkClaimsTypesCl").buttonsetv().on("click",function(t){var i;return i=$(t.target).closest("label"),e.chkHandler(i,"chkClaim"),!1})})},showAll:function(){var e;return $("#sidePanelCl").find("label.ui-state-active").removeClass("ui-state-active"),e=t.claimsController,e.chkCriteria=null,e.chkInsurers=null,e.chkData=null,e.chkClaim=null,e.filterDidChange(this,"All")}})}.call(this),function(){var e=window,t=e.App,i=e.Em,n=e.oGLOBAL,a=e.oDATA,r=e.oCONTROLS;e.MY,t.tabClaimsRegulationController=i.ArrayController.create({stepsCont1:['<a href="#">Parenkite ir siųskite</a><div>arba</div><a href="#">Užregistruokite</a>','<a href="#">Patvirtinti, kad visa informacija yra pateikta</a>','<a href="#">Patvirtinti #### Lt kaip galutinę žalos sumą</a>','<a href="#">Patvirtinti #### Lt kaip galutinę išmokos sumą</a>','<a href="#">Uždaryti bylą</a>'],stepsCont2:["Draudikui pranešta ####",'Visa informacija pateikta:</br>####</br><a href="#">Atšaukti</a>','Patvirtinta galutinė žalos suma: #### Lt</br><a href="#">Atšaukti</a>','Patvirtinta galutinė išmokos suma: #### Lt</br><a href="#">Atšaukti</a>','Byla uždaryta <a href="#"></br>Atidaryti</a>'],stepsConfirm:["",'<p>Įveskite paskutinio dokumento pateikimo datą:</p><input class="date" type="text" value="####"><button class="btn btn-small">Patvirtinti</button>','<p>Galutinė žalos dydžio suma - #### Lt.</p><button class="btn btn-small">Patvirtinti</button>','<p>Galutinė išmokos dydžio suma - #### Lt</p><button class="btn btn-small">Patvirtinti</button>',""],stepVal:[],stepsTemp:[{stepNo:1,name:"Pranešimas draudikui"},{stepNo:2,name:"Informacija draudikui"},{stepNo:3,name:"Žalos suma"},{stepNo:4,name:"Draudimo išmoka"},{stepNo:5,name:"Bylos uždarymas"}],fnSetContent:function(e,t){var i;return i=e?this.stepsCont1:this.stepsCont2,this.claim.steps[t].set("content",i[t].replace("####",this.stepVal[t]))},setSteps:function(){var e,t,a,r,o,s,l,c,d,u;return e=this.claim,u=n.date.getTodayString(),this.set("stepVal",[u,u,e.lossAmount,e.insuranceClaimAmount,""]),c=this.stepsTemp,o=this.stepsCont1,s=this.stepsCont2,l=this.stepsConfirm,r=[],d=this.stepVal,a=!1,t=function(e,t){return e[t].replace("####",d[t])},c.forEach(function(n){var l,c;return c=$.extend({},n),l=n.stepNo-1,e.claimStatus+1===c.stepNo?(c.step="current",a=!0,c.content=t(o,l)):a?c.step="pending":(c.step="completed",c.content=e.claimStatus===c.stepNo?t(s,l):t(s,l).replace('<a href="#">Atšaukti</a>',"")),r.pushObject(i.Object.create(c))}),e.steps=r},fnStepForward:function(e){var t,i,n,a,r;return a=this.claim.steps,r=this.stepVal,n=e+1,a[e].set("step","completed"),a[e].set("content",this.stepsCont2[e].replace("####",r[e])),a.length!==n&&(a[n].set("step","current"),a[e+1].set("content",this.stepsCont1[n].replace("####",r[n]))),e-1>0&&(i=this.stepsCont2[e-1].replace("####",r[e-1]).replace('<a href="#">Atšaukti</a>',""),a[e-1].set("content",i)),t={Data:[n],Fields:["claimStatus"]},1===n?(t.Fields.push("DateNotification"),t.Data.push(r[e])):2===n?(t.Fields.push("DateDocsSent"),t.Data.push(r[e])):3===n?(t.Fields.push("LossAmount"),t.Data.push(r[e])):4===n&&(t.Fields.push("InsuranceClaimAmount"),t.Data.push(r[e])),this.fnSaveData(t)},fnConfirm:function(e,t){var i;return i='<div class="step-box-addon"><div class="inner">'+this.stepsConfirm[t].replace("####",this.stepVal[t])+"</div></div>",$(i).appendTo(e).hide().slideDown("slow",function(){return $(this).css("overflow","visible")})},fnStepBack:function(e){var t,i;return i=this.claim.steps,i[e].set("step","current"),i[e].set("content",this.stepsCont1[e].replace("####",this.stepVal[e])),5>e+1&&(i[e+1].set("step","pending"),i[e+1].set("content","")),e-1>0&&i[e-1].set("content",this.stepsCont2[e-1].replace("####",this.stepVal[e-1])),t={Data:[e],Fields:["claimStatus"]},this.fnSaveData(t)},fnSaveData:function(e){var t;return t=$.extend({id:this.claim.iD,DataTable:"tblClaims"},e),SERVER.update2({Action:"Edit",DataToSave:t,Ctrl:$("#claimsSteps"),source:"tblClaims",row:this.claim,CallBackAfter:function(e){return console.log(e)}})}}),t.ActionMainView=i.View.extend({viewName:"actionMain",templateName:"tmpActionMain",controller:t.actionViewController}),t.actionViewController=i.ObjectController.create({parentView:{},init:function(){},title:"",childViewName:"",userData:{},goToOtherView:function(e){var t;return t=$(e.target).data("ctrl"),this.set("title",t.title).set("childViewName","view_"+t.view),this.parentView.set("actionView",this.view_wrapper).rerender(),i.run.next(function(){return $("#contentOfClaimReg").find("div.row").find("div.ExtendIt:first").data("ctrl").Value=a.GET("userData").emData[0].userID,r.UpdatableForm({frm:"#contentOfClaimReg"})})},saveForm:function(){return alert("saveForm")},cancelForm:function(){return this.parentView.set("actionView",t.ActionMainView).rerender()},view_wrapper:i.View.extend({init:function(){var e;return this._super(),e=t.actionViewController,this.set("childView",this[e.childViewName]).set("title",e.title)},childView:{},childViewName:"",viewName:"actionWrapper",templateName:"tmpActionWrapper",view_sendEmail:i.View.extend({viewName:"action_sendEmail",templateName:"tmpAction_sendEmail"}),view_addEmail:i.View.extend({viewName:"action_addEmail",templateName:"tmpAction_addEmail"}),view_meeting:i.View.extend({viewName:"action_meeting",templateName:"tmpAction_meeting"}),view_note:i.View.extend({viewName:"action_note",templateName:"tmpAction_note"}),view_phone:i.View.extend({viewName:"action_phone",templateName:"tmpAction_phone"}),view_task:i.View.extend({viewName:"action_task",templateName:"tmpAction_task"}),view_addCompensation:i.View.extend({viewName:"addCompensation",templateName:"tmpAddCompensation"}),view_addInsuranceBenefit:i.View.extend({viewName:"addInsuranceBenefit",templateName:"tmpAddInsuranceBenefit"}),view_addInvoice:i.View.extend({viewName:"addInvoice",templateName:"tmpAddInvoice"}),view_addPropReport:i.View.extend({viewName:"addPropReport",templateName:"tmpAddPropReport"})})}),t.TabClaimsRegulationView=Ember.View.extend(t.HidePreviousWindow,{viewName:"tabClaimsRegulation",previuosWindow:"#divClaimsList",thisWindow:"#divClaimRegulation",init:function(){return this._super(),this.controller.setSteps(),t.actionViewController.set("parentView",this)},actionView:t.ActionMainView,templateName:"tmpClaimRegulation",didInsertElement:function(){var e,t,n,a;return this._super(),n=this,t=0,e=n.controller,a={},this.$().find("#claimsSteps").on("click","a",function(){var n,r,o;
return a=$(this).closest("div.step-box"),n=a.attr("class"),r=a.data("stepno"),t=r-1,o=e.claim.steps,n.indexOf("completed")>0?e.fnStepBack(t):n.indexOf("current")>0&&(1===r?e.fnStepForward(t):5===r?e.fnStepForward(t):(e.fnConfirm(a,t),2===r&&i.run.next(this,function(){return a.find("input.date").ValidateOnBlur({Allow:"Date"}).datepicker()}))),!1}).on("click","button",function(){var i;return 1===t&&(i=a.find("input.date").val(),e.stepVal[t]=i),e.fnStepForward(t),a.find("div.step-box-addon").slideUp("slow").remove(),!1}),$("#claimRegulationTab").tabs().on("tabsactivate",function(e,t){return 1===t.newTab.index()?console.log("first"):void 0})},controller:t.tabClaimsRegulationController})}.call(this),function(){var e,t=window,i=t.App,n=t.Em,a=t.oGLOBAL,r=t.oDATA,o=t.oCONTROLS,s=t.MY;i.listsStart=function(){return i.topNewController.set("drivers",r.GET("proc_topDrivers").emData),i.topNewController.set("vehicles",r.GET("proc_topVehicles").emData),i.topNewController.set("insPolicies",r.GET("proc_topInsPolicies").emData),r.execWhenLoaded(["proc_Vehicles","proc_Drivers","proc_InsPolicies"],function(){return i.listAllController.set("vehicles",r.GET("proc_Vehicles").emData),i.listAllController.set("drivers",r.GET("proc_Drivers").emData),i.listAllController.set("insPolicies",r.GET("proc_InsPolicies").emData)})},i.topNewController=n.ResourceController.create({vehicles:[],drivers:[],insPolicies:[],tableName:"?"}),i.DriverView=n.View.extend({templateName:"tmpDriverRow",tagName:""}),i.VehicleView=n.View.extend({templateName:"tmpVehicleRow",tagName:""}),i.InsPolicyView=n.View.extend({templateName:"tmpInsPolicyRow",tagName:""}),i.listAllController=n.ResourceController.create({current:"",clicked:"",endDate:"",editItem:"",filterValue:"",addMakeMode:"",VehicleMakes:[],editVehicleMake:!1,valueDidChange:function(){return this.filterItems()}.observes("filterValue"),deleteForm:function(e){var t,n,a,s;return console.log(e),a=e.view._parentView.pars,n=r.GET(a.source),t=n.Config.Msg,s=a.row,o.dialog.Confirm({title:"",msg:"Ištrinti "+t.GenNameWhat+" '"+s.MapArrToString(n.Config.titleFields,!0)+"'?"},function(){return SERVER.update2({Action:"Delete",DataToSave:{id:s.iD,DataTable:n.Config.tblUpdate},Ctrl:$("#tabLists"),source:a.source,row:s,CallBackAfter:function(){var e,t;return i.topNewController[a.emObject].removeObject(s),i.listAllController.content.removeObject(s),e=r.GET(a.source.replace("_","_top")).emData,t=e.findProperty("iD",s.iD),e.removeObject(t),$("#openItemDialog").dialog("close")}})})},saveForm:function(e,t){var n,a,r,s;return s=t?t.pars:e.view._parentView.pars,n=t?t.Alert:null,r=t?t.execOnSuccess:null,a=o.ValidateForm($("#dialogContent")),a?($.extend(s,{DataToSave:a,Ctrl:$("#tabLists"),CallBackAfter:function(e){return"Add"===s.Action&&(i.listAllController.content.unshiftObject(e),i.topNewController[s.emObject]&&i.topNewController[s.emObject].unshiftObject(e),s.input&&(s.input.data("newval",e.iD),s.input.autocomplete("option").fnRefresh(),s.input.data("autocomplete").fnItemChanged(e.iD))),e.iD&&$("#tabLists").find("div.ui-tabs").find("li.ui-tabs-selected a").trigger("click"),r?r(e):$("#openItemDialog").dialog("close")}}),SERVER.update2(s),!1):n?o.dialog.Alert({title:"",msg:"Užpildykite pažymėtus laukus.."}):void 0},cancelForm:function(){return $("#openItemDialog").dialog("close"),!1},editListItems:function(e){var t,n,a,l;return a=e.data("ctrl").Source,l=e.data("ctrl").tblUpdate?e.data("ctrl").tblUpdate:a,n=r.GET(a),this.set("listItems",n.emData.removeObject(n.emData.findProperty("iD",0))),t="dialog"+ +new Date,s[t]=JQ.Dialog.create({input:e,dialogID:t,legend:n.Config.Msg.ListName,title:"Redaguoti sąrašą",msg:n.Config.Msg,addNewMsg:"Pridėti naują",saveData:function(e){var t,n;return t=i.listAllController.listItems,n=this,$.extend(e,{Ctrl:$("#"+this.dialogID),source:a,CallBackAfter:function(i){return"Edit"===e.Action&&t.findProperty("iD",i.iD).set("edit",!1),"Add"===e.Action&&s[n.dialogID].set("addItem",!1),n.input.autocomplete("option").fnRefresh()}}),SERVER.update2(e),!1},editItem:function(e){return e.context.set("edit",e.context.name)},cancelItem:function(e){return e.context.set("edit",!1)},saveItem:function(t){var i,n,a,r;return n=t.context.name,e=$(t.target).prev(),r=e.val(),a=t.context,a.name=r,n.length>0?(i={Title:this.title,Success:this.msg.GenName+" '"+n+"' pakeista(s).",Error:this.msg.GenNameWhat+" '"+n+"' nepavyko pakeisti.."},this.saveData({DataToSave:{id:a.iD,Data:[a.name],Fields:["Name"],DataTable:l},Msg:i,row:a,Action:"Edit"})):t.context.set("name",t.context.edit).set("edit",!1)},deleteItem:function(e){var t,i;return t=e.context.name,i=this,o.dialog.Confirm({title:this.title,msg:i.msg.Delete+" '"+t+"'?"},function(){var n,a;return n={Title:i.title,Success:i.msg.GenName+" '"+t+"' ištrinta(s).",Error:i.msg.GenNameWhat+" '"+t+"' nepavyko ištrinti."},a=e.context,i.saveData({DataToSave:{id:a.iD,DataTable:l},Msg:n,row:a,Action:"Delete"})})},addNewItem:function(){return this.set("addItem",!0)},cancelNewItem:function(){return this.set("addItem",!1)},saveNewItem:function(t){var i,n;return e=$(t.target).prev(),n=e.val(),i={Title:this.title,Success:this.msg.GenName+" '"+n+"' pridėtas.",Error:this.msg.GenNameWhat+" '"+n+"' nepavyko pridėti."},this.saveData({DataToSave:{Data:[n],Fields:["Name"],DataTable:l},Msg:i,row:[n],Action:"Add"})},closeDialog:function(){return $("#"+this.dialogID).dialog("close"),!1},width:600,templateName:"tmpEditItems"}).append()},openItem:function(t){var l,c;return t.row.iD?this.set("deleteButton",!0):this.set("deleteButton",!1),this.set("dateIsEdited",!1),i.docsTypesController||i.create_docsTypesController(),l=r.GET(t.source).Config,c=t.row?l.Msg.GenName+": "+t.row.MapArrToString(l.titleFields,"tmp_Drivers"===t.template?!0:!1):l.Msg.AddNew,!t.row&&t.newVals&&(t.row=t.newVals.vals.toRowObject(t.newVals.cols)),s.dialog&&s.dialog.remove(),n.run.next(this,function(){return s.dialog=JQ.Dialog.create({controllerBinding:"App.listAllController",thisController:this,pars:t,init:function(){return this._super(),this.templateName=t.template,this.title=c,this.pars=t},goToEditDate:function(){return i.listAllController.set("dateIsEdited",!0),n.run.next(this,function(){return $("#dialogEndDateInput").datepicker({minDate:"-3y",maxDate:"0"}).trigger("focus")})},saveDate:function(){var e,t;return e=$(event.target).parent().parent().find("input").val(),a.date.isDate(e)||(e=""),t=$("#dialogContent").data("ctrl"),SERVER.update2({Action:"Edit",Ctrl:$("#openItemDialog"),source:t.Source,row:this.pars.row,DataToSave:{id:t.id,Data:[e],Fields:["EndDate"],DataTable:t.tblUpdate},CallBackAfter:function(){return $("#tabLists").find("div.ui-tabs").find("li.ui-tabs-selected a").trigger("click")}}),console.log("išsaugoti "+e),this.pars.me.endDate=e,i.listAllController.set("dateIsEdited",!1).set("endDate",e)},makeAttach:function(a){var o,s,l,c,d,u;return s=$("#openItemDialog"),o=!1,l=r.GET("tblDocGroup").emData,a?(c=l.findProperty("ref",a).iD,4===a&&(d="TP "+t.row.make+", "+t.row.model+", "+t.row.plate+" dokumentai",o={showCategories:[{iD:c,ref:a,name:d}],vehicles:[{iD:t.row.iD,title:d}]}),3===a&&(d="Vairuotojo '"+t.row.firstName+" "+t.row.lastName+"' dokumentai",o={showCategories:[{iD:c,ref:a,name:d}],driver:{iD:t.row.iD,title:d}}),s.find("div.uploadDocsContainer").UploadFiles({categoryOpts:o,showPhoto:!1,docsController:"dialogDocController",requireCategory:!0}),u=t.row.iD,i.dialogDocController.setDocs(u,c),this.removeOnCloseView=n.View.create(e).appendTo("#dialoguploadDocsContainer")):console.warn("no ref")},didInsertElement:function(){var e,i,a;return this._super(),e=$("#dialogContent"),i=0,a=this,"vehicles"===t.emObject||"proc_Vehicles"===t.source?i=4:("drivers"===t.emObject||"proc_Drivers"===t.source)&&(i=3),t.row.iD?this.makeAttach(i):(c=4===i?"tr. priemonę":"vairuotoją",$('<div class="row fileupload-buttonbar" style="padding:10px 0 20px 40px;"><center><i class="img16-attach"></i><a href="#" class="fileinput-button">Išsaugoti naują '+c+" ir prisegti dokumentus</a></center></div>").appendTo("#dialoguploadDocsContainer").find("a").on("click",function(r){var s;return r.preventDefault(),s=e.data("ctrl"),e.length?a.thisController.saveForm(null,{Alert:!0,pars:t,execOnSuccess:function(r){return o.UpdatableForm_toSaved(r.iD,e),t.row=r,$("#dialoguploadDocsContainer").empty(),n.run.next(function(){return a.makeAttach(i)})}}):void 0})),"tmp_InsPolicies"===this.templateName&&this.$().tabs().css("margin","-5px 1px 0 1px"),o.UpdatableForm({frm:e,row:t.row,btnSaveToDisable:e.next().find("button.btnSave")})},width:700,templateName:"dialog-content"}).append()})},addNew:function(e){var t;return t=$(e.target).parent().data("ctrl"),console.log("addNew"),console.log(t),$.extend(t,{row:0,Action:"Add",me:this,CallBackAfter:function(){}}),this.set("endDate",""),this.set("editItem",!1),this.openItem(t)},edit:function(e){var t,i,n;return console.log("edit"),console.log(e.target),console.log(e.view._context),t=e.view._context,n=$(e.target).closest("table").next().data("ctrl"),n=n?n:this.current,$.extend(n,{row:t,Action:"Edit",me:this}),i=n.row.endDate?n.row.endDate:"",this.set("endDate",i),this.set("editItem",!0),this.openItem(n)},filterByField:function(){var e;return e=this.filterValue?"var ret=false,cols="+JSON.stringify(this.current.filterCols)+";console.log('Filtering by val:"+this.filterValue+"'); 		for(var i=0; i < cols.length; i++){      			if (row[cols[i]]==null){				ret=false; break;			}else{				console.log(row[cols[i]]); console.log(row[cols[i]].toLowerCase().indexOf('"+this.filterValue+"')>-1);				if (row[cols[i]].toLowerCase().indexOf('"+this.filterValue+"')>-1){ret=true; break;}			}		}		console.log('filterByval rez: '+ret);return ret;":"return true;",Function("row",e)},filterByTab:function(){var e,t;if("drivers"===this.current.emObject)t="NotWorking"===this.clicked?"!":"",e="var ret=true; if ($.trim(row.endDate)) {ret=oGLOBAL.date.firstBigger(row.endDate);} console.log('endDate: '+row.endDate+', '+ret);return "+t+"ret";else{if("vehicles"!==this.current.emObject)throw Error("filterByTab has no such emObject");t="NotWorking"===this.clicked?"!":"",e="var ret=true; if ($.trim(row.endDate)) {ret=oGLOBAL.date.firstBigger(row.endDate);} console.log('endDate: '+row.endDate+', '+ret);return "+t+"ret"}return Function("row",e)},filterItems:function(){var e,t=this;return e="insPolicies"===this.current.emObject?function(e){var i;return i=t.filterByField()(e),e.set("visible",i)}:function(e){var i;return i=t.filterByTab()(e)?t.filterByField()(e):!1,e.set("visible",i)},i.listAllController[this.current.emObject].forEach(e)},showTabs:function(e){var t;return t=$(e.target),t.closest("ul").find("li").removeClass("ui-tabs-selected ui-state-active"),t.closest("li").addClass("ui-tabs-selected ui-state-active")},filterWorking:function(e){return this.set("clicked","Working"),this.showTabs(e),this.filterItems()},filterNotWorking:function(e){return this.set("clicked","NotWorking"),this.showTabs(e),this.filterItems()},vehicles:[],drivers:[],insPolicies:[],tableName:"?"}),i.TopListsView=i.mainMenuView.extend({templateName:"tmpListsTop",viewIx:4}),i.AllDriversView=i.mainMenuView.extend({init:function(){return this._super(),i.listAllController.set("content",r.GET("proc_Drivers").emData)},templateName:"tmpAllDrivers",viewIx:4,didInsertElement:function(){var e;return this._super(),e=$("#tabLists"),e.find("div.ui-tabs").find("li:first a").trigger("click"),e.find("table.zebra-striped").tblSortable({cols:["firstName","lastName","dateBorn","phone","docs"],controller:"listAllController",sortedCol:1})}}),i.AllInsPoliciesView=i.mainMenuView.extend({init:function(){return this._super(),i.listAllController.set("content",r.GET("proc_InsPolicies").emData)},templateName:"tmpAllInsPolicies",viewIx:4,didInsertElement:function(){return $("#tabLists").find("table.zebra-striped").tblSortable({cols:["claimType","insurerName","policyNumber","endDate","isuredName"],controller:"listAllController",sortedCol:0})}}),i.AllVehiclesView=i.mainMenuView.extend({init:function(){return this._super(),i.listAllController.set("content",r.GET("proc_Vehicles").emData)},templateName:"tmpAllVehicles",viewIx:4,didInsertElement:function(){var e;return this._super(),e=$("#tabLists"),e.find("div.ui-tabs").find("li:first a").trigger("click"),e.find("table.zebra-striped").tblSortable({cols:["plate","type","make","model","year","docs"],controller:"listAllController",sortedCol:0})}}),i.dialogDocController=n.ResourceController.create({refID:null,groupID:null,docs:[],refreshDocs:function(){return this.setDocs(this.refID,this.groupID)},setDocs:function(e,t){var i,a,o,s,l,c,d,u;return e&&(this.refID=e,this.groupID=t),o=r.GET("userData").emData[0].docsPath,d="Uploads/"+o,u=r.GET("tblUsers").emData,i=r.GET("tblDocTypes").emData,l=function(e){return e=e.slice(0,3),"img32-doc_"+("xls"===e||"doc"===e||"pdf"===e?e:"unknown")},c=function(e){var t;return t=u.find(function(t){return t.iD===e}),t.firstName+" "+t.surname},s=function(e){return i.find(function(t){return t.iD===e}).name},a=r.GET("tblDocs").emData.filter(function(i){return i.refID===e&&i.groupID===t}).map(function(e){var t,i;return i=c(e.userID),t="/"+e.iD+"."+e.fileType,n.Object.create({docID:e.iD,hasThumb:e.hasThumb,urlThumb:d+"/Thumbs"+t,urlDoc:d+t,docType:s(e.docTypeID),description:e.description,docName:e.docName,userName:i,fileDate:e.fileDate,fileName:e.docName+"."+e.fileType,fileIcon:e.hasThumb?"img32-doc_unknown":l(e.fileType),docDetails:"Įkėlė "+i+" "+e.fileDate+", dydis - "+Math.ceil(e.fileSize/1e4)/100+"Mb"})}),this.set("docs",a)}}),e={opts:null,templateName:"tmpDocsView",tagName:"ul",classNames:["gallery","ui-helper-reset","ui-helper-clearfix"],controller:i.dialogDocController,didInsertElement:function(){return this._super(),this.$().data("opts",this.opts)}}}.call(this),oGLOBAL.LoadAccident_Card=function(e){"use strict";var t;return SERVER.send("{'AccidentNo':"+e+"}",oGLOBAL.Start.fnSetNewData,{Ctrl:"divAccidentEdit",RenderNew:1,fnCallBack:function(){t()}},"/Accident/GetAccident","json"),t=function(){$("#btnMapTown").button({disabled:!0}).click(function(){return oGLOBAL.mapFn.GetMapFromTown(),!1});var t=$("#AccidentForm").data("ctrl"),i={};t.NewRec&&(i.disabled=[1]),$("#accidentTab").tabs(i).on("tabsactivate",function(e,t){if(1===t.newTab.index()){var i=t.oldPanel,n=t.newPanel,a=$("#uploadDocsToAccident");(n.data("ctrl").id!==i.data("ctrl").id||$("#AccDocs").data("ctrl").Saved)&&(MY.accidentCard.TreeView&&(MY.accidentCard.TreeView.remove(),MY.accidentCard.DocsView.remove(),$("#uploadDocsToAccident").next().data("Tree")&&$("#uploadDocsToAccident").next().Tree("destroy")),$("#AccDocs").data("ctrl").Saved&&(App.treeDocController.refreshDocs(),$("#AccDocs").data("ctrl").Saved=!1),oGLOBAL.appStart=(new Date).getTime(),oGLOBAL.logFromStart("Started docsAccident"),App.docsAccident({accidentForm:i,docsForm:n,uploadForm:a}),n.data("ctrl").id=i.data("ctrl").id,oGLOBAL.logFromStart("Finished docsAccident"))}});var n=function(e,t){$("#btnReturnToAccidents").trigger("click"),Em.run.next({accNo:e},function(){var e=$("#accidentsTable").find("div.accident").removeClass("selectedAccident");$("#accidentsTable").find("div.dividers").remove(),$("#AccDetailsWraper").remove();var i=e.find("div.td:nth(0):contains("+this.accNo+")").parent().addClass("selectedAccident");Em.run.next(function(){console.log(i),i.trigger("click"),i.trigger("click"),Em.run.next(function(){t&&$("#AccDetailsContent").find("button").trigger("click"),Em.run.next(function(){var e=i.offset().top-$(window).height()/2+100;$("html, body").animate({scrollTop:e},"slow")})})})})};$("#btnDeleteAccident").on("click",function(){var t=oDATA.GET("proc_Accidents").emData,i=t.findProperty("no",e);return i.cNo_All>0?(oCONTROLS.dialog.Alert({title:"",msg:"Negalima šalinti įvykio, kol jis turi nepašalintų žalų."}),!1):(oCONTROLS.dialog.Confirm({title:"Įvykio Nr. "+e+" pašalinimas",msg:"Ištrinti šį įvykį?"},function(){SERVER.update({Action:"Delete",DataToSave:{id:i.iD,DataTable:"tblAccidents"},Msg:{Title:"Įvykio pašalinimas",Success:"Pasirinktas įvykis buvo pašalintas.",Error:"Nepavyko pašalinti šio įvykio"},CallBack:{Success:function(){$("#accidentsTable").find("div.accident").removeClass("selectedAccident"),$("#accidentsTable").find("div.dividers").remove(),$("#AccDetailsWraper").remove(),t.removeObject(i),$("#btnReturnToAccidents").trigger("click")}}})}),void 0)}),$("#btnSaveAccident").on("click",{fn:n},function(t){var i,n,a=oCONTROLS.ValidateForm($("#AccidentForm"));if(a){if(oGLOBAL.AccidentForm.NewRec){if(oGLOBAL.AccidentForm.Lat?0:1)return oCONTROLS.dialog.Alert({msg:"Pažymėkite įvykio vietą pelės spragtelėjimu žemėlapyje..",title:"Naujo įvykio įvedimas"}),!1;a.Data.push(oGLOBAL.AccidentForm.Lat),a.Fields.push("Lat"),a.Data.push(oGLOBAL.AccidentForm.Lng),a.Fields.push("Lng"),a.Data.push(oGLOBAL.AccidentForm.Country),a.Fields.push("LocationCountry"),a.Data.push(oGLOBAL.AccidentForm.District),a.Fields.push("LocationDistrict"),a.Data.push(oGLOBAL.AccidentForm.Address),a.Fields.push("LocationAddress"),n={Title:"Naujo įvykio įvedimas",Success:"Naujas įvykis pridėtas",Error:"Nepavyko pridėti naujo įvykio."},i="Add"}else n={Title:"Įvykio duomenų keitimas",Success:"Duomenys sėkmingai pakeisti",Error:"Nepavyko pakeisti duomenų."},i="Edit";SERVER.update({Action:i,DataToSave:a,CallBack:{Success:function(n){var a=n.ResponseMsg.Ext.replace(/#\|#\|/g,":::").split("|#|");a[13]=a[13].replace(/:::/g,"#|#|");var r=parseInt(a[1],10),o="Edit"===i?!1:{sort:"desc",col:"date"};App.accidentsController.get("setNewVal").call(App.accidentsController,{newVal:a,toAppend:o,fieldsToInt:[0,1,5,6,7,8]})[0],$("#AccDocs").data("ctrl").Saved=!0,oGLOBAL.AccidentForm.NewRec?t.data.fn(r,!0):t.data.fn(e,!1)}},Msg:n})}return!1}),$("#btnCancel").on("click",{fn:n},function(t){t.data.fn(e,!1)}),$("#btnReturnToAccidents").click(function(e){e.preventDefault(),$("#tabAccidents").addClass("colmask"),$("#divAccidentsList").show(),$("#divAccidentEdit").empty().hide()}),$("#inputChooseTown").bind("keypress",function(){$(this).val().length>1?$("#btnMapTown").button("enable"):$("#btnMapTown").button("disable")});var a=$("#divAccidentEdit").height()-$("h2").outerHeight(!0)-$("#ulWhiteMenu").outerHeight(!0)-$("#AccidentForm").outerHeight(!0);a>0&&$("div.HalfDivleft1").height($("div.HalfDivleft1").height()+a);var r=$("#AccidentForm").outerHeight(!1)-$("#divMapHead").outerHeight(!1);$("#divMap").height(r).width("100%"),oGLOBAL.AccidentForm=$("#AccidentForm").data("ctrl"),$("#divSearchMap").outerHeight($("#divMapHead").height()),oGLOBAL.mapFn.loadGMap(),oGLOBAL.AccidentForm.NewRec||oGLOBAL.mapFn.fnSetAddress($("#txtPlace").html())},!1},oGLOBAL.map=null,oGLOBAL.geocoder=null,oGLOBAL.AccidentForm={},oGLOBAL.infoWindow=new google.maps.InfoWindow,oGLOBAL.openInfoWindow=function(e,t){var i=oGLOBAL.infoWindow;i.close(),i.setContent(t),i.setPosition(e),i.open(oGLOBAL.map)},oGLOBAL.mapFn={GetMapFromTown:function(){"use strict";var e,t=$("#inputChooseTown").val(),i=t.match(RegExp("([0-9]+.[0-9]+)","g"));null===i?e=t:i.length>1?(new google.maps.LatLng(parseFloat(i[0]),parseFloat(i[1])),e=new google.maps.LatLng(i[0],i[1])):e=t,oGLOBAL.geocoder.geocode({address:e},oGLOBAL.mapFn.addAddressToMap)},SetAddress:function(e){e&&oGLOBAL.geocoder.geocode({latLng:e},function(t,i){i==google.maps.GeocoderStatus.OK?(oGLOBAL.map.SetAddress=oGLOBAL.mapFn.fnGetAddress(t),oGLOBAL.openInfoWindow(e,oGLOBAL.map.SetAddress)):oGLOBAL.map.SetAddress="Adresas nerastas"})},fnGetAddress:function(e){var t=e[0].address_components,i=t.length,n=i-1;"country"!==t[n].types[0]&&n--;var a=t[n].long_name;n--;var r=n>0?t[n].long_name:"";n--,0>n&&(n=0);var o=t.slice(0,n).map(function(e){return e.long_name}).join(", ");$.extend(oGLOBAL.AccidentForm,{Address:o,District:r,Country:a});var s=oGLOBAL.AccidentForm;return(s.Address?s.Address+", ":"")+s.District+", "+s.Country},fnSetAddress:function(e){var t=oGLOBAL.AccidentForm;$("#linkToGoogle").attr("href","https://maps.google.com/maps?q="+t.Lat+","+t.Lng+"("+e+")"),$("#txtPlace").html(e),$("#divSearchMap").css("display","none")},Mapclicked:function(e){"use strict";var t=e.latLng;t&&(oGLOBAL.AccidentForm.Lat=t.lat(),oGLOBAL.AccidentForm.Lng=t.lng(),oGLOBAL.geocoder.geocode({latLng:t},function(e,i){if(i==google.maps.GeocoderStatus.OK){var n=oGLOBAL.mapFn.fnGetAddress(e);oGLOBAL.openInfoWindow(t,n),oGLOBAL.mapFn.fnSetAddress(n),oGLOBAL.AccidentForm.NewRec||$("#ConfirmNewMapData").length||($('<a id="ConfirmNewMapData" href="javascript:void(0);return false;">Patvirtinti</a>').insertAfter("#btnEditMap").button(),$("#ConfirmNewMapData").click(function(){var e={Data:[],Fields:[],DataTable:$("#AccidentForm").data("ctrl").Source};return e.Data.push(oGLOBAL.AccidentForm.Lat),e.Fields.push("Lat"),e.Data.push(oGLOBAL.AccidentForm.Lng),e.Fields.push("Lng"),e.Data.push(oGLOBAL.AccidentForm.Country),e.Fields.push("LocationCountry"),e.Data.push(oGLOBAL.AccidentForm.District),e.Fields.push("LocationDistrict"),e.Data.push(oGLOBAL.AccidentForm.Address),e.Fields.push("LocationAddress"),e.id=$("#AccidentForm").data("ctrl").id,SERVER.update({Action:"Edit",DataToSave:e,CallBack:{Success:function(e){t=new google.maps.LatLng(oGLOBAL.AccidentForm.Lat,oGLOBAL.AccidentForm.Lng),oGLOBAL.map.setCenter(t,8);var i=new google.maps.Marker({position:new google.maps.LatLng(t),map:oGLOBAL.map});oGLOBAL.mapFn.SetAddress(t),google.maps.event.addListener(i,"click",function(){oGLOBAL.openInfoWindow(t,oGLOBAL.map.SetAddress)}),$("#btnEditMap").attr("title","Keisti įvykio vietą").html("Keisti").data("caption","Change"),$("#ConfirmNewMapData").remove();var n=e.ResponseMsg.Ext.replace(/#\|#\|/g,":::").split("|#|");n[13]=n[13].replace(/:::/g,"#|#|"),App.accidentsController.get("setNewVal").call(App.accidentsController,{newVal:n,toAppend:!1,fieldsToInt:[0,1,5,6,7,8]})[0]}},Msg:{Title:"Įvykio vietos keitimas",Success:"Įvykio vieta pakeista.",Error:"Nepavyko pakeist įvykio vietos."}}),!1}))}else oCONTROLS.dialog.Alert({msg:"Nepavyko rasti šios vietos adreso - "+t.toUrlValue(),title:"Nepavyko rasti adreso"})}))},loadGoogleMapScript:function(e){"use strict";if("function"==typeof GMap2)return e(),void 0;var t=document.createElement("script");t.setAttribute("src","http://maps.google.com/maps?file=api&amp;v=2&amp;sensor=true&amp;key=AIzaSyBmiyz9zmTD_hY7qT7Degr0o7tqAzjKQos&async=2&callback=oGLOBAL.mapFn.loadGMap"),t.setAttribute("type","text/javascript"),document.documentElement.firstChild.appendChild(t)},addAddressToMap:function(e,t){t==google.maps.GeocoderStatus.OK?(oGLOBAL.map.setCenter(e[0].geometry.location),new google.maps.Marker({map:oGLOBAL.map,position:e[0].geometry.location}),oGLOBAL.openInfoWindow(e[0].geometry.location,e[0].formatted_address)):alert("Neradau šios vietovės - '"+$("#inputChooseTown").val()+"'")},loadGMap:function(){var e,t,i=function(){oGLOBAL.map.EventMapclicked=google.maps.event.addListener(oGLOBAL.map,"click",oGLOBAL.mapFn.Mapclicked);var e=oGLOBAL.map.getCenter();oGLOBAL.openInfoWindow(e,"Suraskite ir pažymėkite įvykio vietą žemėlapyje")};if(oGLOBAL.geocoder=new google.maps.Geocoder,oGLOBAL.AccidentForm.NewRec?(e=new google.maps.LatLng(54.682961,25.2740478),t=4):(e=new google.maps.LatLng(oGLOBAL.AccidentForm.Lat,oGLOBAL.AccidentForm.Lng),t=8),oGLOBAL.map=new google.maps.Map(document.getElementById("divMap"),{zoom:t,center:e,mapTypeId:google.maps.MapTypeId.ROADMAP}),oGLOBAL.AccidentForm.NewRec)i();else{var n=new google.maps.Marker({position:new google.maps.LatLng(e),map:oGLOBAL.map});oGLOBAL.mapFn.SetAddress(e),google.maps.event.addListener(n,"click",function(){oGLOBAL.openInfoWindow(e,oGLOBAL.map.SetAddress)}),$("#cancelMap").on("click",function(){oGLOBAL.map.EventMapclicked&&google.maps.event.removeListener(oGLOBAL.map.EventMapclicked),oGLOBAL.mapFn.fnSetAddress(oGLOBAL.map.SetAddress),$("#ConfirmNewMapData").length&&$("#ConfirmNewMapData").remove(),oGLOBAL.openInfoWindow(e,oGLOBAL.map.SetAddress),$("#divSearchMap").hide()})}$("#btnEditMap").click(function(){$(this),$("#divSearchMap").show().outerHeight($("#divMapHead").height()),i()})}},console.log("accidentCard loaded"),function(){var e=window,t=e.App,i=e.Em,n=(e.oGLOBAL,e.oDATA),a=e.oCONTROLS;e.MY,t.TabUserCardView=i.View.extend({didInsertElement:function(){var e,i,n;return this._super(),$("#userInfoTab").tabs(),n=$("#InfoDataForm"),i=t.userCardController,i.content.length?n.data("ctrl",{NewRec:0,id:i.content[0].iD,Source:"tblUsers"}):n.data("ctrl",{NewRec:1,id:0,Source:"tblUsers"}),a.UpdatableForm({frm:n,btnSaveToDisable:n.next().find("button.btnSave")}),e=t.userCardController.SaveOk,e?($("#savePasswordNote").html(e).show().delay(2e3).fadeOut(),t.userCardController.set("SaveOk",null)):void 0},templateName:"tmpUserCard",controllerBinding:"App.userCardController",changeMyPassword:function(){return t.router.transitionTo("tabChangePass")},sendUserPasswordForm:function(){return t.userCardController.set("passwordReset",!0)},sendUserPassword:function(e,i,n){var a,r;return a=e?$(e.target).parent():null,r=i?i:"ResetUserPsw",n=n?n:t.userCardController.content[0].email,SERVER.update3({pars:{email:n,mailTmpl:r},ctrl:a,CallBack:function(e){return e.ErrorMsg?$("#savePasswordNote").html("Nepavyko išsiųsti, klaida: "+e.ErrorMsg).show().delay(2e3).fadeOut():$("#savePasswordNote").html(e.ResponseMsg).show().delay(2e3).fadeOut(),t.userCardController.set("passwordReset",!1)},url:"/Account/RecoverPassword2"})},emailText:function(){return alert("Laiško tekstas")},cancelSendUserPassword:function(){return t.userCardController.set("passwordReset",!1)},saveUserCard:function(){var e,i,n,r,o;return n=$("#InfoDataForm"),i=a.ValidateForm(n),o=this.sendUserPassword,e=n.data("ctrl").NewRec?"Add":"Edit",i?(r={Action:e,DataToSave:i,row:t.userCardController.content[0],source:"tblUsers",Ctrl:n,CallBackAfter:function(e,i){return"Add"===i&&o(null,"NewUserPsw",e.email),t.userCardController.setUser({myInfo:!1,User:e}),t.router.transitionTo("tabAdmin")}},SERVER.update2(r)):void 0},saveUserRights:function(){return alert("saveUserRights")},goToAdminTab:function(){return t.router.transitionTo("tabAdmin"),!1}}),t.userCardController=i.ArrayController.create({init:function(){return console.log("init")},setUser:function(e){var t;return this.set("myInfo",e.myInfo?!0:!1).set("passwordReset",!1),e.myInfo&&(t=n.GET("userData").emData[0].userID,e.User=n.GET("tblUsers").emData.findProperty("iD",t)),this.content.length&&this.content.removeAt(0),e.User?this.content.pushObject(e.User):void 0},myInfo:!0,passwordReset:!1,content:[],addNewUser:function(){return this.setUser({myInfo:!1}),this.set("deleteButton",!1),t.router.transitionTo("tabUserCard"),!1},editUser:function(e){return this.setUser({myInfo:!1,User:e.view._context}),this.set("deleteButton",!0),t.router.transitionTo("tabUserCard"),!1},deleteForm:function(){var e,i,r,o,s;return i=$("#InfoDataForm"),o=i.data("ctrl"),r=n.GET(o.Source),e=r.Config.Msg,s=t.userCardController.content[0],a.dialog.Confirm({title:"",msg:"Ištrinti "+e.GenNameWhat+" '"+s.MapArrToString(r.Config.titleFields,!0)+"'?"},function(){return SERVER.update2({Action:"Delete",DataToSave:{id:s.iD,DataTable:r.Config.tblUpdate},Ctrl:$("#tabLists"),source:o.Source,row:s,CallBackAfter:function(){return t.router.transitionTo("tabAdmin"),!1}})})},saveForm:function(){var e,i,n,r,o;return n=$("#InfoDataForm"),i=a.ValidateForm(n),o=t.TabUserCardView.sendUserPassword,e=n.data("ctrl").NewRec?"Add":"Edit",i?(r={Action:e,DataToSave:i,row:t.userCardController.content[0],source:"tblUsers",Ctrl:n,CallBackAfter:function(e,i){var n;return"Add"===i?o(null,"NewUserPsw",e.email):(n=$("#systemEmail"),n.val()!==n.data("ctrl").Value&&o(null,"ResetUserPsw",e.email)),t.userCardController.myInfo?void 0:(t.userCardController.setUser({myInfo:!1,User:e}),t.router.transitionTo("tabAdmin"))}},SERVER.update2(r),!1):void 0},cancelForm:function(){return t.router.transitionTo("tabAdmin"),!1}}),t.ChangeUserPassView=i.View.extend({saveNewPass:function(){var e,i,n,a,r,o,s;return s=this.$(),r=s.find("input:eq(0)"),e=s.find("input:gt(0)"),$.validity.start(),r.require("Įveskite esamą slaptažodį"),e.require("Įveskite naują slaptažodį").minLength(3,"Įveskite ne mažiau 3 raidžių").match("textOrNumber"),i=$.trim(e.eq(0).val()),n=$.trim(e.eq(1).val()),o=$.trim(r.val()),a=function(){return i===n},e.assert(a,"Nesutampa slaptažodžiai"),$.validity.end().valid?SERVER.update3({pars:{OldPassword:o,NewPassword:i,UserId:0},CallBack:function(e){return e.ErrorMsg?$("#changePaswordError").html(e.ErrorMsg):(t.userCardController.set("SaveOk",e.ResponseMsg),t.router.transitionTo(t.userCardController.myInfo?"tabMyCard":"tabUserCard")),console.log(e)},url:"/Account/NewPassword2"}):void 0},cancelNewPass:function(){return t.router.transitionTo(t.userCardController.myInfo?"tabMyCard":"tabUserCard"),!1},templateName:"tmpChangeUsrPass"})}.call(this),function(){var e=window,t=e.App,i=(e.Em,e.oGLOBAL,e.oDATA);e.oCONTROLS,e.MY,t.docsAccident=function(e){var t,n,a,r,o,s,l,c;return o=e.accidentForm.data("ctrl"),s=1===o.NewRec?!0:!1,t=s?null:o.id,n=$("#lstDrivers"),a=s?null:n.data("ctrl").Value,r="Vairuotojo '"+n.val()+"' dokumentai",c=[],s||o.vehicles.forEach(function(e){return c.findProperty("iD",e.iD)?void 0:c.addObject(e)}),l={categoryOpts:{accident:{iD:t,title:"Įvykio dokumentai"},driver:{iD:a,title:r},vehicles:c}},i.execWhenLoaded(["tmpUploadForm","tmpDocsTree"],function(){return $("#uploadDocsToAccident").UploadFiles(l),$("#uploadDocsToAccident").next().Tree({categoryOpts:l.categoryOpts})})}}.call(this),App.ClaimsView=App.mainMenuView.extend({templateName:"tmpClaims",viewIx:1}),App.MapView=App.mainMenuView.extend({templateName:"tmpMap",viewIx:2}),App.ReportsView=App.mainMenuView.extend({templateName:"tmpReports",viewIx:3}),App.Router=Em.Router.extend({executed:{},enableLogging:!1,location:"hash",root:Em.Route.extend({viewAccidents:Em.State.transitionTo("tabAccidents"),viewClaims:Em.State.transitionTo("tabClaims"),viewMap:Em.State.transitionTo("tabMap"),viewReports:Ember.State.transitionTo("tabReports"),viewLists:Ember.State.transitionTo("tabLists"),viewAdmin:Ember.State.transitionTo("tabAdmin"),tabAccidents:Em.Route.extend({route:"/",connectOutlets:function(e){MY.NavbarController.fnSetNewTab({newState:e.currentState.name,viewIx:0}),$("#divAccidentsList").find("div.col2").css("top","0")}}),tabClaims:Em.Route.extend({route:"/claims",connectOutlets:function(e){MY.NavbarController.fnSetNewTab({newState:e.currentState.name,viewIx:1}),oDATA.fnLoad2({url:"Main/tabClaims",callBack:function(){App.claimsStart(),e.get("applicationController").connectOutlet("claimsOutlet","tabClaims"),e.get("applicationController").connectOutlet("claimsSidePanelOutlet","sidePanelForClaims")}})},claimRegulation:function(e,t){MY.NavbarController.fnSetNewTab({newState:e.currentState.name,viewIx:1,transparent:!0}),console.log(t.context),App.tabClaimsRegulationController.set("claim",t.context),e.get("applicationController").connectOutlet("claimRegulationOutlet","tabClaimsRegulation")}}),tabMap:Em.Route.extend({route:"/map",connectOutlets:function(e){MY.NavbarController.fnSetNewTab({newState:e.currentState.name,viewIx:2})}}),tabReports:Em.Route.extend({route:"/reports",connectOutlets:function(e){MY.NavbarController.fnSetNewTab({newState:e.currentState.name,viewIx:3})}}),tabLists:Em.Route.extend({route:"/tabLists",connectOutlets:function(e){MY.NavbarController.fnSetNewTab({newState:e.currentState.name,viewIx:4,transparent:!0}),oDATA.fnLoad2({url:"Main/tabLists",checkFn:"App.listsStart",runAllways:!0,callBack:function(){App.listsStart(),e.get("applicationController").connectOutlet("listsOutlet","topLists")}})},toListAll:function(e,t){MY.NavbarController.fnSetNewTab({newState:e.currentState.name,viewIx:4,newOutlet:"tabLists"})&&(d=$(t.target).parent().data("ctrl"),App.listAllController.set("current",d),e.get("applicationController").connectOutlet("listsOutlet",d.goTo))},toTop:function(e){MY.NavbarController.fnSetNewTab({newState:e.currentState.name,viewIx:4,transparent:!0}),App.listsStart(),e.get("applicationController").connectOutlet("listsOutlet","topLists")}}),tabAdmin:Em.Route.extend({route:"/tabAdmin",connectOutlets:function(e){MY.NavbarController.fnSetNewTab({newState:e.currentState.name,viewIx:5,transparent:!0}),oDATA.fnLoad2({url:"Main/tabAdmin",callBack:function(){App.adminStart(),console.log(".connectOutlet('adminOutlet', 'tabAdmin');"),e.get("applicationController").connectOutlet("adminOutlet","tabAdmin")
}})}}),tabUserCard:Em.Route.extend({route:"/tabUserCard",connectOutlets:function(e){var t=App.userCardController.myInfo?-1:5;MY.NavbarController.fnSetNewTab({newState:e.currentState.name,viewIx:t,newOutlet:"tabAdmin"})&&e.get("applicationController").connectOutlet("adminOutlet","tabUserCard")}}),tabMyCard:Em.Route.extend({route:"/tabMyCard",connectOutlets:function(e){MY.NavbarController.fnSetNewTab({newState:e.currentState.name,viewIx:-1,newOutlet:"tabAdmin"})&&e.get("applicationController").connectOutlet("adminOutlet","tabUserCard")}}),tabChangePass:Em.Route.extend({route:"/changePass",connectOutlets:function(e){MY.NavbarController.fnSetNewTab({newState:e.currentState.name,viewIx:-1,newOutlet:"tabEmpty"})&&e.get("applicationController").connectOutlet("emptyOutlet","changeUserPass")}})})}),App.initialize(),$(function(){$("#userLink").on("click",function(){return App.userCardController.setUser({myInfo:!0}),App.router.transitionTo("tabMyCard"),!1}),Em.run.next(function(){$("#tabAccidents,#tabClaims,#tabReports,#tabLists,#tabAdmin").on("focus","input:text,textarea",function(e){$(e.target).addClass("activeField")}).on("blur","input:text,textarea",function(e){$(e.target).removeClass("activeField")})})});