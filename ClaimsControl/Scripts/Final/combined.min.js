function ArrayIndexOf(t,e){if(!e||"function"!=typeof e)return-1;if(!t||!t.length||1>t.length)return-1;for(var i=0;t.length>i;i++)if(e(t[i]))return i;return-1}JQ=Ember.Namespace.create(),JQ.Widget=Ember.Mixin.create({didInsertElement:function(){var t=this._gatherOptions();this._gatherEvents(t);var e=jQuery.ui[this.get("uiType")](t,this.get("element"));this.set("ui",e)},willDestroyElement:function(){var t=this.get("ui");if(t){var e=this._observers;for(var i in e)e.hasOwnProperty(i)&&this.removeObserver(i,e[i]);t._destroy()}},_gatherOptions:function(){var t=this.get("uiOptions"),e={};return t.forEach(function(t){e[t]=this.get(t);var i=function(){var e=this.get(t);this.get("ui")._setOption(t,e)};this.addObserver(t,i),this._observers=this._observers||{},this._observers[t]=i},this),e},_gatherEvents:function(t){var e=this.get("uiEvents")||[],i=this;e.forEach(function(e){var n=i[e];n&&(t[e]=function(t,e){n.call(i,t,e)})})}}),JQ.Dialog=Ember.View.extend(JQ.Widget,{init:function(){this._super(),this.dialogID&&(this.elementId=this.dialogID)},elementId:"openItemDialog",uiType:"dialog",didInsertElement:function(){this.title.length>50&&(this.title=this.title.slice(0,50)+".."),this._super(),me=this,this.cancelLink&&(dialog=this.$(),pane=dialog.next().find("div.ui-dialog-buttonset"),$("<a />",{"class":"linkCancel",text:"Atšaukti"}).appendTo(pane).click(function(){me.ui.close()})),this.runFunction&&this.runFunction(this),this.pars&&this.pars.input&&(t=this.pars.input.offset().top-200+"px",this.$().parent().css("top",t))},uiOptions:"autoOpen width close title resizable modal position buttons".w(),autoOpen:!0,width:400,resizable:!1,modal:!0,position:"top",close:function(){$(this).dialog("destroy"),$(this).remove();var t=$(this).attr("id"),e="openItemDialog"!==t?MY[t]:MY.dialog;e?(e.removeOnCloseView&&e.removeOnCloseView.remove(),e.remove()):console.error("??"),$("div.validity-tooltip").remove()},open:function(){$(this).dialog("open")}}),function(t){t.fn.spinner=function(e){var i=t.extend({},t.fn.spinner.defaults,e);return this.each(function(){var n,a=0,r=0,o=0,s=0,l=0,c=t(this);if("remove"==e||"close"==e){var n=c.data("spinner"),d=c.data("opts");if(n!==void 0)return n.remove(),c.removeData("spinner").removeData("opts"),d.hide&&c.css("visibility","visible"),d.onFinish.call(this),void 0}c.is("body")&&c.height()<t(document).height()&&c.height(t(document).height()),"spinnerBig.gif"===i.img&&(i.height=66,i.width=66);var u=c.offset();if(o=c.outerWidth(),s=c.outerHeight(),s>t(window).height()&&(s=t(window).height()),s>i.height?l=Math.round((s-i.height)/2):i.height>s&&(l=0-Math.round((i.height-s)/2)),r=u.top+l+"px","right"==i.position)a=u.left+o+10+"px";else if("left"==i.position)a=u.left-i.width-10+"px";else{var p=0;if(c.is("body")){var f=t("body").css("margin-left");p=parseInt(f.replace("px",""),10)}a=p+u.left+Math.round(.5*o)-Math.round(.5*i.width)+"px"}i.onStart.call(this),i.hide&&c.css("visibility","hidden"),n=t('<img class="spinner" src="/Content/images/'+i.img+'" style="position: absolute; left: '+a+"; top: "+r+"; width: "+i.width+"px; height: "+i.height+"px; z-index: "+i.zIndex+';" />').appendTo("body"),c.data("spinner",n).data("opts",i)})},t.fn.spinner.defaults={img:"spinnerBig.gif",height:16,width:16,zIndex:1001,hide:!1,onStart:function(){},onFinish:function(){}}}(jQuery),$("div.content:visible:first").length>0?$("div.content:visible:first").spinner({centerOnBody:!0,position:"center",img:"spinnerBig.gif"}):$("body").spinner({centerOnBody:!0,position:"center",img:"spinnerBig.gif"}),window.console||(console={}),console.log=console.log||function(){},console.warn=console.warn||function(){},console.error=console.error||function(){},console.info=console.info||function(){},jQuery.fn.log=function(t){return t=t||"log",console.log("%s: %o",t,this),this.each(function(t){id=this.id?"ID: "+this.id:"",console.log("%d: %s.%s %s",t,this.tagName,this.className,id)}),this},Object.keys||(Object.keys=function(){var t=Object.prototype.hasOwnProperty,e=!{toString:null}.propertyIsEnumerable("toString"),i=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],n=i.length;return function(a){if("object"!=typeof a&&"function"!=typeof a||null===a)throw new TypeError("Object.keys called on non-object");var r=[];for(var o in a)t.call(a,o)&&r.push(o);if(e)for(var s=0;n>s;s++)t.call(a,i[s])&&r.push(i[s]);return r}}());var MY={change:{onlyNumbers:function(t){return(""+t).replace(/[^\d.]/g,"")}}};Number.prototype.toRound=function(){return(Math.round(100*this)/100).toFixed(2)},String.prototype.toRowObject=function(t){var e=this.split(" ");retObj={};for(var i=0;e.length>i;i++)t[i]&&(retObj[t[i]]=$.trim(e[i]));return retObj},String.prototype.firstSmall=function(){return this.slice(0,1).toLowerCase()+this.slice(1)},String.prototype.firstBig=function(){return this.slice(0,1).toUpperCase()+this.slice(1)},String.prototype.replaceAt=function(t,e){return this.substr(0,e)+t+this.substr(e)},Array.prototype.filterByTbl=function(t){if(fTbl=[],me=this,!me.length)return fTbl;me[0].iD||console.error("No iD for filter");var e=t.filterTbl.filter(function(e){return e[t.filterField]===t.filterValue});return e.forEach(function(e){for(var i=0;me.length>i;i++)if(me[i].iD===e[t.joinField]){fTbl[fTbl.length]=me[i];break}}),fTbl},Em.Object.prototype.MapArrToString=function(t,e,i){for(var n,a=[],r=0;t.length>r;r++)n=$.trim(this[t[r]]),""!==n&&(a[a.length]=n);return i?this.notUnique?a.join(" ")+", "+this.dateBorn:a.join(" "):e?a.join(" "):a.join(", ")},Em.Object.prototype.updateTo=function(t){for(var e in this)this.hasOwnProperty(e)&&t[e]&&this[e]!==t[e]&&this.set(e,t[e])},Array.prototype.getColByFName=function(t){for(var e="",i=0;this.length>i;i++)if(this[i].FName.toLowerCase()==t.toLowerCase())return this[i];return e},Array.prototype.FNameIndex=function(t){for(var e="",i=0;this.length>i;i++)if(this[i].FName.toLowerCase()==t.toLowerCase())return i;return e},Array.prototype.move=function(t,e){for(;0>t;)t+=this.length;for(;0>e;)e+=this.length;if(e>=this.length)for(var i=e-this.length;i--+1;)this.push(void 0);return this.splice(e,0,this.splice(t,1)[0]),this},Array.prototype.findIndexByKeyValue=function(t,e){for(var i=0;this.length>i;i++)if(this[i][t]==e)return i;return null},Array.prototype.findIndexByVal=function(t,e){var i="";e&&(t=t.toLowerCase());for(var n=0;this.length>n;n++){if(e&&this[n].toLowerCase()==t)return n;if(this[n]==t)return n}return i},Array.prototype.findValueByID=function(t){for(var e=0;this.length>e;e++)if(this[e][0]===t)return this[e];return!1},Array.prototype.findObjectByProperty=function(t,e){for(var i=0;this.length>i;i++)if(this[i][t]===e)return this[i]},Array.prototype.findColValuesByID=function(t,e){for(var i="",n=0;this.length>n;n++)if(this[n][0]===t){for(var a="",r=0;e.length>r;r++)a+=this[n][e[r]]+", ";return a.slice(0,-2)}return i},Array.prototype.findColValueByID=function(t,e){for(var i="",n=0;this.length>n;n++)if(this[n][0]===t)return this[n][e];return i},Array.prototype.removeRowByProperty=function(t,e){for(var i=0;this.length>i;i++)if(this[i][t]===e)return this.splice(i,1),i;return!1},Array.prototype.removeRowByID=function(t){for(var e="",i=0;this.length>i;i++)if(this[i][0]===t)return this.splice(i,1),i;return e},Array.prototype.AddArray=function(t){for(var e=0;t.length>e;e++)this[this.length]=t[e]},Array.prototype.IndexOfFunc=function(t){for(var e=0;this.length>e;e++)if(t(this[e]))return e;return-1},Array.prototype.ValueInMe=function(t){for(var e=0;this.length>e;e++)if(this[e]===t)return!0;return!1},Array.prototype.findColValByColVal=function(t,e,i){for(var n=0;this.length>n;n++)if(this[n][e]==t)return this[n][i];return""},String.prototype.endsWith=function(t){return this.substr(this.length-t.length)===t},String.prototype.startsWith=function(t){return this.substr(0,t.length)===t},Array.prototype.MapArrToString=function(t,e){for(var i,n=[],a=0;t.length>a;a++)i=$.trim(this[t[a]]),""!==i&&(n[n.length]=i);return e?n.join(" "):n.join(", ")},Array.prototype.UpdateArrToNew=function(t,e){if(e)for(var i=0;e.length>i;i++)t[e[i]]=parseInt(t[e[i]],10);for(var i=0;this.length>i;i++)if(this[i][0]===t[0])return this[i]=t,!0;return!1},Array.prototype.arrElementToInt=function(t){for(var e=0;t.length>e;e++)this[t[e]]=parseInt(this[t[e]],10)},String.prototype.IsImage=function(){var t=this.substring(this.search("\\.")+1).toUpperCase();return"PNG"===t||"JPG"===t||"GIF"===t||"JPEG"===t||"BMP"===t?!0:!1},String.prototype.format=function(){for(var t=this,e=arguments.length;e--;)t=t.replace(RegExp("\\{"+e+"\\}","gm"),arguments[e]);return t};var jscss_filesadded="";String.prototype.GetIcon=function(t){var e=this.search("\\."),i="<span style='display:inline-block;' class='{0} ui-button-icon-primary'>",n="img32-Help";if(e>0){var a=this.substring(this.search("\\.")+1).toLowerCase();i="<a href='/Uploads/"+t+"."+a+"' target='_blank'>"+i+"</a>","png"===a||"jpg"===a||"gif"===a||"jpg"===a||"jpeg"===a||"bmp"===a?n="img32-Img":"xls"===a||"xlsx"===a?n="img32-Excel":"pdf"===a?n="img32-Pdf":"ppt"===a||"pptx"===a?n="img32-ppt":("doc"===a||"docx"===a)&&(n="img32-Word")}else"Add"===this&&(n="img32-"+(""+this));return i.format(n)};var oSIZES={DoneSizes:0};oGLOBAL.Start={fnSetNewData:function(t,e){var i=0,n=e.RenderNew&&oGLOBAL.Start[e.Ctrl]?oGLOBAL.Start[e.Ctrl]:"";n?($("#"+e.Ctrl).empty(),$("#"+e.Ctrl).replaceWith(oGLOBAL.Start[e.Ctrl])):!oGLOBAL.Start[e.Ctrl];for(var a in t)if("Render"===a){var r=t[a];for(var o in r)if(r[o]){$("#"+o).html(r[o]);for(var s=$("#"+o+" div.js-frm"),l=0;s.length>l;l++){var c;"AccidentForm"===$(s)[l].id&&(c=$("#btnSaveAccident")),oCONTROLS.UpdatableForm({frm:$(s)[l],btnSaveToDisable:c})}}}else"ExecFn"===a?i=t[a]:t[a]&&oDATA.SET(a,t[a]);if(i)for(var d in i)i[d]&&$("#"+d)[i[d]]();if("tabMessages"==e.Ctrl);else if("tabAccidents"==e.Ctrl){var u=Tab_AccidentsList(e.Ctrl);oGLOBAL.Start.fnApplyLayout(e.Ctrl,u,20)}else"tabClaims"==e.Ctrl||"tabMap"==e.Ctrl||"tabReports"==e.Ctrl||"tabLists"==e.Ctrl;e.fnCallBack!==void 0&&e.fnCallBack(t),oGLOBAL.Start.FormLoaded(void 0,e.Ctrl),console.log("oGLOBAL.Start.fnSetNewData,#"+e.Ctrl+" height:"+$("#"+e.Ctrl).height())},FormLoaded:function(){$("img.spinner").remove()}},oGLOBAL.date={dateFormat:"yyyy.mm.dd",dateDelimiter:".",getTodayString:function(){return moment().format(oDATA.GET("userData").emData[0].dateFormat)},getDate:function(t){var e=RegExp("([^-]*)"+this.dateDelimiter+"([^-]*)"+this.dateDelimiter+"([^-]*)");this.checkFormat();var i=t.match(e),n=i?new Date(i[2]+"/"+i[3]+"/"+i[1]):"";return n},isDate:function(t){return!isNaN(Date.parse(this.getDate(t)))},firstBigger:function(t,e){return 1===arguments.length&&(e=this.getTodayString()),this.getDate(t)>this.getDate(e)},checkFormat:function(){if("yyyy.mm.dd"!==this.dateFormat)throw Error(err+"no such format in General.js date obj.")}},oGLOBAL.helper={emData_fromDataToSave:function(t,e){return ret={},t.Fields.forEach(function(e,i){ret[e.firstSmall()]=t.Data[i]}),e&&(ret.iD=e),Em.Object.create(ret)},getData_fromDataToSave:function(t,e){return ret="",t.Fields.forEach(function(i,n){i===e&&(ret=t.Data[n])}),ret},executeFunctionByName:function(t,e){for(var i=Array.prototype.slice.call(arguments,2),n=t.split("."),a=n.pop(),r=0;n.length>r;r++)e=e[n[r]];return e[a].apply(e,i)},existsFunctionByName:function(t,e){for(var i=(Array.prototype.slice.call(arguments,2),t.split(".")),n=i.pop(),a=0;i.length>a;a++)if(e=e[i[a]],!e)return!1;return e[n]||!1},execWhen:function(t,e){e||(e=0),t.timeout||(t.timeout=2e3),t.fnCondition()?(t.fnExec(),console.log("execWhen: baigiau - atitiko")):t.timeout/(200*e)>200?(console.log("execWhen: dar"),setTimeout(function(){oGLOBAL.helper.execWhen(t,e++)},200)):(t.fnExec(),console.log("execWhen: baigesi laikas"))}},$(window).load(function(){oGLOBAL.logFromStart("All finished."),$("body").spinner("remove")}),$(oGLOBAL.logFromStart("DOM ready."));var oDATA=Ember.Object.create({me:this,Obj:{},objNames:[],listTemplates:{},SET:function(t,e){this.Obj[t]=e,this.objNames.contains(t)||this.objNames.push(t)},GET:function(t){return this.Obj[t]?this.Obj[t]:(console.warn("Object "+t+" not downloaded yet."),!1)},GetRow:function(t,e){return this.GET(e).emData.findProperty("iD",t)},execWhenLoaded:function(t,e,i,n){var a=n?n:0,r=this,o=!1;return t.forEach(function(t){"tmp"===t.slice(0,3)?Em.TEMPLATES[t]||(console.log("template "+t+" not exists"),o=!0):this.get("exists").call(this,t)||(console.log("obj "+t+" not exists"),o=!0)},r),o?(a=setTimeout(function(){oDATA.execWhenLoaded(t,e,i,a)},200),!1):(0!==a&&clearTimeout(a),e.call(i),void 0)},emBuilder:function(t){if(oData=oDATA.GET(t.tblName),oData.emData||(oData.emData=[]),t.newData){var e,i,n,a=t.newData,r=oData.Cols,o=[],s=oData.emData;for(i=0;r.length>i;i++)e=r[i].FName,o[o.length]=e.slice(0,1).toLowerCase()+e.slice(1);if(t.toAppend)for(i=0;a.length>i;i++){var l={};for(n=0;r.length>n;n++)l[o[n]]=a[i][n];l.visible=!0,t.toAppend.sort?oDATA.setToPlace(t.toAppend,l,s):s.pushObject(Em.Object.create(l))}else for(i=0;a.length>i;i++){var c=s.findProperty("iD",a[i][0]);for(n=1;r.length>n;n++)c.set(o[n],a[i][n])}return t.toAppend&&(oData.Data.length=0),s}},setToPlace:function(t,e,i){var n,a,r=t.col;n="desc"===t.sort?function(t,i){return i.get(r)<=e[r]?(a=t,!1):void 0}:function(t,i){return i.get(r)>=e[r]?(a=t,!1):void 0},$.each(i,n),i.insertAt(a,Em.Object.create(e))},load:function(t,e){if(this.get("exists").call(this,t))throw Error(t+"  already loaded");var i=this.get("SET"),n=this.get("emBuilder"),a=this;$.ajax({url:this.get("listUrl")[t],dataType:"json",type:"POST",success:function(r){i.call(a,t,r[t]);var o=n.call(a,{newData:r[t].Data,tblName:t,toAppend:!0});e(o)}})},exists:function(t){return this.Obj[t]!==void 0},fnErr:function(t,e){throw e?Error(e):Error("No object '"+t+"' in oDATA.listUrl;")},fnLoadMain:function(){this.fnLoad2({url:"Main/tabMain"})},executed:{},fnLoad2:function(t){if(!localStorage)throw Error("No localStorage in Browser");var e=(new Date).getTime(),i=this.get("SET"),n=this.get("emBuilder"),a=this,r=function(){t.callBack&&t.callBack()};t.ctrl?$(t.ctrl).spinner():$("body").spinner();var o=t.name?"ver_"+t.name:t.url;if(this.executed[o]&&!t.runAllways)r(e,"Second click no need to load."),$("img.spinner").remove();else{var s={ver:localStorage[o]?localStorage[o]:0};t.name&&(s.name=t.name),t.dataPars&&$.extend(s,t.dataPars),$.ajax({url:t.url,dataType:"json",type:"POST",data:s,success:function(s){s.system&&s.system.resObj&&(App.Lang=JSON.parse(s.system.resObj)),s.jsonObj&&$.each(s.jsonObj,function(e,r){e=t.name?t.name:e,i.call(a,e,r),n.call(a,{newData:r.Data,tblName:e,toAppend:!0}),"userData"===e&&(App.userData=oDATA.GET("userData").emData[0])}),s.templates&&$.each(s.templates,function(e,i){e=t.name?t.name:e,i?localStorage[e]=i:i=localStorage[e],i||console.error("No template "+e),"tmp2"===e.slice(0,4)?$("body").append('<script id="'+e+'" type="text/x-tmpl">'+i+"</script>"):Em.TEMPLATES[e]||(Em.TEMPLATES[e]=Em.Handlebars.compile(i))}),s.Script?s.Script.File&&(console.log("Downloading js file - "+s.Script.File),$.ajaxSetup({cache:!0}),$.getScript(s.Script.File,function(){r(e,"First click, script loaded.")})):r(e,"First click, no script."),localStorage[o]=s.ver,oDATA.executed[o]=(new Date).getTime()},error:function(t){console.log(t.responseText),window.location="/Account/Logon"},complete:function(){$("img.spinner").remove()}})}}});Ember.ResourceController=Ember.ArrayController.extend(Ember.ResourceAdapter,{init:function(){this._super();var t=this,e=t.get("url");e&&oDATA.fnLoad2({url:e,callBack:function(){t.tableName&&t.set("content",oDATA.GET(t.tableName).emData)}})},content:[],tableName:null,cols:null,config:null,grid:null,path:null,loadStatus:null,getByID:function(t){var e=this.get("content").findValueByID(t);if(!e)throw Error("Didn't found arr value in getById, id -"+t);return e},setNewVal:function(t){"array"!==Em.typeOf(t.newVal[0])&&(t.newVal=[t.newVal]);var e=this;return t.fieldsToInt&&t.newVal.forEach(function(e){e.arrElementToInt(t.fieldsToInt)}),oDATA.emBuilder.call(e,{newData:t.newVal,tblName:e.tableName,toAppend:t.toAppend}),t.newVal},refreshContent:function(){this.get("content").length?alert("Not populated"):this.getAll(url)},getAll:function(t){var e=this;return this._resourceRequest({type:"POST",url:t}).done(function(t){e.set("loadStatus","ok");var i=t[e.get("tableName")];i.Data&&e.set("content",i.Data),i.cols&&e.set("cols",i.cols),i.config&&e.set("config",i.config),i.grid&&e.set("grid",i.grid),console.log("data loaded")})}});var SERVER={update3:function(t){updData=t.ctrl?$.extend({},t.pars,t.ctrl):t.pars,this.send(t.pars,t.CallBack,updData,t.url)},update2:function(t){if(!t.DataToSave)return!1;var e={Success:function(e,i){var n=oDATA.GET(t.source),a="Add"===i.Action?e.ResponseMsg.ID:t.DataToSave.id,r={},o={};if("updateRelations"===t.Action){var s=t.DataToSave.idField.firstSmall(),l=t.DataToSave.Field.firstSmall(),c=n.emData.filter(function(t){return t[s]!==a}),d=t.DataToSave.Data.map(function(t){var e={};return e[s]=a,e[l]=t,Em.Object.create(e)}),u=c.concat(d),p=u.length;n.emData=u;var f="tblDocsInActivity"===t.source?"proc_Activities":"proc_Finances";oDATA.GET(f).emData.findProperty("iD",a).set("docs",0===p?"":p)}else{if(r="Add"===t.Action?Em.Object.create({}):t.row,o="Add"===i.Action?oGLOBAL.helper.emData_fromDataToSave(t.DataToSave,a):n.emData.findProperty("iD",a),"proc_Drivers"===t.source){var h=n.emData.filter(function(t){return t.firstName===o.firstName&&t.lastName===o.lastName});2===h.length&&h.map(function(t){t.notUnique=!1})}if(t.DataToSave.id&&!r&&(r=n.emData.findProperty("iD",t.DataToSave.id)),"Delete"===i.Action)n.emData.removeObject(o);else{var m="Add"===t.Action?!0:!1;if(!r)throw Error("p.Row is empty");var g=n.Cols;if(!n)throw Error("p.oData is empty");if(m&&(r.iD=e.ResponseMsg.ID),g.forEach(function(t){var e=!1,n=t.FName.firstSmall();if(i.DataToSave.Fields.forEach(function(a,o){if(n==a.firstSmall()){var s=i.DataToSave.Data[o];if(t.Type){"Decimal"===t.Type&&(s=parseFloat(s,10));var l=(""+s).toLowerCase();"Integer"!==t.Type&&"Radio"!==t.Type&&"Boolean"!==t.Type||"false"===l||"true"===l||(s=parseInt(s,10)),"number"==typeof s&&isNaN(s)&&(s="")}else"ID"===t.FName.slice(-2)&&(s=parseInt(s,10));if(r.set(n,s),e=!0,t.List){var c=g.findObjectByProperty("IdField",n);if(c){var d=oDATA.GET(t.List.Source).emData.findObjectByProperty("iD",s).MapArrToString(t.List.iText,!0);r.set(c.FName.firstSmall(),d)}else console.warn("List field '"+a+"' without IdField")}}}),!e&&m&&"iD"!==n)if(t.Default){var a=oDATA.GET("userData").emData[0];"Today"===t.Default?r.set(n,oGLOBAL.date.getTodayString()):"UserName"===t.Default?r.set(n,a.userName):"UserId"===t.Default?r.set(n,a.userID):r.set(n,t.Default)}else r.set(n,"");console.log("col: "+n+", ok: "+e+", fieldValue:"+r[n])}),"proc_Drivers"===t.source){var v;h=n.emData.filter(function(t){return t.firstName===r.firstName&&t.lastName===r.lastName}),v=2>h.length?!1:!0,h.map(function(t){t.notUnique=v}),r.notUnique=v}m?(r.set("visible",!0),n.emData.unshiftObject(r)):n.emData.findProperty("iD",r.iD).updateTo(r);var y=i.controller,D=i.emObject?i.emObject:"content";y&&(m?App[y][D].unshiftObject(r):App[y][D].findProperty("iD",r.iD).updateTo(r))}}Em.run.next(function(){$("img.spinner").remove()}),t.CallBackAfter&&t.CallBackAfter(r,i.Action,e,i)}};$.extend(t,{CallBack:e}),t.Ctrl||(t.Ctrl=""),this.update(t)},update:function(t){var e="/Update/"+t.Action,i=t;SERVER.send(t.DataToSave,this.fnUpdated,i,e)},send:function(t,e,i,n,a){a||(a="json"),"string"!=typeof t&&(t=JSON.stringify(t)),i.Ctrl&&$(i.Ctrl).spinner({position:"center",img:"spinnerBig.gif"}),a||(a="json"),$.ajax({type:"POST",url:n,beforeSend:function(t){t.setRequestHeader("Content-type","application/json; charset=utf-8")},data:t,contentType:"application/json; charset=utf-8",dataType:a,error:function(t){console.warn(t),window.location="/Account/Logon"},success:function(t){e(t,i)},complete:function(){$("img.spinner").remove()}})},fnUpdated:function(t,e){var i=e.source?oDATA.GET(e.source).Config.titleFields:!1,n="Duomenų keitimas.";i&&e.row&&(n=e.row.iD?e.row.MapArrToString(i,!0):"Duomenų keitimas."),DefMsg={Title:n||e.Title||"Duomenų keitimas",Error:{Add:"Nepavyko išsaugot naujų duomenų.",Edit:"Nepavyko pakeisti duomenų.",Delete:"Nepavyko ištrinti duomenų."},Success:{}};var a,r,o,s;return t.ErrorMsg?(o="Error",r="img32-warning",s=!0):(o="Success",r="img32-check",s=!1),a=e.Msg?e.Msg[o]:DefMsg[o][e.Action],a||(a=""),"Error"===o&&(a+=" Klaida:\n"+t.ErrorMsg),e.CallBack&&"function"==typeof e.CallBack[o]&&e.CallBack[o](t,e),t.ErrorMsg&&oGLOBAL.notify.withIcon(DefMsg.Title,a,r,s),!1},updateRecord:function(t,e,i,n,a){$.ajax({type:"POST",url:t,data:e,dataType:"json",error:function(t){console.warn(t)},success:function(t){var e=oDATA.GET(i),r=e.Cols,o=Em.Object.create({});if(r.forEach(function(e){o[e.FName.firstSmall()]=t.data.Data[0][e.FName]}),o.visible=!0,"proc_Claims"===i){var s=App.claimsController;s.content.length&&s.setClaimContext(o)}"Add"==n?e.emData.unshiftObject(o):e.emData.findProperty("iD",o.iD).updateTo(o),a&&a()}})}};(function(t){"use strict";var e=function(t,i){var n=/[^\w\-\.:]/.test(t)?Function(e.arg+",tmpl","var _e=tmpl.encode"+e.helper+",_s='"+t.replace(e.regexp,e.func)+"';return _s;"):e.cache[t]=e.cache[t]||e(e.load(t));return i?n(i,e):function(t){return n(t,e)}};e.cache={},e.load=function(t){return document.getElementById(t).innerHTML},e.regexp=/([\s'\\])(?![^%]*%\})|(?:\{%(=|#)([\s\S]+?)%\})|(\{%)|(%\})/g,e.func=function(t,e,i,n,a,r){return e?{"\n":"\\n","\r":"\\r","	":"\\t"," ":" "}[t]||"\\"+t:i?"="===i?"'+_e("+n+")+'":"'+("+n+"||'')+'":a?"';":r?"_s+='":void 0},e.encReg=/[<>&"'\x00]/g,e.encMap={"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;","'":"&#39;"},e.encode=function(t){return((t||"")+"").replace(e.encReg,function(t){return e.encMap[t]||""})},e.arg="o",e.helper=",print=function(s,e){_s+=e&&(s||'')||_e(s);},include=function(s,d){_s+=tmpl(s,d);}","function"==typeof define&&define.amd?define(function(){return e}):t.tmpl=e})(this),function(t){"use strict";var e=function(t,i,n){var a,r,o=document.createElement("img");return o.onerror=i,o.onload=function(){r&&(!n||!n.noRevoke)&&e.revokeObjectURL(r),i(e.scale(o,n))},a=window.Blob&&t instanceof Blob||window.File&&t instanceof File?r=e.createObjectURL(t):t,a?(o.src=a,o):e.readFile(t,function(t){o.src=t})},i=window.createObjectURL&&window||window.URL&&URL.revokeObjectURL&&URL||window.webkitURL&&webkitURL;e.scale=function(t,e){e=e||{};var i=document.createElement("canvas"),n=t.width,a=t.height,r=Math.max((e.minWidth||n)/n,(e.minHeight||a)/a);return r>1&&(n=parseInt(n*r,10),a=parseInt(a*r,10)),r=Math.min((e.maxWidth||n)/n,(e.maxHeight||a)/a),1>r&&(n=parseInt(n*r,10),a=parseInt(a*r,10)),t.getContext||e.canvas&&i.getContext?(i.width=n,i.height=a,i.getContext("2d").drawImage(t,0,0,n,a),i):(t.width=n,t.height=a,t)},e.createObjectURL=function(t){return i?i.createObjectURL(t):!1},e.revokeObjectURL=function(t){return i?i.revokeObjectURL(t):!1},e.readFile=function(t,e){if(window.FileReader&&FileReader.prototype.readAsDataURL){var i=new FileReader;return i.onload=function(t){e(t.target.result)},i.readAsDataURL(t),i}return!1},"function"==typeof define&&define.amd?define(function(){return e}):t.loadImage=e}(this),function(t){"use strict";var e=t.HTMLCanvasElement&&t.HTMLCanvasElement.prototype,i=t.Blob&&function(){try{return Boolean(new Blob)}catch(t){return!1}}(),n=i&&t.Uint8Array&&function(){try{return 100===new Blob([new Uint8Array(100)]).size}catch(t){return!1}}(),a=t.BlobBuilder||t.WebKitBlobBuilder||t.MozBlobBuilder||t.MSBlobBuilder,r=(i||a)&&t.atob&&t.ArrayBuffer&&t.Uint8Array&&function(t){var e,r,o,s,l,c;for(e=t.split(",")[0].indexOf("base64")>=0?atob(t.split(",")[1]):decodeURIComponent(t.split(",")[1]),r=new ArrayBuffer(e.length),o=new Uint8Array(r),s=0;e.length>s;s+=1)o[s]=e.charCodeAt(s);return l=t.split(",")[0].split(":")[1].split(";")[0],i?new Blob([n?o:r],{type:l}):(c=new a,c.append(r),c.getBlob(l))};t.HTMLCanvasElement&&!e.toBlob&&(e.mozGetAsFile?e.toBlob=function(t,i,n){n&&e.toDataURL&&r?t(r(this.toDataURL(i,n))):t(this.mozGetAsFile("blob",i))}:e.toDataURL&&r&&(e.toBlob=function(t,e,i){t(r(this.toDataURL(e,i)))})),"function"==typeof define&&define.amd?define(function(){return r}):t.dataURLtoBlob=r}(this),function(t){"use strict";"function"==typeof define&&define.amd?define(["jquery","load-image","bootstrap"],t):t(window.jQuery,window.loadImage)}(function(t,e){"use strict";t.extend(t.fn.modal.defaults,{delegate:document,selector:null,filter:"*",index:0,href:null,preloadRange:2,offsetWidth:100,offsetHeight:200,canvas:!1,slideshow:0,imageClickDivision:.5});var i=t.fn.modal.Constructor.prototype.show,n=t.fn.modal.Constructor.prototype.hide;t.extend(t.fn.modal.Constructor.prototype,{initLinks:function(){var e=this,i=this.options,n=i.selector||"a[data-target="+i.target+"]";this.$links=t(i.delegate).find(n).filter(i.filter).each(function(t){e.getUrl(this)===i.href&&(i.index=t)}),this.$links[i.index]||(i.index=0)},getUrl:function(e){return e.href||t(e).data("href")},getDownloadUrl:function(e){return t(e).data("download")},startSlideShow:function(){var t=this;this.options.slideshow&&(this._slideShow=window.setTimeout(function(){t.next()},this.options.slideshow))},stopSlideShow:function(){window.clearTimeout(this._slideShow)},toggleSlideShow:function(){var t=this.$element.find(".modal-slideshow");this.options.slideshow?(this.options.slideshow=0,this.stopSlideShow()):(this.options.slideshow=t.data("slideshow")||5e3,this.startSlideShow()),t.find("i").toggleClass("icon-play icon-pause")},preloadImages:function(){var e,i,n=this.options,a=n.index+n.preloadRange+1;for(i=n.index-n.preloadRange;a>i;i+=1)e=this.$links[i],e&&i!==n.index&&t("<img>").prop("src",this.getUrl(e))},loadImage:function(){var t,i=this,n=this.$element,a=this.options.index,r=this.getUrl(this.$links[a]),o=this.getDownloadUrl(this.$links[a]);this.abortLoad(),this.stopSlideShow(),n.trigger("beforeLoad"),this._loadingTimeout=window.setTimeout(function(){n.addClass("modal-loading")},100),t=n.find(".modal-image").children().removeClass("in"),window.setTimeout(function(){t.remove()},3e3),n.find(".modal-title").text(this.$links[a].title),n.find(".modal-download").prop("href",o||r),this._loadingImage=e(r,function(t){i.img=t,window.clearTimeout(i._loadingTimeout),n.removeClass("modal-loading"),n.trigger("load"),i.showImage(t),i.startSlideShow()},this._loadImageOptions),this.preloadImages()},showImage:function(e){var i,n,a=this.$element,r=t.support.transition&&a.hasClass("fade"),o=r?a.animate:a.css,s=a.find(".modal-image");s.css({width:e.width,height:e.height}),a.find(".modal-title").css({width:Math.max(e.width,380)}),r&&(i=a.clone().hide().appendTo(document.body)),t(window).width()>767?o.call(a.stop(),{"margin-top":-((i||a).outerHeight()/2),"margin-left":-((i||a).outerWidth()/2)}):a.css({top:(t(window).height()-(i||a).outerHeight())/2}),i&&i.remove(),s.append(e),n=e.offsetWidth,a.trigger("display"),r?a.is(":visible")?t(e).on(t.support.transition.end,function(i){i.target===e&&(t(e).off(t.support.transition.end),a.trigger("displayed"))}).addClass("in"):(t(e).addClass("in"),a.one("shown",function(){a.trigger("displayed")})):(t(e).addClass("in"),a.trigger("displayed"))},abortLoad:function(){this._loadingImage&&(this._loadingImage.onload=this._loadingImage.onerror=null),window.clearTimeout(this._loadingTimeout)},prev:function(){var t=this.options;t.index-=1,0>t.index&&(t.index=this.$links.length-1),this.loadImage()},next:function(){var t=this.options;t.index+=1,t.index>this.$links.length-1&&(t.index=0),this.loadImage()},keyHandler:function(t){switch(t.which){case 37:case 38:t.preventDefault(),this.prev();break;case 39:case 40:t.preventDefault(),this.next()}},wheelHandler:function(t){t.preventDefault(),t=t.originalEvent,this._wheelCounter=this._wheelCounter||0,this._wheelCounter+=t.wheelDelta||t.detail||0,t.wheelDelta&&this._wheelCounter>=120||!t.wheelDelta&&0>this._wheelCounter?(this.prev(),this._wheelCounter=0):(t.wheelDelta&&-120>=this._wheelCounter||!t.wheelDelta&&this._wheelCounter>0)&&(this.next(),this._wheelCounter=0)},initGalleryEvents:function(){var e=this,i=this.$element;i.find(".modal-image").on("click.modal-gallery",function(i){var n=t(this);1===e.$links.length?e.hide():(i.pageX-n.offset().left)/n.width()<e.options.imageClickDivision?e.prev(i):e.next(i)}),i.find(".modal-prev").on("click.modal-gallery",function(t){e.prev(t)}),i.find(".modal-next").on("click.modal-gallery",function(t){e.next(t)}),i.find(".modal-slideshow").on("click.modal-gallery",function(t){e.toggleSlideShow(t)}),t(document).on("keydown.modal-gallery",function(t){e.keyHandler(t)}).on("mousewheel.modal-gallery, DOMMouseScroll.modal-gallery",function(t){e.wheelHandler(t)})},destroyGalleryEvents:function(){var e=this.$element;this.abortLoad(),this.stopSlideShow(),e.find(".modal-image, .modal-prev, .modal-next, .modal-slideshow").off("click.modal-gallery"),t(document).off("keydown.modal-gallery").off("mousewheel.modal-gallery, DOMMouseScroll.modal-gallery")},show:function(){if(!this.isShown&&this.$element.hasClass("modal-gallery")){var e=this.$element,n=this.options,a=t(window).width(),r=t(window).height();e.hasClass("modal-fullscreen")?(this._loadImageOptions={maxWidth:a,maxHeight:r,canvas:n.canvas},e.hasClass("modal-fullscreen-stretch")&&(this._loadImageOptions.minWidth=a,this._loadImageOptions.minHeight=r)):this._loadImageOptions={maxWidth:a-n.offsetWidth,maxHeight:r-n.offsetHeight,canvas:n.canvas},a>767?e.css({"margin-top":-(e.outerHeight()/2),"margin-left":-(e.outerWidth()/2)}):e.css({top:(t(window).height()-e.outerHeight())/2}),this.initGalleryEvents(),this.initLinks(),this.$links.length&&(e.find(".modal-slideshow, .modal-prev, .modal-next").toggle(1!==this.$links.length),e.toggleClass("modal-single",1===this.$links.length),this.loadImage())}i.apply(this,arguments)},hide:function(){this.isShown&&this.$element.hasClass("modal-gallery")&&(this.options.delegate=document,this.options.href=null,this.destroyGalleryEvents()),n.apply(this,arguments)}}),t(function(){t(document.body).on("click.modal-gallery.data-api",'[data-toggle="modal-gallery"]',function(e){var i,n=t(this),a=n.data(),r=t(a.target),o=r.data("modal");o||(a=t.extend(r.data(),a)),a.selector||(a.selector="a[data-gallery=gallery]"),i=t(e.target).closest(a.selector),i.length&&r.length&&(e.preventDefault(),a.href=i.prop("href")||i.data("href"),a.delegate=i[0]!==this?this:document,o&&t.extend(o.options,a),r.modal(a))})})}),function(t){"use strict";"function"==typeof define&&define.amd?define(["jquery"],t):t(window.jQuery)}(function(t){"use strict";var e=0;t.ajaxTransport("iframe",function(i){if(i.async&&("POST"===i.type||"GET"===i.type)){var n,a;return{send:function(r,o){n=t('<form style="display:none;"></form>'),n.attr("accept-charset",i.formAcceptCharset),a=t('<iframe src="javascript:false;" name="iframe-transport-'+(e+=1)+'"></iframe>').bind("load",function(){var e,r=t.isArray(i.paramName)?i.paramName:[i.paramName];a.unbind("load").bind("load",function(){var e;try{if(e=a.contents(),!e.length||!e[0].firstChild)throw Error()}catch(i){e=void 0}o(200,"success",{iframe:e}),t('<iframe src="javascript:false;"></iframe>').appendTo(n),n.remove()}),n.prop("target",a.prop("name")).prop("action",i.url).prop("method",i.type),i.formData&&t.each(i.formData,function(e,i){t('<input type="hidden"/>').prop("name",i.name).val(i.value).appendTo(n)}),i.fileInput&&i.fileInput.length&&"POST"===i.type&&(e=i.fileInput.clone(),i.fileInput.after(function(t){return e[t]}),i.paramName&&i.fileInput.each(function(e){t(this).prop("name",r[e]||i.paramName)}),n.append(i.fileInput).prop("enctype","multipart/form-data").prop("encoding","multipart/form-data")),n.submit(),e&&e.length&&i.fileInput.each(function(i,n){var a=t(e[i]);t(n).prop("name",a.prop("name")),a.replaceWith(n)})}),n.append(a).appendTo(document.body)},abort:function(){a&&a.unbind("load").prop("src","javascript".concat(":false;")),n&&n.remove()}}}}),t.ajaxSetup({converters:{"iframe text":function(e){return t(e[0].body).text()
},"iframe json":function(e){return t.parseJSON(t(e[0].body).text())},"iframe html":function(e){return t(e[0].body).html()},"iframe script":function(e){return t.globalEval(t(e[0].body).text())}}})}),function(t){"use strict";"function"==typeof define&&define.amd?define(["jquery","jquery.ui.widget"],t):t(window.jQuery)}(function(t){"use strict";t.support.xhrFileUpload=!(!window.XMLHttpRequestUpload||!window.FileReader),t.support.xhrFormDataFileUpload=!!window.FormData,t.widget("blueimp.fileupload",{options:{namespace:void 0,dropZone:t(document),pasteZone:t(document),fileInput:void 0,replaceFileInput:!0,paramName:void 0,singleFileUploads:!0,limitMultiFileUploads:void 0,sequentialUploads:!1,limitConcurrentUploads:void 0,forceIframeTransport:!1,redirect:void 0,redirectParamName:void 0,postMessage:void 0,multipart:!0,maxChunkSize:void 0,uploadedBytes:void 0,recalculateProgress:!0,progressInterval:100,bitrateInterval:500,formData:function(t){return t.serializeArray()},add:function(t,e){e.submit()},processData:!1,contentType:!1,cache:!1},_refreshOptionsList:["namespace","fileInput","dropZone","pasteZone","multipart","forceIframeTransport"],_BitrateTimer:function(){this.timestamp=+new Date,this.loaded=0,this.bitrate=0,this.getBitrate=function(t,e,i){var n=t-this.timestamp;return(!this.bitrate||!i||n>i)&&(this.bitrate=8*(e-this.loaded)*(1e3/n),this.loaded=e,this.timestamp=t),this.bitrate}},_isXHRUpload:function(e){return!e.forceIframeTransport&&(!e.multipart&&t.support.xhrFileUpload||t.support.xhrFormDataFileUpload)},_getFormData:function(e){var i;return"function"==typeof e.formData?e.formData(e.form):t.isArray(e.formData)?e.formData:e.formData?(i=[],t.each(e.formData,function(t,e){i.push({name:t,value:e})}),i):[]},_getTotal:function(e){var i=0;return t.each(e,function(t,e){i+=e.size||1}),i},_onProgress:function(t,e){if(t.lengthComputable){var i,n,a=+new Date;if(e._time&&e.progressInterval&&a-e._time<e.progressInterval&&t.loaded!==t.total)return;e._time=a,i=e.total||this._getTotal(e.files),n=parseInt(t.loaded/t.total*(e.chunkSize||i),10)+(e.uploadedBytes||0),this._loaded+=n-(e.loaded||e.uploadedBytes||0),e.lengthComputable=!0,e.loaded=n,e.total=i,e.bitrate=e._bitrateTimer.getBitrate(a,n,e.bitrateInterval),this._trigger("progress",t,e),this._trigger("progressall",t,{lengthComputable:!0,loaded:this._loaded,total:this._total,bitrate:this._bitrateTimer.getBitrate(a,this._loaded,e.bitrateInterval)})}},_initProgressListener:function(e){var i=this,n=e.xhr?e.xhr():t.ajaxSettings.xhr();n.upload&&(t(n.upload).bind("progress",function(t){var n=t.originalEvent;t.lengthComputable=n.lengthComputable,t.loaded=n.loaded,t.total=n.total,i._onProgress(t,e)}),e.xhr=function(){return n})},_initXHRData:function(e){var i,n=e.files[0],a=e.multipart||!t.support.xhrFileUpload,r=e.paramName[0];(!a||e.blob)&&(e.headers=t.extend(e.headers,{"X-File-Name":n.name,"X-File-Type":n.type,"X-File-Size":n.size}),e.blob?a||(e.contentType="application/octet-stream",e.data=e.blob):(e.contentType=n.type,e.data=n)),a&&t.support.xhrFormDataFileUpload&&(e.postMessage?(i=this._getFormData(e),e.blob?i.push({name:r,value:e.blob}):t.each(e.files,function(t,n){i.push({name:e.paramName[t]||r,value:n})})):(e.formData instanceof FormData?i=e.formData:(i=new FormData,t.each(this._getFormData(e),function(t,e){i.append(e.name,e.value)})),e.blob?i.append(r,e.blob,n.name):t.each(e.files,function(t,n){n instanceof Blob&&i.append(e.paramName[t]||r,n,n.name)})),e.data=i),e.blob=null},_initIframeSettings:function(e){e.dataType="iframe "+(e.dataType||""),e.formData=this._getFormData(e),e.redirect&&t("<a></a>").prop("href",e.url).prop("host")!==location.host&&e.formData.push({name:e.redirectParamName||"redirect",value:e.redirect})},_initDataSettings:function(t){this._isXHRUpload(t)?(this._chunkedUpload(t,!0)||(t.data||this._initXHRData(t),this._initProgressListener(t)),t.postMessage&&(t.dataType="postmessage "+(t.dataType||""))):this._initIframeSettings(t,"iframe")},_getParamName:function(e){var i=t(e.fileInput),n=e.paramName;return n?t.isArray(n)||(n=[n]):(n=[],i.each(function(){for(var e=t(this),i=e.prop("name")||"files[]",a=(e.prop("files")||[1]).length;a;)n.push(i),a-=1}),n.length||(n=[i.prop("name")||"files[]"])),n},_initFormSettings:function(e){e.form&&e.form.length||(e.form=t(e.fileInput.prop("form")),e.form.length||(e.form=t(this.options.fileInput.prop("form")))),e.paramName=this._getParamName(e),e.url||(e.url=e.form.prop("action")||location.href),e.type=(e.type||e.form.prop("method")||"").toUpperCase(),"POST"!==e.type&&"PUT"!==e.type&&(e.type="POST"),e.formAcceptCharset||(e.formAcceptCharset=e.form.attr("accept-charset"))},_getAJAXSettings:function(e){var i=t.extend({},this.options,e);return this._initFormSettings(i),this._initDataSettings(i),i},_enhancePromise:function(t){return t.success=t.done,t.error=t.fail,t.complete=t.always,t},_getXHRPromise:function(e,i,n){var a=t.Deferred(),r=a.promise();return i=i||this.options.context||r,e===!0?a.resolveWith(i,n):e===!1&&a.rejectWith(i,n),r.abort=a.promise,this._enhancePromise(r)},_chunkedUpload:function(e,i){var n,a,r,o,s=this,l=e.files[0],c=l.size,d=e.uploadedBytes=e.uploadedBytes||0,u=e.maxChunkSize||c,p=l.webkitSlice||l.mozSlice||l.slice;return this._isXHRUpload(e)&&p&&(d||c>u)&&!e.data?i?!0:d>=c?(l.error="uploadedBytes",this._getXHRPromise(!1,e.context,[null,"error",l.error])):(a=Math.ceil((c-d)/u),n=function(i){return i?n(i-=1).pipe(function(){var n=t.extend({},e);return n.blob=p.call(l,d+i*u,d+(i+1)*u),n.chunkIndex=i,n.chunksNumber=a,n.chunkSize=n.blob.size,s._initXHRData(n),s._initProgressListener(n),r=(t.ajax(n)||s._getXHRPromise(!1,n.context)).done(function(){n.loaded||s._onProgress(t.Event("progress",{lengthComputable:!0,loaded:n.chunkSize,total:n.chunkSize}),n),e.uploadedBytes=n.uploadedBytes+=n.chunkSize})}):s._getXHRPromise(!0,e.context)},o=n(a),o.abort=function(){return r.abort()},this._enhancePromise(o)):!1},_beforeSend:function(t,e){0===this._active&&(this._trigger("start"),this._bitrateTimer=new this._BitrateTimer),this._active+=1,this._loaded+=e.uploadedBytes||0,this._total+=this._getTotal(e.files)},_onDone:function(e,i,n,a){this._isXHRUpload(a)||this._onProgress(t.Event("progress",{lengthComputable:!0,loaded:1,total:1}),a),a.result=e,a.textStatus=i,a.jqXHR=n,this._trigger("done",null,a)},_onFail:function(t,e,i,n){"parsererror"===e&&(window.location="/Account/Logon"),n.jqXHR=t,n.textStatus=e,n.errorThrown=i,this._trigger("fail",null,n),n.recalculateProgress&&(this._loaded-=n.loaded||n.uploadedBytes||0,this._total-=n.total||this._getTotal(n.files))},_onAlways:function(t,e,i,n){this._active-=1,n.textStatus=e,i&&i.always?(n.jqXHR=i,n.result=t):(n.jqXHR=t,n.errorThrown=i),this._trigger("always",null,n),0===this._active&&(this._trigger("stop"),this._loaded=this._total=0,this._bitrateTimer=null)},_onSend:function(e,i){var n,a,r,o=this,s=o._getAJAXSettings(i),l=function(i,a){return o._sending+=1,s._bitrateTimer=new o._BitrateTimer,n=n||(i!==!1&&o._trigger("send",e,s)!==!1&&(o._chunkedUpload(s)||t.ajax(s))||o._getXHRPromise(!1,s.context,a)).done(function(t,e,i){o._onDone(t,e,i,s)}).fail(function(t,e,i){o._onFail(t,e,i,s)}).always(function(t,e,i){if(o._sending-=1,o._onAlways(t,e,i,s),s.limitConcurrentUploads&&s.limitConcurrentUploads>o._sending)for(var n,a=o._slots.shift();a;){if(n=a.state?"pending"===a.state():!a.isRejected()){a.resolve();break}a=o._slots.shift()}})};return this._beforeSend(e,s),this.options.sequentialUploads||this.options.limitConcurrentUploads&&this.options.limitConcurrentUploads<=this._sending?(this.options.limitConcurrentUploads>1?(a=t.Deferred(),this._slots.push(a),r=a.pipe(l)):r=this._sequence=this._sequence.pipe(l,l),r.abort=function(){var t=[void 0,"abort","abort"];return n?n.abort():(a&&a.rejectWith(r,t),l(!1,t))},this._enhancePromise(r)):l()},_onAdd:function(e,i){var n,a,r,o,s=this,l=!0,c=t.extend({},this.options,i),d=c.limitMultiFileUploads,u=this._getParamName(c);if((c.singleFileUploads||d)&&this._isXHRUpload(c))if(!c.singleFileUploads&&d)for(r=[],n=[],o=0;i.files.length>o;o+=d)r.push(i.files.slice(o,o+d)),a=u.slice(o,o+d),a.length||(a=u),n.push(a);else n=u;else r=[i.files],n=[u];return i.originalFiles=i.files,t.each(r||i.files,function(a,o){var c=t.extend({},i);return c.files=r?o:[o],c.paramName=n[a],c.submit=function(){return c.jqXHR=this.jqXHR=s._trigger("submit",e,this)!==!1&&s._onSend(e,this),this.jqXHR},l=s._trigger("add",e,c)}),l},_replaceFileInput:function(e){var i=e.clone(!0);t("<form></form>").append(i)[0].reset(),e.after(i).detach(),t.cleanData(e.unbind("remove")),this.options.fileInput=this.options.fileInput.map(function(t,n){return n===e[0]?i[0]:n}),e[0]===this.element[0]&&(this.element=i)},_handleFileTreeEntry:function(e,i){var n,a=this,r=t.Deferred(),o=function(t){t&&!t.entry&&(t.entry=e),r.resolve([t])};return i=i||"",e.isFile?e.file(function(t){t.relativePath=i,r.resolve(t)},o):e.isDirectory?(n=e.createReader(),n.readEntries(function(t){a._handleFileTreeEntries(t,i+e.name+"/").done(function(t){r.resolve(t)}).fail(o)},o)):r.resolve([]),r.promise()},_handleFileTreeEntries:function(e,i){var n=this;return t.when.apply(t,t.map(e,function(t){return n._handleFileTreeEntry(t,i)})).pipe(function(){return Array.prototype.concat.apply([],arguments)})},_getDroppedFiles:function(e){e=e||{};var i=e.items;return i&&i.length&&(i[0].webkitGetAsEntry||i[0].getAsEntry)?this._handleFileTreeEntries(t.map(i,function(t){return t.webkitGetAsEntry?t.webkitGetAsEntry():t.getAsEntry()})):t.Deferred().resolve(t.makeArray(e.files)).promise()},_getSingleFileInputFiles:function(e){e=t(e);var i,n,a=e.prop("webkitEntries")||e.prop("entries");if(a&&a.length)return this._handleFileTreeEntries(a);if(i=t.makeArray(e.prop("files")),!i.length){if(n=e.prop("value"),!n)return t.Deferred().resolve([]).promise();i=[{name:n.replace(/^.*\\/,"")}]}return t.Deferred().resolve(i).promise()},_getFileInputFiles:function(e){return e instanceof t&&1!==e.length?t.when.apply(t,t.map(e,this._getSingleFileInputFiles)).pipe(function(){return Array.prototype.concat.apply([],arguments)}):this._getSingleFileInputFiles(e)},_onChange:function(e){var i=e.data.fileupload,n={fileInput:t(e.target),form:t(e.target.form)};i._getFileInputFiles(n.fileInput).always(function(t){n.files=t,i.options.replaceFileInput&&i._replaceFileInput(n.fileInput),i._trigger("change",e,n)!==!1&&i._onAdd(e,n)})},_onPaste:function(e){var i=e.data.fileupload,n=e.originalEvent.clipboardData,a=n&&n.items||[],r={files:[]};return t.each(a,function(t,e){var i=e.getAsFile&&e.getAsFile();i&&r.files.push(i)}),i._trigger("paste",e,r)===!1||i._onAdd(e,r)===!1?!1:void 0},_onDrop:function(t){t.preventDefault();var e=t.data.fileupload,i=t.dataTransfer=t.originalEvent.dataTransfer,n={};e._getDroppedFiles(i).always(function(i){n.files=i,e._trigger("drop",t,n)!==!1&&e._onAdd(t,n)})},_onDragOver:function(t){var e=t.data.fileupload,i=t.dataTransfer=t.originalEvent.dataTransfer;return e._trigger("dragover",t)===!1?!1:(i&&(i.dropEffect="copy"),t.preventDefault(),void 0)},_initEventHandlers:function(){var t=this.options.namespace;this._isXHRUpload(this.options)&&(this.options.dropZone.bind("dragover."+t,{fileupload:this},this._onDragOver).bind("drop."+t,{fileupload:this},this._onDrop),this.options.pasteZone.bind("paste."+t,{fileupload:this},this._onPaste)),this.options.fileInput.bind("change."+t,{fileupload:this},this._onChange)},_destroyEventHandlers:function(){var t=this.options.namespace;this.options.dropZone.unbind("dragover."+t,this._onDragOver).unbind("drop."+t,this._onDrop),this.options.pasteZone.unbind("paste."+t,this._onPaste),this.options.fileInput.unbind("change."+t,this._onChange)},_setOption:function(e,i){var n=-1!==t.inArray(e,this._refreshOptionsList);n&&this._destroyEventHandlers(),t.Widget.prototype._setOption.call(this,e,i),n&&(this._initSpecialOptions(),this._initEventHandlers())},_initSpecialOptions:function(){var e=this.options;void 0===e.fileInput?e.fileInput=this.element.is('input[type="file"]')?this.element:this.element.find('input[type="file"]'):e.fileInput instanceof t||(e.fileInput=t(e.fileInput)),e.dropZone instanceof t||(e.dropZone=t(e.dropZone)),e.pasteZone instanceof t||(e.pasteZone=t(e.pasteZone))},_create:function(){var e=this.options;t.extend(e,t(this.element[0].cloneNode(!1)).data()),e.namespace=e.namespace||this.widgetName,this._initSpecialOptions(),this._slots=[],this._sequence=this._getXHRPromise(!0),this._sending=this._active=this._loaded=this._total=0,this._initEventHandlers()},destroy:function(){this._destroyEventHandlers(),t.Widget.prototype.destroy.call(this)},enable:function(){var e=!1;this.options.disabled&&(e=!0),t.Widget.prototype.enable.call(this),e&&this._initEventHandlers()},disable:function(){this.options.disabled||this._destroyEventHandlers(),t.Widget.prototype.disable.call(this)},add:function(e){var i=this;e&&!this.options.disabled&&(e.fileInput&&!e.files?this._getFileInputFiles(e.fileInput).always(function(t){e.files=t,i._onAdd(null,e)}):(e.files=t.makeArray(e.files),this._onAdd(null,e)))},send:function(e){if(e&&!this.options.disabled){if(e.fileInput&&!e.files){var i,n,a=this,r=t.Deferred(),o=r.promise();return o.abort=function(){return n=!0,i?i.abort():(r.reject(null,"abort","abort"),o)},this._getFileInputFiles(e.fileInput).always(function(t){n||(e.files=t,i=a._onSend(null,e).then(function(t,e,i){r.resolve(t,e,i)},function(t,e,i){r.reject(t,e,i)}))}),this._enhancePromise(o)}if(e.files=t.makeArray(e.files),e.files.length)return this._onSend(null,e)}return this._getXHRPromise(!1,e&&e.context)}})}),function(t){"use strict";"function"==typeof define&&define.amd?define(["jquery","load-image","canvas-to-blob","./jquery.fileupload"],t):t(window.jQuery,window.loadImage)}(function(t,e){"use strict";t.widget("blueimpFP.fileupload",t.blueimp.fileupload,{options:{process:[],add:function(e,i){t(this).fileupload("process",i).done(function(){i.submit()})}},processActions:{load:function(i,n){var a=this,r=i.files[i.index],o=t.Deferred();return window.HTMLCanvasElement&&window.HTMLCanvasElement.prototype.toBlob&&("number"!==t.type(n.maxFileSize)||r.size<n.maxFileSize)&&(!n.fileTypes||n.fileTypes.test(r.type))?e(r,function(t){i.canvas=t,o.resolveWith(a,[i])},{canvas:!0}):o.rejectWith(a,[i]),o.promise()},resize:function(t,i){if(t.canvas){var n=e.scale(t.canvas,i);(n.width!==t.canvas.width||n.height!==t.canvas.height)&&(t.canvas=n,t.processed=!0)}return t},save:function(e){if(!e.canvas||!e.processed)return e;var i=this,n=e.files[e.index],a=n.name,r=t.Deferred(),o=function(t){t.name||(n.type===t.type?t.name=n.name:n.name&&(t.name=n.name.replace(/\..+$/,"."+t.type.substr(6)))),e.files[e.index]=t,r.resolveWith(i,[e])};return e.canvas.mozGetAsFile?o(e.canvas.mozGetAsFile(/^image\/(jpeg|png)$/.test(n.type)&&a||(a&&a.replace(/\..+$/,"")||"blob")+".png",n.type)):e.canvas.toBlob(o,n.type),r.promise()}},_processFile:function(e,i,n){var a=this,r=t.Deferred().resolveWith(a,[{files:e,index:i}]),o=r.promise();return a._processing+=1,t.each(n.process,function(t,e){o=o.pipe(function(t){return a.processActions[e.action].call(this,t,e)})}),o.always(function(){a._processing-=1,0===a._processing&&a.element.removeClass("fileupload-processing")}),1===a._processing&&a.element.addClass("fileupload-processing"),o},process:function(e){var i=this,n=t.extend({},this.options,e);return n.process&&n.process.length&&this._isXHRUpload(n)&&t.each(e.files,function(a){i._processingQueue=i._processingQueue.pipe(function(){var r=t.Deferred();return i._processFile(e.files,a,n).always(function(){r.resolveWith(i)}),r.promise()})}),this._processingQueue},_create:function(){t.blueimp.fileupload.prototype._create.call(this),this._processing=0,this._processingQueue=t.Deferred().resolveWith(this).promise()}})}),function(t){"use strict";"function"==typeof define&&define.amd?define(["jquery","tmpl","load-image","./jquery.fileupload-fp"],t):t(window.jQuery,window.tmpl,window.loadImage)}(function(t,e,i){"use strict";var n=(t.blueimpFP||t.blueimp).fileupload;t.widget("blueimpUI.fileupload",n,{options:{autoUpload:!1,maxNumberOfFiles:void 0,maxFileSize:void 0,minFileSize:void 0,acceptFileTypes:/.+$/i,previewSourceFileTypes:/^image\/(gif|jpeg|png)$/,previewSourceMaxFileSize:5e6,previewMaxWidth:80,previewMaxHeight:80,previewAsCanvas:!0,uploadTemplateId:"template-upload",downloadTemplateId:"template-download",filesContainer:void 0,prependFiles:!1,dataType:"json",add:function(e,i){var n=t(this).data("fileupload"),a=n.options,r=i.files;t(this).fileupload("process",i).done(function(){n._adjustMaxNumberOfFiles(-r.length),i.maxNumberOfFilesAdjusted=!0,i.files.valid=i.isValidated=n._validate(r),i.context=n._renderUpload(r).data("data",i),a.filesContainer[a.prependFiles?"prepend":"append"](i.context),n._renderPreviews(r,i.context),n._forceReflow(i.context),n._transition(i.context).done(function(){n._trigger("added",e,i)!==!1&&(a.autoUpload||i.autoUpload)&&i.autoUpload!==!1&&i.isValidated&&i.submit()})})},send:function(e,i){var n=t(this).data("fileupload");return i.isValidated||(i.maxNumberOfFilesAdjusted||(n._adjustMaxNumberOfFiles(-i.files.length),i.maxNumberOfFilesAdjusted=!0),n._validate(i.files))?(i.context&&i.dataType&&"iframe"===i.dataType.substr(0,6)&&i.context.find(".progress").addClass(!t.support.transition&&"progress-animated").attr("aria-valuenow",100).find(".bar").css("width","100%"),n._trigger("sent",e,i)):!1},done:function(e,i){var n,a=t(this).data("fileupload");i.context?i.context.each(function(r){var o=t.isArray(i.result)&&i.result[r]||{error:"emptyResult"};o.error&&a._adjustMaxNumberOfFiles(1),a._transition(t(this)).done(function(){var r=t(this);n=a._renderDownload([o]).replaceAll(r),a._forceReflow(n),a._transition(n).done(function(){i.context=t(this),a._trigger("completed",e,i)})})}):(t.isArray(i.result)&&(t.each(i.result,function(t,e){i.maxNumberOfFilesAdjusted&&e.error?a._adjustMaxNumberOfFiles(1):i.maxNumberOfFilesAdjusted||e.error||a._adjustMaxNumberOfFiles(-1)}),i.maxNumberOfFilesAdjusted=!0),n=a._renderDownload(i.result).appendTo(a.options.filesContainer),a._forceReflow(n),a._transition(n).done(function(){i.context=t(this),a._trigger("completed",e,i)}))},fail:function(e,i){var n,a=t(this).data("fileupload");i.maxNumberOfFilesAdjusted&&a._adjustMaxNumberOfFiles(i.files.length),i.context?i.context.each(function(r){if("abort"!==i.errorThrown){var o=i.files[r];o.error=o.error||i.errorThrown||!0,a._transition(t(this)).done(function(){var r=t(this);n=a._renderDownload([o]).replaceAll(r),a._forceReflow(n),a._transition(n).done(function(){i.context=t(this),a._trigger("failed",e,i)})})}else a._transition(t(this)).done(function(){t(this).remove(),a._trigger("failed",e,i)})}):"abort"!==i.errorThrown?(i.context=a._renderUpload(i.files).appendTo(a.options.filesContainer).data("data",i),a._forceReflow(i.context),a._transition(i.context).done(function(){i.context=t(this),a._trigger("failed",e,i)})):a._trigger("failed",e,i)},progress:function(t,e){if(e.context){var i=parseInt(100*(e.loaded/e.total),10);e.context.find(".progress").attr("aria-valuenow",i).find(".bar").css("width",i+"%")}},progressall:function(e,i){var n=t(this),a=parseInt(100*(i.loaded/i.total),10),r=n.find(".fileupload-progress"),o=r.find(".progress-extended");o.length&&o.html(n.data("fileupload")._renderExtendedProgress(i)),r.find(".progress").attr("aria-valuenow",a).find(".bar").css("width",a+"%")},start:function(e){var i=t(this).data("fileupload");i._transition(t(this).find(".fileupload-progress")).done(function(){i._trigger("started",e)})},stop:function(e){var i=t(this).data("fileupload");i._transition(t(this).find(".fileupload-progress")).done(function(){t(this).find(".progress").attr("aria-valuenow","0").find(".bar").css("width","0%"),t(this).find(".progress-extended").html("&nbsp;"),i._trigger("stopped",e)})},destroy:function(e,i){var n=t(this).data("fileupload");i.url&&(t.ajax(i),n._adjustMaxNumberOfFiles(1)),n._transition(i.context).done(function(){t(this).remove(),n._trigger("destroyed",e,i)})}},_enableDragToDesktop:function(){var e=t(this),i=e.prop("href"),n=e.prop("download"),a="application/octet-stream";e.bind("dragstart",function(t){try{t.originalEvent.dataTransfer.setData("DownloadURL",[a,n,i].join(":"))}catch(e){}})},_adjustMaxNumberOfFiles:function(t){"number"==typeof this.options.maxNumberOfFiles&&(this.options.maxNumberOfFiles+=t,1>this.options.maxNumberOfFiles?this._disableFileInputButton():this._enableFileInputButton())},_formatFileSize:function(t){return"number"!=typeof t?"":t>=1e9?(t/1e9).toFixed(2)+" GB":t>=1e6?(t/1e6).toFixed(2)+" MB":(t/1e3).toFixed(2)+" KB"},_formatBitrate:function(t){return"number"!=typeof t?"":t>=1e9?(t/1e9).toFixed(2)+" Gbit/s":t>=1e6?(t/1e6).toFixed(2)+" Mbit/s":t>=1e3?(t/1e3).toFixed(2)+" kbit/s":t+" bit/s"},_formatTime:function(t){var e=new Date(1e3*t),i=parseInt(t/86400,10);return i=i?i+"d ":"",i+("0"+e.getUTCHours()).slice(-2)+":"+("0"+e.getUTCMinutes()).slice(-2)+":"+("0"+e.getUTCSeconds()).slice(-2)},_formatPercentage:function(t){return(100*t).toFixed(2)+" %"},_renderExtendedProgress:function(t){return this._formatBitrate(t.bitrate)+" | "+this._formatTime(8*(t.total-t.loaded)/t.bitrate)+" | "+this._formatPercentage(t.loaded/t.total)+" | "+this._formatFileSize(t.loaded)+" / "+this._formatFileSize(t.total)},_hasError:function(t){return t.error?t.error:0>this.options.maxNumberOfFiles?"maxNumberOfFiles":this.options.acceptFileTypes.test(t.type)||this.options.acceptFileTypes.test(t.name)?this.options.maxFileSize&&t.size>this.options.maxFileSize?"maxFileSize":"number"==typeof t.size&&t.size<this.options.minFileSize?"minFileSize":null:"acceptFileTypes"},_validate:function(e){var i=this,n=!!e.length;return t.each(e,function(t,e){e.error=i._hasError(e),e.error&&(n=!1)}),n},_renderTemplate:function(e,i){if(!e)return t();var n=e({files:i,formatFileSize:this._formatFileSize,options:this.options});return n instanceof t?n:t(this.options.templatesContainer).html(n).children()},_renderPreview:function(e,n){var a=this,r=this.options,o=t.Deferred();return(i&&i(e,function(e){n.append(e),a._forceReflow(n),a._transition(n).done(function(){o.resolveWith(n)}),t.contains(document.body,n[0])||o.resolveWith(n)},{maxWidth:r.previewMaxWidth,maxHeight:r.previewMaxHeight,canvas:r.previewAsCanvas})||o.resolveWith(n))&&o},_renderPreviews:function(e,i){var n=this,a=this.options;return i.find(".preview span").each(function(i,r){var o=e[i];a.previewSourceFileTypes.test(o.type)&&("number"!==t.type(a.previewSourceMaxFileSize)||o.size<a.previewSourceMaxFileSize)&&(n._processingQueue=n._processingQueue.pipe(function(){var e=t.Deferred();return n._renderPreview(o,t(r)).done(function(){e.resolveWith(n)}),e.promise()}))}),this._processingQueue},_renderUpload:function(t){return this._renderTemplate(this.options.uploadTemplate,t)},_renderDownload:function(t){return this._renderTemplate(this.options.downloadTemplate,t).find("a[download]").each(this._enableDragToDesktop).end()},_startHandler:function(e){e.preventDefault();var i=t(this),n=i.closest(".template-upload"),a=n.data("data");a&&a.submit&&!a.jqXHR&&a.submit()&&i.prop("disabled",!0)},_cancelHandler:function(e){e.preventDefault();var i=t(this).closest(".template-upload"),n=i.data("data")||{};n.jqXHR?n.jqXHR.abort():(n.errorThrown="abort",e.data.fileupload._trigger("fail",e,n))},_deleteHandler:function(e){e.preventDefault();var i=t(this);e.data.fileupload._trigger("destroy",e,{context:i.closest(".template-download"),url:i.attr("data-url"),type:i.attr("data-type")||"DELETE",dataType:e.data.fileupload.options.dataType})},_forceReflow:function(e){return t.support.transition&&e.length&&e[0].offsetWidth},_transition:function(e){var i=t.Deferred();return t.support.transition&&e.hasClass("fade")?e.bind(t.support.transition.end,function(n){n.target===e[0]&&(e.unbind(t.support.transition.end),i.resolveWith(e))}).toggleClass("in"):(e.toggleClass("in"),i.resolveWith(e)),i},_initButtonBarEventHandlers:function(){var e=this.element.find(".fileupload-buttonbar"),i=this.options.filesContainer,n=this.options.namespace;e.find(".start").bind("click."+n,function(t){t.preventDefault(),i.find(".start button").click()}),e.find(".cancel").bind("click."+n,function(t){t.preventDefault(),i.find(".cancel button").click()}),e.find(".delete").bind("click."+n,function(t){t.preventDefault(),i.find(".delete input:checked").siblings("button").click(),e.find(".toggle").prop("checked",!1)}),e.find(".toggle").bind("change."+n,function(){i.find(".delete input").prop("checked",t(this).is(":checked"))})},_destroyButtonBarEventHandlers:function(){this.element.find(".fileupload-buttonbar button").unbind("click."+this.options.namespace),this.element.find(".fileupload-buttonbar .toggle").unbind("change."+this.options.namespace)},_initEventHandlers:function(){n.prototype._initEventHandlers.call(this);var t={fileupload:this};this.options.filesContainer.delegate(".start button","click."+this.options.namespace,t,this._startHandler).delegate(".cancel button","click."+this.options.namespace,t,this._cancelHandler).delegate(".delete button","click."+this.options.namespace,t,this._deleteHandler),this._initButtonBarEventHandlers()},_destroyEventHandlers:function(){var t=this.options;this._destroyButtonBarEventHandlers(),t.filesContainer.undelegate(".start button","click."+t.namespace).undelegate(".cancel button","click."+t.namespace).undelegate(".delete button","click."+t.namespace),n.prototype._destroyEventHandlers.call(this)},_enableFileInputButton:function(){this.element.find(".fileinput-button input").prop("disabled",!1).parent().removeClass("disabled")},_disableFileInputButton:function(){this.element.find(".fileinput-button input").prop("disabled",!0).parent().addClass("disabled")},_initTemplates:function(){var t=this.options;t.templatesContainer=document.createElement(t.filesContainer.prop("nodeName")),e&&(t.uploadTemplateId&&(t.uploadTemplate=e(t.uploadTemplateId)),t.downloadTemplateId&&(t.downloadTemplate=e(t.downloadTemplateId)))},_initFilesContainer:function(){var e=this.options;void 0===e.filesContainer?e.filesContainer=this.element.find(".files"):e.filesContainer instanceof t||(e.filesContainer=t(e.filesContainer))},_stringToRegExp:function(t){var e=t.split("/"),i=e.pop();return e.shift(),RegExp(e.join("/"),i)},_initRegExpOptions:function(){var e=this.options;"string"===t.type(e.acceptFileTypes)&&(e.acceptFileTypes=this._stringToRegExp(e.acceptFileTypes)),"string"===t.type(e.previewSourceFileTypes)&&(e.previewSourceFileTypes=this._stringToRegExp(e.previewSourceFileTypes))},_initSpecialOptions:function(){n.prototype._initSpecialOptions.call(this),this._initFilesContainer(),this._initTemplates(),this._initRegExpOptions()},_create:function(){n.prototype._create.call(this),this._refreshOptionsList.push("filesContainer","uploadTemplateId","downloadTemplateId"),t.blueimpFP||(this._processingQueue=t.Deferred().resolveWith(this).promise(),this.process=function(){return this._processingQueue})},enable:function(){var t=!1;this.options.disabled&&(t=!0),n.prototype.enable.call(this),t&&(this.element.find("input, button").prop("disabled",!1),this._enableFileInputButton())},disable:function(){this.options.disabled||(this.element.find("input, button").prop("disabled",!0),this._disableFileInputButton()),n.prototype.disable.call(this)}})}),App=Em.Application.create(),App.ApplicationController=Em.Controller.extend(),App.ApplicationView=Em.View.extend({templateName:"tmpApplication"}),App.NavbarController=Em.Controller.extend({currentState:null,fnSetNewTab:function(t){var e=this,i=this.get("currentState");i?($("#ulMainMenu a.selected").removeClass("selected").addClass("notactive"),"tabEmpty"===e.get("currentOutlet")&&$("tabEmpty").empty(),$("body").find("div.validity-tooltip").remove()):e.set("currentOutlet","tabAccidents"),oDATA.GET("userData")||oDATA.fnLoadMain();var n=function(t){Em.run.next(t,function(){var t=$("#"+this.newOutlet);t.removeClass("hidden"),this.transparent?t.addClass("transparent"):t.removeClass("transparent"),this.viewIx>-1&&$("#ulMainMenu a:eq("+this.viewIx+")").removeClass("notactive").addClass("selected"),this.needUrl&&oDATA.fnLoad2({url:this.needUrl,callBack:this.callBack}),this.hide&&$(this.hide).hide(),this.show&&$(this.show).show()})};return $("#"+e.get("currentOutlet")).addClass("hidden"),$("body").spinner(),t.newOutlet||(t.newOutlet=t.newState),e.currentState||t.newOutlet===t.newState?(e.set("currentState",t.newState).set("currentOutlet",t.newOutlet),("tabAccidents"===t.newState||"tabReports"===t.newState)&&$("img.spinner").remove(),n(t),!0):(t.newOutlet="tabEmpty"===t.newOutlet?"tabAccidents":t.newOutlet,e.set("currentState",t.newOutlet).set("currentOutlet",t.newOutlet),App.router.transitionTo(t.newOutlet),console.log("fnSetNewTab2:"+t.newOutlet+";"+t.viewIx),t.newOutlet="",n(t),!1)}}),MY.NavbarController=App.NavbarController.create(),App.NavbarView=Em.View.extend({templateName:"tmpNavbar"}),App.mainMenuView=Em.View.extend({}),function(){var App,Em,MY,oDATA,oGLOBAL,w;w=window,App=w.App,Em=w.Em,oGLOBAL=w.oGLOBAL,oDATA=w.oDATA,MY=w.MY,w.oCONTROLS={UpdatableForm_reset:function(t){return $(t).find(".UpdateField").each(function(){var t,e,i,n;return t=$(this),e=t.data("ctrl"),i="List"===t.data("ctrl").Type?!0:!1,n=e.Value,"checkbox"===t.attr("type")?t.attr("checked",n):t.is("textarea")?t.html(n):i?$.isNumeric(n)?(t.data("newval",n),t.val(oDATA.GET(t.data("ctrl").Source).Data.findColValuesByID(n,e.iText))):void 0:t.val(n)})},UpdatableForm_toSaved:function(t,e,i){return i&&SERVER.update({Action:"Edit",DataToSave:i}),t&&$.extend(e.data("ctrl"),{NewRec:0,id:t}),e.find(".UpdateField").each(function(){var t,e,i;return t=$(this),e=t.data("ctrl"),i=void 0,i="checkbox"===t.attr("type")?t.attr("checked")?1:0:t.is("input")&&"List"===t.data("ctrl").Type?t.data("newval"):t.val(),$.extend(t.data("ctrl"),{Value:i})})},getValFromRow:function(t,e){var i;return i=t.slice(0,1).toLowerCase()+t.slice(1),e[i]},UpdatableForm:function(t){var e,i,n,a,r,o,s;return s="",r=$(t.frm).data("ctrl"),i=App.Lang.tables[r.Source],o=this,e=null,r?(t.row&&t.row.iD&&(r.NewRec=0,r.id=t.row.iD),"0"===r.NewRec&&(r.NewRec=0),n="NoData"===r.Source?"NoData":oDATA.GET(r.Source),a=function(){return e?e.removeAttr("disabled","disabled"):void 0},r.NewRec||(t.btnSaveToDisable?1===t.btnSaveToDisable.length?(e=t.btnSaveToDisable,e.is("button")&&e.attr("disabled","disabled")):console.error("wrong btnSaveToDisable no: "+t.btnSaveToDisable.length):console.warn("no btnSaveToDisable")),$(t.frm).find("div.ExtendIt, span.ExtendIt").each(function(){var e,r,s,l,c,d,u,p,f,h,m,g,v,y,D,b,C,T,w;if(p=$(this),h=p.data("ctrl"),f="",y=-1,u={},c="",!h)return console.warn("e-data not parsed"),!0;"NoData"!==n&&(m=h.Field,c=i.Cols[h.colLabels?h.colLabels:m],c||console.error("Wrong Field")),l="NoData"!==n?$.extend({},n.Cols.findProperty("FName",m)):{},g=void 0,h.classes?"string"==typeof h.classes&&(h.classes={span:"",input:h.classes}):h.classes={span:"",input:""},l=$.extend(!0,l,h,{colLabels:c}),s=l.Type?l.Type:l.List?"List":"","undefined"===s&&console.log("Nesusiparsino ctrl"),e="ui-widget-content ",l.Radio||(e+=p.hasClass("NotUpdateField")?" NotUpdateField":" UpdateField"),"Integer"===s||"Decimal"===s?e+=" number":"List"===s?l.Type="List":(s?-1!==s.search("Date"):void 0)&&(e+=" date"),l.classes.input=l.classes.input+" "+e,"number"!=typeof l.Value&&"boolean"!=typeof l.Value&&(l.Value=l.Value?l.Value.replace(/'/g,'"'):"");for(C in l)"List"===C?$.extend(u,l[C]):"Value"===C||"Validity"===C||"AgrValidity"===C||"Field"===C||"Type"===C||"Ext"===C||"UpdateField"===C||"Editable"===C?u[C]=l[C]:"Radio"===C&&(d=parseInt(l.Value),isNaN(d)||l[C].forEach(function(t){var e;return e=parseInt(t.value),d===e?t.checked=1:delete t.checked}),u[C]=l[C]);return t.row&&(T=o.getValFromRow(l.FName,t.row),T&&(u.Value=T,l.Value=T)),"Integer"===s||"Decimal"===s?"number"==typeof T?(u.Value=T,l.Value=T):null!==T&&T!==void 0&&(u.Value=T,l.Value=T):T&&(u.Value=T,l.Value=T),u=JSON.stringify(u),"Integer"===s||"Decimal"===s?u=u.replace("match('integer')","match(integer)").replace("match('number')","match(number)"):-1!==s.search("Date")&&(u=u.replace("match('date')","match(date)").replace("lessThanOrEqualTo(new Date())","lessThanOrEqualTo(new Date(),\\&quot;Data negali būti didesnė už šiandieną.\\&quot;)")),$.extend(l,{data_ctrl:u},{label:{txt:c.caption,type:l.labelType}}),"Boolean"===s||"checkbox"===s?(f=oCONTROLS.chk(l),$(f).prependTo(p)):"String"===s||"Email"===s||"text"===s||"Textarea"===s||"hidden"===s?(D=l.LenMax===void 0?0:l.LenMax,"hidden"===s?(f+=oCONTROLS.hidden(l),g=$(f).prependTo(p).parent().find("input:first")):101>D&&"Textarea"!==s?(f+=oCONTROLS.txt(l),g=$(f).prependTo(p).parent().find("input:first")):(f+=oCONTROLS.txtarea(l),g=$(f).prependTo(p).parent().find("Textarea:first").autosize())):"Integer"===s||"Decimal"===s?(f+=oCONTROLS.txt(l),g=$(f).prependTo(p).parent().find("input:first")):"Radio"===s||l.Radio?(f=oCONTROLS.radio(l),p.addClass("UpdateField").data("ctrl").Type="Radio",$(f).prependTo(p)):-1!==s.search("Date")&&(v=0,l.Value||"Today"!==l.Default||(l.Value=oGLOBAL.date.getTodayString()),-1!==s.search("Time")&&(r=l.Value.length>=16?l.Value.substring(11,16):"00:00",v=1),l.Value=l.Value.substring(0,11),f+=oCONTROLS.txt(l),v&&(f+=oCONTROLS.txt({Value:r,title:"Laikas",classes:"ui-widget-content time",add:"onfocus='this.select()' onMouseUp='return false'"})),g=$(f).prependTo(p).parent().find("input.time").inputControl({type:"Time"}).end().find("input:first")),l.List&&(g?g.ComboBox():(f+=oCONTROLS.txt(l),g=$(f).prependTo(p).parent().find("input").ComboBox())),b=l.Plugin?l.Plugin:!1,b&&$.each(b,function(t,e){return g[t](e)
}),"Boolean"===s||"checkbox"===s?p.find("input:checkbox").on("click",a):l.List?g.data("autocomplete").fnItemChanged=function(){return a()}:g&&(w=g.val(),g.hasClass("date")&&!b.inputControl&&g.inputControl({type:"Date"}),g.hasClass("hasDatepicker")&&b.datepicker&&g.datepicker("option","onSelect",a).closest("div.ExtendIt").find("input.time").on("keyup",a),g.on("keyup",a).val(w)),g!==void 0?(g.val($.trim(g.val())),"Integer"!==s&&"Decimal"!==s||b.inputControl||g.inputControl({type:s}),g.attr("placeholder",c.place?c.place:"Pradėkite vesti..")):void 0}),Em.run.next({frm:t.frm},function(){var t;return t=$(this.frm),t.parent().find("button").blur(),t.data("ctrl").NewRec?t.find("input:text[value='']:first").focus():void 0})):(console.warn("No frmOpt"),void 0)},ValidateForm:function(frm,DataToSaveAppend){var DataTable,DataToSave,NewRec,ValRes,c,i,id;if($("div.validity-modal-msg").remove(),c=frm.data("ctrl"),id=parseInt(c.id,10),NewRec=parseInt(c.NewRec,10),DataTable=c.tblUpdate?c.tblUpdate:oDATA.GET(c.Source).Config.tblUpdate,!id&!NewRec&&console.error("Nėra nurodyta id formos data(ctrl)!"),$.validity.start(),DataToSave={Data:[],Fields:[],DataTable:DataTable},$.each(frm.find(".UpdateField:visible"),function(i,v){var CheckIt,Empty,FName,NotEmpty,OldVal,Require,TimeCtrl,Type,UpdateField,Validity,Value,aVal,e,elDesc,val;return e=$(v),elDesc=e[0].tagName+", id-"+e.attr("id"),Value=void 0,UpdateField=e.data("ctrl").UpdateField?e.data("ctrl").UpdateField:!1,void 0===e.data("ctrl")?(console.error("Nerasta data(ctrl),el: "+elDesc),!0):(Type=void 0,FName=e.data("ctrl").Field,OldVal=NewRec?"":$.trim(e.data("ctrl").Value),val="","checkbox"===e.attr("type")?(NewRec||(OldVal=OldVal&&"False"!==OldVal&&"0"!==OldVal?1:0),val=e.attr("checked")?1:0,e.data("ctrl").ToggleValue&&(val=val?0:1,OldVal=10)):(e.data("ctrl").Type===void 0?console.error("Nerastas elemento Tipas!"):(Type=e.data("ctrl").Type,Validity=e.data("ctrl").Validity?e.data("ctrl").Validity:"","hidden"===Type?val=e.val():"Radio"===Type?(val=e.find("input:radio:checked").val(),OldVal=e.data("ctrl").Value):"Date"===Type.substring(0,4)?(Validity=Validity.replace(/match\(date\)/g,"match('date')"),val=$.trim(e.val()),"-"===val&&(val=""),(-1!==Validity.indexOf("require")||""!==e.val())&&(eval("$(this)."+Validity),Type.search(/time/i)>-1&&(TimeCtrl=e.parent().next(),TimeCtrl.require().match(/^\d{2}[:]\d{2}$/,"Turi būti laiko formatas - valandos:minutės, pvz.12:30"),val=val+" "+TimeCtrl.val()+":00"))):"List"===Type?$.isNumeric(e.data("newval"))?val=e.data("newval"):e.hasClass("notRequired")?e.val(""):(e.val(""),e.require("Parinkite reikšmę iš sąrašo.")):(("Decimal"===Type||"Integer"===Type)&&(e.val(e.val().replace(/,/g,".")),Validity=Validity.replace(/match\(number\)/g,"match('number')").replace(/match\(integer\)/g,"match('integer')")),val=e.val(),CheckIt=id?OldVal!==val?!0:!1:!0,Require=Validity.search(/require/i)>-1,NotEmpty=""===val?!1:!0,(CheckIt&&(Require||NotEmpty)?Validity:void 0)&&eval("$(this)."+Validity))),e.data("ctrl").AgrValidity!==void 0&&(aVal=e.data("ctrl").AgrValidity,"require"===aVal.Validity&&(Empty=$.map($(aVal.Selector),function(t){return $(t).val()?null:1}),Empty.length===$(aVal.Selector).length&&e.require(aVal.Msg)))),OldVal!==val||0===val&&""===OldVal||NewRec?UpdateField?DataToSave[UpdateField]=val:(DataToSave.Data.push(val),DataToSave.Fields.push(FName)):void 0)}),"object"==typeof DataToSaveAppend)if($.isArray(DataToSaveAppend))for(i=0;DataToSaveAppend.length>i;)DataToSave.Data.push(DataToSaveAppend[i].Data),DataToSave.Fields.push(DataToSaveAppend[i].Fields),i++;else if(!$.isEmptyObject(DataToSaveAppend))for(i=0;DataToSaveAppend.Data.length>i;)DataToSave.Data.push(DataToSaveAppend.Data[i]),DataToSave.Fields.push(DataToSaveAppend.Fields[i]),i++;return ValRes=$.validity.end(),ValRes.valid&&DataToSave.Data.length?(NewRec||(DataToSave.id=id),DataToSave):ValRes.valid?0:!1},lbl:function(t){return"<label class='dialog-form-label'>"+t+"</label>"},AddToProperty:function(t,e,i){return t[e]=t[e]?t[e]+" "+i:i,t},basic:function(t){var e;return e="","string"==typeof t.classes?e=t.classes:t.classes.input&&(e=t.classes.input),(t.add?t.add+" ":"")+(t.attr?t.attr+" ":"")+(t.id?"id='"+t.id+"' ":"")+(t.style?'style="'+t.style+'" ':"")+(t.notabstop?"tabindex='-1' ":"")+(t.title?"title='"+t.title+"' ":"")+(t.data_ctrl?"data-ctrl='"+t.data_ctrl+"' ":"")+(e?"class='"+e+"' ":"")},appendLabel:function(t,e){var i,n;return t.label?t.label.txt&&"None"!==t.label.type?t.label===void 0||"None"===t.label?e:((t.classes?t.classes.label:void 0)&&(n=t.classes.label),i="Top"===t.label.type?!0:!1,"<label class='"+(i?"toplabel":"leftlabel")+(n?" "+n:"")+(t.colLabels.tip?" js-tip":"")+"'><span "+(t.classes.span?"class='"+t.classes.span+"'":"")+"><span>"+t.label.txt+(i?"":":")+"</span></span>"+e+"</label>"):e:e},txt:function(t){return("Integer"===t.Type||"Decimal"===t.Type)&&(t.Value=t.Value+""),this.appendLabel(t,"<input type='text' "+this.basic(t)+(t.Value?'value="'+$.trim(t.Value).replace(/"/g,"&quot;")+'" ':"")+"/>")},hidden:function(t){return this.appendLabel(t,"<input type='hidden' "+this.basic(t)+(t.Value?'value="'+$.trim(t.Value).replace(/"/g,"&quot;")+'" ':"")+"/>")},radio:function(t){var e,i,n;return t.classes.label&&(i=t.classes.label),e=t.classes?t.classes:"",n="<label"+(t.colLabels.tip?" class='js-tip'":"")+">"+t.colLabels.caption+":</label>",n+=t.Radio.map(function(i){return"<label "+(e.label?"class='"+e.label+"'":"")+"><input "+(e.input?"class='"+e.input+"'":"")+" type='radio' name='rd_"+t.Field+"' value='"+i.value+"'"+(i.checked?" checked":"")+"/>"+i.label+"</label>"}).join("")},a:function(t){return"<a "+this.basic(t)+" href='javascript:void(0);return false;'>"+$.trim(t.Value).replace(/"/g,"&quot;")+"</a>"},txtarea:function(t){return this.appendLabel(t,"<textarea cols='100' rows='"+(t.textAreaRows?t.textAreaRows:4)+"' "+this.basic(t)+">"+(t.Value?t.Value.replace(/"/g,"&quot;"):"")+"</textarea>")},chk:function(t){return"string"==typeof t.Value&&(t.Value=t.Value.toLowerCase().search(/false/i)>-1||""===t.Value||0===t.Value?0:1),"<label "+(t.label.classes?" class='"+t.label.classes+"'":"")+(t.attr?t.attr+" ":"")+"><input type='checkbox' "+this.basic(t)+(t.Value?"checked='checked'":"")+"/>"+(t.label.txt?t.label.txt:"")+"</label>"},img:function(t){return"<img src='"+t.src+"' alt='"+t.alt+"' onclick='"+t.onclickfn+"'/>"},ui_img:function(t){return"<span class='ui-icon "+t.name+"' style='"+t.style+";margin-top:.5em;' onclick=\""+t.onclickfn+'"/>'},txt_imgINtxt:function(t,e,i){return e.classes=e.classes?e.classes+" InputInWraper":"InputInWraper",w="width:"+(t.width-20)+"px;",e.style=e.style?e.style+w:w,"<div "+this.basic(t)+"width:"+t.width+"px;"+"'>"+this.txt(e)+this.ui_img(i)+"</div>"},btnOKimg:function(t){return"<button tabindex='-1' title='"+t+"' class='ui-button ui-widget ui-state-default ui-button-icon-only ui-corner-all ui-button-icon' role='button'><span class='ui-button-icon-primary ui-icon ui-icon-circle-check'></span><span class='ui-button-text'>&nbsp;</span></button></div>"},lbltxt_inline_btnConfirm:function(t,e,i,n,a){return"<div id="+t+"><label class='dialog-form-r'>"+e+"</label><input type='text' data-ctrl=\""+i+"\" value='"+n+"' class='validate-dialog ui-widget-content ui-corner-left'/><button tabindex='-1' title='"+a+"' class='ui-button ui-widget ui-state-default ui-button-icon-only ui-corner-right ui-button-icon' role='button'><span class='ui-button-icon-primary ui-icon ui-icon-circle-check'></span><span class='ui-button-text'>&nbsp;</span></button></div>"},lbla_inline:function(t,e,i,n){return"<div id="+t+"><label class='dialog-form-label'>"+e+'</label><a data-ctrl="'+n+"\" href='javascript:void(0);'>"+i+"</a></div>"},btnTextOnly:function(t){return oCONTROLS.AddToProperty(t,"classes","ui-button ui-corner-all ui-button-text-icon-primary"),"<button "+oCONTROLS.basic(t)+'" role="button"><span class="ui-button-text">'+t.text+"</span></button>"},btnImgOnly:function(t){return oCONTROLS.AddToProperty(t,"classes","ui-button ui-corner-all ui-icon-only"),"<button "+oCONTROLS.basic(t)+'" role="button"><span class="ui-button-icon-primary ui-icon '+t.icon+'"></span></button>'},btnTextImg:function(t){return oCONTROLS.AddToProperty(t,"classes","ui-button ui-corner-all ui-button-text-icon-primary"),"<button "+oCONTROLS.basic(t)+'" role="button"><span class="ui-button-icon-primary ui-icon '+t.icon+'"></span><span class="ui-button-text">'+t.text+"</span></button>"},OptionList:function(t){var e,i,n,a,r,o,s,l,c;for(e="<select id='"+t.id+"' name= id='"+t.id+"'>",r=0;t.Arr.length>r;){for(a=[],i=0;t.TextI.length>i;)a.push(t.Arr[r][t.TextI[i]]),i++;if(t.ReplaceArr!==void 0)for(o=0;t.ReplaceArr.length>o;){for(l=t.ReplaceArr[o].obj.Data,n=t.ReplaceArr[o].Ix,c=t.ReplaceArr[o].txtIx,s=0;l.length>s;){if(a[n]===l[s][0]){a[n]=l[s][c];break}s++}o++}a=a.join(", "),e+=t.SelectedID?'<option value="'+t.Arr[r][t.ValI]+(+t.Arr[r][0]===t.SelectedID?'" selected="selected"':'"')+">"+a+"</option>":'<option value="'+t.Arr[r][t.ValI]+'">'+a+"</option>",r++}return e+"</select>"},Set_Updatable_HTML:{mega_select_list:function(t){var e,i,n,a;for(e="<div class='container medium heading'><div class='left'>"+t.opt.SelectText+"<span></span></div>"+"<div class='right'><a id='aCancelSelectOpt' class='floatright btn' href='#'>Atšaukti</a></div></div>",e+="<div class='megaselectlistoptions clearfix'>",a="",n=1;t.oDATA.emData.length>n;)a+="<div class='megaselectlistcolumn'><ul>",a+="<li 'tabindex=-1' data-val="+t.oDATA.emData[n][t.opt.val]+">"+t.oDATA.emData[n][t.opt.text]+"</li>",a+="<li 'tabindex=-1' data-val="+t.oDATA.emData[n+1][t.opt.val]+">"+t.oDATA.emData[n+1][t.opt.text]+"</li>",a+="<li 'tabindex=-1' data-val="+t.oDATA.emData[n+2][t.opt.val]+">"+t.oDATA.emData[n+2][t.opt.text]+"</li></ul></div>",n+=3;return e+=a+"<div style='clear: both;'></div></div></hr>",$(t.ctrl).append(e),i=t.ctrl.find("div.megaselectlistoptions"),i.data("height",i.height()),t.ctrl.find("a.floatright").bind("click",function(){return t.fnCancel(),!1}),t.ctrl.find("li").bind("click",function(){var e;return $("#aCancelSelectOpt").remove(),e=$(this),t.ctrl.find("span:eq(0)").html(e.html()),t.ctrl.data("ctrl")[t.opt.FieldName]=e.data("val"),t.ctrl.attr("data-ctrl",JSON.stringify(t.ctrl.data("ctrl"))),"function"==typeof t.fnAfterOptClick&&t.fnAfterOptClick($(this)),t.ctrl.find("div.megaselectlistoptions").height("0px")}),t.ctrl.find("span").bind("click",function(){return i=t.ctrl.find(".megaselectlistoptions"),0===i.height()?i.animate({height:i.data("height")+"px"}):i.animate({height:"0px"})})},lbltxt_inline_btnConfirm:function(t){return t.ctrl.html(oCONTROLS.lbl(t.lblTitle)+oCONTROLS.txt(t.txt.Title,t.txt.Value,'{"Validity":"'+t.Data.Validity+'"}')+oCONTROLS.btnOKimg(t.btnTitle)),t.fnPostInit!==void 0&&t.fnPostInit(),t.ctrl.find("button").bind("click",function(e){return e.preventDefault(),oGLOBAL.ValidateCtrlsArr([t.ctrl.find("input")])&&(t.DataToSave.Data[0]=t.ctrl.find("input").val(),SERVER.update("Edit",t.DataToSave,t.Data.tblToUpdate,t.fnCallBack,"")),t.ctrl.block("Siunčiami duomenys.."),!1})},lbla_inline:function(t){return t.ctrl.html(oCONTROLS.lbla_inline("divID"+t.DataToSave.id,t.lblTitle,t.Value,"")),t.ctrl.find("a").bind("click",function(e){return e.preventDefault(),SERVER.update("Edit",t.DataToSave,t.Data.tblToUpdate,t.fnCallBack,""),t.ctrl.block("Siunčiami duomenys.."),!1})}},table:{getAll:function(t){var e,i,n,a,r;return i=t.fields,e=t.content,a=i.length,n=a-1,a!==Object.keys(e[0]).length&&console.error("notSameNo"),r="<table class='zebra-striped'><thead><tr><th>",i.forEach(function(t,e){return t.visible?(r+=t.title,r+=e!==n?"</th><th>":"</th></thead>"):void 0}),r+this.getBody(t)+"</table>"},getBody:function(t){var e,i;return i="<tbody>",e=t.fields,t.content.forEach(function(t){return i+="<tr><td>",e.forEach(function(e,n){return e.visible?(i+=t[e.name],i+=n!==last?"</td><td>":"</td></tr>"):void 0})}),i+"</tbody>"}},dialog:{opt:{title:"",msg:"",autoOpen:!1,height:"auto",width:350,minWidth:300,modal:!0,show:"clip",hide:"clip",close:function(){return oCONTROLS.dialog.destroy(this)}},destroy:function(t){return $(t).dialog("destroy"),$("#dialog_form_tmp_id").remove()},Alert:function(t){var e;return e={Gerai:function(){return oCONTROLS.dialog.destroy(this)}},this.showDialog(t,e)},Confirm:function(t,e){var i,n;return oCONTROLS.dialog.fnCallBack=e,n=!1,i={Taip:function(){var t;return t=oCONTROLS.dialog,t.fnCallBack(),t.destroy(this)},Ne:function(){return oCONTROLS.dialog.destroy(this)}},"string"==typeof e&&(delete i.Taip,t.open=function(){return $("<a />",{"class":"linkClass linkYes",text:"Taip",href:e,target:"_blank"}).insertBefore($(".ui-dialog-buttonpane button"))},n=!0),this.showDialog(t,i,n)},showDialog:function(t,e){var i,n;return n=$.extend(!0,{},this.opt,{buttons:e},t),i=$('<div id="dialog_form_tmp_id">').html(t.msg).dialog(n).dialog("open"),Em.run.next(function(){return $("#dialog_form_tmp_id").on("click","a.linkYes",function(){return alert("opa")})})}}}}.call(this),function(){var t,e=window,i=e.jQuery,n=e.App,a=e.Em;t=0,i.widget("ui.UploadFiles",{options:{uploadTemplateId:"tmp2templateUpload",downloadTemplateId:"tmp2templateDownload",formTemplate:"tmpUploadForm",docsController:"treeDocController",url:"Files/Start",fileuploaddone:function(){},categoryOpts:{},ListType:"List",Source:"tblDocTypes",iVal:"iD",iText:["name"]},_create:function(){var e;return e="",a.View.create({templateName:this.options.formTemplate,options:this.options,showPhoto:this.options.showPhoto,showFromAccident:this.options.showFromAccident,addFromAccident:function(){return a.run.next(this,function(){return MY.dialog=JQ.Dialog.create({controllerBinding:"App.claimDocController",categoryOpts:this.options.categoryOpts,claim:this.options.claim,init:function(){var t;return this._super(),t=this.claim.accident,this.title="Įvykis Nr. "+t.no+", "+t.accType+", "+t.date,n.claimDocController.setAccDocs(this.categoryOpts,this.claim)},didInsertElement:function(){var t;return this._super(),t=i("#dialogContent")},width:700,buttons:{"Išsaugoti pakeitimus":function(){var t,e,i;return e=[],i=n.claimDocController,i.vGroup.forEach(function(t){return t.items.forEach(function(t){return t.added?e.push(t.docID):void 0})}),t={id:i.activityID,idField:"ActivityID",Field:"DocID",Data:e,DataTable:i.relationTbl},SERVER.update2({Action:"updateRelations",DataToSave:t,source:i.relationTbl,CallBackAfter:function(){return i.refreshDocs(),MY.dialog.ui.close()}}),console.log(t),oDATA.GET("proc_InsPolicies").emData}},runFunction:function(t){return t.$().find("div.groupHead input").on("click",function(e){var n,a;return t=i(e.target),n=t.closest("div.groupHead"),n.length?a=n.next().find("input").prop("checked",i(e.target).prop("checked")):void 0})},cancelLink:!0,templateName:"tmpAccidentDocs"}).append()})}}).appendTo(this.element),a.run.next(this,function(){return e=this.element.find("form").data("opts",this.options),e.fileupload(this.options),i(".fileupload-progress").addClass("hidden")}),a.run.next(this,function(){return e.bind("fileuploadadded",function(t,e){var i,n,a;return a=e.context,e.form.find(".submitButtons").removeClass("hidden"),i=a.find("input[name='category[]']"),n=e.form.data("opts"),(e.paramName="docs[]")?i.ComboBoxCategory(n):console.log("paveikslai")}).bind("fileuploadadd",function(t,e){var i;return e.files[0].paramName=e.paramName,i=e.files[0].name.split(".").pop().substring(0,3),e.files[0].extension="xls"===i||"doc"===i||"pdf"===i?i:"unknown",e.files[0].type2=e.files[0].type.split("/")[0]}).bind("fileuploadsubmit",function(t,e){var n,a,r,o,s,l,c,d,u;return i(".fileupload-progress").removeClass("hidden"),u=e.context,s=e.files[0],l=e.form.data("opts"),c=l.categoryOpts.accident,o=u.find("input[name='category[]']"),n=c?c.iD:null,r=o.data("refID"),r=r?r:n,o.length?(a=o.data("categoryID"),a=a?a:5):a=1,l.requireCategory&&"number"!=typeof o.data("newval")?(e.context.find("input.ui-autocomplete-input").closest(".ExtendIt").addClass("validity-error-on-field").closest("td").append("<div class='validity-tooltip'>Priskirkite dokumentui kategoriją</div>"),!1):(e.formData={FileName:s.name,FileSize:s.size,DocTypeID:o.data("newval"),RefID:r,GroupID:a,Description:u.find("textarea[name='description[]']").val(),AccidentID:n},d=l.lastUpload?oDATA.GET("tblDocGroup").emData.findProperty("iD",l.lastUpload.GroupID).ref:{},5===e.formData.GroupID?l.lastUpload=e.formData:5!==d&&2!==d?l.lastUpload=e.formData:void 0)}).bind("fileuploaddone",function(e,r){var o,s,l,c,d,u,p,f,h,m,g,v,y,D;return r.result.success?(console.log("Upload result for file '"+r.files[0].name+"':"),console.log(r.result),p=a.Object.create(r.result.tblDoc),oDATA.GET("tblDocs").emData.pushObject(p),h=oDATA.GET("tblDocGroup").emData.findProperty("iD",p.groupID).ref,3===h?(d=oDATA.GET("proc_Drivers").emData.findProperty("iD",p.refID),s=parseInt(d.docs.slice(1,-1),10),isNaN(s)&&(s=0),s++,c="("+s+")",d.set("docs",c),g=oDATA.GET("proc_topDrivers"),g&&(u=g.emData.findProperty("iD",p.refID),u&&u.set("docs",c))):4===h&&(y=oDATA.GET("proc_Vehicles").emData.findProperty("iD",p.refID),s=parseInt(y.docs.slice(1,-1),10),isNaN(s)&&(s=0),s++,c="("+s+")",y.set("docs",c),v=oDATA.GET("proc_topVehicles"),v&&(D=v.emData.findProperty("iD",p.refID),D&&D.set("docs",c))),f=r.form.data("opts"),f.updateRelationsTbl&&(t++,o=JSON.parse(JSON.stringify(f.updateRelationsTbl)),m=o.DataTable,o.Data.push(r.result.tblDoc.iD),SERVER.update2({Action:"Add",DataToSave:o,source:m,CallBackAfter:function(){return t--}})),r.context.remove(),!r.form.find("table tbody tr").length&&(r.form.find(".submitButtons, table, .fileupload-progress").addClass("hidden"),l=f.docsController,f.updateRelationsTbl?oGLOBAL.helper.execWhen({fnCondition:function(){return 0===t},fnExec:function(){return n[l].refreshDocs()}}):n[l].refreshDocs(),f.lastUpload.AccidentID&&f.refreshTree)?(n.docsTypesController.refreshTree(),a.run.next({opts:f},function(){var t,e,n;return e=this.opts.lastUpload,h=oDATA.GET("tblDocGroup").emData.findProperty("iD",e.GroupID).ref,t=e.DocTypeID,n=i("#dynamicTree>div>ul").children("li[data-category-id='"+e.GroupID+"']"),4===h&&(n=n.find("ul").children("li.isGroup[data-ref-id='"+e.RefID+"']")),this.opts.lastUpload=null,n.trigger("click")})):void 0):console.warn("upload error")}).find(".fileinput-button").on("click",function(){return i(this).closest("form").find("table").removeClass("hidden").end().find("a.cancel").on("click",function(){return i(this).closest("form").find(".submitButtons, table").addClass("hidden"),i(this).closest("form").find("table tbody tr").remove()})})})}}),n.editDocsController=a.Object.create({getOpts:function(t){var e;return e=t.closest("ul").parent().find("form"),e.length||(e=t.closest("ul").closest("table").parent().parent().find("form:first")),e.data("opts")},editDoc:function(t){var e;return e=i(t.target).parent().parent(),e.addClass("docs-selected"),t.context.set("editMode",!0),a.run.next(this,function(){return e.find("input.docType").ComboBoxCategory(this.getOpts(e))})},cancelSaveDoc:function(t){var e;return e=i(t.target).parent().parent().find("input.docType"),i(".docs-selected").removeClass("docs-selected"),e.autocomplete("destroy").removeData("autocomplete"),t.context.set("editMode",!1)},SaveEditedDoc:function(t){var e,a,r,o,s,l,c,d,u;return u=i(t.target).parent().parent(),r=u.find("input.description").val(),l=u.find("input.docType").data("newval"),a=n[this.getOpts(u).docsController],c=u.find("input.docType").val(),e=t.context,s=e.docID,o=oDATA.GET("tblDocs").emData.findProperty("iD",s),l=l?l:o.docTypeID,d=oDATA.GET("tblDocTypes").emData.findProperty("iD",l).docGroupID,SERVER.update2({Action:"Edit",Ctrl:u,source:"tblDocs",row:o,DataToSave:{id:s,Data:[d,l,r],Fields:["groupID","docTypeID","description"],DataTable:"tblDocs"},CallBackAfter:function(){return a.refreshDocs(),i(".docs-selected").removeClass("docs-selected")}})},deleteDoc:function(t){var e,a,r;return r=i(t.target).parent().parent(),e=t.context,a=n[this.getOpts(r).docsController],oCONTROLS.dialog.Confirm({title:"Dokumento pašalinimas",msg:"Ištrinti dokumentą '"+e.docName+"'?"},function(){return SERVER.update2({Action:"Delete",Ctrl:r,source:"tblDocs",DataToSave:{id:e.docID,DataTable:"tblDocs"},Msg:{Title:"Dokumento pašalinimas",Success:"Dokumentas '"+e.docName+"' pašalintas.",Error:"Nepavyko pašalinti dokumento '"+e.docName+"'."},CallBackAfter:function(){return a.refreshDocs(),i(".docs-selected").removeClass("docs-selected")}})})}})}.call(this),Handlebars.registerHelper("highlight",function(t){var e=Ember.getPath(this,t);return new Handlebars.SafeString('<span class="highlight">'+e+"</span>")}),Handlebars.registerHelper("currency",function(t){var e=Ember.getPath(this,t)+"";return e+=" "+App.accidentsController.currency,new Handlebars.SafeString(e)}),Handlebars.registerHelper("updatableField",function(t,e){t||console.error("No prop");var i=t,n=e.hash,a=this[i];!a&&this.content&&(a=this.content[0][i]),a||(a=""),"string"==typeof a&&(a=a.replace(/'/g,"\\&quot;").replace(/"/g,"\\&quot;"));var r=n.classes?n.classes:"",o="";if("dfgdgsf{}".indexOf(">"),r.indexOf(":")>-1){var s=r.split(","),o={},l=!0;r="",s.forEach(function(t){var e=t.split(":"),i=$.trim(e[0]).replace(/'/g,""),n=$.trim(e[1]).replace(/'/g,"");"wrapper"===i?r=n:(o[i]=n,l=!1)}),o=l?"":',"classes":'+JSON.stringify(o)}var c=n.Radio?',"Radio":'+n.Radio.replace(/'/g,'"'):"",d=n.style?"style='"+n.style+"'":"",u=n.id;u=u?',"id":"'+u+'"':"";var p=n.labelType;p=p?',"labelType":"'+p+'"':"";var f=n.colLabels;f=f?',"colLabels":"'+f+'"':"";var h=n.attr;h=h?',"attr":"'+h+'"':"";var m=n.List;m=m?',"List":'+m:"";var g=n.Editable;g=g?',"Editable":'+g:"";var v=" class='ExtendIt"+(r?" "+r:"")+"' "+d+' data-ctrl=\'{"Value":"'+a+'","Field":"'+i.firstBig()+'"'+o+u+p+f+h+m+g+c;return v=n.tag?"<"+n.tag+v+"}'></"+n.tag+">":"<div"+v+"}'></div>",new Handlebars.SafeString(v)}),Handlebars.registerHelper("reportRow",function(t){var e="";t=this[t];for(var i=0,n=t.length;n>i;i++)e+=block(t[i]);return e}),Handlebars.registerHelper("compare",function(t,e,i,n){var a,r,o=this;if(3>arguments.length)throw Error("Handlerbars Helper 'compare' needs 2 parameters");return void 0===n&&(n=i,i=e,e="==="),getVal=function(t){if(!isNaN(t))return parseInt(t,10);var e=t.split("."),i=o;if(1===e.length){var n=e[0].toLowerCase();i="true"==n||"false"==n?"true"===n?!0:!1:i[e[0]]}else e.forEach(function(t){i=i[t]});return i},t=getVal(t),i=i?getVal(i):"",a={"==":function(t,e){return t==e},"===":function(t,e){return t===e},"!=":function(t,e){return t!=e},"!==":function(t,e){return t!==e},"<":function(t,e){return e>t},">":function(t,e){return t>e},"<=":function(t,e){return e>=t},">=":function(t,e){return t>=e},"typeof":function(t,e){return typeof t==e}},a[e]||console.error("No such operator "+e),r=a[e](t,i),r?n.fn(this):n.inverse(this)}),App.SearchField=Ember.View.extend({context:null,tagName:"",template:Em.Handlebars.compile('<form class="topSearchForm" onsubmit="return false;" ><input  {{action "valueDidChange" on="keyUp" target="parentView"}} type="text" class="searchField" placeholder="Ieškoti.."/><div class="divSearch"><span {{action "clear" target="parentView"}} class="spanToClearText"><img src="Content/images/icon-cancel.png"></span></div></form>'),clear:function(t){$(t.target).closest("form").find("input").val(""),this.get("valueDidChange").call(this,"")},valueDidChange:function(t){if(13===(t.keyCode||t.which))return!1;var e=t?$(t.target).val():"";if(this.get("context"),controller=this.get("controller")){var i=App[controller].filterValue,n=i?i.length:0,a=e?e.length:0,r=n>a?!0:!1;App[controller].set("filterReduced",r).set("filterValue",e.toLowerCase())}}}),App.FormBottomView=Em.View.extend({init:function(){var t,e=["deleteForm","saveForm","editForm","cancelForm"],n=this.get("target"),a=Ember.getPath(n);a||console.error("no target");var r=function(t,n){if("function"==typeof t){var a=function(e){t.call(n,e)};this.set(e[i],a)}else console.warn("No target for "+e[i])};for(t=Em.get(n),i=0;e.length>i;i++)r.call(this,a[e[i]],t);this._super()},templateName:"tmpFormBottom"}),function(){var t,e,i=window,n=i.App,a=i.Em,r=i.oGLOBAL,o=i.oDATA,s=i.oCONTROLS,l=i.MY;n.tabAccidentsView=n.mainMenuView.extend({content:null,viewIx:0,templateName:"tmpAccidentsMain"}),n.AccidentView=a.View.extend({templateName:"tmpAccidentRow",tagName:""}),n.SelectedAccidentView=a.View.extend({templateName:"tmpAccident_Claims",init:function(){var t,e,i,a,r,o,s=[],l=[];if(this._super(),a=this.claims_TypeID.split("#"),t=this.get("claims_C").replace(RegExp("{{(.*?)}}","gm"),"").split("#||"),e=this.get("claims_C2").split("#||"),""!==t[0])for(o=t.length-1,r=-1;o>r++;)i=a[r],s[r]={Claims:t[r].split("#|"),Claims2:e[r].split("#|")},l[r]={finished:"5"===t[r][0]?!0:!1,no:s[r].Claims[1],type:s[r].Claims[2],autoNo:s[r].Claims[3],insurer:s[r].Claims[4],loss:s[r].Claims[5],totalLoss:"0"!==s[r].Claims2[2]&&s[r].Claims2[6]&&"2"===i&&!isNaN(parseFloat(s[r].Claims2[3]))?+s[r].Claims[5]+ +s[r].Claims2[3]:0,Claims2:s[r].Claims2,claimStatus:t[r][0],accidentID:this.get("iD"),accidentDate:this.date};return n.thisAccidentController.set("content",l),n.thisAccidentController.set("accidentID",this.get("iD"))},tbodyClick:function(t){var e,i,r;return r=$(t.target).closest("tr"),e=r.hasClass("selectedClaim")?!0:!1,n.claimEditController.removeOpenClaimDetails(),e?!1:(i=t.context,l.tabAccidents.SelectedClaimView=n.SelectedClaimView.create({rowContext:{Claims2:i.Claims2,newClaim:!1,LossAmount:i.loss,InsuranceType:i.type,accidentID:i.accidentID,accidentDate:i.accidentDate,claimStatus:i.claimStatus},elementId:"ClaimDetailsContent",contentBinding:"App.claimEditController.content"}),r.addClass("selectedClaim title").after("<tr><td id='ClaimWraper' colspan='7' class='selectedClaim content'></td></tr>"),l.tabAccidents.SelectedClaimView.appendTo("#ClaimWraper"),a.run.next(function(){return $("#ClaimDetailsContent").slideDown()}),!1)},newClaim:function(t){var e,i,r;return r=$(t.target).closest("div.tr"),$(t.target).closest("div.rightFooterBig").hide(),r.append('<div id=\'divNewClaimCard\' data-ctrl=\'{"id":"0","NewRec":"1","Source":"proc_Claims","ClaimTypeID":"0"}\'></div>'),i=function(){return $("#divNewClaimCard").remove(),$("#AccDetailsContent").find("div.rightFooterBig").show()},e={ctrl:$("#divNewClaimCard"),oDATA:o.GET("tblClaimTypes"),opt:{val:"iD",text:"name",FieldName:"ClaimTypeID",SelectText:"Pasirinkite žalos tipą:"},fnAfterOptClick:function(){return n.claimEditController.removeOpenClaimDetails(),$("#divNewClaimCard").find("#divNewClaimCard_Content,div.frmbottom").remove(),l.tabAccidents.NewClaimView&&(l.tabAccidents.NewClaimView.remove(),$("#newClaimDetailsContent").remove()),l.tabAccidents.NewClaimView=n.SelectedClaimView.create({rowContext:{newClaim:!0,accidentID:n.thisAccidentController.get("accidentID")},elementId:"newClaimDetailsContent",contentBinding:"App.newClaimController.content"}),l.tabAccidents.NewClaimView.appendTo("#divNewClaimCard"),a.run.next(function(){return $("#newClaimDetailsContent").slideDown()}),{fnCancel:function(){return i()}}},fnCancel:function(){return i()}},s.Set_Updatable_HTML.mega_select_list(e),!1},toClaimRegulation:function(t){return n.router.transitionTo("claimRegulation",{claimNo:t.context.no}),!1},elementId:"AccDetailsContent",contentBinding:"App.thisAccidentController.content",destroyElement:function(){return l.tabAccidents.SelectedClaimView?l.tabAccidents.SelectedClaimView.remove():void 0}}),n.SelectedClaimView=a.View.extend({didInsertElement:function(){var t,e,i,a,r,o;return i=n.claimEditController.claim,r=i.newClaim?"#divNewClaimCard":"#divClaimCard_Content",e=i.newClaim?$(r).find("button.btnSave"):$(r).next().find("button.btnSave"),s.UpdatableForm({frm:r,btnSaveToDisable:e}),2===i.typeID&&(t=$("#InsuranceClaimAmount").parent().parent(),t.find("span").html("Žalos suma asmeniui"),$("#LossAmount").parent().find("span").html("Žalos suma turtui"),a=function(){return this.attr("checked")?t.css("display","block").find("input").data("ctrl").Validity=t.find("input").data("ctrl").Validity.replace("require().",""):t.css("display","none").find("input").val("").data("ctrl").Validity="require()."+t.find("input").data("ctrl").Validity},a.call($("#IsInjuredPersons")),$("#IsInjuredPersons").on("click",function(){return a.call($("#IsInjuredPersons"))})),6===i.typeID&&$("#claimEditDays,#claimEditPerDay").on("keyup",function(){return $("#LossAmount").val($("#claimEditDays").val()*$("#claimEditPerDay").val())}),i.claimStatus>2&&(o=$(r).find("input"),"3"===i.claimStatus?o=o.eq(1).prop("title","Suma jau patvirtina"):"4"===i.claimStatus?o=o.filter(function(t){return 1===t||"InsuranceClaimAmount"===$(this).attr("id")}).prop("title","Suma jau patvirtina"):"5"===i.claimStatus&&($(r).find("button").prop("disabled",!0),o.prop("title","Žala uždaryta")),o.prop("disabled",!0)),i.noInsurance?n.claimEditController.fnToggle_noInsurance():void 0},init:function(){var t,e,i,r;return this._super(),r=this.get("rowContext"),r.newClaim?(i=$("#divNewClaimCard").data("ctrl").ClaimTypeID,e=a.Object.create({iD:0,vehicleID:"",insPolicyID:"",insuranceClaimAmount:0,insurerClaimID:"",isTotalLoss:0,isInjuredPersons:0,days:5,perDay:500,lossAmount:6===i?2500:0,newClaim:!0,typeID:i,noInsurance:!1})):(t=r.Claims2,i=o.GET("tblClaimTypes").emData.findProperty("name",r.InsuranceType).iD,e=a.Object.create({iD:t[0],vehicleID:t[1],insPolicyID:t[2],insuranceClaimAmount:t[3],insurerClaimID:t[4].slice(1).slice(0,-1),isTotalLoss:t[5],isInjuredPersons:parseInt(t[6],10),days:t[7],perDay:t[8],lossAmount:r.LossAmount,claimStatus:r.claimStatus,newClaim:!1,typeID:i,deleteButton:!0,noInsurance:"0"===t[2]?!0:!1})),n.claimEditController.set("claim",e),console.log("init Claim.Type - "+i)},templateName:"tmpClaimEdit"}),n.claimEditController=a.Controller.create({removeOpenClaimDetails:function(){var t;return t=$("#ClaimWraper").closest("tbody").find(".selectedClaim").removeClass("selectedClaim title").end().end(),t.length>0?(l.tabAccidents.SelectedClaimView.remove(),t.remove(),!1):void 0},fnToggle_noInsurance:function(){var t,e,i,n;return n=this.claim.noInsurance,console.log(this.claim.get("noInsurance")),t=$("#NotInsuredClaim").find("input"),t.data("ctrl")||t.data("ctrl",{Type:"Boolean",Value:"0",ToggleValue:!0,Field:"InsPolicyID"}),e=this.claim.iD?$("#ClaimDetailsContent"):$("#newClaimDetailsContent"),i=e.find("div.js-toggle"),e.find("button.btnSave").attr("disabled",!1),n?(t.addClass("UpdateField"),i.hide()):(t.removeClass("UpdateField"),i.show(),$("#InsuredClaimList").data("newval","")),$("#IsInjuredPersons").length&&($("#IsInjuredPersons").prop("checked",!1),$("#InsuranceClaimAmount").parent().parent().hide()),!1}.observes("claim.noInsurance"),deleteForm:function(t){var e,i;return i=o.GET("proc_Claims"),e=t.view._parentView.templateData.view.rowContext,console.log("Žalos ID: "+e.Claims2[0]),s.dialog.Confirm({title:"",msg:"Ištrinti pasirinktą žalą?"},function(){return SERVER.update({Action:"Delete",DataToSave:{id:e.Claims2[0],DataTable:i.Config.tblUpdate,Ext:e.accidentID},Msg:{Title:"Duomenų ištrynimas",Success:"Pasirinkta žala buvo pašalinta.",Error:"Nepavyko pašalinti šios žalos"},CallBack:{Success:function(t,e){var a;return a=t.ResponseMsg.Ext.replace(/#\|#\|/g,":::").split("|#|"),a[13]=a[13].replace(/:::/g,"#|#|"),n.accidentsController.get("setNewVal").call(n.accidentsController,{newVal:a,toAppend:!1,fieldsToInt:[0,1,5,6,7,8]})[0],i.Data.removeRowByID(parseInt(e.DataToSave.id,10)),$("#accidentsTable").find("div.selectedAccident").trigger("click")}}})})},fnUpdateAccident:function(t){var e;return e=t.ResponseMsg.Ext.replace(/#\|#\|/g,":::").split("|#|"),e[13]=e[13].replace(/:::/g,"#|#|"),n.accidentsController.get("setNewVal").call(n.accidentsController,{newVal:e,toAppend:!1,fieldsToInt:[0,1,5,6,7,8]})[0]},saveForm:function(t){var e,i,r,o,l,c,d,u,p;return d=t.view._context.newClaim,o=t.view._parentView.templateData.view.rowContext.accidentID,p=$("#accidentsTable").find("div.selectedAccident"),d?(c=$("#divNewClaimCard"),e="Add",r={Title:"Naujos žalos sukūrimas",Success:"Nauja žala sukurta.",Error:"Nepavyko išsaugot naujos žalos."}):(c=$("#divClaimCard_Content"),e="Edit",r={Title:"Žalos redagavimas",Success:"Žalos duomenys pakeisti.",Error:"Nepavyko pakeisti žalos duomenų."}),i=s.ValidateForm(c),i?(d&&(i.Fields.push("ClaimTypeID"),i.Data.push(t.view._context.typeID),i.Fields.push("AccidentID"),i.Data.push(o)),i.Ext=o,l=function(t,e){var i,r,o;
return r=n.claimEditController,o=n.sidePanelController,r.fnUpdateAccident.call(r,t),o.refreshPanels.call(o,"refreshClaims"),i=t.ResponseMsg.ID,i||(i=e.DataToSave.id),SERVER.updateRecord("Main/claim",{id:i},"proc_Claims",e.Action),this.tr.trigger("click"),a.run.later(this,function(){return this.tr.trigger("click"),console.log("trigger click"),console.log(this.tr)},500),!1},u={Action:e,DataToSave:i,CallBack:{Success:$.proxy(l,{tr:p})},Msg:r},SERVER.update(u),!1):void 0},cancelForm:function(t){var e,i;return e=$(t.target),i=e.closest("tr"),i.find("td.selectedClaim").length?(l.tabAccidents.SelectedClaimView.remove(),i.parent().find("tr.selectedClaim").removeClass("selectedClaim title").next("tr").remove()):(l.tabAccidents.NewClaimView&&l.tabAccidents.NewClaimView.remove(),$("#divNewClaimCard").remove(),$("#AccDetailsContent").find("div.rightFooterBig").show())}}),n.accidentsController=a.ResourceController.create({url:"Accident/AccidentsList",tableName:"proc_Accidents",currency:"Lt",animationSpeedEnd:400,animationSpeedStart:400,setAnimationSpeed:function(t){var e,i;return e=parseInt($(t.target).val(),10),i="start"===$(t.target).data("action")?"animationSpeedStart":"animationSpeedEnd",$.isNumeric(e)?this.set(i,e):alert("turi būti skaičius")},removeClaims:function(t,e,i,a){var r,o;return console.log("removeClaims"),r=t.parent().find("div.dividers"),r.slideUp(n.accidentsController.animationSpeedEnd,function(){return r.remove()}),t.length>0?(l.tabAccidents.AcccidentdetailsView.remove(),o=this,t.slideUp(n.accidentsController.animationSpeedEnd,function(){return i.hasClass("selectedAccident")?(i.removeClass("selectedAccident"),t.remove()):(a.find("div.selectedAccident").removeClass("selectedAccident"),t.remove(),o.addClaim(e,i))})):this.addClaim(e,i)},addClaim:function(t,e){return e.hasClass("selectedAccident")||e.addClass("selectedAccident"),l.tabAccidents.AcccidentdetailsView=n.SelectedAccidentView.create(t.context),e.after("<div id='AccDetailsWraper'></div><div class='dividers'></div>"),l.tabAccidents.AcccidentdetailsView.appendTo("#AccDetailsWraper"),t.isTrigger?a.run.next(function(){return $("#AccDetailsContent, div.dividers").show()}):a.run.next(function(){return $("#AccDetailsContent, div.dividers").slideDown(n.accidentsController.animationSpeedStart)})},tbodyClick:function(t){var e,i,n;if(n=$(t.target).closest("div.tr"),console.log("tbodyClick"),this.setfilteredPolicies(t.context.date),e=$("#AccDetailsWraper"),i=n.parent(),n.hasClass("selectedAccident")&&!t.isTrigger){if(i.find("div.dividers").length)return this.removeClaims(e,t,n,i),!1}else this.removeClaims(e,t,n,i);return!1},setfilteredPolicies:function(t){var e,i;return i=$.map(o.GET("proc_InsPolicies").Data,function(e){return r.date.firstBigger(e[4],t)?[e]:null}),e=$.extend({},o.GET("proc_InsPolicies"),{Data:i}),o.SET("proc_InsPolicies_forThisAccident",e)},editAccident:function(t){return this.openAccident(t.context.no)},addNewAccident:function(){return this.openAccident(null)},openAccident:function(t){var e;return $("#tabAccidents").removeClass("colmask"),$("#divAccidentsList").hide(),e=$("#divAccidentEdit").show(),e.spinner({position:"center",img:"spinnerBig.gif"}),r.LoadAccident_Card(t),$("body").spinner("remove"),!1},filterDidChange:function(t,e){var i,n;return console.log("filterDidChange"),l.tabAccidents.AcccidentdetailsView&&(i=l.tabAccidents,i.AcccidentdetailsView.remove(),i.AcccidentdetailsView=null,$("#AccDetailsWraper").next("div.dividers").remove().end().prev().removeClass("selectedAccident").end().remove()),n="All"===e?void 0:t[e],"filterValue"===e?this.textFilterIsActive=""===n?!1:!0:(this.panelFilterIsActive=this.chkDocs||this.chkOpen||this.chkData||this.chkClaim?!0:!1,this.filterByPanel=this.get_filterByPanel()),this.filterItems(e,n,t),a.run.next(function(){var t;return t=$("#accidentsTable"),t.find("div.selectedAccident").length?void 0:t.find("div.dividers").remove()})}.observes("chkDocs","chkOpen","chkData","chkClaim","filterValue")},e=!1,t=!1,{filterCols:["accType","driver","shortNote","userName","place","claims_C"],filterValue:null,chkDocs:null,chkOpen:null,chkData:null,chkClaim:null,filterByField:function(t){var e,i,n,a,r,o,s;if(!this.filterReduced&&t.filterToHide)return!1;for(a=this,r=!1,e=JSON.parse(JSON.stringify(a.filterCols)),i=function(i){return t[e[i]].toLowerCase().indexOf(a.filterValue)>-1?!0:!1},console.log("---Start filtering----"),n=o=0,s=e.length;s>o;n=o+=1){if(i(n)){console.log("true - "+t[e[n]]),r=!0;break}console.log("false - "+t[e[n]]),r=!1}return console.log("---End filtering----"),t.set("filterToHide",!r),r},get_filterByPanel:function(){var t;return t="",this.chkOpen&&(t+="chkWithOpen"===this.chkOpen?"if (row.cNo_NotF===0) return false;":"if (row.cNo_NotF>0) return false;"),this.chkDocs&&(t+="chkWithDocs"===this.chkDocs?"if (row.docNo===0) return false;":"if (row.docNo>0) return false;"),this.chkData&&(t+="12month"===this.chkData?"if (row.daysFrom>365) return false;":"if (row.date.indexOf("+this.chkData+")===-1) return false;"),this.chkClaim&&(t+="if (row.claims_TypeID.indexOf('"+this.chkClaim+"')===-1) return false;"),t+="return true;",Function("row",t)},filterByPanel:null,filterItems:function(t,e){var i,n=this;return"filterValue"===t?(i=""===e?this.panelFilterIsActive?function(t){return t.filterToHide=!1,n.filterByPanel(t)}:function(t){return t.filterToHide=!1,!0}:this.panelFilterIsActive?function(t){var e;return e=n.filterByField(t)?n.filterByPanel(t):!1}:function(t){return n.filterByField(t)},console.log("Filtro pradžia - tekstas---------------")):(i=this.textFilterIsActive||this.panelFilterIsActive?function(t){return t.filterToHide?!1:n.filterByPanel(t)}:function(){return!0},console.log("Filtro pradžia - kiti filtrai---------------")),this.content.forEach(function(t){var e;return e=i(t),t.set("visible",e)})}}),n.thisAccidentController=a.ResourceController.create({content:[],tableName:"?"}),n.sidePanelController=a.ResourceController.create({chkHandlerToggle:function(t,e,i){return $(t).buttonset().on("click",function(t){var a,r;return a=$(t.target).closest("label").prev(),r=a.next().hasClass("ui-state-active")?a.attr("id"):null,$(this).find("label").not(a.next()).removeClass("ui-state-active").end().prev().not(a).removeAttr("checked"),n[i].set(e,r),!1}),this},chkHandler:function(t,e,i){return $(t).buttonset().on("click",function(t){var a,r;return t.preventDefault(),a=$(t.target).closest("label"),a.parent().find("label").not(a).removeClass("ui-state-active"),r=a.hasClass("ui-state-active")?a.attr("for").replace("chkClaimAcc_","").replace("chk_date","").replace("chkInsurers_","").replace("chkData_","").replace("chkClaim_",""):null,n[i].set(e,r),!1}),("claimsController"===i||"chkClaim"===e)&&n.sidePanelController.fnHighlight(e,i),this},refreshPanels:function(t){var e,i,a;return t=t,e=[],i=[],a=[],this.years.length||this.set("years",o.GET("proc_Years").emData.map(function(t){return t.chkId="chk_date"+t.year,t.chkId2="chkData_"+t.year,t})),o.GET("proc_Claims").emData.forEach(function(r){return e.contains(r.claimTypeID)||e.push(r.claimTypeID),("loadCl"===t||"refreshCriteria"===t)&&(a.contains(r.insPolicyID)||a.push(r.insPolicyID),this.isOpen||5!==r.claimStatus&&this.set("isOpen",!0),this.isWithWarnings||r.warnings&&this.set("isWithWarnings",!0),this.isWithMyTasks||r.warnings&&r.warnings.tasks&&r.warnings.tasks.filter(function(t){return t.toID===n.userData.userID}).length&&this.set("isWithMyTasks",!0),this.set("isWith",this.isOpen||this.isWithWarnings||this.isWithMyTasks),a.forEach(function(t){var e,n;return n=o.GET("proc_InsPolicies").emData.findProperty("iD",t),e=n?n.insurerID:null,e&&!i.contains(e)?i.push(e):void 0})),"loadCl"===t&&(i=o.GET("tblInsurers").emData.filter(function(t){return i.contains(t.iD)}).map(function(t){return t.chkId="chkInsurers_"+t.iD,t}),this.set("insurers",i)),!1},this),"refreshClaims"!==t&&this.claimTypes.length||(e=o.GET("tblClaimTypes").emData.filter(function(t){return e.contains(t.iD)}).map(function(t){return 0===t.iD&&(t.visible=!1),6===t.iD&&(t.notForClaims=!0),t.chkId="chkClaimAcc_"+t.iD,t.chkId2="chkClaim_"+t.iD,t}),this.set("claimTypes",e)),"refreshCriteria"===t&&this.attachBtnClaims(t),"refreshClaims"===t&&(this.attachBtnClaims(t),this.attachBtnAccidents(t)),this},fnAfterAtach:function(t){return t=$(t),t.hasClass("hidden")?t.closest("div.col2").stickyPanel().end().removeClass("hidden"):void 0},attachBtnAccidents:function(t){return a.run.next({me:this,event:t},function(){var t;return t="accidentsController","refreshClaims"===this.event?this.me.chkHandler("#chkClaimsTypes","chkClaim",t):this.me.chkHandlerToggle("#chkOpen","chkOpen",t).chkHandlerToggle("#chkDocs","chkDocs",t).chkHandler("#chkYears","chkData",t).chkHandler("#chkClaimsTypes","chkClaim",t).fnAfterAtach("#sidePanel")})},attachBtnClaims:function(t){return a.run.next({me:this,event:t},function(){var t;return t="claimsController","refreshCriteria"===this.event?this.me.chkHandler("#chkCriteria","chkCriteria",t):"refreshClaims"===this.event?this.me.chkHandler("#chkClaimsTypesCl","chkClaim",t):this.me.chkHandler("#chkCriteria","chkCriteria",t).chkHandler("#chkInsurers","chkInsurers",t).chkHandler("#chkYearsCl","chkData",t).chkHandler("#chkClaimsTypesCl","chkClaim",t).fnAfterAtach("#sidePanelCl")})},fnHighlight:function(t,e){var i,a;return a=n[e][t],a&&(i="accidentsController"===e?t+"Acc_"+a:"chkCriteria"===t?a:t+"_"+a,i=$("#"+i).next("label"),!i.hasClass("ui-state-active"))?i.addClass("ui-state-active"):void 0},years:[],claimTypes:[],insurers:[],years:[]}),n.SidePanelView=a.View.extend({templateName:"tmpSidePanel",controller:n.sidePanelController,panel:"#sidePanel",didInsertElement:function(){return this._super(),o.execWhenLoaded(["tblClaimTypes"],function(){return this.controller.refreshPanels("loadAcc").attachBtnAccidents()},this)},showAll:function(){var t;return $(this.panel).find("label.ui-state-active").removeClass("ui-state-active"),$(this.panel).find("input:checkbox").removeAttr("checked").parent().next().next().find("span.ui-checkbox-icon").removeClass("ui-icon ui-icon-check").attr("aria-checked","false"),t=n.accidentsController,t.chkOpen=null,t.chkDocs=null,t.chkData=null,t.chkClaim=null,t.filterDidChange(this,"All")}}),n.SidePanelForClaimsView=a.View.extend({templateName:"tmpSidePanelForClaims",controller:n.sidePanelController,panel:"#sidePanelCl",showAll:function(){var t;return $(this.panel).find("input:checkbox").removeAttr("checked").parent().next().next().find("span.ui-checkbox-icon").removeClass("ui-icon ui-icon-check").attr("aria-checked","false"),$(this.panel).find("label.ui-state-active").removeClass("ui-state-active"),t=n.claimsController,t.chkCriteria=null,t.chkInsurers=null,t.chkData=null,t.chkClaim=null,t.filterDidChange(this,"All")}}),l.tabAccidents={}}.call(this),function(){var t=window,e=t.jQuery,i=t.App,n=t.Em;i.create_docsTypesController=function(t){return i.docsTypesController=n.ResourceController.create({init:function(){var e,i;return this._super(),i=this,e=oDATA.GET("tblDocTypes").emData,this.set("docTypes",e),t?this.refreshTree(t):void 0},refreshTree:function(t){var e,i,n,a,r,o;return oGLOBAL.logFromStart("Started refreshTree"),t?this.set("categoryOpts",t):t=this.categoryOpts,i=t,n=oDATA.GET("tblDocGroup").emData,a=oDATA.GET("tblDocs").emData,e=[],r=this,o="",i.driver&&n.findProperty("ref",3).set("name",i.driver.title),n.forEach(function(t){var n,s,l,c,d,u;return c={categoryId:t.iD,title:t.name},d=t.ref,1!==d&&5!==d&&(c.isTree="isTree"),c.isGroup="isGroup",4!==d&&(c.isSelectable=!0),l=function(e,i){var n;return n=a.filter(function(i){return i.refID===e&&i.groupID===t.iD}),i.title+=n.length?" ("+n.length+")":"",n},4===d?(n=0,c.items=i.vehicles.map(function(e){return{isGroup:"isGroup",refID:e.iD,categoryId:t.iD,title:e.title,isTree:"isTree",isSelectable:!0}}),c.items.forEach(function(e){var i;return i=l(e.refID,e),n+=i.length,e.items=r.setDocTypes(r.docTypes,t.iD,e.refID,i)}),c.title+=n?" ("+n+")":""):(u=3===d?i.driver.iD:i.accident.iD,s=l(u,c),c.items=r.setDocTypes(r.docTypes,t.iD,u,s)),5===d?o=c:e[e.length]=c}),e[e.length]=o,this.set("content",e),oGLOBAL.logFromStart("Finished refreshTree")},setDocTypes:function(t,e,i,n){var a;return a="",n=n,t.filter(function(t){return t.docGroupID===e}).map(function(t){return a=n.filter(function(e){return e.docTypeID===t.iD}).length,a=a?" ("+a+")":"",{categoryId:t.iD,title:t.name+a,refID:i}})},content:[],docTypes:[],filterTypes:function(){var t,e;return console.log("Start filterTypes fn"),e=this.get("docTypes"),t=oDATA.GET("tblDocGroup").emData,this.set("docTypes_accident",e.filterProperty("docGroupID",t.findProperty("ref",2).iD)),this.set("docTypes_driver",e.filterProperty("docGroupID",t.findProperty("ref",3).iD)),this.set("docTypes_vehicle",e.filterProperty("docGroupID",t.findProperty("ref",4).iD))}.observes("docTypes.length")})},e.widget("ui.Tree",{options:{treeId:"dynamicTree",docViewForTreeId:"docViewForTree",formTemplate:"tmpUploadForm",docsUpdateCallBack:null,categoryOpts:{},docsTypesController:"docsTypesController",TreeDocController:"treeDocController"},_create:function(){return e('<table width="100%;"><tr style="vertical-align:top"><td style="width:28em"><div id="'+this.options.treeId+'" ></div></td>'+'<td style="vertical-align:top;padding:10px;"><div id="'+this.options.docViewForTreeId+'"></div></td></tr></table>').appendTo(this.element),i.docsTypesController?i.docsTypesController.refreshTree(this.options.categoryOpts):i.create_docsTypesController(this.options.categoryOpts),i.DocTreeView=n.View.extend(this.DocTreeViewOpt),this.TreeViewOpts.opts=this.options,this.TreeDocControllerOpts.opts=this.options,this.DocTreeViewOpt.opts=this.options,i.TreeView=n.View.extend(this.TreeViewOpts),i[this.options.TreeDocController]=n.Object.create(this.TreeDocControllerOpts),MY.accidentCard.TreeView=n.View.create({templateName:"tmpDocsTree"}).appendTo("#"+this.options.treeId),this.docViewForTreeOpts.controller=i[this.options.TreeDocController],this.docViewForTreeOpts.opts=this.options,MY.accidentCard.DocsView=n.View.create(this.docViewForTreeOpts).appendTo("#"+this.options.docViewForTreeId)},DocTreeViewOpt:{templateName:"tmpDocsNodes",tagName:"",opts:null,didInsertElement:function(){return e("li.treeItem").droppable({accept:"#gallery > li",accept:"#"+this.opts.docViewForTreeId+" li",over:function(){var t,i,n;return e(this).hasClass("isTree")||e(this).addClass("treeItemHover"),i=e("ul",this),i.size()>0&&(t=i.eq(0),"none"===t.css("display"))?(n=t.get(0),window.setTimeout(function(){return e(n).show(),e("img.expandImage",n.parentNode).eq(0).attr("src","Content/less/images/toggle_minus.png")},200)):void 0},out:function(){return e(this).removeClass("treeItemHover")},drop:function(t,n){var a,r,o;return e(this).removeClass("treeItemHover"),r=e("ul",this),0===r.size()?(o=e(this).find("span.textHolder").eq(0),a=e(this).closest("tr").find("td:eq(1) ul").data("opts"),i[a.TreeDocController].deleteDocument(n.draggable,this)):void 0}})}},TreeViewOpts:{docs:null,opts:null,templateName:"tmpDocsCategory",tagName:"",classNames:[],getDocs:function(t){var a,r,o,s,l,c,d,u,p,f,h,m,g;return i.treeDocController.set("selectedCategoryId",t.view.bindingContext.categoryId),e("div.treeContent").removeClass("selected selectNeighbor"),h=e(t.target),(h.is("li")?h.find("div:first"):h.closest("div")).addClass("selected"),console.log("categoryId: "+t.view.bindingContext.categoryId),console.log("context: "),console.log(this._context),r=[],a=this._context,l=a.isGroup?a.refID?function(t){return t.groupID===a.categoryId&&t.refID===a.refID}:function(t){return t.groupID===a.categoryId}:a.refID?function(t){return t.docTypeID===a.categoryId&&t.refID===a.refID}:function(t){return t.docTypeID===a.categoryId},r=i[this.opts.TreeDocController].AllDocs.filter(l),s=oDATA.GET("userData").emData[0].docsPath,m="Uploads/"+s,g=oDATA.GET("tblUsers").emData,o=oDATA.GET("tblDocTypes").emData,d=function(t){return t=t.slice(0,3),"img32-doc_"+("xls"===t||"doc"===t||"pdf"===t?t:"unknown")},u=function(t){var e;return e=g.find(function(e){return e.iD===t}),e.firstName+" "+e.surname},c=function(t){return o.find(function(e){return e.iD===t}).name},p=a.isGroup&&1===a.categoryId?!0:!1,f=r.map(function(t){var e,i;return i=u(t.userID),e="/"+t.iD+"."+t.fileType,n.Object.create({docID:t.iD,hasThumb:t.hasThumb,urlThumb:m+"/Thumbs"+e,urlDoc:m+e,docType:c(t.docTypeID),description:t.description,docName:t.docName,userName:i,fileDate:t.fileDate,fileName:t.docName+"."+t.fileType,fileIcon:t.hasThumb?"img32-doc_unknown":d(t.fileType),docDetails:p?"":"Įkėlė "+i+" "+t.fileDate+", dydis - "+Math.ceil(t.fileSize/1e4)/100+"Mb"})}),i[this.opts.TreeDocController].set("isPhoto",p),i[this.opts.TreeDocController].set("docs",f),!1},expandCollapse:function(t){var i,n,a;return n=t.target,-1===n.src.indexOf("spacer")?(a=e("ul",n.parentNode.parentNode),i="hide","none"===a.eq(0).css("display")&&(i="show"),e(a).each(function(){return"show"===i?(e(this).show(),e(this).parent().find("img.expandImage").attr("src","Content/less/images/toggle_minus.png")):(e(this).hide(),e(this).parent().find("img.expandImage").attr("src","Content/less/images/toggle_plus.png"))})):void 0}},TreeDocControllerOpts:{init:function(){var t;return this._super(),this.refreshDocs(),t=e("#"+this.opts.treeId),n.run.next(this,function(){return this.AllDocs.filter(function(t){return 5===t.groupID}).length?t.find("ul>li:last").trigger("click"):this.AllDocs.filter(function(t){return 1===t.groupID}).length?t.find("li:first").trigger("click"):t.find("li:nth(1)").trigger("click")})},refreshDocs:function(){var t,e,i,n,a,r,o,s;return oGLOBAL.logFromStart("Started refreshDocs"),n=oDATA.GET("tblDocs").emData,e=this.opts.categoryOpts,i=oDATA.GET("tblDocGroup").emData,e.accident?(t=e.accident.iD,s=e.vehicles,r=e.driver.iD,a=i.findProperty("ref",3).iD,o=i.findProperty("ref",4).iD,this.AllDocs=n.filter(function(e){var i,n;if(n=e.refID,i=e.groupID,i===a){if(n===r)return!0}else{if(i!==o)return n===t?!0:!1;if(s.findProperty("iD",n))return!0}})):this.AllDocs=n,oGLOBAL.logFromStart("Finished refreshDocs")},docs:[],opts:null,AllDocs:[],selectedCategoryId:null,deleteDocument:function(t,i){var n,a,r,o,s,l,c,d,u,p,f,h;return h=e(i),f=h.data("ref-id"),l=h.hasClass("isGroup"),o=t.data("doc-id"),u=e(i).data("category-id"),s=oDATA.GET("tblDocTypes").emData.find(function(t){return t.iD===u}),c=s.docGroupID,d=s.name,l&&(1===u&&(c=1,u=0),5===u&&(c=5,u=11)),console.log("docID:"+o+", new type:"+u+", new group:"+c),n=[u,c],a=["DocTypeID","GroupID"],f&&(n.push(f),a.push("RefID")),r=this.AllDocs.findProperty("iD",o),p=this.opts,SERVER.update2({Action:"Edit",Ctrl:e("#"+p.treeId),source:"tblDocs",row:r,DataToSave:{id:o,Data:n,Fields:a,DataTable:"tblDocs"},Msg:{Title:"Duokumento tipo priskyrimas",Success:"Dokumentas '"+r.docName+"' priskirtas tipui '"+d+"'.",Error:"Nepavyko pakeisti dokumento '"+r.docName+"' tipo."},CallBackAfter:function(){}}),t.fadeOut()}},docViewForTreeOpts:{opts:null,templateName:"tmpDocsView",tagName:"ul",attributeBindings:["data-toggle","data-target"],"data-toggle":"modal-gallery","data-target":"#modal-gallery",classNames:["gallery","ui-helper-reset","ui-helper-clearfix"],didInsertElement:function(){return this.$().data("opts",this.opts),this.$().sortable({revert:!0,opacity:.2,refreshPositions:!0}),this.$().disableSelection()}}}),MY.accidentCard={}}.call(this),function(){var t=window.jQuery;t.widget("ui.ComboBox",{options:{ListType:"List",Editable:{EditThis:!1,EditList:!1},selectFirst:!1,Value:"",mapWithNoCommas:!1,addNewIfNotExists:!1},_create:function(){var e,i,n,a,r,o;return r=t(this.element[0]).attr("placeholder","Pasirinkite iš sąrašo.."),0===r.length&&console.error("Input not found for ComboBox!"),o=t.extend(!0,this.options,r.data("ctrl")),"proc_Drivers"===o.Source&&(o.mapWithNoCommas=!0),i=function(t,e){var i,n,a;return t=parseInt(t,10),i=t?"Edit":"Add",a="proc_InsPolicies_forThisAccident"===o.Source?"tmp_InsPolicies":o.Source.replace("proc_","tmp_"),n={source:o.Source,template:a,row:t?oDATA.GET(o.Source).emData.findProperty("iD",t):0,Action:t?"Edit":"Add",newVals:e?{vals:e,cols:o.iText}:null,input:r,CallBackFromComboBox:function(){}},App.listAllController.openItem(n),!1},e=void 0,n=function(){var i,n;return i=parseInt(o.Value,10),o.data?e=o.data():(n=function(t){return o.excludeFromList&&o.excludeFromList.ValueInMe(t.iD)?null:(t.iD===i&&r.val(t.MapArrToString(o.iText,o.mapWithNoCommas,o.Source)),{id:t[o.iVal],label:t.MapArrToString(o.iText,o.mapWithNoCommas,o.Source)})},e=t.map(oDATA.GET(o.Source).emData,function(t){return n(t)})),o.Editable.EditList&&(e[e.length]={id:-1,value:"Redaguoti sąrašą",label:"Redaguoti sąrašą"}),o.Editable.AddNew?e[e.length]={id:-2,value:"Įvesti naują",label:"Įvesti naują"}:void 0},n(),t(r).on("keyup",function(){return t(this).parent().find("span.ui-menu-icon").remove()}).data("newval",o.Value).autocomplete({selectFirst:o.selectFirst,delay:0,minLength:"None"===this.options.ListType?2:0,autoFocus:!0,fnRefresh:function(){return r.data("newval")&&(o.Value=r.data("newval")),n(),o.Editable.EditThis&&r.data("newval")&&"None"===o.ListType&&!r.siblings(".img18-pencil").length?(console.log(r.siblings(".img18-pencil").length),r.after("<i title='redaguoti..' class='img18-pencil ui-menu-icon'></i>")):void 0},source:function(i,n){return n(t.ui.autocomplete.filter(e,i.term))},select:function(e,n){var a,s;return"function"==typeof n.item.id?(n.item.id(),!1):-1===n.item.id?(App.listAllController.editListItems(r,e),!1):-2===n.item.id?(i(0,null,e),!1):(a=r.next().next("span"),s=a.hasClass("img18-pencil"),0===n.item.id&&s?a.css("display","none"):s&&a.css("display","block"),t(e.srcElement).hasClass("ui-menu-icon")?(r.data("autocomplete").fnClickOnBtn({id:n.item.id,elm:t(e.srcElement),fromInput:!1}),!1):n.item&&(n.item.id!==t(this).data("newval")&&(t(this).data("newval",n.item.id).val(n.item.value),r.data("autocomplete").fnItemChanged&&r.data("autocomplete").fnItemChanged(n.item.id)),n.item.refID&&(t(this).data("refID",n.item.refID),t(this).data("categoryID",n.item.categoryID)),o.fnChangeCallBack)?o.fnChangeCallBack(e,n):void 0)},change:function(e,n){var a;return n.item?void 0:(i(0,r.val(),e),a=t(this),a.data("newval",""),"List"===o.Type&&a.val(""),r.data("autocomplete")!==void 0&&(r.data("autocomplete").term=""),!1)},close:function(){return!1},open:function(){var e,i;return(o.Editable.EditList||o.Editable.AddNew)&&t("ul.ui-autocomplete:visible").find("a:last").addClass("actionLink"),"None"===o.ListType||"Combo"===o.ListType?(e=t(this).data("autocomplete"),i='<span style="color:red">%s</span>',e.menu.element.find("a").each(function(){var n,a;return n=t(this),a=RegExp(e.term,"gi"),n.html(n.text().replace(a,function(t){return i.replace("%s",t)}))})):void 0}}),t(".ui-autocomplete-input").live("autocompleteopen",function(){var e,i;return e=t(this).data("autocomplete"),i=e.menu,e.options.selectFirst?i.activate(t.Event({type:"mouseenter"}),i.element.children().first()):void 0}),o.Editable.EditThis&&(a=t(this).data("newval"),a=a?a:0,o.appendToList="<i title='redaguoti..' class='img18-pencil ui-menu-icon'></i>",r.after(o.appendToList),r.data("autocomplete").fnClickOnBtn=function(t){var n,a,s,l,c;return n=t.elm.hasClass("img18-pencil")?"Edit":"Delete",l=oDATA.GET(o.Source),t.elm.hasClass("img18-pencil")?i(t.id):(c=l.Data.findValueByID(t.id).MapArrToString(r.data("ctrl").iText,!0),a=l.Config.Msg.Delete,s=a+' <b>"'+c+'"</b>?',oCONTROLS.dialog.Confirm({title:a,msg:s},function(){return SERVER.update({Action:"Delete",DataToSave:{id:t.id,DataTable:l.Config.tblUpdate},Msg:{Title:"Duomenų ištrynimas",Success:l.Config.Msg.GenName+" "+c+" buvo pašalintas.",Error:l.Config.Msg.Delete+" "+c+" nepavyko."},CallBack:{Success:function(){return e.findObjectByProperty("id",t.id).label===r.val()&&r.val("").parent().find("span.ui-menu-icon").remove(),l.Data.removeRowByID(t.id),e.removeRowByProperty("id",t.id),r.autocomplete("search",r.val())}}})}))},r.parent().on("click","span.ui-menu-icon,i.ui-menu-icon",function(){var e;return e=t(this),a=e.parent().find("input").data("newval"),r.data("autocomplete").fnClickOnBtn({id:a,elm:e,fromInput:!0})})),"None"!==o.ListType&&this.addButton({Editable:o.Editable,title:"Parodyti visus",icon:"ui-icon-triangle-1-s",fn:function(){return r.autocomplete("widget").is(":visible")?(r.autocomplete("close"),void 0):(r.autocomplete("search",""),r.focus(),!1)}},r),"List"===o.ListType?(r.attr("readonly",!0),r.click(function(){return r.autocomplete("widget").is(":visible")?(r.autocomplete("close"),!1):(r.autocomplete("search",""),r.focus(),!1)})):r.click(function(){return this.select()})},addButton:function(e,i){var n,a;return n=0!==i.outerHeight()?"style='height:"+i.outerHeight()+"px;'":"",this.button=t("<button "+n+" class='drop-down'>&nbsp;</button>").attr("tabIndex",-1).attr("title",e.title).insertAfter(i).button({icons:{primary:e.icon},text:!1}).click(function(){return e.fn(),!1}).removeClass("ui-corner-all").find("span").attr("class",""),"img18-plus"===e.icon&&this.button.removeClass("ui-button-icon-primary ui-icon").css("margin","-2px 0 0 -8px"),e.Editable.EditThis?(a=i.prev().width()-26+"px",i.css("width",a)):void 0},destroy:function(){return t.Widget.prototype.destroy.call(this)}}),t.widget("ui.ComboBoxCategory",t.ui.ComboBox,{_create:function(){var e,i,n,a,r,o,s;return r=this.options,r.element=this.element,e=r.categoryOpts,n=e.showCategories?e.showCategories:oDATA.GET("tblDocGroup").emData,App.docsTypesController||App.create_docsTypesController(),a=function(){var e;return e=oDATA.GET("tblDocTypes").emData,t.map.call(this,e,function(t){return{id:t[r.iVal],label:t.MapArrToString(r.iText,r.mapWithNoCommas),categoryID:t.docGroupID}})},i=function(e){var i;return i="dialog"+ +new Date,MY[i]=JQ.Dialog.create({catOpts:e.categoryOpts,dialogID:i,title:"Redaguoti sąrašą",title2:"Dokumentų tipai",saveData:function(i){var n,a;return n=App.docsTypesController.docTypes,a=i.row.docGroupID,t.extend(i,{Ctrl:t("#"+this.dialogID),source:"tblDocTypes",CallBackAfter:function(t){return"Edit"===i.Action&&n.findProperty("iD",t.iD).set("edit",!1),"Add"===i.Action&&MY.dialog.set("addNewType"+t.docGroupID,!1),App.docsTypesController.init(),e.element.closest("table").find("input").autocomplete("option","source",e.data()),console.log("New Row"),console.log(t)}}),SERVER.update2(i),!1},editDocType:function(t){return t.context.set("edit",t.context.name)},cancelDocType:function(t){return t.context.set("edit",!1)},saveDocType:function(e){var i,n,a,r,o;return r=e.context.name,n=t(e.target).prev(),o=n.val(),a=e.context,a.name=o,r.length>2?(i={Title:this.title2,Success:"Dokumento tipas '"+r+"' pakeistas.",Error:"Nepavyko pakeisti tipo '"+r+"'."},this.saveData({DataToSave:{id:a.iD,Data:[a.name],Fields:["Name"],DataTable:"tblDocTypes"},Msg:i,row:a,Action:"Edit"})):e.context.set("name",e.context.edit).set("edit",!1)},deleteDocType:function(t){var e,i;return i=t.context.name,e=this,oCONTROLS.dialog.Confirm({title:this.title2,msg:"Ištrinti tipą '"+i+"'?"},function(){var n,a;return n={Title:e.title2,Success:"Dokumento tipas '"+i+"' ištrintas.",Error:"Nepavyko ištrinti tipo '"+i+"'."},a=t.context,e.saveData({DataToSave:{id:a.iD,DataTable:"tblDocTypes"},Msg:n,row:a,Action:"Delete"})})},addNewDocType:function(e){return this.set("addNewType"+t(e.target).data("category-id"),!0)},cancelNewDocType:function(e){return this.set("addNewType"+t(e.target).data("category-id"),!1)},saveNewDocType:function(e){var i,n,a,r;return a=t(e.target).prev(),r=a.val(),n=a.data("category-id"),i={Title:this.title2,Success:"Dokumento tipas '"+r+"' pridėtas.",Error:"Nepavyko pridėt tipo '"+r+"'"},this.saveData({DataToSave:{Data:[r,n],Fields:["Name","DocGroupID"],DataTable:"tblDocTypes"},Msg:i,row:[r,n],Action:"Add"})},closeDialog:function(){return t("#"+this.dialogID).dialog("close"),!1},width:600,templateName:"tmpDocTypes"}).append()},t.extend(!0,this.options,{data:a,editList:i}),this._super(),o=function(e,i,n,a,r){var o;return o=a.filter(function(t){return t.categoryID===r}),n.forEach(function(n){return i.append("<li class='ui-autocomplete-category'>"+n.title+"</li>"),o.forEach(function(a){var r;return r=t.extend({},a,{refID:n.iD}),e._renderItemData(i,r)})})},s=this,this.element.data("autocomplete")._renderMenu=function(i,a){var r,l;return l=this,r="",n.forEach(function(t){if(0===t.ref);else{if(1===t.ref)return l._renderItemData(i,{id:0,label:"Nuotrauka",value:"Nuotrauka",categoryID:1,refID:e.accident.iD});if(3===t.ref&&e.driver)return o(l,i,[e.driver],a,t.iD);if(4===t.ref&&e.vehicles)return o(l,i,e.vehicles,a,t.iD);if(2===t.ref&&e.accident)return o(l,i,[e.accident],a,t.iD)}}),e.editList&&t("<li class='ui-autocomplete-category editCategories'><a >Redaguoti sąrašą</a></li>").appendTo(i),l._renderItemData(i,{id:function(){return s.options.editList(s.options)},label:"Redaguoti sarašą",value:"Redaguoti sarašą"}),i.find("li:last a").addClass("actionLink")}}}),t.widget("my.sortableGrid",{_create:function(){return this.ctrl=this.options.controller,this.element[0].innerHTML="<table class='zebra-striped'><thead></thead><tbody></tbody><table>",this.updateGrid(!0),!1},updateGrid:function(t){var e,i,n,a,r;return n=this.ctrl.fields,e=this.ctrl.content,i=this.element,r=n.length,a=r-1,t&&(i.find("thead")[0].innerHTML=this._getHead(n,a),this._appendHandler()),i.find("tbody")[0].innerHTML=this._getBody(n,e),!1},_getHead:function(t,e){var i;return i="<tr>",t.forEach(function(t,n){return t.visible?(i+="<th data-name='",i+=t.name,i+="'>",i+=t.title,i+=n!==e?"</th>":"</th><tr>"):void 0}),i},_getBody:function(t,e){var i,n;return n="",i=0,t.forEach(function(t,e){return t.visible?i=e:void 0}),e.forEach(function(e){return n+="<tr><td>",t.forEach(function(t,a){return t.visible?(n+=e[t.name],n+=a!==i?"</td><td>":"</td></tr>"):void 0})}),n},_appendHandler:function(){var e,i,n,a,r,o,s,l,c,d,u;return d='<span class="ui-icon ui-icon-carat-2-n-s ui-tblHead-icon"></span>',o="",a=this,n=this.ctrl,r="ui-icon-carat-1-n",l="ui-icon-carat-1-s",s="ui-icon-carat-2-n-s",e="ui-icon ui-tblHead-icon",u=this.element.find("thead").find("th").addClass("clickable").append(d).end().on("click","th",function(){var i,c,d,u;return c=t(this),u=c.find("span"),d=u.attr("class"),o=d.indexOf(r)>-1?l:r,u.attr("class",o+" "+e),c.siblings().find("span").attr("class",s+" "+e),o===r?n.set("sortAscending",!0):n.set("sortAscending",!1),n.set("sortProperties",[c.data("name")]),i=n.get("arrangedContent"),n.set("content",i),Em.run.next(a,function(){return this.updateGrid(!1)})}),c=n.get("sortProperties"),c.length>0&&(i=n.sortAscending?r:l,u.find("th").filter("[data-name='"+c[0]+"']").find("span").attr("class",i+" "+e)),!1},_setOption:function(t,e){return this.options[t]=e,this._update()},destroy:function(){return t.Widget.prototype.destroy.call(this)}})}.call(this),function(t){function e(t,e){return function(i){return l(t.call(this,i),e)}}function i(t,e){return function(i){return this.lang().ordinal(t.call(this,i),e)}}function n(){}function a(t){o(this,t)}function r(t){var e=t.years||t.year||t.y||0,i=t.months||t.month||t.M||0,n=t.weeks||t.week||t.w||0,a=t.days||t.day||t.d||0,r=t.hours||t.hour||t.h||0,o=t.minutes||t.minute||t.m||0,s=t.seconds||t.second||t.s||0,l=t.milliseconds||t.millisecond||t.ms||0;this._input=t,this._milliseconds=+l+1e3*s+6e4*o+36e5*r,this._days=+a+7*n,this._months=+i+12*e,this._data={},this._bubble()}function o(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t}function s(t){return 0>t?Math.ceil(t):Math.floor(t)}function l(t,e){for(var i=t+"";e>i.length;)i="0"+i;return i}function c(t,e,i,n){var a,r,o=e._milliseconds,s=e._days,l=e._months;o&&t._d.setTime(+t._d+o*i),(s||l)&&(a=t.minute(),r=t.hour()),s&&t.date(t.date()+s*i),l&&t.month(t.month()+l*i),o&&!n&&M.updateOffset(t),(s||l)&&(t.minute(a),t.hour(r))}function d(t){return"[object Array]"===Object.prototype.toString.call(t)}function u(t,e){var i,n=Math.min(t.length,e.length),a=Math.abs(t.length-e.length),r=0;for(i=0;n>i;i++)~~t[i]!==~~e[i]&&r++;return r+a}function p(t){return t?le[t]||t.toLowerCase().replace(/(.)s$/,"$1"):t}function f(t,e){return e.abbr=t,G[t]||(G[t]=new n),G[t].set(e),G[t]
}function h(t){delete G[t]}function m(t){if(!t)return M.fn._lang;if(!G[t]&&j)try{require("./lang/"+t)}catch(e){return M.fn._lang}return G[t]||M.fn._lang}function g(t){return t.match(/\[.*\]/)?t.replace(/^\[|\]$/g,""):t.replace(/\\/g,"")}function v(t){var e,i,n=t.match(z);for(e=0,i=n.length;i>e;e++)n[e]=pe[n[e]]?pe[n[e]]:g(n[e]);return function(a){var r="";for(e=0;i>e;e++)r+=n[e]instanceof Function?n[e].call(a,t):n[e];return r}}function y(t,e){return e=D(e,t.lang()),ce[e]||(ce[e]=v(e)),ce[e](t)}function D(t,e){function i(t){return e.longDateFormat(t)||t}for(var n=5;n--&&(W.lastIndex=0,W.test(t));)t=t.replace(W,i);return t}function b(t,e){switch(t){case"DDDD":return Z;case"YYYY":return Q;case"YYYYY":return X;case"S":case"SS":case"SSS":case"DDD":return q;case"MMM":case"MMMM":case"dd":case"ddd":case"dddd":return J;case"a":case"A":return m(e._l)._meridiemParse;case"X":return ee;case"Z":case"ZZ":return K;case"T":return te;case"MM":case"DD":case"YY":case"HH":case"hh":case"mm":case"ss":case"M":case"D":case"d":case"H":case"h":case"m":case"s":return Y;default:return RegExp(t.replace("\\",""))}}function C(t){var e=(K.exec(t)||[])[0],i=(e+"").match(re)||["-",0,0],n=+(60*i[1])+~~i[2];return"+"===i[0]?-n:n}function T(t,e,i){var n,a=i._a;switch(t){case"M":case"MM":null!=e&&(a[1]=~~e-1);break;case"MMM":case"MMMM":n=m(i._l).monthsParse(e),null!=n?a[1]=n:i._isValid=!1;break;case"D":case"DD":null!=e&&(a[2]=~~e);break;case"DDD":case"DDDD":null!=e&&(a[1]=0,a[2]=~~e);break;case"YY":a[0]=~~e+(~~e>68?1900:2e3);break;case"YYYY":case"YYYYY":a[0]=~~e;break;case"a":case"A":i._isPm=m(i._l).isPM(e);break;case"H":case"HH":case"h":case"hh":a[3]=~~e;break;case"m":case"mm":a[4]=~~e;break;case"s":case"ss":a[5]=~~e;break;case"S":case"SS":case"SSS":a[6]=~~(1e3*("0."+e));break;case"X":i._d=new Date(1e3*parseFloat(e));break;case"Z":case"ZZ":i._useUTC=!0,i._tzm=C(e)}null==e&&(i._isValid=!1)}function w(t){var e,i,n,a=[];if(!t._d){for(n=_(t),e=0;3>e&&null==t._a[e];++e)t._a[e]=a[e]=n[e];for(;7>e;e++)t._a[e]=a[e]=null==t._a[e]?2===e?1:0:t._a[e];a[3]+=~~((t._tzm||0)/60),a[4]+=~~((t._tzm||0)%60),i=new Date(0),t._useUTC?(i.setUTCFullYear(a[0],a[1],a[2]),i.setUTCHours(a[3],a[4],a[5],a[6])):(i.setFullYear(a[0],a[1],a[2]),i.setHours(a[3],a[4],a[5],a[6])),t._d=i}}function A(t){var e=t._i;t._d||(t._a=[e.years||e.year||e.y,e.months||e.month||e.M,e.days||e.day||e.d,e.hours||e.hour||e.h,e.minutes||e.minute||e.m,e.seconds||e.second||e.s,e.milliseconds||e.millisecond||e.ms],w(t))}function _(t){var e=new Date;return t._useUTC?[e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate()]:[e.getFullYear(),e.getMonth(),e.getDate()]}function x(t){var e,i,n,a=m(t._l),r=""+t._i;for(n=D(t._f,a).match(z),t._a=[],e=0;n.length>e;e++)i=(b(n[e],t).exec(r)||[])[0],i&&(r=r.slice(r.indexOf(i)+i.length)),pe[n[e]]&&T(n[e],i,t);r&&(t._il=r),t._isPm&&12>t._a[3]&&(t._a[3]+=12),t._isPm===!1&&12===t._a[3]&&(t._a[3]=0),w(t)}function k(t){var e,i,n,r,s,l=99;for(r=0;t._f.length>r;r++)e=o({},t),e._f=t._f[r],x(e),i=new a(e),s=u(e._a,i.toArray()),i._il&&(s+=i._il.length),l>s&&(l=s,n=i);o(t,n)}function S(t){var e,i=t._i,n=ie.exec(i);if(n){for(t._f="YYYY-MM-DD"+(n[2]||" "),e=0;4>e;e++)if(ae[e][1].exec(i)){t._f+=ae[e][0];break}K.exec(i)&&(t._f+=" Z"),x(t)}else t._d=new Date(i)}function F(e){var i=e._i,n=U.exec(i);i===t?e._d=new Date:n?e._d=new Date(+n[1]):"string"==typeof i?S(e):d(i)?(e._a=i.slice(0),w(e)):i instanceof Date?e._d=new Date(+i):"object"==typeof i?A(e):e._d=new Date(i)}function I(t,e,i,n,a){return a.relativeTime(e||1,!!i,t,n)}function E(t,e,i){var n=P(Math.abs(t)/1e3),a=P(n/60),r=P(a/60),o=P(r/24),s=P(o/365),l=45>n&&["s",n]||1===a&&["m"]||45>a&&["mm",a]||1===r&&["h"]||22>r&&["hh",r]||1===o&&["d"]||25>=o&&["dd",o]||45>=o&&["M"]||345>o&&["MM",P(o/30)]||1===s&&["y"]||["yy",s];return l[2]=e,l[3]=t>0,l[4]=i,I.apply({},l)}function O(t,e,i){var n,a=i-e,r=i-t.day();return r>a&&(r-=7),a-7>r&&(r+=7),n=M(t).add("d",r),{week:Math.ceil(n.dayOfYear()/7),year:n.year()}}function N(t){var e=t._i,i=t._f;return null===e||""===e?null:("string"==typeof e&&(t._i=e=m().preparse(e)),M.isMoment(e)?(t=o({},e),t._d=new Date(+e._d)):i?d(i)?k(t):x(t):F(t),new a(t))}function L(t,e){M.fn[t]=M.fn[t+"s"]=function(t){var i=this._isUTC?"UTC":"";return null!=t?(this._d["set"+i+e](t),M.updateOffset(this),this):this._d["get"+i+e]()}}function $(t){M.duration.fn[t]=function(){return this._data[t]}}function R(t,e){M.duration.fn["as"+t]=function(){return+this/e}}for(var M,B,V="2.2.1",P=Math.round,G={},j="undefined"!=typeof module&&module.exports,U=/^\/?Date\((\-?\d+)/i,H=/(\-)?(?:(\d*)\.)?(\d+)\:(\d+)\:(\d+)\.?(\d{3})?/,z=/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|mm?|ss?|SS?S?|X|zz?|ZZ?|.)/g,W=/(\[[^\[]*\])|(\\)?(LT|LL?L?L?|l{1,4})/g,Y=/\d\d?/,q=/\d{1,3}/,Z=/\d{3}/,Q=/\d{1,4}/,X=/[+\-]?\d{1,6}/,J=/[0-9]*['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF\/]+(\s*?[\u0600-\u06FF]+){1,2}/i,K=/Z|[\+\-]\d\d:?\d\d/i,te=/T/i,ee=/[\+\-]?\d+(\.\d{1,3})?/,ie=/^\s*\d{4}-\d\d-\d\d((T| )(\d\d(:\d\d(:\d\d(\.\d\d?\d?)?)?)?)?([\+\-]\d\d:?\d\d)?)?/,ne="YYYY-MM-DDTHH:mm:ssZ",ae=[["HH:mm:ss.S",/(T| )\d\d:\d\d:\d\d\.\d{1,3}/],["HH:mm:ss",/(T| )\d\d:\d\d:\d\d/],["HH:mm",/(T| )\d\d:\d\d/],["HH",/(T| )\d\d/]],re=/([\+\-]|\d\d)/gi,oe="Date|Hours|Minutes|Seconds|Milliseconds".split("|"),se={Milliseconds:1,Seconds:1e3,Minutes:6e4,Hours:36e5,Days:864e5,Months:2592e6,Years:31536e6},le={ms:"millisecond",s:"second",m:"minute",h:"hour",d:"day",w:"week",W:"isoweek",M:"month",y:"year"},ce={},de="DDD w W M D d".split(" "),ue="M D H h m s w W".split(" "),pe={M:function(){return this.month()+1},MMM:function(t){return this.lang().monthsShort(this,t)},MMMM:function(t){return this.lang().months(this,t)},D:function(){return this.date()},DDD:function(){return this.dayOfYear()},d:function(){return this.day()},dd:function(t){return this.lang().weekdaysMin(this,t)},ddd:function(t){return this.lang().weekdaysShort(this,t)},dddd:function(t){return this.lang().weekdays(this,t)},w:function(){return this.week()},W:function(){return this.isoWeek()},YY:function(){return l(this.year()%100,2)},YYYY:function(){return l(this.year(),4)},YYYYY:function(){return l(this.year(),5)},gg:function(){return l(this.weekYear()%100,2)},gggg:function(){return this.weekYear()},ggggg:function(){return l(this.weekYear(),5)},GG:function(){return l(this.isoWeekYear()%100,2)},GGGG:function(){return this.isoWeekYear()},GGGGG:function(){return l(this.isoWeekYear(),5)},e:function(){return this.weekday()},E:function(){return this.isoWeekday()},a:function(){return this.lang().meridiem(this.hours(),this.minutes(),!0)},A:function(){return this.lang().meridiem(this.hours(),this.minutes(),!1)},H:function(){return this.hours()},h:function(){return this.hours()%12||12},m:function(){return this.minutes()},s:function(){return this.seconds()},S:function(){return~~(this.milliseconds()/100)},SS:function(){return l(~~(this.milliseconds()/10),2)},SSS:function(){return l(this.milliseconds(),3)},Z:function(){var t=-this.zone(),e="+";return 0>t&&(t=-t,e="-"),e+l(~~(t/60),2)+":"+l(~~t%60,2)},ZZ:function(){var t=-this.zone(),e="+";return 0>t&&(t=-t,e="-"),e+l(~~(10*t/6),4)},z:function(){return this.zoneAbbr()},zz:function(){return this.zoneName()},X:function(){return this.unix()}};de.length;)B=de.pop(),pe[B+"o"]=i(pe[B],B);for(;ue.length;)B=ue.pop(),pe[B+B]=e(pe[B],2);for(pe.DDDD=e(pe.DDD,3),o(n.prototype,{set:function(t){var e,i;for(i in t)e=t[i],"function"==typeof e?this[i]=e:this["_"+i]=e},_months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),months:function(t){return this._months[t.month()]},_monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),monthsShort:function(t){return this._monthsShort[t.month()]},monthsParse:function(t){var e,i,n;for(this._monthsParse||(this._monthsParse=[]),e=0;12>e;e++)if(this._monthsParse[e]||(i=M.utc([2e3,e]),n="^"+this.months(i,"")+"|^"+this.monthsShort(i,""),this._monthsParse[e]=RegExp(n.replace(".",""),"i")),this._monthsParse[e].test(t))return e},_weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdays:function(t){return this._weekdays[t.day()]},_weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysShort:function(t){return this._weekdaysShort[t.day()]},_weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),weekdaysMin:function(t){return this._weekdaysMin[t.day()]},weekdaysParse:function(t){var e,i,n;for(this._weekdaysParse||(this._weekdaysParse=[]),e=0;7>e;e++)if(this._weekdaysParse[e]||(i=M([2e3,1]).day(e),n="^"+this.weekdays(i,"")+"|^"+this.weekdaysShort(i,"")+"|^"+this.weekdaysMin(i,""),this._weekdaysParse[e]=RegExp(n.replace(".",""),"i")),this._weekdaysParse[e].test(t))return e},_longDateFormat:{LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D YYYY",LLL:"MMMM D YYYY LT",LLLL:"dddd, MMMM D YYYY LT"},longDateFormat:function(t){var e=this._longDateFormat[t];return!e&&this._longDateFormat[t.toUpperCase()]&&(e=this._longDateFormat[t.toUpperCase()].replace(/MMMM|MM|DD|dddd/g,function(t){return t.slice(1)}),this._longDateFormat[t]=e),e},isPM:function(t){return"p"===(t+"").toLowerCase().charAt(0)},_meridiemParse:/[ap]\.?m?\.?/i,meridiem:function(t,e,i){return t>11?i?"pm":"PM":i?"am":"AM"},_calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},calendar:function(t,e){var i=this._calendar[t];return"function"==typeof i?i.apply(e):i},_relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},relativeTime:function(t,e,i,n){var a=this._relativeTime[i];return"function"==typeof a?a(t,e,i,n):a.replace(/%d/i,t)},pastFuture:function(t,e){var i=this._relativeTime[t>0?"future":"past"];return"function"==typeof i?i(e):i.replace(/%s/i,e)},ordinal:function(t){return this._ordinal.replace("%d",t)},_ordinal:"%d",preparse:function(t){return t},postformat:function(t){return t},week:function(t){return O(t,this._week.dow,this._week.doy).week},_week:{dow:0,doy:6}}),M=function(t,e,i){return N({_i:t,_f:e,_l:i,_isUTC:!1})},M.utc=function(t,e,i){return N({_useUTC:!0,_isUTC:!0,_l:i,_i:t,_f:e}).utc()},M.unix=function(t){return M(1e3*t)},M.duration=function(t,e){var i,n,a=M.isDuration(t),o="number"==typeof t,s=a?t._input:o?{}:t,l=H.exec(t);return o?e?s[e]=t:s.milliseconds=t:l&&(i="-"===l[1]?-1:1,s={y:0,d:~~l[2]*i,h:~~l[3]*i,m:~~l[4]*i,s:~~l[5]*i,ms:~~l[6]*i}),n=new r(s),a&&t.hasOwnProperty("_lang")&&(n._lang=t._lang),n},M.version=V,M.defaultFormat=ne,M.updateOffset=function(){},M.lang=function(t,e){return t?(t=t.toLowerCase(),t=t.replace("_","-"),e?f(t,e):null===e?(h(t),t="en"):G[t]||m(t),M.duration.fn._lang=M.fn._lang=m(t),void 0):M.fn._lang._abbr},M.langData=function(t){return t&&t._lang&&t._lang._abbr&&(t=t._lang._abbr),m(t)},M.isMoment=function(t){return t instanceof a},M.isDuration=function(t){return t instanceof r},o(M.fn=a.prototype,{clone:function(){return M(this)},valueOf:function(){return+this._d+6e4*(this._offset||0)},unix:function(){return Math.floor(+this/1e3)},toString:function(){return this.format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")},toDate:function(){return this._offset?new Date(+this):this._d},toISOString:function(){return y(M(this).utc(),"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]")},toArray:function(){var t=this;return[t.year(),t.month(),t.date(),t.hours(),t.minutes(),t.seconds(),t.milliseconds()]},isValid:function(){return null==this._isValid&&(this._isValid=this._a?!u(this._a,(this._isUTC?M.utc(this._a):M(this._a)).toArray()):!isNaN(this._d.getTime())),!!this._isValid},invalidAt:function(){var t,e=this._a,i=(this._isUTC?M.utc(this._a):M(this._a)).toArray();for(t=6;t>=0&&e[t]===i[t];--t);return t},utc:function(){return this.zone(0)},local:function(){return this.zone(0),this._isUTC=!1,this},format:function(t){var e=y(this,t||M.defaultFormat);return this.lang().postformat(e)},add:function(t,e){var i;return i="string"==typeof t?M.duration(+e,t):M.duration(t,e),c(this,i,1),this},subtract:function(t,e){var i;return i="string"==typeof t?M.duration(+e,t):M.duration(t,e),c(this,i,-1),this},diff:function(t,e,i){var n,a,r=this._isUTC?M(t).zone(this._offset||0):M(t).local(),o=6e4*(this.zone()-r.zone());return e=p(e),"year"===e||"month"===e?(n=432e5*(this.daysInMonth()+r.daysInMonth()),a=12*(this.year()-r.year())+(this.month()-r.month()),a+=(this-M(this).startOf("month")-(r-M(r).startOf("month")))/n,a-=6e4*(this.zone()-M(this).startOf("month").zone()-(r.zone()-M(r).startOf("month").zone()))/n,"year"===e&&(a/=12)):(n=this-r,a="second"===e?n/1e3:"minute"===e?n/6e4:"hour"===e?n/36e5:"day"===e?(n-o)/864e5:"week"===e?(n-o)/6048e5:n),i?a:s(a)},from:function(t,e){return M.duration(this.diff(t)).lang(this.lang()._abbr).humanize(!e)},fromNow:function(t){return this.from(M(),t)},calendar:function(){var t=this.diff(M().zone(this.zone()).startOf("day"),"days",!0),e=-6>t?"sameElse":-1>t?"lastWeek":0>t?"lastDay":1>t?"sameDay":2>t?"nextDay":7>t?"nextWeek":"sameElse";return this.format(this.lang().calendar(e,this))},isLeapYear:function(){var t=this.year();return 0===t%4&&0!==t%100||0===t%400},isDST:function(){return this.zone()<this.clone().month(0).zone()||this.zone()<this.clone().month(5).zone()},day:function(t){var e=this._isUTC?this._d.getUTCDay():this._d.getDay();return null!=t?"string"==typeof t&&(t=this.lang().weekdaysParse(t),"number"!=typeof t)?this:this.add({d:t-e}):e},month:function(t){var e,i=this._isUTC?"UTC":"";return null!=t?"string"==typeof t&&(t=this.lang().monthsParse(t),"number"!=typeof t)?this:(e=this.date(),this.date(1),this._d["set"+i+"Month"](t),this.date(Math.min(e,this.daysInMonth())),M.updateOffset(this),this):this._d["get"+i+"Month"]()},startOf:function(t){switch(t=p(t)){case"year":this.month(0);case"month":this.date(1);case"week":case"isoweek":case"day":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}return"week"===t?this.weekday(0):"isoweek"===t&&this.isoWeekday(1),this},endOf:function(t){return t=p(t),this.startOf(t).add("isoweek"===t?"week":t,1).subtract("ms",1)},isAfter:function(t,e){return e=e!==void 0?e:"millisecond",+this.clone().startOf(e)>+M(t).startOf(e)},isBefore:function(t,e){return e=e!==void 0?e:"millisecond",+this.clone().startOf(e)<+M(t).startOf(e)},isSame:function(t,e){return e=e!==void 0?e:"millisecond",+this.clone().startOf(e)===+M(t).startOf(e)},min:function(t){return t=M.apply(null,arguments),this>t?this:t},max:function(t){return t=M.apply(null,arguments),t>this?this:t},zone:function(t){var e=this._offset||0;return null==t?this._isUTC?e:this._d.getTimezoneOffset():("string"==typeof t&&(t=C(t)),16>Math.abs(t)&&(t=60*t),this._offset=t,this._isUTC=!0,e!==t&&c(this,M.duration(e-t,"m"),1,!0),this)},zoneAbbr:function(){return this._isUTC?"UTC":""},zoneName:function(){return this._isUTC?"Coordinated Universal Time":""},hasAlignedHourOffset:function(t){return t=t?M(t).zone():0,0===(this.zone()-t)%60},daysInMonth:function(){return M.utc([this.year(),this.month()+1,0]).date()},dayOfYear:function(t){var e=P((M(this).startOf("day")-M(this).startOf("year"))/864e5)+1;return null==t?e:this.add("d",t-e)},weekYear:function(t){var e=O(this,this.lang()._week.dow,this.lang()._week.doy).year;return null==t?e:this.add("y",t-e)},isoWeekYear:function(t){var e=O(this,1,4).year;return null==t?e:this.add("y",t-e)},week:function(t){var e=this.lang().week(this);return null==t?e:this.add("d",7*(t-e))},isoWeek:function(t){var e=O(this,1,4).week;return null==t?e:this.add("d",7*(t-e))},weekday:function(t){var e=(this._d.getDay()+7-this.lang()._week.dow)%7;return null==t?e:this.add("d",t-e)},isoWeekday:function(t){return null==t?this.day()||7:this.day(this.day()%7?t:t-7)},get:function(t){return t=p(t),this[t.toLowerCase()]()},set:function(t,e){t=p(t),this[t.toLowerCase()](e)},lang:function(e){return e===t?this._lang:(this._lang=m(e),this)}}),B=0;oe.length>B;B++)L(oe[B].toLowerCase().replace(/s$/,""),oe[B]);L("year","FullYear"),M.fn.days=M.fn.day,M.fn.months=M.fn.month,M.fn.weeks=M.fn.week,M.fn.isoWeeks=M.fn.isoWeek,M.fn.toJSON=M.fn.toISOString,o(M.duration.fn=r.prototype,{_bubble:function(){var t,e,i,n,a=this._milliseconds,r=this._days,o=this._months,l=this._data;l.milliseconds=a%1e3,t=s(a/1e3),l.seconds=t%60,e=s(t/60),l.minutes=e%60,i=s(e/60),l.hours=i%24,r+=s(i/24),l.days=r%30,o+=s(r/30),l.months=o%12,n=s(o/12),l.years=n},weeks:function(){return s(this.days()/7)},valueOf:function(){return this._milliseconds+864e5*this._days+2592e6*(this._months%12)+31536e6*~~(this._months/12)},humanize:function(t){var e=+this,i=E(e,!t,this.lang());return t&&(i=this.lang().pastFuture(e,i)),this.lang().postformat(i)},add:function(t,e){var i=M.duration(t,e);return this._milliseconds+=i._milliseconds,this._days+=i._days,this._months+=i._months,this._bubble(),this},subtract:function(t,e){var i=M.duration(t,e);return this._milliseconds-=i._milliseconds,this._days-=i._days,this._months-=i._months,this._bubble(),this},get:function(t){return t=p(t),this[t.toLowerCase()+"s"]()},as:function(t){return t=p(t),this["as"+t.charAt(0).toUpperCase()+t.slice(1)+"s"]()},lang:M.fn.lang});for(B in se)se.hasOwnProperty(B)&&(R(B,se[B]),$(B.toLowerCase()));R("Weeks",6048e5),M.duration.fn.asMonths=function(){return(+this-31536e6*this.years())/2592e6+12*this.years()},M.lang("en",{ordinal:function(t){var e=t%10,i=1===~~(t%100/10)?"th":1===e?"st":2===e?"nd":3===e?"rd":"th";return t+i}}),j&&(module.exports=M),"undefined"==typeof ender&&(this.moment=M),"function"==typeof define&&define.amd&&define("moment",[],function(){return M})}.call(this),function(t,e,i,n){t.fn.caret=function(a,r){var o,s,l=this[0],c=t.browser.msie;if("object"==typeof a&&"number"==typeof a.start&&"number"==typeof a.end)o=a.start,s=a.end;else if("number"==typeof a&&"number"==typeof r)o=a,s=r;else if("number"==typeof a&&r===void 0)o=a,s=a;else if("string"==typeof a)(o=l.value.indexOf(a))>-1?s=o+a[e]:o=null;else if("[object RegExp]"===Object.prototype.toString.call(a)){var d=a.exec(l.value);null!=d&&(o=d.index,s=o+d[0][e])}if(o!==void 0){if(c){var u=this[0].createTextRange();u.collapse(!0),u.moveStart("character",o),u.moveEnd("character",s-o),u.select()}else this[0].selectionStart=o,this[0].selectionEnd=s;return this[0].focus(),this}if(c){var p=document.selection;if("textarea"!=this[0].tagName.toLowerCase()){var f=this.val(),h=p[i]()[n]();h.moveEnd("character",f[e]);var m=""==h.text?f[e]:f.lastIndexOf(h.text);h=p[i]()[n](),h.moveStart("character",-f[e]);var g=h.text[e]}else{var h=p[i](),v=h[n]();v.moveToElementText(this[0]),v.setEndPoint("EndToEnd",h);var m=v.text[e]-h.text[e],g=m+h.text[e]}}else var m=l.selectionStart,g=l.selectionEnd;var y=l.value.substring(m,g);return{start:m,end:g,text:y,replace:function(t){return l.value.substring(0,m)+t+l.value.substring(g,l.value[e])}}}}(jQuery,"length","createRange","duplicate"),function(t){t.widget("ui.inputControl",{_init:function(){var e={fnDecimal:function(t){return"."===t.text.slice(-3).slice(0,1)?(t.e.preventDefault(),void 0):(isNaN(t.str)&&(0>t.text.indexOf(".")&&(t.text=t.text.replaceAt(".",t.pos),t.input.val(t.text).caret(t.pos+1)),t.e.preventDefault()),void 0)},fnDecimalBlur:function(){},fnInteger:function(t){isNaN(t.str)&&t.e.preventDefault()},fnIntegerBlur:function(){},fnTime:function(t){if(isNaN(t.str)){var e=t.pos,i=t.text;e!==t.len||2!==e&&1!==e||(1===e&&(i="0"+i,e++),i=i.replaceAt(":",e),t.input.val(i).caret(e+1)),t.e.preventDefault()}else t.pos>4&&t.e.preventDefault()},fnNoBlur:function(t){var e=/^\d+\.?\d*/.exec(t.text);e=e[0],"."===e.slice(-1)&&(e+="0"),t.input.val(e)},fnTimeBlur:function(t){var e,i=t.input.val().match(/(2[0-3]|[01]?\d)?(:)?([0-5]?\d)/);i?(e=i[0],i[2]?1===i[3].length&&(e=e.replace(":",":0")):(1===e.length&&(e="0"+e),e+=":00")):e="00:00",t.input.val(e)},fnDate:function(e){if(isNaN(e.str)){var i=e.text,n=e.pos,a=e.len,r=parseInt(i,10);console.log("position: "+n),n===a&&t.inArray(n,[2,6,4,7])>-1&&(2===n?(i=30>r?"20"+i:"19"+i,n=4):6===n&&(i=i.replace(".",".0"),n++),i=i.replaceAt(".",n),e.input.val(i).caret(n+1)),e.e.preventDefault()}else e.pos>9&&e.e.preventDefault()},fnDateBlur:function(t){var e=t.opts.Validity;9===t.len&&(t.text=t.text.slice(0,8)+"0"+t.text.slice(-1),t.input.val(t.text));var i=function(){var i=App.userData.dateFormat,n=moment(t.text,i),a="Netinkamas datos formatas. Pakeiskite į tokį "+i;if(t.input.css("border-color","").data("notValid",!1).parent().find("div.validity-tooltip").remove(),n&&n.isValid()&&(a=""),!a){var r="Data negali būt didesnė už šiandieną - ",o=function(t){return"today"===t.toLocaleLowerCase()?moment():moment(t,i)};if(e.lessOf){var s=e.lessOf,l=o(s.date);0>l.diff(n,"hours")&&(a=(s.msg?s.msg:r)+l.format(i))}if(e.moreOf&&!a){var s=e.moreOf,l=o(s.date);l.diff(n,"hours")>23&&(a=(s.msg?s.msg:r.replace("didesnė","mažesnė"))+l.format(i)),console.log("moreOf dif: "+l.diff(n,"hours"))}}a&&t.input.css("border-color","#eb5a44").data("notValid",!0).parent().append("<div class='validity-tooltip'>"+a+"</div>")};e&&(i(),Em.run.later(this,function(){i()},300))}},i=function(e){var i="blur"===e.type?"Blur":"",n=t(e.target),a=n.val(),r=a.length,o=e.charCode,s=String.fromCharCode(e.keyCode),l=n.caret().start,c=this.opts,e=e;if(!i){var d=n.caret();d.start!==d.end&&(a=a.slice(0,d.start)+a.slice(d.end),l=d.start)}var u="fn"+this.opts.type+i;this.fnHandlers[u]({input:n,text:a,len:r,key:o,str:s,pos:l,opts:c,e:e})},n={opts:this.options,fnHandlers:e},a=t.proxy(i,n);t(this.element).on("keypress",a).on("blur",a)},options:{delay:500}})}(jQuery),jQuery(function(t){t.datepicker.regional.lt={closeText:"Uždaryti",prevText:"&#x3c;Atgal",nextText:"Pirmyn&#x3e;",currentText:"Šiandien",monthNames:["Sausis","Vasaris","Kovas","Balandis","Gegužė","Birželis","Liepa","Rugpjūtis","Rugsėjis","Spalis","Lapkritis","Gruodis"],monthNamesShort:["Sau","Vas","Kov","Bal","Geg","Bir","Lie","Rugp","Rugs","Spa","Lap","Gru"],dayNames:["sekmadienis","pirmadienis","antradienis","trečiadienis","ketvirtadienis","penktadienis","šeštadienis"],dayNamesShort:["sek","pir","ant","tre","ket","pen","šeš"],dayNamesMin:["Se","Pr","An","Tr","Ke","Pe","Še"],weekHeader:"Sv",dateFormat:"yy.mm.dd",firstDay:1,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},t.datepicker.setDefaults(t.datepicker.regional.lt),t.datepicker.setDefaults({duration:"fast",changeMonth:!0,changeYear:!0,showOtherMonths:!0,constrainInput:!1})}),function(t){t.fn.extend({tblSortable:function(e){var i={cols:[],controller:null,sortedCol:1},n=t.extend(i,e),a=this;return a.each(function(){t(this).find("th").each(function(e){n.cols[e]&&(t(this).addClass("clickable").on("click",function(i){a.spinner();var r,o="TH"===i.target.tagName.toUpperCase()?t(i.target):t(i.target).closest("th"),s=o.find("span").attr("class"),l="ui-icon-carat-1-n",c="ui-icon-carat-1-s",d="ui-icon-carat-2-n-s";if(s.indexOf(d)>-1)r=l;else if(s.indexOf(l)>-1)r=c;else{if(!(s.indexOf(c)>-1))throw Error("no needed class found");r=l}o.closest("tr").find("span."+l).toggleClass(l+" "+d),o.closest("tr").find("span."+c).toggleClass(c+" "+d),o.find("span").toggleClass(d+" "+r);var u=App[n.controller];r===l?u.set("sortAscending",!0):u.set("sortAscending",!1),u.set("sortProperties",[n.cols[e]]),u.set("content",u.get("arrangedContent")),n.refreshView&&!i.isTrigger&&n.refreshView.call(u),a.spinner("remove")}).append('<span class="ui-icon ui-icon-carat-2-n-s ui-tblHead-icon"></span>'),e===n.sortedCol&&t(this).trigger("click"))})})}})}(jQuery),function(t){var e={options:{topPadding:0,afterDetachCSSClass:"",savePanelSpace:!1,onDetached:null,onReAttached:null,parentSelector:null},init:function(i){var i=t.extend({element:t(this)},e.options,i);return this.each(function(){var n=Math.ceil(9999*Math.random());if(t(this).data("stickyPanel.state",{stickyPanelId:n,isDetached:!1,parentContainer:t(i.parentSelector?i.parentSelector:window),options:i}),i.parentSelector){var a=t(this).data("stickyPanel.state").parentContainer.css("position");switch(a){case"inherit":case"static":t(this).data("stickyPanel.state").parentContainer.css("position","relative")}}t(this).data("stickyPanel.state").parentContainer.bind("scroll.stickyPanel_"+n,{selected:t(this)},e.scroll),t(window).resize(function(){return e.unstick(i.element),!1})})},scroll:function(i){var n=i.originalEvent?i.data.selected:i,a=n.data("stickyPanel.state").options,r=n.data("stickyPanel.state").parentContainer,o=r.height(),s=n.outerHeight(!0);if(s+50>o)return!1;var l=a.parentSelector?r.scrollTop():t(document).scrollTop(),c=a.parentSelector?r.height():t(document).height(),d=a.parentSelector?o:c-o,u=n.position().top-a.topPadding,p=0>u?0:u,f=n.data("stickyPanel.state").isDetached;if(d>=l&&l>p&&!f){n.data("stickyPanel.state").isDetached=!0;var h=0;"undefined"!=a.topPadding&&(h+=a.topPadding);var m=a.parentSelector?n.position().left:n.offset().left,g=a.parentSelector?n.position().top:n.offset().top;n.data("PanelsTop",g-h);var v=null;if(1==a.savePanelSpace){var y=n.outerWidth(!0),D=n.css("float"),b=n.css("display"),C=Math.ceil(9999*Math.random());n.data("stickyPanel.PanelSpaceID","stickyPanelSpace"+C),v=t("<div id='"+n.data("stickyPanel.PanelSpaceID")+"' style='width:"+y+"px;height:"+s+"px;float:"+D+";display:"+b+";'>&#20;</div>"),n.before(v)}""!=a.afterDetachCSSClass&&n.addClass(a.afterDetachCSSClass),n.data("Original_Inline_CSS",n.attr("style")?n.attr("style"):""),n.css({margin:0,left:m,top:h,position:a.parentSelector?"absolute":"fixed",width:n.outerWidth(!1)}),a.onDetached&&a.onDetached(n,v)}a.parentSelector&&f&&n.css({top:a.topPadding?l+a.topPadding:l}),n.data("PanelsTop")>=l&&"auto"!=n.css("top")&&f&&e.unstick(n)},unstick:function(i){var n=i?i:this;n.data("stickyPanel.state").isDetached=!1;var a=n.data("stickyPanel.state").options;1==a.savePanelSpace&&t("#"+n.data("stickyPanel.PanelSpaceID")).remove(),n.attr("style",n.data("Original_Inline_CSS")),""!=a.afterDetachCSSClass&&n.removeClass(a.afterDetachCSSClass),a.onReAttached&&a.onReAttached(n),i||e._unstick(n)},_unstick:function(t){t.data("stickyPanel.state").parentContainer.unbind("scroll.stickyPanel_"+t.data("stickyPanel.state").stickyPanelId)}};t.fn.stickyPanel=function(i){return e[i]?e[i].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof i&&i?(t.error("Method "+i+" does not exist on jQuery.stickyPanel"),void 0):e.init.apply(this,arguments)}}(jQuery),function(t){t.fn.buttonsetv=function(){return t(this).buttonset()}}(jQuery),function(t){t.fn.hoverIntent=function(e,i,n){var a={interval:600,sensitivity:7,timeout:300};a="object"==typeof e?t.extend(a,e):t.isFunction(i)?t.extend(a,{over:e,out:i,selector:n}):t.extend(a,{over:e,out:e,selector:i});var r,o,s,l,c=function(t){r=t.pageX,o=t.pageY},d=function(e,i){return i.hoverIntent_t=clearTimeout(i.hoverIntent_t),Math.abs(s-r)+Math.abs(l-o)<a.sensitivity?(t(i).off("mousemove.hoverIntent",c),i.hoverIntent_s=1,a.over.apply(i,[e])):(s=r,l=o,i.hoverIntent_t=setTimeout(function(){d(e,i)},a.interval),void 0)},u=function(t,e){return e.hoverIntent_t=clearTimeout(e.hoverIntent_t),e.hoverIntent_s=0,a.out.apply(e,[t])},p=function(e){var i=jQuery.extend({},e),n=this;n.hoverIntent_t&&(n.hoverIntent_t=clearTimeout(n.hoverIntent_t)),"mouseenter"==e.type?(s=i.pageX,l=i.pageY,t(n).on("mousemove.hoverIntent",c),1!=n.hoverIntent_s&&(n.hoverIntent_t=setTimeout(function(){d(i,n)},a.interval))):(t(n).off("mousemove.hoverIntent",c),1==n.hoverIntent_s&&(n.hoverIntent_t=setTimeout(function(){u(i,n)},a.timeout)))};return this.on({"mouseenter.hoverIntent":p,"mouseleave.hoverIntent":p},a.selector)}}(jQuery),jQuery.loadScript=function(t,e,i){var n=!1,a=null;$.isFunction(e)?(a=e,n=i||n):(n=e||n,a=i||a);var r=!0;jQuery('script[type="text/javascript"]').each(function(){return r=t!=$(this).attr("src")}),r?jQuery.ajax({type:"GET",url:t,success:a,dataType:"script",cache:n}):jQuery.isFunction(a)&&a.call(this)},function(t){var e,i,n={className:"autosizejs",append:"",callback:!1},a="hidden",r="border-box",o="lineHeight",s='<textarea tabindex="-1" style="position:absolute; top:-999px; left:0; right:auto; bottom:auto; border:0; -moz-box-sizing:content-box; -webkit-box-sizing:content-box; box-sizing:content-box; word-wrap:break-word; height:0 !important; width: 0; min-height:0 !important; overflow:hidden;"/>',l=["fontFamily","fontSize","fontWeight","fontStyle","letterSpacing","textTransform","wordSpacing","textIndent"],c="oninput",d="onpropertychange",u=t(s).data("autosize",!0)[0];u.style.lineHeight="99px","99px"===t(u).css(o)&&l.push(o),u.style.lineHeight="",t.fn.autosize=function(o){return o=t.extend({},n,o||{}),u.parentNode!==document.body&&(t(document.body).append(u),u.value="\n\n\n",u.scrollTop=9e4,e=u.scrollHeight===u.scrollTop+u.clientHeight),this.each(function(){function n(){i=m,u.className=o.className,t.each(l,function(t,e){u.style[e]=g.css(e)})}function s(){var t,r,s;if(i!==m&&n(),!f){f=!0,u.value=m.value+o.append,u.style.overflowY=m.style.overflowY,s=parseInt(m.style.height,10),u.style.width=Math.max(g.width(),0)+"px",e?t=u.scrollHeight:(u.scrollTop=0,u.scrollTop=9e4,t=u.scrollTop);var l=parseInt(g.css("maxHeight"),10);l=l&&l>0?l:9e4,t>l?(t=l,r="scroll"):p>t&&(t=p),t+=v,m.style.overflowY=r||a,s!==t&&(m.style.height=t+"px",y&&o.callback.call(m)),setTimeout(function(){f=!1},1)}}var p,f,h,m=this,g=t(m),v=0,y=t.isFunction(o.callback);g.data("autosize")||((g.css("box-sizing")===r||g.css("-moz-box-sizing")===r||g.css("-webkit-box-sizing")===r)&&(v=g.outerHeight()-g.height()),p=Math.max(parseInt(g.css("minHeight"),10)-v,g.height()),h="none"===g.css("resize")||"vertical"===g.css("resize")?"none":"horizontal",g.css({overflow:a,overflowY:a,wordWrap:"break-word",resize:h}).data("autosize",!0),d in m?c in m?m[c]=m.onkeyup=s:m[d]=s:m[c]=s,t(window).on("resize",function(){f=!1,s()}),g.on("autosize",function(){f=!1,s()}),s())})}}(window.jQuery||window.Zepto),function(t,e){function i(e,i,n){var r=[];return(e.reduction||e).filter(t.validity.settings.elementSupport).each(function(){i(this)?r.push(this):a(this,s(n,{field:l(this)}))}),e.reduction=t(r),e}function n(){t.validity.isValidating()&&(t.validity.report.errors++,t.validity.report.valid=!1)}function a(e,i){n(),t.validity.out.raise(t(e),i)}function r(e,i){n(),t.validity.out.raiseAggregate(e,i)}function o(t){var e=0;return t.each(function(){var t=parseFloat(this.value);e+=isNaN(t)?0:t}),e}function s(t,e){for(var i in e)e.hasOwnProperty(i)&&(t=t.replace(RegExp("#\\{"+i+"\\}","g"),e[i]));return c(t)}function l(e){var e=t(e),i=e.prop("id"),n=t.validity.settings.defaultFieldName;if(e.prop("title").length)n=e.prop("title");else if(/^([A-Z0-9][a-z]*)+$/.test(i))n=i.replace(/([A-Z0-9])[a-z]*/g," $&");else if(/^[a-z0-9]+(_[a-z0-9]+)*$/.test(i)){for(e=i.split("_"),i=0;e.length>i;++i)e[i]=c(e[i]);n=e.join(" ")}return t.trim(n)}function c(t){return t.substring?t.substring(0,1).toUpperCase()+t.substring(1,t.length):t}var d;t.validity={settings:t.extend({outputMode:"tooltip",scrollTo:!1,modalErrorsClickable:!0,defaultFieldName:"This field",elementSupport:":text, :password, textarea, select, :radio, :checkbox",argToString:function(t){return t.getDate?t.getMonth()+1+"/"+t.getDate()+"/"+t.getFullYear():t},debugPrivates:!1},{}),patterns:{integer:/^\d+$/,date:/^((0?\d)|(1[012]))\/([012]?\d|30|31)\/\d{1,4}$/,email:/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i,usd:/^\$?((\d{1,3}(,\d{3})*)|\d+)(\.(\d{2})?)?$/,url:/^(https?|ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i,number:/^[+-]?(\d+(\.\d*)?|\.\d+)([Ee]-?\d+)?$/,zip:/^\d{5}(-\d{4})?$/,phone:/^[2-9]\d{2}-\d{3}-\d{4}$/,guid:/^(\{?([0-9a-fA-F]){8}-(([0-9a-fA-F]){4}-){3}([0-9a-fA-F]){12}\}?)$/,time12:/^((0?\d)|(1[12])):[0-5]\d?\s?[aApP]\.?[mM]\.?$/,time24:/^(20|21|22|23|[01]\d|\d)(([:][0-5]\d){1,2})$/,nonHtml:/^[^<>]*$/},messages:{require:"#{field} is required.",match:"#{field} is in an invalid format.",integer:"#{field} must be a positive, whole number.",date:"#{field} must be formatted as a date. (mm/dd/yyyy)",email:"#{field} must be formatted as an email.",usd:"#{field} must be formatted as a US Dollar amount.",url:"#{field} must be formatted as a URL.",number:"#{field} must be formatted as a number.",zip:"#{field} must be formatted as a zipcode ##### or #####-####.",phone:"#{field} must be formatted as a phone number ###-###-####.",guid:"#{field} must be formatted as a guid like {3F2504E0-4F89-11D3-9A0C-0305E82C3301}.",time24:"#{field} must be formatted as a 24 hour time: 23:00.",time12:"#{field} must be formatted as a 12 hour time: 12:00 AM/PM",lessThan:"#{field} must be less than #{max}.",lessThanOrEqualTo:"#{field} must be less than or equal to #{max}.",greaterThan:"#{field} must be greater than #{min}.",greaterThanOrEqualTo:"#{field} must be greater than or equal to #{min}.",range:"#{field} must be between #{min} and #{max}.",tooLong:"#{field} cannot be longer than #{max} characters.",tooShort:"#{field} cannot be shorter than #{min} characters.",nonHtml:"#{field} cannot contain HTML characters.",alphabet:"#{field} contains disallowed characters.",minCharClass:"#{field} cannot have more than #{min} #{charClass} characters.",maxCharClass:"#{field} cannot have less than #{min} #{charClass} characters.",equal:"Values don't match.",distinct:"A value was repeated.",sum:"Values don't add to #{sum}.",sumMax:"The sum of the values must be less than #{max}.",sumMin:"The sum of the values must be greater than #{min}.",radioChecked:"The selected value is not valid.",generic:"Invalid."},out:{start:function(){this.defer("start")
},end:function(t){this.defer("end",t)},raise:function(t,e){this.defer("raise",t,e)},raiseAggregate:function(t,e){this.defer("raiseAggregate",t,e)},defer:function(e){var i=t.validity,i=i.outputs[i.settings.outputMode];i[e].apply(i,Array.prototype.slice.call(arguments,1))}},charClasses:{alphabetical:/\w/g,numeric:/\d/g,alphanumeric:/[A-Za-z0-9]/g,symbol:/[^A-Za-z0-9]/g},outputs:{},__private:e,setup:function(i){this.settings=t.extend(this.settings,i),this.__private=this.settings.debugPrivates?d:e},report:null,isValidating:function(){return!!this.report},start:function(){this.out.start(),this.report={errors:0,valid:!0}},end:function(){var t=this.report||{errors:0,valid:!0};return this.report=null,this.out.end(t),t},clear:function(){this.start(),this.end()}},t.fn.extend({validity:function(e){return this.each(function(){if("form"==this.tagName.toLowerCase()){var i=null;"string"==typeof e?i=function(){t(e).require()}:t.isFunction(e)&&(i=e),e&&t(this).bind("submit",function(){return t.validity.start(),i(),t.validity.end().valid})}})},require:function(e){return i(this,function(e){return t(e).val().length},e||t.validity.messages.require)},match:function(e,n){return n||(n=t.validity.messages.match,"string"==typeof e&&t.validity.messages[e]&&(n=t.validity.messages[e])),"string"==typeof e&&(e=t.validity.patterns[e]),i(this,t.isFunction(e)?function(t){return!t.value.length||e(t.value)}:function(t){return e.global&&(e.lastIndex=0),!t.value.length||e.test(t.value)},n)},range:function(e,n,a){return i(this,e.getTime&&n.getTime?function(t){return t=new Date(t.value),t>=new Date(e)&&new Date(n)>=t}:e.substring&&n.substring&&Big?function(t){return t=new Big(t.value),t.greaterThanOrEqualTo(new Big(e))&&t.lessThanOrEqualTo(new Big(n))}:function(t){return t=parseFloat(t.value),t>=e&&n>=t},a||s(t.validity.messages.range,{min:t.validity.settings.argToString(e),max:t.validity.settings.argToString(n)}))},greaterThan:function(e,n){return i(this,e.getTime?function(t){return new Date(t.value)>e}:e.substring&&Big?function(t){return new Big(t.value).greaterThan(new Big(e))}:function(t){return parseFloat(t.value)>e},n||s(t.validity.messages.greaterThan,{min:t.validity.settings.argToString(e)}))},greaterThanOrEqualTo:function(e,n){return i(this,e.getTime?function(t){return new Date(t.value)>=e}:e.substring&&Big?function(t){return new Big(t.value).greaterThanOrEqualTo(new Big(e))}:function(t){return parseFloat(t.value)>=e},n||s(t.validity.messages.greaterThanOrEqualTo,{min:t.validity.settings.argToString(e)}))},lessThan:function(e,n){return i(this,e.getTime?function(t){return e>new Date(t.value)}:e.substring&&Big?function(t){return new Big(t.value).lessThan(new Big(e))}:function(t){return e>parseFloat(t.value)},n||s(t.validity.messages.lessThan,{max:t.validity.settings.argToString(e)}))},lessThanOrEqualTo:function(e,n){return i(this,e.getTime?function(t){return e>=new Date(t.value)}:e.substring&&Big?function(t){return new Big(t.value).lessThanOrEqualTo(new Big(e))}:function(t){return e>=parseFloat(t.value)},n||s(t.validity.messages.lessThanOrEqualTo,{max:t.validity.settings.argToString(e)}))},maxLength:function(e,n){return i(this,function(t){return e>=t.value.length},n||s(t.validity.messages.tooLong,{max:e}))},minLength:function(e,n){return i(this,function(t){return t.value.length>=e},n||s(t.validity.messages.tooShort,{min:e}))},alphabet:function(e,n){var a=[];return i(this,function(t){for(var i=0;t.value.length>i;++i)if(-1==e.indexOf(t.value.charAt(i)))return a.push(t.value.charAt(i)),!1;return!0},n||s(t.validity.messages.alphabet,{chars:a.join(", ")}))},minCharClass:function(e,n,a){return"string"==typeof e&&(e=e.toLowerCase(),t.validity.charClasses[e]&&(e=t.validity.charClasses[e])),i(this,function(t){return(t.value.match(e)||[]).length>=n},a||s(t.validity.messages.minCharClass,{min:n,charClass:e}))},maxCharClass:function(e,n,a){return"string"==typeof e&&(e=e.toLowerCase(),t.validity.charClasses[e]&&(e=t.validity.charClasses[e])),i(this,function(t){return n>=(t.value.match(e)||[]).length},a||s(t.validity.messages.maxCharClass,{max:n,charClass:e}))},nonHtml:function(e){return i(this,function(e){return t.validity.patterns.nonHtml.test(e.value)},e||t.validity.messages.nonHtml)},equal:function(e,i){var n=(this.reduction||this).filter(t.validity.settings.elementSupport),a=function(t){return t},o=t.validity.messages.equal;if(n.length){t.isFunction(e)?(a=e,"string"==typeof i&&(o=i)):"string"==typeof e&&(o=e);var s,l=t.map(n,function(t){return a(t.value)}),c=l[0],d=!0;for(s in l)l[s]!=c&&(d=!1);d||(r(n,o),this.reduction=t([]))}return this},distinct:function(e,i){var n=(this.reduction||this).filter(t.validity.settings.elementSupport),a=function(t){return t},o=t.validity.messages.distinct,s=[],l=!0;if(n.length){t.isFunction(e)?(a=e,"string"==typeof i&&(o=i)):"string"==typeof e&&(o=e);for(var c=t.map(n,function(t){return a(t.value)}),d=0;c.length>d;++d)if(c[d].length){for(var u=0;s.length>u;++u)s[u]==c[d]&&(l=!1);s.push(c[d])}l||(r(n,o),this.reduction=t([]))}return this},sum:function(e,i){var n=(this.reduction||this).filter(t.validity.settings.elementSupport);return n.length&&e!=o(n)&&(r(n,i||s(t.validity.messages.sum,{sum:e})),this.reduction=t([])),this},sumMax:function(e,i){var n=(this.reduction||this).filter(t.validity.settings.elementSupport);return n.length&&o(n)>e&&(r(n,i||s(t.validity.messages.sumMax,{max:e})),this.reduction=t([])),this},sumMin:function(e,i){var n=(this.reduction||this).filter(t.validity.settings.elementSupport);return n.length&&o(n)>e&&(r(n,i||s(t.validity.messages.sumMin,{min:e})),this.reduction=t([])),this},radioChecked:function(e,i){var n=(this.reduction||this).filter(t.validity.settings.elementSupport);n.is(":radio")&&n.find(":checked").val()!=e&&r(n,i||t.validity.messages.radioChecked)},radioNotChecked:function(e,i){var n=(this.reduction||this).filter(t.validity.settings.elementSupport);n.is(":radio")&&n.filter(":checked").val()==e&&r(n,i||t.validity.messages.radioChecked)},checkboxChecked:function(e){var i=(this.reduction||this).filter(t.validity.settings.elementSupport);i.is(":checkbox")&&!i.is(":checked")&&r(i,e||t.validity.messages.radioChecked)},assert:function(e,n){var a=this.reduction||this;if(a.length){if(t.isFunction(e))return i(this,e,n||t.validity.messages.generic);e||(r(a,n||t.validity.messages.generic),this.reduction=t([]))}return this},fail:function(t){return this.assert(!1,t)}}),d={validate:i,addToReport:n,raiseError:a,raiseAggregateError:r,numericSum:o,format:s,infer:l,capitalize:c}}(jQuery),function(t){t.validity.outputs.tooltip={tooltipClass:"validity-tooltip",start:function(){t("."+t.validity.outputs.tooltip.tooltipClass).prev().hasClass("validity-error-on-field")&&t("."+t.validity.outputs.tooltip.tooltipClass).prev().removeClass("validity-error-on-field"),t("."+t.validity.outputs.tooltip.tooltipClass).remove()},end:function(){},raise:function(e,i){t('<div class="validity-tooltip">'+i+'<div class="validity-tooltip-outer"><div class="validity-tooltip-inner"></div></div></div>').click(function(){e.focus(),t(this).fadeOut(),e.parent().hasClass("validity-error-on-field")&&e.parent().removeClass("validity-error-on-field")}).hide().insertAfter(e.parent()).fadeIn(),e.parent().addClass("validity-error-on-field")},raiseAggregate:function(t,e){t.length&&this.raise(t.filter(":last"),e)}}}(jQuery),function(t){function e(t){return t.attr("id").length?t.attr("id"):t.attr("name")}t.validity.outputs.label={cssClass:"error",start:function(){t("."+t.validity.settings.cssClass).remove()},end:function(e){!e.valid&&t.validity.settings.scrollTo&&(location.hash=t("."+t.validity.outputs.label.cssClass+":eq(0)").attr("for"))},raise:function(i,n){var a="."+t.validity.outputs.label.cssClass+"[for='"+e(i)+"']";t(a).length?t(a).text(n):t("<label/>").attr("for",e(i)).addClass(t.validity.outputs.label.cssClass).text(n).click(function(){i.length&&i[0].select()}).insertAfter(i)},raiseAggregate:function(e,i){e.length&&this.raise(t(e.get(e.length-1)),i)}}}(jQuery),function(t){t.validity.outputs.modal={start:function(){t(".validity-modal-msg").remove()},end:function(e){!e.valid&&t.validity.settings.scrollTo&&(location.hash=t(".validity-modal-msg:eq(0)").attr("id"))},raise:function(e,i){if(e.length){var n=e.offset();e.get(0),n={left:parseInt(n.left+e.width()+4,10)+"px",top:parseInt(n.top-10,10)+"px"},t("<div/>").addClass("validity-modal-msg").css(n).text(i).click(t.validity.settings.modalErrorsClickable?function(){t(this).remove()}:null).appendTo("body")}},raiseAggregate:function(e,i){e.length&&this.raise(t(e.get(e.length-1)),i)}}}(jQuery),function(t){var e=[];t.validity.outputs.summary={start:function(){t(".validity-erroneous").removeClass("validity-erroneous"),e=[]},end:function(){if(t(".validity-summary-container").hide().find("ul").html(""),e.length){for(var i=0;e.length>i;++i)t("<li/>").text(e[i]).appendTo(".validity-summary-container ul");t(".validity-summary-container").show(),t.validity.settings.scrollTo&&(location.hash=t(".validity-erroneous:eq(0)").attr("id"))}},raise:function(t,i){e.push(i),t.addClass("validity-erroneous")},raiseAggregate:function(t,e){this.raise(t,e)},container:function(){document.write('<div class="validity-summary-container">The form didn\'t submit for the following reason(s):<ul></ul></div>')}}}(jQuery),$.extend($.validity.messages,{require:"Šis langelis turi būti užpildytas",match:"Netinkamo formato laukas #{field}",integer:"#{field} turi būti teigiamas, sveikas skaičius",dateUS:"#{field} must be formatted as US date (mm/dd/yyyy).",date:"#{field} turi būt datos formato - (yyyy/mm/dd)",email:"#{field} turi būt e-pašto formato.",emailList:"#{field} turi būti e-pašto formato ir atskirtas ';'.",usd:"#{field} must be formatted as a US Dollar amount.",url:"#{field} must be formatted as a URL.",number:"#{field} turi būti numerio formato.",zip:"#{field} must be formatted as a zipcode ##### or #####-####.",phone:"#{field} must be formatted as a phone number ###-###-####.",guid:"#{field} must be formatted as a guid like {3F2504E0-4F89-11D3-9A0C-0305E82C3301}.",time24:"#{field} must be formatted as a 24 hour time: 23:00.",time12:"#{field} must be formatted as a 12 hour time: 12:00 AM/PM",lessThan:"#{field} turi būti mažiau negu #{max}.",lessThanOrEqualTo:"#{field} turi būti mažiau arba lygu #{max}.",greaterThan:"#{field} turi būti daugiau negu #{min}.",greaterThanOrEqualTo:"#{field} turi būti daugiau arba lygu #{min}.",range:"#{field} turi būti tarp #{min} ir #{max}.",tooLong:"#{field} negali būti ilgesnis negu #{max} raidžių.",tooShort:"#{field} negali būti ilgesnis negu #{min} raidžių.",nonHtml:"#{field} negali turėti HTML raidžių.",alphabet:"#{field} turi būti tik raidės.",minCharClass:"#{field} cannot have more than #{min} #{charClass} characters.",maxCharClass:"#{field} cannot have less than #{min} #{charClass} characters.",equal:"Values don't match.",distinct:"A value was repeated.",sum:"Values don't add to #{sum}.",sumMax:"The sum of the values must be less than #{max}.",sumMin:"The sum of the values must be greater than #{min}.",radioChecked:"The selected value is not valid.",textWithPoint:"Turi būti raidė, skaičius - arba _",textOrNumber:"Turi būti raidės arba skaičiai",generic:"Neteisinga."}),$.extend($.validity.patterns,{date:/^(19|20)[0-9]{2}[\s\.\/-]((0?\d)|(1[012]))[\s\.\/-]([012]?\d|30|31)$/,number:/^[+-]?(\d+(\.\d*)?|\.\d+)([Ee]-?\d+)?$/,textWithPoint:/^[A-Za-z0-9\-\.\_]+$/,textOrNumber:/^[A-Za-z0-9]+$/}),$.extend($.validity.settings,{defaultFieldName:"Šis laukas"}),function(t){t.widget("ech.notify",{options:{speed:300,expires:1500,stack:"below",custom:!1,queue:!1},_create:function(){var e=this;this.templates={},this.keys=[],this.element.addClass("ui-notify").children().addClass("ui-notify-message ui-notify-message-style").each(function(i){i=this.id||i,e.keys.push(i),e.templates[i]=t(this).removeAttr("id").wrap("<div></div>").parent().html()}).end().empty().show()},create:function(e,i,n){return"object"==typeof e&&(n=i,i=e,e=null),e=this.templates[e||this.keys[0]],n&&n.custom&&(e=t(e).removeClass("ui-notify-message-style").wrap("<div></div>").parent().html()),this.openNotifications=this.openNotifications||0,new t.ech.notify.instance(this)._create(i,t.extend({},this.options,n),e)}}),t.extend(t.ech.notify,{instance:function(t){this.__super=t,this.isOpen=!1}}),t.extend(t.ech.notify.instance.prototype,{_create:function(e,i,n){this.options=i;var a=this,n=n.replace(/#(?:\{|%7B)(.*?)(?:\}|%7D)/g,function(t,i){return i in e?e[i]:""}),n=this.element=t(n),r=n.find(".ui-notify-close");return"function"==typeof this.options.click&&n.addClass("ui-notify-click").bind("click",function(t){a._trigger("click",t,a)}),r.length&&r.bind("click",function(){return a.close(),!1}),this.__super.element.queue("notify",function(){a.open(),"number"==typeof i.expires&&i.expires>0&&setTimeout(t.proxy(a.close,a),i.expires)}),(!this.options.queue||this.__super.openNotifications<=this.options.queue-1)&&this.__super.element.dequeue("notify"),this},close:function(){var e=this.options.speed;return this.element.fadeTo(e,0).slideUp(e,t.proxy(function(){this._trigger("close"),this.isOpen=!1,this.element.remove(),this.__super.openNotifications-=1,this.__super.element.dequeue("notify")},this)),this},open:function(){if(this.isOpen||!1===this._trigger("beforeopen"))return this;var t=this;return this.__super.openNotifications+=1,this.element["above"===this.options.stack?"prependTo":"appendTo"](this.__super.element).css({display:"none",opacity:""}).fadeIn(this.options.speed,function(){t._trigger("open"),t.isOpen=!0}),this},widget:function(){return this.element},_trigger:function(t,e,i){return this.__super._trigger.call(this,t,e,i)}})}(jQuery),$(function(){$container=$("#container").notify(),oGLOBAL.message=function(t,e){var i=function(t,e,i){return $container.notify("create",t,e,i)},n=$("#container").notify();i("default",{title:t,text:e},{click:function(){n.close()}})},oGLOBAL.notify={notifyIt:function(t,e,i){return $container.notify("create",t,e,i)},msg:function(t,e){var i=this.notifyIt;$("#container").notify(),i("default",{title:t,text:e},{click:function(t,e){e.close()}})},withIcon:function(t,e,i,n){var a=this.notifyIt;$("#container").notify(),expire=n?!1:1500,a("withIcon",{title:t,text:e,icon:i},{expires:expire,click:function(t,e){e.close()}})}}}),function(){var t=window,e=t.App,i=t.Em,n=(t.oGLOBAL,t.oDATA);t.oCONTROLS,t.MY;var a,r;e.claimsStart=function(){var t;return t=e.tabClaimsRegulationController.activityTypes,t&&t.length?void 0:(n.execWhenLoaded(["proc_Claims"],function(){return e.claimsController.set("content",n.GET("proc_Claims").emData)}),n.execWhenLoaded(["proc_Activities","tblActivityTypes","tblUsers"],function(){var i;return t=n.GET("tblActivityTypes").emData.map(function(t){return t.typeID=t.iD,delete t.iD,t}),i=e.tabClaimsRegulationController,i.set("activities",n.GET("proc_Activities").emData).set("activityTypes",t).set("users",n.GET("tblUsers").emData),i.set("ativitiesNotFin",t.filter(function(t){return!t.isFinances}))}))},e.TabClaimsView=e.mainMenuView.extend({didInsertElement:function(){return n.execWhenLoaded(["tblClaimTypes"],function(){return e.sidePanelController.refreshPanels("loadCl").attachBtnClaims()})},templateName:"tmpClaimsMain"}),e.ClaimView=i.View.extend({init:function(){return this._super(),e.claimsController.setClaimContext(this.bindingContext)},templateName:"tmpClaimView",tagName:""}),e.claimsController=i.ArrayController.create({setClaimContext:function(t){var e;return e=t.iD,t.set("accident",n.GET("proc_Accidents").emData.findProperty("iD",t.accidentID)),t.set("claimType",n.GET("tblClaimTypes").emData.findProperty("iD",t.claimTypeID)),t.set("vehicle",n.GET("proc_Vehicles").emData.findProperty("iD",t.vehicleID)),t.set("insPolicy",n.GET("proc_InsPolicies").emData.findProperty("iD",t.insPolicyID)),t.set("activities",n.GET("proc_Activities").emData.filter(function(t){return t.claimID===e})),$.extend(t,{insurerID:t.insPolicy.insurerID,daysFrom:t.accident.daysFrom,date:t.accident.date}),this.getWarnings(t),!1},getWarnings:function(t){var i,n,a,r,o,s,l,c;return c={},l=[],a=e.userData.dateFormat,s=!1,t.accident||this.setClaimContext(t),t.warnings&&(t.warnings=null),n=e.tabClaimsRegulationController,o=n.fnGetUser,t.insPolicyID&&(0===t.claimStatus?(c={notifyOfClaim:!0},s=!0):2>t.claimStatus?(i=moment().diff(moment(t.date,a),"days"),0>i?(c={notifyOfDocs:{expired:math.abs(i)}},s=!0):0===i?(c={notifyOfDocs:{today:!0}},s=!0):1>i-t.insPolicy.warn_DocsSupplyTermExpire&&(c={notifyOfDocs:{leftDays:i}},s=!0)):t.dateNotification&&(r=moment().diff(moment(t.dateNotification,a),"days"),r>t.insPolicy.warn_PaymentTerm&&4>t.claimStatus&&(c.noPayment=r))),t.activities.forEach(function(t){var e;return 3===t.typeID?(e={date:t.date,user:o.call(n,t.toID),subject:t.subject,iD:t.iD,toID:t.toID},moment().diff(moment(t.date,a),"days")>0&&(s=!0,e.red=!0),l.addObject(e)):void 0}),l.length&&(c.tasks=l),$.isEmptyObject(c)||t.set("warnings",c).set("warningClass",s?"red-border":"yellow-border"),console.log("getWarnings. New Warning:"),console.log(t.warnings),!1},addNewAccident:function(){return this.openAccident(null)},content:[],filterDidChange:function(t,e){var i;return console.log("filterDidChange"),console.log(this.chkCriteria),i="All"===e?void 0:t[e],"filterValue"===e?this.textFilterIsActive=""===i?!1:!0:(this.panelFilterIsActive=this.chkCriteria||this.chkInsurers||this.chkData||this.chkClaim?!0:!1,this.filterByPanel=this.get_filterByPanel()),this.filterItems(e,i,t)}.observes("chkCriteria","chkInsurers","chkData","chkClaim","filterValue")},r=!1,a=!1,{filterCols:[["accident","place"],["accident","shortNote"],["vehicle","plate"],"insurerClaimID"],filterByField:function(t){var e,i,n,a,r,o,s,l,c,d,u;if(!this.filterReduced&&t.filterToHide)return!1;if(!t.accident)return!1;for(s=this,l=!1,n=s.filterCols,a=s.filterValue,r=function(t){return t.toLowerCase().indexOf(a)>-1?!0:!1},console.log("---Start filtering----"),o=d=0,u=n.length;u>d;o=d+=1){if(e=n[o],i="string"==typeof e?t[e]:t[e[0]][e[1]],c=i?r(i):!1){console.log("true - "+t[n[o]]),l=!0;break}console.log("false - "+t[n[o]]),l=!1}return console.log("---End filtering----"),t.set("filterToHide",!l),l},get_filterByPanel:function(){var t;return t="",this.chkCriteria&&("chkOpenCl"===this.chkCriteria?t+="if (row.claimStatus===5) return false;":"chkWithWarnings"===this.chkCriteria?t+=" if (!row.warnings) return false;":"chkWithMyTasks"===this.chkCriteria&&(t+="			if(!row.warnings){				return false;			}else{				if(!row.warnings.tasks){return false;}				else{if(row.warnings.tasks.filter(function(t){return t.toID="+e.userData.userID+"}).length===0) return false;}			};")),this.chkInsurers&&(t+="if (row.insurerID!=="+this.chkInsurers+") return false;"),this.chkData&&(t+="if (!row.date) return false;",t+="12month"===this.chkData?"if (row.daysFrom>365) return false;":"if (row.date.indexOf("+this.chkData+")===-1) return false;"),this.chkClaim&&(t+="if (row.claimTypeID!=="+this.chkClaim+") return false;"),t+="return true;",Function("row",t)},filterByPanel:null,filterItems:function(t,e){var i,n=this;return"filterValue"===t?(i=""===e?this.panelFilterIsActive?function(t){return t.filterToHide=!1,n.filterByPanel(t)}:function(t){return t.filterToHide=!1,!0}:this.panelFilterIsActive?function(t){var e;return e=n.filterByField(t)?n.filterByPanel(t):!1}:function(t){return n.filterByField(t)},console.log("Filtro pradžia - tekstas---------------")):(i=this.textFilterIsActive||this.panelFilterIsActive?function(t){return t.filterToHide?!1:n.filterByPanel(t)}:function(){return!0},console.log("Filtro pradžia - kiti filtrai---------------")),this.content.forEach(function(t){var e;return e=i(t),t.set("visible",e)})}})}.call(this),function(){var t=window,e=t.App,i=t.Em,n=t.oGLOBAL,a=t.oDATA,r=t.oCONTROLS;t.MY;var o,s,l;o={},s={},e.tabClaimsRegulationController=i.ArrayController.create({init:function(){var t;return this._super(),t=this},stepsCont1:['<a href="#">Užregistruokite</a>','<a href="#">Patvirtinti, kad visa informacija yra pateikta</a>','<a href="#">Patvirtinti #### Lt kaip galutinę žalos sumą</a>','<a href="#">Patvirtinti #### Lt kaip galutinę išmokos sumą</a>','<a href="#">Uždaryti bylą</a>'],stepsCont2:["Draudikui pranešta ####",'Visa informacija pateikta:</br>####</br><a href="#">Atšaukti</a>','Patvirtinta galutinė žalos suma: #### Lt</br><a href="#">Atšaukti</a>','Patvirtinta galutinė išmokos suma: #### Lt</br><a href="#">Atšaukti</a>','Byla uždaryta <a href="#"></br>Atidaryti</a>'],stepsConfirm:["",'<p>Įveskite paskutinio dokumento pateikimo datą:</p><input class="date" type="text" value="####"><button class="btn btn-small">Patvirtinti</button><a class="box-1pr-left js-cancel-addon">Atšaukti</a>','<p>Galutinė žalos dydžio suma - #### Lt.</p><button class="btn btn-small">Patvirtinti</button><a class="box-1pr-left js-cancel-addon">Atšaukti</a>','<p>Galutinė išmokos dydžio suma - #### Lt</p><button class="btn btn-small">Patvirtinti</button><a class="box-1pr-left js-cancel-addon">Atšaukti</a>',""],stepVal:[],stepsTemp:[{stepNo:1,name:"Pranešimas draudikui"},{stepNo:2,name:"Informacija draudikui"},{stepNo:3,name:"Žalos suma"},{stepNo:4,name:"Draudimo išmoka"},{stepNo:5,name:"Bylos uždarymas"}],setSteps:function(){var t,e,a,r,o,s,l,c,d,u,p,f;return t=this.claim,f=n.date.getTodayString(),p=[f,f,t.lossAmount,t.insuranceClaimAmount,""],t.insPolicyID&&(t.claimStatus>0&&(p[0]=t.dateNotification),t.claimStatus>1&&(p[1]=t.dateDocsSent)),this.set("stepVal",p),0===t.insPolicyID?(a=[],this.stepsTemp.forEach(function(t,e){return 2===e||4===e?(a[e]=t,a[e].stepNo2=2===e?1:2):void 0}),d=a,0===t.claimStatus&&(t.claimStatus=2)):d=this.stepsTemp,s=this.stepsCont1,l=this.stepsCont2,c=this.stepsConfirm,o=[],u=this.stepVal,r=!1,e=function(t,e){return t[e].replace("####",u[e])},d.forEach(function(n){var a,c;return c=$.extend({},n),a=n.stepNo-1,1===n.stepNo&&(c.first=!0),t.claimStatus+1===c.stepNo?(c.step="current",r=!0,c.content=e(s,a)):r?c.step="pending":(c.step="completed",c.content=t.claimStatus===c.stepNo?e(l,a):e(l,a).replace('<a href="#">Atšaukti</a>',"")),o.pushObject(i.Object.create(c)),!1}),t.set("steps",o),this},fnUpdateStep:function(t,e,i,n){var a,r;return a="",t?(r=t.stepNo-1,i&&(a=this[i][r].replace("####",this.stepVal[r])),"noCancel"===n&&(a=a.replace('<a href="#">Atšaukti</a>',"")),e&&t.set("step",e),t.set("content",a),!1):void 0},fnGetSteps:function(t){var e,i,n,a,r,o,s,l;return n=!1,0===t&&(t=1,n=!0),l=this.claim.steps,i=l.findProperty("stepNo",t),r=100,a=0,e=i.stepNo,o=null,s=null,l.forEach(function(i){return t=i.stepNo,t>e&&r>t&&(o=i,r=i.stepNo),e>t&&t>a?(s=i,a=i.stepNo):void 0}),{currStep:i,nextStep:o,prevStep:n?null:s}},fnStepForward:function(t,e){var i,n,a,r,o;if(0===this.claim.claimStatus&&e)return this.replaceActivityView(this.activityTypes.findProperty("name","activity_notifyInsurer")),!1;if(r=this.fnGetSteps(t),a=$("#claimsSteps").find(".step-box-addon").find("input.date"),a.length){if(a.data("notValid"))return!1;this.stepVal[1]=a.val()}switch(n=null,i="",o=!1,t){case 1:i="DateNotification";break;case 2:i="DateDocsSent";break;case 3:i="LossAmount",o=!0;break;case 4:i="InsuranceClaimAmount",o=!0}return i&&(n={Data:[this.stepVal[t-1]],Fields:[i]}),this.fnSaveData({stepNo:t,forward:!0,updAccidents:o,dF:n})},fnConfirm:function(t,e){var i;return t.find("div.step-box-addon").length?!1:(i='<div class="step-box-addon"><div class="inner">'+this.stepsConfirm[e-1].replace("####",this.stepVal[e-1])+"</div></div>",$(i).appendTo(t).hide().slideDown("slow",function(){return $(this).css("overflow","visible")}))},fnStepBack:function(t){return this.fnSaveData({stepNo:t})},fnSaveData:function(t){var i,n,a,r,o,s,l,c,d,u;return u=t.updAccidents,r=t.dF?t.dF:{Data:[],Fields:[]},(t.stepNo||0===t.stepNo)&&(s=t.forward?t.stepNo:t.stepNo-1,this.claim.set("claimStatus",s),r.Data.push(s),r.Fields.push("claimStatus"),d=this.fnGetSteps(t.stepNo),o=this.fnUpdateStep,a=[d.currStep,"current","stepsCont1","cancel"],l=[d.nextStep,"pending","","cancel"],c=[d.prevStep,"","stepsCont2","cancel"],t.forward&&(a.splice(1,2,"completed","stepsCont2"),l.splice(1,2,"current","stepsCont1"),c[3]="noCancel"),o.apply(this,a),o.apply(this,l),o.apply(this,c)),n=$.extend({id:this.claim.iD,DataTable:"tblClaims",Ext:this.claim.accidentID},r),i=null,u&&(i={Success:e.claimEditController.fnUpdateAccident}),SERVER.update2({Action:"Edit",DataToSave:n,CallBack:i,source:"proc_Claims",row:this.claim,CallBackAfter:function(t,i,n){return u?e.claimEditController.fnUpdateAccident(n):void 0}}),e.claimsController.getWarnings(this.claim),this.claimStatusBefore=this.claim.claimStatus,this},target:function(){return this}.property(),damageSum:0,insurerSum:0,compensationSum:0,activitiesTbl:[],finDamageTbl:[],finInsurerTbl:[],finOtherPartyTbl:[],fnSum:function(t){var e;return e=0,t.forEach(function(t){return e+=t.amount}),e.toRound()},fnclaimStatusChanged:function(){var t,i,n;return this.claim.claimStatus>2||this.claimStatusBefore>2?(i=this.claim,t={DataTable:"tblClaims",Ext:i.accidentID,id:i.iD,Fields:["ClaimStatus"],Data:[i.claimStatus]},3===i.claimStatus&&(t.Fields.push("lossAmount"),t.Data.push(i.lossAmount)),4===i.claimStatus&&(t.Fields.push("insuranceClaimAmount"),t.Data.push(i.insuranceClaimAmount)),n={Action:"Edit",DataToSave:t,CallBack:{Success:e.claimEditController.fnUpdateAccident}},SERVER.update(n),this.claimStatusBefore=this.claim.claimStatus):void 0},finDamageChanged:function(){return i.run.next(this,function(){var t;return t=this.fnSum(this.finDamageTbl),this.set("damageSum",t),this.stepVal[2]=t,3>this.claim.claimStatus&&(this.claim.set("lossAmount",t),2===this.claim.claimStatus)?this.fnUpdateStep.call(this,this.claim.steps.findProperty("step","current"),"","stepsCont1","cancel"):void 0})}.observes("finDamageTbl.@each"),finInsurerChanged:function(){return i.run.next(this,function(){var t;return t=this.fnSum(this.finInsurerTbl),this.set("insurerSum",t),this.stepVal[3]=t,4>this.claim.claimStatus&&(this.claim.set("insuranceClaimAmount",t),3===this.claim.claimStatus)?this.fnUpdateStep.call(this,this.claim.steps.findProperty("step","current"),"","stepsCont1","cancel"):void 0})}.observes("finInsurerTbl.@each"),finOtherPartyChanged:function(){return i.run.next(this,function(){var t;return t=0,this.finOtherPartyTbl.forEach(function(e){return t+=e.amount}),this.set("compensationSum",t.toRound())})}.observes("finOtherPartyTbl.@each"),setActivitiesTables:function(t){var i,n,a,r,o,s;return this.set("finDamageTbl",[]).set("finInsurerTbl",[]).set("finOtherPartyTbl",[]),r=this.claim.iD,console.log("Showing all activities Claim iD: "+r),i=this.activities,a=this.activityTypes,t&&i.findProperty("iD",t.iD).set("docs","("+t.docNo+")"),i=i.filter(function(t){return t.claimID===r}),s=this,n=[],o=e.tabClaimsRegulationController.clickActivityID,i.forEach(function(t){var e,i;if(i=a.findProperty("typeID",t.typeID),e=s.fnMapActivitiesRecord(t,i),o&&e.iD===o&&(e.clickMe="js-clickMe"),n.push(e),i.isFinances)switch(i.tmp){case"tmpAddDamageCA":case"tmpAddDamageKASKO":return s.finDamageTbl.addObject(s.fnMapDamageRecord(t,i.typeTitle));case"tmpAddInsuranceBenefit":return s.finInsurerTbl.addObject(s.fnMapRefundRecord(t));case"tmpAddCompensation":return s.finOtherPartyTbl.addObject(s.fnMapRefundRecord(t));default:return console.error("checkTmp in tblActivities")}}),s.set("activitiesTbl",n),s},users:null,fnGetUser:function(t){var e;return e=this.users.find(function(e){return e.iD===t}),e.firstName+" "+e.surname},fnGetFrom:function(t){switch(t.typeID){case 3:case 6:return this.fnGetUser(t.fromID);case 4:case 5:return t.fromText}},fnGetTo:function(t){switch(t.typeID){case 3:return this.fnGetUser(t.toID);case 4:case 5:return t.toText;default:return""}},fnMapDamageRecord:function(t,e){return i.Object.create({iD:t.iD,amount:t.amount,docType:e,subject:t.subject,body:t.body,docs:t.docs,typeID:t.typeID,userID:t.userID,userName:this.fnGetUser(t.userID),entryDate:t.entryDate})},fnMapRefundRecord:function(t){return i.Object.create({iD:t.iD,amount:t.amount,date:t.date,body:t.body,docs:t.docs,typeID:t.typeID,userID:t.userID,userName:this.fnGetUser(t.userID),entryDate:t.entryDate})},fnMapActivitiesRecord:function(t,e){var n,a;return a=6===t.typeID?t.body:t.subject,n=this.fnGetFrom(t),i.Object.create({iD:t.iD,claimID:t.claimID,typeID:t.typeID,body:t.body,date:t.date.slice(0,16),entryDate:t.entryDate,from:n,fromOnlyTbl:e.isFinances?e.typeTitle?e.typeTitle:e.title:14===t.typeID?this.fnGetUser(t.userID):n,subject:a,amount:t.amount,infoOnlyTbl:e.isFinances?(a?a+", ":"")+t.amount+" Lt":14===t.typeID?"Pranešimas draudikui":a.length>25?a.slice(0,25)+" [...]":a,userID:t.userID,userName:this.fnGetUser(t.userID),icon:e.icon?e.icon:"",to:this.fnGetTo(t),docs:t.docs,toID:t.toID,fromText:t.fromText,toText:t.toText})},actViewZone:"#actionsEnterOfClaimReg",frm:"#contentOfClaimReg",typeID:"",goToOtherView:function(t){var e;return"A"!==t.target.tagName.toUpperCase()&&$(t.target).closest("tr").addClass("selected").siblings().removeClass("selected"),e=$.extend(t.context,{claim:this.claim}),this.replaceActivityView(e)},replaceActivityView:function(t){var e,n;return n=$(window).scrollTop(),e=$(this.actViewZone),e.length>0&&e.html().length>0&&(o.remove(),e.empty()),o=t?this.actionView.create(t):this.mainView.create({controller:this}),o.appendTo(this.actViewZone),i.run.next(n,function(){return $(window).scrollTop(this)})},editForm:function(t){var e;return e=$(t.target).closest(".js-frm"),this.actionViewInstance.set("notEditable",!1).set("editButton",!1),i.run.next(this,function(){return r.UpdatableForm({frm:e,btnSaveToDisable:e.find("button.btnSave")})})},deleteForm:function(t){var e,i,n,a;return e=t.context,i=$(this.frm),n=i.data("ctrl"),a=this,r.dialog.Confirm({title:"Veiksmas '"+e.title+"'",msg:"Ištrinti šį veiksmą'?"},function(){return SERVER.update2({Action:"Delete",DataToSave:{id:e.iD,DataTable:n.tblUpdate},Ctrl:i,source:n.Source,CallBackAfter:function(){var t;switch(e.tmp){case"tmpAddDamageCA":case"tmpAddDamageKASKO":t="finDamageTbl";break;case"tmpAddInsuranceBenefit":t="finInsurerTbl";break;case"tmpAddCompensation":t="finOtherPartyTbl";break;case"tmpAction_notifyInsurer":a.fnSaveData({stepNo:1,forward:!1})}return function(t,e){var i,n;return t&&(i=t.findProperty("iD",this.iD),t.removeObject(i)),n=e.findProperty("iD",this.iD),e.removeObject(n)}.call(e,a[t],a.activitiesTbl),a.cancelForm()}})})},saveForm:function(t){var e,i,n,o,s,l,c,d,u,p;return d=$(this.frm),l=t.view.bindingContext,c=t.execOnSuccess,u=d.data("ctrl"),p=this,s={},e=u.NewRec?"Add":"Edit","Add"===e&&(n=this.claim.iD,s={Fields:["ClaimID"],Data:[n]},l.isFinances?"tmpAddDamage"!==l.tmp.slice(0,12)&&(s.Fields.push("TypeID"),s.Data.push(l.typeID)):(s.Fields.push("TypeID","FromID"),s.Data.push(l.typeID,a.GET("userData").emData[0].userID))),o=r.ValidateForm(d,s),!o&&t.isTrigger&&r.dialog.Alert({title:"Veiksmo išsaugojimas",msg:"Užpildykite pažymėtus laukus.."}),o?(i=function(t,e){return 14===t.typeID&&(p.stepVal[0]=t.date.slice(0,10),p.claim.set("dateNotification",p.stepVal[0]),"Add"===e?p.fnStepForward(1):p.fnSaveData({dF:{Data:[t.date],Fields:["DateNotification"]}}).fnUpdateStep(p.claim.steps[0],"completed","stepsCont2"),c&&c(t,d)),p.setActivitiesTables().cancelForm()},SERVER.update2({Action:e,DataToSave:o,Ctrl:d,source:u.Source,CallBackAfter:i})):void 0},cancelForm:function(){return this.replaceActivityView(),$("div.validity-tooltip").remove(),this},mainView:i.View.extend({addDamage:{},addBenefit:{},addCompensation:{},init:function(){var t,i,n,a,r,o,s;return this._super(),a=e.tabClaimsRegulationController,t=a.claim.claimTypeID,s=a.activityTypes,r=function(t,e){var i;return i=s.findProperty(t,e),i.title||(i.title=i.typeTitle),$.parseJSON(JSON.stringify(i))},o=1===t?"tmpAddDamageKASKO":"tmpAddDamageCA",this.addDamage=$.extend({txt:"Įvesti žalos sumą"},r("tmp",o)),this.addBenefit=$.extend({txt:"Įvesti draudimo išmoką"},r("tmp","tmpAddInsuranceBenefit")),this.addBenefit.title+=" ("+this.controller.claim.insPolicy.insurerName+")",i=1===t?"finances_compensationFrom":"finances_compensationTo",n=1===t?"Įvesti kaltininko kompensaciją":"Įvesti kompensaciją nukentėjusiam",this.addCompensation=$.extend({txt:n},r("name",i))
},controller:e.tabClaimsRegulationController,templateName:"tmpActionMain"}),taskComplete:!1,notActionOwner:!0,actionViewContext:null,fnTaskComplete:function(){var t,e,i,n,a,r;return r=this.get("taskComplete"),a=r?1:0,n=this,t=this.actionViewContext,e=$(this.frm),i=e.data("ctrl"),SERVER.update2({Action:"Edit",DataToSave:{id:t.iD,Data:[a],Fields:["Amount"],DataTable:i.tblUpdate},Ctrl:e,source:i.Source,CallBackAfter:function(){return n.activitiesTbl.findProperty("iD",t.iD).set("amount",a),!1}}),console.log("------------------------------------"),console.log("fnTaskComplete. newVal set: "+a),console.log("------------------------------------")}.observes("taskComplete"),actionViewInstance:{},actionView:i.View.extend({isNew:!0,deleteButton:!1,editButton:!1,notEditable:!1,init:function(){var t,n;return this._super(),t=e.tabClaimsRegulationController,t.actionViewInstance=this,this.tmp||($.extend(this,{isNew:!1},$.parseJSON(JSON.stringify(t.activityTypes.findProperty("typeID",this.typeID)))),n=a.GET("userData").emData[0],14===this.typeID&&t.claim.claimStatus>1||this.set("deleteButton",!0),this.isFinances||(this.set("notEditable",!0),(n.userID===this.userID||t.users.findProperty("iD",n.userID).isAdmin)&&this.set("editButton",!0),t.set("notActionOwner",this.editButton||n.userID===this.toID?!1:!0),t.taskComplete=0===this.amount?!1:!0,console.log("init. taskComplete val: "+t.taskComplete),console.log("init. cnt.amount: "+this.amount))),this.title||(this.title=this.typeTitle),this.set("childView",i.View.extend({templateName:this.tmp})),t.set("actionViewContext",this)},didInsertElement:function(){var t,e,n,o,s;if(this._super(),n=$(this.frm),t=this.claim,o=this,this.isNew)switch(this.typeID){case 3:case 4:case 5:e=n.find("div.row").find("div.ExtendIt:first"),s=a.GET("userData").emData[0];break;default:console.log("loaded view")}else(function(t){return this.NewRec=0,this.id=t}).call(n.data("ctrl"),this.iD);return r.UpdatableForm({frm:this.frm},this.notEditable?!1:{btnSaveToDisable:n.find("button.btnSave")}),this.isNew?$('<div class="row fileupload-buttonbar box_2pr"><center><i class="img16-attach"></i><a class="fileinput-button">Išsaugoti ir prisegti dokumentus</a></center></div>').appendTo(this.uploadZone).find("a").on("click",function(e){return e.preventDefault(),$("#contentOfClaimReg").find("button.btnSave").trigger({type:"click",execOnSuccess:function(e,n){return r.UpdatableForm_toSaved(e.iD,n),$(o.uploadZone).empty(),i.run.next(o,function(){return o.makeAttach(e,n,t)})}})}):this.makeAttach(this,n,t)},makeAttach:function(t,n,a){var r,o;switch(r={accident:{iD:a.accidentID,title:"Įvykio dokumentai"},driver:{iD:a.accident.driverID,title:"Vairuotojo '"+a.accident.driver+"' dokumentai"},vehicles:[{iD:a.vehicleID,title:"TP "+a.vehicle.make+" "+a.vehicle.model+", "+a.vehicle.plate}]},o={Fields:["ActivityID","DocID"],Data:[t.iD]},n.data("ctrl").tblUpdate){case"tblFinances":o.DataTable="tblDocsInFin";break;case"tblActivities":o.DataTable="tblDocsInActivity";break;default:console.error("no such tbl")}return $(this.uploadZone).UploadFiles({categoryOpts:r,showFromAccident:!0,requireCategory:!0,docsController:"claimDocController",updateRelationsTbl:o,claim:this.claim}),e.claimDocController.setDocs(o.DataTable,t.iD),$.isEmptyObject(s)||(s.remove(),s.destroy()),s=i.View.create({opts:null,templateName:"tmpDocsView",tagName:"ul",classNames:["gallery","ui-helper-reset","ui-helper-clearfix"],controller:e.claimDocController,didInsertElement:function(){return this._super(),this.$().data("opts",this.opts)}}).appendTo(this.uploadZone)},templateName:"tmpActionWrapper",frm:"#contentOfClaimReg",uploadZone:"#uploadClaimDocs"}),goToList:function(){return e.router.transitionTo("claimList")}}),e.TabClaimsRegulationView=Ember.View.extend({init:function(){return this._super(),$.isEmptyObject(o)||(o.remove(),o.destroy()),this.controller.setActivitiesTables(),this.controller.setSteps()},templateName:"tmpClaimRegulation",didInsertElement:function(){var t,a,r;return this._super(),t=this.controller,t.cancelForm(),t.claimStatusBefore=t.claim.claimStatus,i.run.next(this,function(){return t=e.tabClaimsRegulationController,t.clickActivityID?(this.$().find("table tr.js-clickMe").trigger("click"),t.clickActivityID=null):void 0}),a=this,r={},this.$().find("#claimsSteps").on("click","a",function(){var e,a,o;return r=$(this).closest("div.step-box"),e=r.attr("class"),a=r.data("stepno"),o=t.claim.steps,e.indexOf("completed")>0?t.fnStepBack(a):e.indexOf("current")>0&&(1===a?t.fnStepForward(a,!0):5===a?t.fnStepForward(a):(t.fnConfirm(r,a),2===a&&i.run.next(this,function(){return r.find("input.date").val(n.date.getTodayString()).inputControl({type:"Date",Validity:{lessOf:{date:"today"},moreOf:{date:t.stepVal[0],msg:"Data negali būt ankstesnė už pranešimo datą - "}}}).datepicker({minDate:"-3y",maxDate:"0"})}))),!1}).on("click","button",function(e){var i,n;return i=$(e.target).closest("div.step-box.current").data("stepno"),1===i+1&&(n=r.find("input.date").val(),t.stepVal[i+1]=n),t.fnStepForward(i)&&r.find("div.step-box-addon").slideUp("slow").remove(),!1}).on("click","a.js-cancel-addon",function(){return r.find("div.step-box-addon").slideUp("slow").remove(),!1}),$("#claimRegulationTab").tabs().on("tabsactivate",function(t,e){return 1===e.newTab.index()?console.log("first"):void 0})},controller:e.tabClaimsRegulationController}),e.claimDocController=i.ResourceController.create({target:function(){return this}.property(),relationTbl:null,activityID:null,docs:[],accDoc:[],refreshDocs:function(){var t;return this.setDocs(this.relationTbl,this.activityID),t=e.tabClaimsRegulationController,"tblDocsInActivity"===this.relationTbl?t.setActivitiesTables({iD:this.activityID,docNo:this.docs.length}):t.setFinancesTables({iD:this.activityID,docNo:this.docs.length})},setDocs:function(t,e){var n,r,o,s,l,c,d,u,p;return this.relationTbl=t,this.activityID=e,d=a.GET(t).emData.filter(function(t){return t.activityID===e}).map(function(t){return t.docID}),o=a.GET("userData").emData[0].docsPath,u="Uploads/"+o,p=a.GET("tblUsers").emData,n=a.GET("tblDocTypes").emData,l=function(t){return t=t.slice(0,3),"img32-doc_"+("xls"===t||"doc"===t||"pdf"===t?t:"unknown")},c=function(t){var e;return e=p.find(function(e){return e.iD===t}),e.firstName+" "+e.surname},s=function(t){return n.find(function(e){return e.iD===t}).name},r=a.GET("tblDocs").emData.filter(function(t){return d.contains(t.iD)}).map(function(t){var e,n;return n=c(t.userID),e="/"+t.iD+"."+t.fileType,i.Object.create({docID:t.iD,hasThumb:t.hasThumb,urlThumb:u+"/Thumbs"+e,urlDoc:u+e,docType:s(t.docTypeID),description:t.description,docName:t.docName,userName:n,fileDate:t.fileDate,fileName:t.docName+"."+t.fileType,fileIcon:t.hasThumb?"img32-doc_unknown":l(t.fileType),docDetails:"Įkėlė "+n+" "+t.fileDate+", dydis - "+Math.ceil(t.fileSize/1e4)/100+"Mb"})}),this.set("docs",r)},fnMapDocs:function(t,e){var n,r,o,s,l;return n=a.GET("tblDocTypes").emData,s=function(t){return n.find(function(e){return e.iD===t}).name},o=a.GET("userData").emData[0].docsPath,l="Uploads/"+o,r=a.GET(t).emData.filter(function(t){return t.activityID===e}).map(function(t){return t.docID}),this.set("noAccidentDocs",0===r.length?!0:!1),function(t){var e;return e="/"+t.iD+"."+t.fileType,i.Object.create({docID:t.iD,hasThumb:t.hasThumb,urlThumb:l+"/Thumbs"+e,urlDoc:l+e,docType:s(t.docTypeID),docName:t.docName,fileDate:t.fileDate,fileName:t.docName+"."+t.fileType,isPhoto:1===t.groupID?!0:!1,added:r.contains(t.iD)?!0:!1})}},fnSetGroup:function(t){return function(e,i,n){return t.push({groupID:e.iD,refID:i,title:n?n:e.name,items:[]}),!1}},setAccDocs:function(t){var e,i,n,r;return r=[],e=this.fnSetGroup(r),a.GET("tblDocGroup").emData.forEach(function(i){var n,a,r;switch(n=t.accident,a=t.driver,r=t.vehicles,i.ref){case 1:case 2:return e(i,n.iD);case 3:return e(i,a.iD,a.title);case 4:return r.forEach(function(t){return e(i,t.iD,t.title)});case 5:return e(i,n.iD)}}),n=r.findIndexByKeyValue("groupID",5),4>n&&r.move(n,4),i=this.fnMapDocs(this.relationTbl,this.activityID),a.GET("tblDocs").emData.forEach(function(t){var e,n,a,o;for(o=[],n=0,a=r.length;a>n;n++)if(e=r[n],t.groupID===e.groupID){if(t.refID===e.refID){e.items.addObject(i(t));break}if(4!==e.groupID)break;o.push(void 0)}else o.push(void 0);return o}),this.set("vGroup",r)},vGroup:[]}),l={opts:null,templateName:"tmpDocsView",tagName:"ul",classNames:["gallery","ui-helper-reset","ui-helper-clearfix"],controller:e.dialogDocController,didInsertElement:function(){return this._super(),this.$().data("opts",this.opts)}}}.call(this),function(){var t,e=window,i=e.App,n=e.Em,a=e.oGLOBAL,r=e.oDATA,o=e.oCONTROLS,s=e.MY;t={},i.listsStart=function(){var t;return t=i.topNewController,t.set("drivers",r.GET("proc_topDrivers").emData),t.set("vehicles",r.GET("proc_topVehicles").emData),t.set("insPolicies",r.GET("proc_topInsPolicies").emData),r.execWhenLoaded(["proc_Vehicles","proc_Drivers","proc_InsPolicies"],function(){return t=i.listAllController,t.set("vehicles",r.GET("proc_Vehicles").emData),t.set("drivers",r.GET("proc_Drivers").emData),t.set("insPolicies",r.GET("proc_InsPolicies").emData)})},i.topNewController=n.ResourceController.create({vehicles:[],drivers:[],insPolicies:[],tableName:"?"}),i.DriverView=n.View.extend({templateName:"tmpDriverRow",tagName:""}),i.VehicleView=n.View.extend({templateName:"tmpVehicleRow",tagName:""}),i.InsPolicyView=n.View.extend({templateName:"tmpInsPolicyRow",tagName:""}),i.listAllController=n.ResourceController.create({current:"",clicked:"",endDate:"",editItem:"",filterValue:"",addMakeMode:"",VehicleMakes:[],editVehicleMake:!1,valueDidChange:function(){return this.filterItems()}.observes("filterValue"),deleteForm:function(t){var e,n,a,s;return console.log(t),a=t.view._parentView.pars,n=r.GET(a.source),e=n.Config.Msg,s=a.row,o.dialog.Confirm({title:"",msg:"Ištrinti "+e.GenNameWhat+" '"+s.MapArrToString(n.Config.titleFields,!0)+"'?"},function(){return SERVER.update2({Action:"Delete",DataToSave:{id:s.iD,DataTable:n.Config.tblUpdate},Ctrl:$("#tabLists"),source:a.source,row:s,CallBackAfter:function(){var t,e;return i.topNewController[a.emObject].removeObject(s),i.listAllController.content.removeObject(s),t=r.GET(a.source.replace("_","_top")).emData,e=t.findProperty("iD",s.iD),t.removeObject(e),$("#openItemDialog").dialog("close")}})})},saveForm:function(t,e){var i,n,a,r;return r=e?e.pars:t.view._parentView.pars,i=e?e.Alert:null,a=e?e.execOnSuccess:null,n=o.ValidateForm($("#dialogContent")),n?($.extend(r,{DataToSave:n,Ctrl:$("#tabLists"),CallBackAfter:function(t){return"Add"===r.Action&&console.log("bla"),r.input&&(r.input.data("newval",t.iD),r.input.autocomplete("option").fnRefresh(),r.input.data("autocomplete").fnItemChanged(t.iD)),t.iD&&$("#tabLists").find("div.ui-tabs").find("li.ui-tabs-selected a").trigger("click"),r.CallBackFromComboBox&&r.CallBackFromComboBox(t),a?a(t):$("#openItemDialog").dialog("close"),!1}}),SERVER.update2(r),!1):i?o.dialog.Alert({title:"Įšsaugojimas",msg:"Užpildykite pažymėtus laukus.."}):$("#openItemDialog").dialog("close")},cancelForm:function(){return $("#openItemDialog").dialog("close"),!1},editListItems:function(t){var e,n,a,l;return a=t.data("ctrl").Source,l=t.data("ctrl").tblUpdate?t.data("ctrl").tblUpdate:a,n=r.GET(a),this.set("listItems",n.emData.removeObject(n.emData.findProperty("iD",0))),e="dialog"+ +new Date,s[e]=JQ.Dialog.create({input:t,dialogID:e,legend:n.Config.Msg.ListName,title:"Redaguoti sąrašą",msg:n.Config.Msg,addNewMsg:"Pridėti naują",saveData:function(t){var e,n;return e=i.listAllController.listItems,n=this,$.extend(t,{Ctrl:$("#"+this.dialogID),source:a,CallBackAfter:function(i){return"Edit"===t.Action&&e.findProperty("iD",i.iD).set("edit",!1),"Add"===t.Action&&s[n.dialogID].set("addItem",!1),n.input.autocomplete("option").fnRefresh()}}),SERVER.update2(t),!1},editItem:function(t){return t.context.set("edit",t.context.name)},cancelItem:function(t){return t.context.set("edit",!1)},saveItem:function(e){var i,n,a,r;return n=e.context.name,t=$(e.target).closest(".js").find("input"),r=t.val(),a=e.context,a.name=r,n.length>0?(i={Title:this.title,Success:this.msg.GenName+" '"+n+"' pakeista(s).",Error:this.msg.GenNameWhat+" '"+n+"' nepavyko pakeisti.."},this.saveData({DataToSave:{id:a.iD,Data:[a.name],Fields:["Name"],DataTable:l},Msg:i,row:a,Action:"Edit"})):e.context.set("name",e.context.edit).set("edit",!1)},deleteItem:function(t){var e,i;return e=t.context.name,i=this,o.dialog.Confirm({title:this.title,msg:i.msg.Delete+" '"+e+"'?"},function(){var n,a;return n={Title:i.title,Success:i.msg.GenName+" '"+e+"' ištrinta(s).",Error:i.msg.GenNameWhat+" '"+e+"' nepavyko ištrinti."},a=t.context,i.saveData({DataToSave:{id:a.iD,DataTable:l},Msg:n,row:a,Action:"Delete"})})},addNewItem:function(){return this.set("addItem",!0)},cancelNewItem:function(){return this.set("addItem",!1)},saveNewItem:function(e){var i,n;return t=$(e.target).closest(".js").find("input"),n=t.val(),i={Title:this.title,Success:this.msg.GenName+" '"+n+"' pridėtas.",Error:this.msg.GenNameWhat+" '"+n+"' nepavyko pridėti."},this.saveData({DataToSave:{Data:[n],Fields:["Name"],DataTable:l},Msg:i,row:[n],Action:"Add"})},closeDialog:function(){return $("#"+this.dialogID).dialog("close"),!1},width:600,templateName:"tmpEditItems"}).append()},openItem:function(e){var l,c;return e.row.iD?this.set("deleteButton",!0):this.set("deleteButton",!1),this.set("dateIsEdited",!1),l=r.GET(e.source).Config,c=e.row?l.Msg.GenName+": "+e.row.MapArrToString(l.titleFields,"tmp_Drivers"===e.template?!0:!1):l.Msg.AddNew,!e.row&&e.newVals&&(e.row=e.newVals.vals.toRowObject(e.newVals.cols)),s.dialog=JQ.Dialog.create({controllerBinding:"App.listAllController",thisController:this,pars:e,init:function(){return this._super(),this.templateName=e.template,this.title=c,this.pars=e},goToEditDate:function(){return i.listAllController.set("dateIsEdited",!0),n.run.next(this,function(){return $("#dialogEndDateInput").datepicker({minDate:"-3y",maxDate:"0"}).trigger("focus")})},saveDate:function(){var t,e;return t=$(event.target).parent().parent().find("input").val(),a.date.isDate(t)||(t=""),e=$("#dialogContent").data("ctrl"),SERVER.update2({Action:"Edit",Ctrl:$("#openItemDialog"),source:e.Source,row:this.pars.row,DataToSave:{id:e.id,Data:[t],Fields:["EndDate"],DataTable:e.tblUpdate},CallBackAfter:function(){return $("#tabLists").find("div.ui-tabs").find("li.ui-tabs-selected a").trigger("click")}}),console.log("išsaugoti "+t),this.pars.me.endDate=t,i.listAllController.set("dateIsEdited",!1).set("endDate",t)},makeAttach:function(a){var o,s,l,c,d,u;return s=$("#openItemDialog"),o=!1,l=r.GET("tblDocGroup").emData,a?(c=l.findProperty("ref",a).iD,4===a&&(d="TP "+e.row.make+", "+e.row.model+", "+e.row.plate+" dokumentai",o={showCategories:[{iD:c,ref:a,name:d}],vehicles:[{iD:e.row.iD,title:d}]}),3===a&&(d="Vairuotojo '"+e.row.firstName+" "+e.row.lastName+"' dokumentai",o={showCategories:[{iD:c,ref:a,name:d}],driver:{iD:e.row.iD,title:d}}),s.find("div.uploadDocsContainer").UploadFiles({categoryOpts:o,docsController:"dialogDocController",requireCategory:!0}),u=e.row.iD,i.dialogDocController.setDocs(u,c),$.isEmptyObject(t)||(t.remove(),t.destroy()),t=n.View.create({opts:null,templateName:"tmpDocsView",tagName:"ul",classNames:["gallery","ui-helper-reset","ui-helper-clearfix"],controller:i.dialogDocController,didInsertElement:function(){return this._super(),this.$().data("opts",this.opts)}}).appendTo("#dialoguploadDocsContainer")):console.warn("no ref")},didInsertElement:function(){var t,i,a;return this._super(),t=$("#dialogContent"),i=0,a=this,"vehicles"===e.emObject||"proc_Vehicles"===e.source?i=4:("drivers"===e.emObject||"proc_Drivers"===e.source)&&(i=3),e.row.iD?this.makeAttach(i):(c=4===i?"tr. priemonę":"vairuotoją",$('<div class="row fileupload-buttonbar" style="padding:10px 0 20px 40px;"><center><i class="img16-attach"></i><a href="#" class="fileinput-button">Išsaugoti naują '+c+" ir prisegti dokumentus</a></center></div>").appendTo("#dialoguploadDocsContainer").find("a").on("click",function(r){var s;return r.preventDefault(),s=t.data("ctrl"),t.length?a.thisController.saveForm(null,{Alert:!0,pars:e,execOnSuccess:function(r){return o.UpdatableForm_toSaved(r.iD,t),e.row=r,$("#dialoguploadDocsContainer").empty(),n.run.next(function(){return a.makeAttach(i)})}}):void 0})),"tmp_InsPolicies"===this.templateName&&this.$().tabs().css("margin","-5px 1px 0 1px"),o.UpdatableForm({frm:t,row:e.row,btnSaveToDisable:t.next().find("button.btnSave")})},width:700,templateName:"dialog-content"}).append()},addNew:function(t){var e;return e=$(t.target).parent().data("ctrl"),console.log("addNew"),console.log(e),$.extend(e,{row:0,Action:"Add",me:this,CallBackAfter:function(){}}),this.set("endDate",""),this.set("editItem",!1),this.openItem(e)},edit:function(t){var e,i,n;return console.log("edit"),console.log(t.target),console.log(t.view._context),e=t.view._context,n=$(t.target).closest("table").next().data("ctrl"),n=n?n:this.current,$.extend(n,{row:e,Action:"Edit",me:this}),i=n.row.endDate?n.row.endDate:"",this.set("endDate",i),this.set("editItem",!0),this.openItem(n)},filterByField:function(){var t;return t=this.filterValue?"var ret=false,cols="+JSON.stringify(this.current.filterCols)+";console.log('Filtering by val:"+this.filterValue+"'); 		for(var i=0; i < cols.length; i++){      			if (row[cols[i]]==null){				ret=false; break;			}else{				console.log(row[cols[i]]); console.log(row[cols[i]].toLowerCase().indexOf('"+this.filterValue+"')>-1);				if (row[cols[i]].toLowerCase().indexOf('"+this.filterValue+"')>-1){ret=true; break;}			}		}		console.log('filterByval rez: '+ret);return ret;":"return true;",Function("row",t)},filterByTab:function(){var t,e;if("drivers"===this.current.emObject)e="NotWorking"===this.clicked?"!":"",t="var ret=true; if ($.trim(row.endDate)) {ret=oGLOBAL.date.firstBigger(row.endDate);} console.log('endDate: '+row.endDate+', '+ret);return "+e+"ret";else{if("vehicles"!==this.current.emObject)throw Error("filterByTab has no such emObject");e="NotWorking"===this.clicked?"!":"",t="var ret=true; if ($.trim(row.endDate)) {ret=oGLOBAL.date.firstBigger(row.endDate);} console.log('endDate: '+row.endDate+', '+ret);return "+e+"ret"}return Function("row",t)},filterItems:function(){var t,e=this;return t="insPolicies"===this.current.emObject?function(t){var i;return i=e.filterByField()(t),t.set("visible",i)}:function(t){var i;return i=e.filterByTab()(t)?e.filterByField()(t):!1,t.set("visible",i)},i.listAllController[this.current.emObject].forEach(t)},showTabs:function(t){var e;return e=$(t.target),e.closest("ul").find("li").removeClass("ui-tabs-selected ui-state-active"),e.closest("li").addClass("ui-tabs-selected ui-state-active")},filterWorking:function(t){return this.set("clicked","Working"),this.showTabs(t),this.filterItems()},filterNotWorking:function(t){return this.set("clicked","NotWorking"),this.showTabs(t),this.filterItems()},vehicles:[],drivers:[],insPolicies:[],tableName:"?"}),i.TopListsView=i.mainMenuView.extend({templateName:"tmpListsTop",viewIx:4}),i.AllDriversView=i.mainMenuView.extend({init:function(){return this._super(),i.listAllController.set("content",r.GET("proc_Drivers").emData)},templateName:"tmpAllDrivers",viewIx:4,didInsertElement:function(){var t;return this._super(),t=$("#tabLists"),t.find("div.ui-tabs").find("li:first a").trigger("click"),t.find("table.zebra-striped").tblSortable({cols:["firstName","lastName","dateBorn","phone","docs"],controller:"listAllController",sortedCol:1})}}),i.AllInsPoliciesView=i.mainMenuView.extend({init:function(){return this._super(),i.listAllController.set("content",r.GET("proc_InsPolicies").emData)},templateName:"tmpAllInsPolicies",viewIx:4,didInsertElement:function(){return $("#tabLists").find("table.zebra-striped").tblSortable({cols:["claimType","insurerName","policyNumber","endDate","isuredName"],controller:"listAllController",sortedCol:0})}}),i.AllVehiclesView=i.mainMenuView.extend({init:function(){return this._super(),i.listAllController.set("content",r.GET("proc_Vehicles").emData)},templateName:"tmpAllVehicles",viewIx:4,didInsertElement:function(){var t;return this._super(),t=$("#tabLists"),t.find("div.ui-tabs").find("li:first a").trigger("click"),t.find("table.zebra-striped").tblSortable({cols:["plate","type","make","model","year","docs"],controller:"listAllController",sortedCol:0})}}),i.dialogDocController=n.ResourceController.create({refID:null,groupID:null,docs:[],refreshDocs:function(){return this.setDocs(this.refID,this.groupID)},setDocs:function(t,e){var i,a,o,s,l,c,d,u;return t&&(this.refID=t,this.groupID=e),o=r.GET("userData").emData[0].docsPath,d="Uploads/"+o,u=r.GET("tblUsers").emData,i=r.GET("tblDocTypes").emData,l=function(t){return t=t.slice(0,3),"img32-doc_"+("xls"===t||"doc"===t||"pdf"===t?t:"unknown")},c=function(t){var e;return e=u.find(function(e){return e.iD===t}),e.firstName+" "+e.surname},s=function(t){return i.find(function(e){return e.iD===t}).name},a=r.GET("tblDocs").emData.filter(function(i){return i.refID===t&&i.groupID===e}).map(function(t){var e,i;return i=c(t.userID),e="/"+t.iD+"."+t.fileType,n.Object.create({docID:t.iD,hasThumb:t.hasThumb,urlThumb:d+"/Thumbs"+e,urlDoc:d+e,docType:s(t.docTypeID),description:t.description,docName:t.docName,userName:i,fileDate:t.fileDate,fileName:t.docName+"."+t.fileType,fileIcon:t.hasThumb?"img32-doc_unknown":l(t.fileType),docDetails:"Įkėlė "+i+" "+t.fileDate+", dydis - "+Math.ceil(t.fileSize/1e4)/100+"Mb"})}),this.set("docs",a)}})}.call(this),function(){var t,e=window,i=e.App,n=e.Em,a=(e.oGLOBAL,e.oDATA),r=e.oCONTROLS,o=e.MY;i.reportsStart=function(){var t,e;return e=["tblInsurers","proc_InsPolicies","proc_Vehicles","tblClaimTypes","proc_Accidents"],t=["insurers","policies","vehicles","claimTypes","accidents"],a.execWhenLoaded(e,function(){var n;return n=i.tabReportsController,e.forEach(function(i,r){return n.set(t[r],a.GET(e[r]).emData)})})},t={},i.tabReportsController=n.ArrayController.create({target:function(){return this}.property(),content:[],fields:[],insurers:{},policies:{},vehicles:{},claimTypes:{},accidents:{},getInsurerName:function(t){return t?this.insurers.findProperty("iD",t).name:"Neapdrausta"},rep_claimsList:function(t){var e,i,n=this;return e=t.emData.map(function(t){var e,i;return e=n.accidents.findProperty("iD",t.accidentID),i=n.policies.findProperty("iD",t.insPolicyID),{claimType:n.claimTypes.findProperty("iD",t.claimTypeID).name,accDate:e.date,accCountry:e.place.slice(0,e.place.indexOf(",")),accType:e.accType,plate:n.vehicles.findProperty("iD",t.vehicleID).plate,driver:e.driver,quilty:e.IsNotOurFault?"Trečia šalis":"Mes",insurer:n.getInsurerName(i.insurerID),policyNo:i.policyNumber,lossAmount:t.lossAmount,closed:5===t.claimStatus?"Taip":"Ne",iD:t.iD}}),i=[{name:"claimType",title:"Tipas"},{name:"accDate",title:"Įvykio data"},{name:"accCountry",title:"Šalis"},{name:"accType",title:"Įvykio tipas"},{name:"plate",title:"Valst.Nr."},{name:"driver",title:"Vairuotojas"},{name:"quilty",title:"Kaltininkas"},{name:"insurer",title:"Draudikas"},{name:"policyNo",title:"Sutartis"},{name:"lossAmount",title:"Žalos suma"},{name:"closed",title:"Uždaryta"}],i.forEach(function(t){return t.visible=!0}),this.set("content",e).set("fields",i).set("sortProperties",["accDate"]).set("content",this.get("arrangedContent")),!1},changeVisibleCols:function(){return o.dialog=JQ.Dialog.create({ctrl:i.tabReportsController,chkLeft:[],chkRight:[],controllerBinding:"App.tabReportsController",init:function(){var t,e;return this._super(),this.title="Rodomi ataskaitos stulpeliai",e=this.ctrl.fields,t=Math.ceil(e.length/2),this.chkLeft=e.slice(0,t),this.chkRight=e.slice(t)},didInsertElement:function(){return this._super()},width:700,buttons:{"Išsaugoti pakeitimus":function(){return t.sortableGrid("updateGrid",!0),$(this).dialog("close")}},cancelLink:!0,templateName:"tmpReportCols"}).append()},openPdf:function(){return this.getReport("pdf")},openXls:function(){return this.getReport("xls")},getReport:function(t){var e,i,n,a;return n=this.content.map(function(t){return t.iD}),i=[],this.fields.forEach(function(t){return t.visible?i.push(t.name):void 0}),e=$.extend({},{type:t},{reportName:this.report.name,Fields:i,ID:n,sortedField:this.sortProperties[0],asc:this.sortAscending}),a=this,console.log(e),$.ajax({url:"Download/makeReport",dataType:"json",type:"POST",data:e,traditional:!0,success:function(){return $("#downloadFrame").length>0&&$("#downloadFrame").remove(),$("body").append("<iframe id='downloadFrame' target='_blank' src='/Download/GetFile/"+a.report.name+"."+t+"' style='width: 100%;height:800px'></iframe>")},error:function(){},complete:function(){}})},reportsZone:"#reportsViewZone",refreshView:function(){return $(this.reportsZone).find("table").find("tbody").replaceWith(r.table.getBody({fields:this.fields,content:this.content}))},fnAppendReport:function(e){var i,r,o;return o=$(this.reportsZone),i=this[e.name],r=a.GET(e.name),"string"==typeof r&&(r=a.GET(r)),"function"==typeof i?i.call(this,r):console.error("NotaFunction"),this.set("report",e),0===o.html().length?n.run.next(this,function(){return t=o.sortableGrid({controller:this})}):t.sortableGrid("updateGrid",!0)}}),i.TabReportsMainView=Ember.View.extend({init:function(){return this._super()},didInsertElement:function(){return this._super(),$("#reportType").ComboBox({controller:i.tabReportsController,fnChangeCallBack:function(t,e){var i,n;return n=a.GET("words_Reports").emData.findProperty("iD",e.item.id),i=this.controller,a.GET(n.name)?i.fnAppendReport.call(i,n):a.fnLoad2({url:"Reports/Main",name:n.name,dataPars:{bla:"opa1",bla2:"opa3"},ctrl:i.reportsZone,callBack:function(){return i.fnAppendReport.call(i,n)}})}})},templateName:"tmpMainReport",controller:i.tabReportsController})}.call(this),oGLOBAL.LoadAccident_Card=function(t){"use strict";var e;return SERVER.send("{'AccidentNo':"+t+"}",oGLOBAL.Start.fnSetNewData,{Ctrl:"divAccidentEdit",RenderNew:1,fnCallBack:function(){e()}},"/Accident/GetAccident","json"),e=function(){$("#btnMapTown").button({disabled:!0}).click(function(){return oGLOBAL.mapFn.GetMapFromTown(),!1});var e=$("#AccidentForm").data("ctrl"),i={};e.NewRec&&(i.disabled=[1]),$("#accidentTab").tabs(i).on("tabsactivate",function(t,e){if(1===e.newTab.index()){var i=e.oldPanel,n=e.newPanel,a=$("#uploadDocsToAccident");(n.data("ctrl").id!==i.data("ctrl").id||$("#AccDocs").data("ctrl").Saved)&&(MY.accidentCard.TreeView&&(MY.accidentCard.TreeView.remove(),MY.accidentCard.DocsView.remove(),$("#uploadDocsToAccident").next().data("Tree")&&$("#uploadDocsToAccident").next().Tree("destroy")),$("#AccDocs").data("ctrl").Saved&&(App.treeDocController.refreshDocs(),$("#AccDocs").data("ctrl").Saved=!1),oGLOBAL.appStart=(new Date).getTime(),oGLOBAL.logFromStart("Started docsAccident"),App.docsAccident({accidentForm:i,docsForm:n,uploadForm:a}),n.data("ctrl").id=i.data("ctrl").id,oGLOBAL.logFromStart("Finished docsAccident"))}});var n=function(t,e){return $("#btnReturnToAccidents").trigger("click"),$("#ClaimWraper").length?(Em.run.next({accNo:t},function(){$("#accidentsTable").find("div.accident").removeClass("selectedAccident"),$("#accidentsTable").find("div.dividers").remove(),$("#AccDetailsWraper").remove(),Em.run.next(function(){console.log(tr),tr.trigger("click"),tr.trigger("click"),Em.run.next(function(){e&&$("#AccDetailsContent").find("button").trigger("click"),Em.run.next(function(){var t=tr.offset().top-$(window).height()/2+100;$("html, body").animate({scrollTop:t},"slow")})})})}),void 0):!1};$("#btnDeleteAccident").on("click",function(){var e=oDATA.GET("proc_Accidents").emData,i=e.findProperty("no",t);return i.cNo_All>0?(oCONTROLS.dialog.Alert({title:"",msg:"Negalima šalinti įvykio, kol jis turi nepašalintų žalų."}),!1):(oCONTROLS.dialog.Confirm({title:"Įvykio Nr. "+t+" pašalinimas",msg:"Ištrinti šį įvykį?"},function(){SERVER.update({Action:"Delete",DataToSave:{id:i.iD,DataTable:"tblAccidents"},Msg:{Title:"Įvykio pašalinimas",Success:"Pasirinktas įvykis buvo pašalintas.",Error:"Nepavyko pašalinti šio įvykio"},CallBack:{Success:function(){$("#accidentsTable").find("div.accident").removeClass("selectedAccident"),$("#accidentsTable").find("div.dividers").remove(),$("#AccDetailsWraper").remove(),e.removeObject(i),$("#btnReturnToAccidents").trigger("click")}}})}),void 0)}),$("#btnSaveAccident").on("click",{fn:n},function(e){var i,n,a=oCONTROLS.ValidateForm($("#AccidentForm"));if(a){if(oGLOBAL.AccidentForm.NewRec){if(oGLOBAL.AccidentForm.Lat?0:1)return oCONTROLS.dialog.Alert({msg:"Pažymėkite įvykio vietą pelės spragtelėjimu žemėlapyje..",title:"Naujo įvykio įvedimas"}),!1;a.Data.push(oGLOBAL.AccidentForm.Lat),a.Fields.push("Lat"),a.Data.push(oGLOBAL.AccidentForm.Lng),a.Fields.push("Lng"),a.Data.push(oGLOBAL.AccidentForm.Country),a.Fields.push("LocationCountry"),a.Data.push(oGLOBAL.AccidentForm.District),a.Fields.push("LocationDistrict"),a.Data.push(oGLOBAL.AccidentForm.Address),a.Fields.push("LocationAddress"),n={Title:"Naujo įvykio įvedimas",Success:"Naujas įvykis pridėtas",Error:"Nepavyko pridėti naujo įvykio."},i="Add"}else n={Title:"Įvykio duomenų keitimas",Success:"Duomenys sėkmingai pakeisti",Error:"Nepavyko pakeisti duomenų."},i="Edit";SERVER.update({Action:i,DataToSave:a,CallBack:{Success:function(n){var a=n.ResponseMsg.Ext.replace(/#\|#\|/g,":::").split("|#|");a[13]=a[13].replace(/:::/g,"#|#|");var r=parseInt(a[1],10),o="Edit"===i?!1:{sort:"desc",col:"date"};App.accidentsController.get("setNewVal").call(App.accidentsController,{newVal:a,toAppend:o,fieldsToInt:[0,1,5,6,7,8]})[0],$("#AccDocs").data("ctrl").Saved=!0,oGLOBAL.AccidentForm.NewRec?e.data.fn(r,!0):e.data.fn(t,!1)}},Msg:n})}return!1}),$("#btnCancel").on("click",{fn:n},function(e){e.data.fn(t,!1)}),$("#btnReturnToAccidents").click(function(t){t.preventDefault(),$("#tabAccidents").addClass("colmask"),$("#divAccidentsList").show(),$("#divAccidentEdit").empty().hide()}),$("#inputChooseTown").on("keypress",function(t){if($(this).val().length>1){$("#btnMapTown").button("enable");var e=t.which||t.keyCode;13===e&&$("#btnMapTown").trigger("click")}else $("#btnMapTown").button("disable")});var a=$("#divAccidentEdit").height()-$("h2").outerHeight(!0)-$("#ulWhiteMenu").outerHeight(!0)-$("#AccidentForm").outerHeight(!0);a>0&&$("div.HalfDivleft1").height($("div.HalfDivleft1").height()+a);var r=$("#AccidentForm").outerHeight(!1)-$("#divMapHead").outerHeight(!1);$("#divMap").height(r).width("100%"),oGLOBAL.AccidentForm=$("#AccidentForm").data("ctrl"),"undefined"!=typeof google&&oGLOBAL.mapFn.loadGMap(),oGLOBAL.AccidentForm.NewRec||oGLOBAL.mapFn.fnSetAddress($("#txtPlace").html())},!1},"undefined"!=typeof google&&(oGLOBAL.map=null,oGLOBAL.geocoder=null,oGLOBAL.AccidentForm={},oGLOBAL.infoWindow=new google.maps.InfoWindow,oGLOBAL.openInfoWindow=function(t,e){var i=oGLOBAL.infoWindow;i.close(),i.setContent(e),i.setPosition(t),i.open(oGLOBAL.map)}),oGLOBAL.mapFn={fnToogleMapHead:function(t){$("#divSearchMap").toggleClass("hidden",t.hideSearchMap),$("#divMapHead").toggleClass("hidden",!t.hideSearchMap)},GetMapFromTown:function(){"use strict";var t,e=$("#inputChooseTown").val(),i=e.match(RegExp("([0-9]+.[0-9]+)","g"));null===i?t=e:i.length>1?(new google.maps.LatLng(parseFloat(i[0]),parseFloat(i[1])),t=new google.maps.LatLng(i[0],i[1])):t=e,oGLOBAL.geocoder.geocode({address:t},oGLOBAL.mapFn.addAddressToMap)},SetAddress:function(t){t&&oGLOBAL.geocoder.geocode({latLng:t},function(e,i){i==google.maps.GeocoderStatus.OK?(oGLOBAL.map.SetAddress=oGLOBAL.mapFn.fnGetAddress(e),oGLOBAL.openInfoWindow(t,oGLOBAL.map.SetAddress)):oGLOBAL.map.SetAddress="Adresas nerastas"})},fnGetAddress:function(t){var e=t[0].address_components,i=e.length,n=i-1;"country"!==e[n].types[0]&&n--;var a=e[n].long_name;n--;var r=n>0?e[n].long_name:"";n--,0>n&&(n=0);var o=e.slice(0,n).map(function(t){return t.long_name}).join(", ");$.extend(oGLOBAL.AccidentForm,{Address:o,District:r,Country:a});var s=oGLOBAL.AccidentForm;return(s.Address?s.Address+", ":"")+s.District+", "+s.Country},fnSetAddress:function(t){var e=oGLOBAL.AccidentForm;
$("#linkToGoogle").attr("href","https://maps.google.com/maps?q="+e.Lat+","+e.Lng+"("+t+")"),$("#txtPlace").html(t),oGLOBAL.mapFn.fnToogleMapHead({hideSearchMap:!0})},Mapclicked:function(t){"use strict";var e=t.latLng;e&&(oGLOBAL.AccidentForm.Lat=e.lat(),oGLOBAL.AccidentForm.Lng=e.lng(),oGLOBAL.geocoder.geocode({latLng:e},function(t,i){if(i==google.maps.GeocoderStatus.OK){var n=oGLOBAL.mapFn.fnGetAddress(t);oGLOBAL.openInfoWindow(e,n),oGLOBAL.mapFn.fnSetAddress(n),oGLOBAL.AccidentForm.NewRec||$("#ConfirmNewMapData").length||($('<a id="ConfirmNewMapData" href="javascript:void(0);return false;">Patvirtinti</a>').insertAfter("#btnEditMap").button(),$("#ConfirmNewMapData").click(function(){var t={Data:[],Fields:[],DataTable:$("#AccidentForm").data("ctrl").Source};return t.Data.push(oGLOBAL.AccidentForm.Lat),t.Fields.push("Lat"),t.Data.push(oGLOBAL.AccidentForm.Lng),t.Fields.push("Lng"),t.Data.push(oGLOBAL.AccidentForm.Country),t.Fields.push("LocationCountry"),t.Data.push(oGLOBAL.AccidentForm.District),t.Fields.push("LocationDistrict"),t.Data.push(oGLOBAL.AccidentForm.Address),t.Fields.push("LocationAddress"),t.id=$("#AccidentForm").data("ctrl").id,SERVER.update({Action:"Edit",DataToSave:t,CallBack:{Success:function(t){e=new google.maps.LatLng(oGLOBAL.AccidentForm.Lat,oGLOBAL.AccidentForm.Lng),oGLOBAL.map.setCenter(e,8);var i=new google.maps.Marker({position:new google.maps.LatLng(e),map:oGLOBAL.map});oGLOBAL.mapFn.SetAddress(e),google.maps.event.addListener(i,"click",function(){oGLOBAL.openInfoWindow(e,oGLOBAL.map.SetAddress)}),$("#btnEditMap").attr("title","Keisti įvykio vietą").html("Keisti").data("caption","Change"),$("#ConfirmNewMapData").remove();var n=t.ResponseMsg.Ext.replace(/#\|#\|/g,":::").split("|#|");n[13]=n[13].replace(/:::/g,"#|#|"),App.accidentsController.get("setNewVal").call(App.accidentsController,{newVal:n,toAppend:!1,fieldsToInt:[0,1,5,6,7,8]})[0]}},Msg:{Title:"Įvykio vietos keitimas",Success:"Įvykio vieta pakeista.",Error:"Nepavyko pakeist įvykio vietos."}}),!1}))}else oCONTROLS.dialog.Alert({msg:"Nepavyko rasti šios vietos adreso - "+e.toUrlValue(),title:"Nepavyko rasti adreso"})}))},loadGoogleMapScript:function(t){"use strict";if("function"==typeof GMap2)return t(),void 0;var e=document.createElement("script");e.setAttribute("src","http://maps.google.com/maps?file=api&amp;v=2&amp;sensor=true&amp;key=AIzaSyBmiyz9zmTD_hY7qT7Degr0o7tqAzjKQos&async=2&callback=oGLOBAL.mapFn.loadGMap"),e.setAttribute("type","text/javascript"),document.documentElement.firstChild.appendChild(e)},addAddressToMap:function(t,e){e==google.maps.GeocoderStatus.OK?(oGLOBAL.map.fitBounds(t[0].geometry.viewport),new google.maps.Marker({map:oGLOBAL.map,position:t[0].geometry.location}),oGLOBAL.openInfoWindow(t[0].geometry.location,t[0].formatted_address)):alert("Neradau šios vietovės - '"+$("#inputChooseTown").val()+"'")},loadGMap:function(){var t,e,i=function(){oGLOBAL.map.EventMapclicked=google.maps.event.addListener(oGLOBAL.map,"click",oGLOBAL.mapFn.Mapclicked);var t=oGLOBAL.map.getCenter();oGLOBAL.openInfoWindow(t,"Suraskite ir pažymėkite įvykio vietą žemėlapyje")};if(oGLOBAL.geocoder=new google.maps.Geocoder,oGLOBAL.AccidentForm.NewRec?(t=new google.maps.LatLng(54.682961,25.2740478),e=4):(t=new google.maps.LatLng(oGLOBAL.AccidentForm.Lat,oGLOBAL.AccidentForm.Lng),e=8),oGLOBAL.map=new google.maps.Map(document.getElementById("divMap"),{zoom:e,center:t,mapTypeId:google.maps.MapTypeId.ROADMAP}),oGLOBAL.AccidentForm.NewRec)i();else{var n=new google.maps.Marker({position:new google.maps.LatLng(t),map:oGLOBAL.map});oGLOBAL.mapFn.SetAddress(t),google.maps.event.addListener(n,"click",function(){oGLOBAL.openInfoWindow(t,oGLOBAL.map.SetAddress)}),$("#cancelMap").on("click",function(){oGLOBAL.map.EventMapclicked&&google.maps.event.removeListener(oGLOBAL.map.EventMapclicked),oGLOBAL.mapFn.fnSetAddress(oGLOBAL.map.SetAddress),$("#ConfirmNewMapData").length&&$("#ConfirmNewMapData").remove(),oGLOBAL.openInfoWindow(t,oGLOBAL.map.SetAddress),oGLOBAL.mapFn.fnToogleMapHead({hideSearchMap:!0})})}$("#btnEditMap").click(function(){oGLOBAL.mapFn.fnToogleMapHead({hideSearchMap:!1}),i()})}},function(){var t=window,e=t.App,i=t.Em,n=(t.oGLOBAL,t.oDATA),a=t.oCONTROLS;t.MY,e.TabUserCardView=i.View.extend({userContent:null,didInsertElement:function(){var t,i,n;return this._super(),$("#userInfoTab").tabs(),n=$("#InfoDataForm"),i=e.userCardController,i.userContent?n.data("ctrl",{NewRec:0,id:i.userContent.iD,Source:"tblUsers"}):n.data("ctrl",{NewRec:1,id:0,Source:"tblUsers"}),a.UpdatableForm({frm:n,btnSaveToDisable:n.parent().find("button.btnSave:first")}),t=e.userCardController.SaveOk,t&&($("#savePasswordNote").html(t).show().delay(2e3).fadeOut(),e.userCardController.set("SaveOk",null)),$("#userInfoRights").on("click keypress","input",{me:this},this.warnChanged),this.set("userContent",e.userCardController.userContent),this.setWarnSettings()},warnTimer:null,warnChanged:function(t){var e;return e=t.data.me,e.warnTimer&&clearTimeout(e.warnTimer),e.warnTimer=setTimeout($.proxy(e.updateWarnSettings,e),3e3)},updateWarnSettings:function(){var t,e,i;return i=this.userContent,t={id:i.iD,DataTable:"tblUsers",Fields:[],Data:[]},e=$("#userInfoRights"),e.find("input:checkbox").each(function(){var e,n,a,r;return e="",n=$(this),r=n.attr("name"),a=n.closest("tr").find("input:text"),e=a.length&&n.prop("checked")?parseInt(a.val(),10):n.prop("checked"),void 0===i[r]?console.error("wrong userInfoRights"):(console.log(i[r]!==e),console.log(!(null===i[r]&&e===!1)),i[r]===e||null===i[r]&&e===!1?void 0:(t.Fields.push(r),t.Data.push(e)))}),t.Data.length?SERVER.update2({Action:"Edit",DataToSave:t,Ctrl:e,source:"tblUsers",row:i}):void 0},setWarnSettings:function(){var t,e;return t=this,e=this.userContent,$("#userInfoRights").find("input:checkbox").each(function(){var t,i,n;return t=$(this),n=t.attr("name"),i=t.closest("tr").find("input:text"),void 0===e[n]?console.error("wrong userInfoRights"):e[n]&&(t.prop("checked",!0),i.length)?i.val(e[n]):void 0})},templateName:"tmpUserCard",controllerBinding:"App.userCardController",changeMyPassword:function(){return e.router.transitionTo("tabChangePass")},sendUserPasswordForm:function(){return e.userCardController.set("passwordReset",!0)},sendUserPassword:function(t,i,n){var a,r;return a=t?$(t.target).parent():null,r=i?i:"ResetUserPsw",n=n?n:e.userCardController.userContent.email,SERVER.update3({pars:{email:n,mailTmpl:r},ctrl:a,CallBack:function(t){return t.ErrorMsg?$("#savePasswordNote").html("Nepavyko išsiųsti, klaida: "+t.ErrorMsg).show().delay(2e3).fadeOut():$("#savePasswordNote").html(t.ResponseMsg).show().delay(2e3).fadeOut(),e.userCardController.set("passwordReset",!1)},url:"/Account/RecoverPassword2"})},emailText:function(){return alert("Laiško tekstas")},cancelSendUserPassword:function(){return e.userCardController.set("passwordReset",!1)},saveUserCard:function(){var t,i,n,r,o;return n=$("#InfoDataForm"),i=a.ValidateForm(n),o=this.sendUserPassword,t=n.data("ctrl").NewRec?"Add":"Edit",i?(r={Action:t,DataToSave:i,row:e.userCardController.userContent,source:"tblUsers",Ctrl:n,CallBackAfter:function(t,i){return"Add"===i&&o(null,"NewUserPsw",t.email),e.userCardController.setUser({myInfo:!1,User:t}),e.router.transitionTo("tabAdmin")}},SERVER.update2(r)):void 0},saveUserRights:function(){return alert("saveUserRights")},goToAdminTab:function(){return e.router.transitionTo("tabAdmin"),!1}}),e.userCardController=i.ArrayController.create({init:function(){return console.log("init")},setUser:function(t){var e;return this.set("myInfo",t.myInfo?!0:!1).set("passwordReset",!1),t.myInfo&&(e=n.GET("userData").emData[0].userID,t.User=n.GET("tblUsers").emData.findProperty("iD",e)),this.set("userContent",t.User?t.User:null)},myInfo:!0,passwordReset:!1,userContent:null,addNewUser:function(){return this.setUser({myInfo:!1}),this.set("deleteButton",!1),e.router.transitionTo("tabUserCard"),!1},editUser:function(t){return this.setUser({myInfo:!1,User:t.view._context}),this.set("deleteButton",!0),e.router.transitionTo("tabUserCard"),!1},deleteForm:function(){var t,i,r,o,s;return i=$("#InfoDataForm"),o=i.data("ctrl"),r=n.GET(o.Source),t=r.Config.Msg,s=e.userCardController.userContent,a.dialog.Confirm({title:"",msg:"Ištrinti "+t.GenNameWhat+" '"+s.MapArrToString(r.Config.titleFields,!0)+"'?"},function(){return SERVER.update2({Action:"Delete",DataToSave:{id:s.iD,DataTable:r.Config.tblUpdate},Ctrl:$("#tabLists"),source:o.Source,row:s,CallBackAfter:function(){return e.router.transitionTo("tabAdmin"),!1}})})},saveForm:function(){var t,i,n,r,o;return n=$("#InfoDataForm"),i=a.ValidateForm(n),o=e.TabUserCardView.sendUserPassword,t=n.data("ctrl").NewRec?"Add":"Edit",i?(r={Action:t,DataToSave:i,row:e.userCardController.userContent,source:"tblUsers",Ctrl:n,CallBackAfter:function(t,i){var n;return"Add"===i?o(null,"NewUserPsw",t.email):(n=$("#systemEmail"),n.val()!==n.data("ctrl").Value&&o(null,"ResetUserPsw",t.email)),e.userCardController.myInfo?void 0:(e.userCardController.setUser({myInfo:!1,User:t}),e.router.transitionTo("tabAdmin"))}},SERVER.update2(r),!1):void 0},cancelForm:function(){return e.router.transitionTo("tabAdmin"),!1}}),e.ChangeUserPassView=i.View.extend({saveNewPass:function(){var t,i,n,a,r,o,s;return s=this.$(),r=s.find("input:eq(0)"),t=s.find("input:gt(0)"),$.validity.start(),r.require("Įveskite esamą slaptažodį"),t.require("Įveskite naują slaptažodį").minLength(3,"Įveskite ne mažiau 3 raidžių").match("textOrNumber"),i=$.trim(t.eq(0).val()),n=$.trim(t.eq(1).val()),o=$.trim(r.val()),a=function(){return i===n},t.assert(a,"Nesutampa slaptažodžiai"),$.validity.end().valid?SERVER.update3({pars:{OldPassword:o,NewPassword:i,UserId:0},CallBack:function(t){return t.ErrorMsg?$("#changePaswordError").html(t.ErrorMsg):(e.userCardController.set("SaveOk",t.ResponseMsg),e.router.transitionTo(e.userCardController.myInfo?"tabMyCard":"tabUserCard")),console.log(t)},url:"/Account/NewPassword2"}):void 0},cancelNewPass:function(){return e.router.transitionTo(e.userCardController.myInfo?"tabMyCard":"tabUserCard"),!1},templateName:"tmpChangeUsrPass"})}.call(this),function(){var t=window,e=t.App,i=(t.Em,t.oGLOBAL,t.oDATA);t.oCONTROLS,t.MY,e.docsAccident=function(t){var e,n,a,r,o,s,l,c;return o=t.accidentForm.data("ctrl"),s=1===o.NewRec?!0:!1,e=s?null:o.id,n=$("#lstDrivers"),a=s?null:n.data("ctrl").Value,r="Vairuotojo '"+n.val()+"' dokumentai",c=[],s||o.vehicles.forEach(function(t){return c.findProperty("iD",t.iD)?void 0:c.addObject(t)}),l={showPhoto:!0,refreshTree:!0,categoryOpts:{accident:{iD:e,title:"Įvykio dokumentai"},driver:{iD:a,title:r},vehicles:c}},i.execWhenLoaded(["tmpUploadForm","tmpDocsTree"],function(){return $("#uploadDocsToAccident").UploadFiles(l),$("#uploadDocsToAccident").next().Tree({categoryOpts:l.categoryOpts})})}}.call(this),App.ClaimsView=App.mainMenuView.extend({templateName:"tmpClaims",viewIx:1}),App.MapView=App.mainMenuView.extend({templateName:"tmpMap",viewIx:2}),App.ReportsView=App.mainMenuView.extend({templateName:"tmpReports",viewIx:3}),App.Router=Em.Router.extend({executed:{},enableLogging:!1,location:"hash",root:Em.Route.extend({viewAccidents:Em.State.transitionTo("tabAccidents"),viewClaims:function(t,e){if(e.context){if("A"===e.target.tagName.toUpperCase()){var i=$(e.target).data("id");i&&(console.log("ActivityID: "+i),App.tabClaimsRegulationController.clickActivityID=i)}e.context.claimNo||(e.context.claimNo=e.context.accident.no+"-"+e.context.no),t.transitionTo("claimRegulation",e.context)}else t.transitionTo("claimList")},viewMap:Em.State.transitionTo("tabMap"),viewReports:Ember.State.transitionTo("tabReports"),viewLists:Ember.State.transitionTo("tabLists"),viewAdmin:Ember.State.transitionTo("tabAdmin"),tabAccidents:Em.Route.extend({route:"/",connectOutlets:function(t){MY.NavbarController.fnSetNewTab({newState:t.currentState.name,viewIx:0}),$("#divAccidentsList").find("div.col2").css("top","0")}}),claimList:Em.Route.extend({route:"/claims",connectOutlets:function(t){MY.NavbarController.fnSetNewTab({newState:"tabClaims",viewIx:1,transparent:!0,hide:"#divClaimRegulation",show:"#divClaimsList",needUrl:"Main/tabClaims",callBack:function(){App.claimsStart(),t.get("applicationController").connectOutlet("claimsOutlet","tabClaims"),t.get("applicationController").connectOutlet("claimsSidePanelOutlet","sidePanelForClaims")}})}}),claimRegulation:Em.Route.extend({route:"/claim/:claimNo",connectOutlets:function(t,e){MY.NavbarController.fnSetNewTab({newState:"tabClaims",viewIx:1,transparent:!0,show:"#divClaimRegulation",hide:"#divClaimsList",needUrl:"Main/tabClaims",callBack:function(){if(App.claimsStart(),!e.accident){var i=e.claimNo.split("-"),n=parseInt(i[0],10),a=parseInt(i[1],10),r=oDATA.GET("proc_Accidents").emData.find(function(t){return t.no===n?!0:!1}),o=oDATA.GET("proc_Claims").emData.find(function(t){return t.no===a&&t.accidentID===r.iD?!0:!1});if(!o)return t.transitionTo("tabAccidents"),!1;App.claimsController.setClaimContext(o),$.extend(e,o)}App.tabClaimsRegulationController.set("claim",e),t.get("applicationController").connectOutlet("claimRegulationOutlet","tabClaimsRegulation")}})}}),tabReports:Em.Route.extend({route:"/reports",connectOutlets:function(t){return MY.NavbarController.fnSetNewTab({newState:t.currentState.name,viewIx:3}),$("#tabReports").length&&$("#tabReports>div").html().length?!1:(oDATA.fnLoad2({url:"Main/tabReports",callBack:function(){App.reportsStart(),t.get("applicationController").connectOutlet("reportsOutlet","tabReportsMain")}}),void 0)}}),tabLists:Em.Route.extend({route:"/tabLists",connectOutlets:function(t){MY.NavbarController.fnSetNewTab({newState:t.currentState.name,viewIx:4,transparent:!0}),oDATA.fnLoad2({url:"Main/tabLists",checkFn:"App.listsStart",runAllways:!0,callBack:function(){App.listsStart(),t.get("applicationController").connectOutlet("listsOutlet","topLists")}})},toListAll:function(t,e){MY.NavbarController.fnSetNewTab({newState:t.currentState.name,viewIx:4,newOutlet:"tabLists"})&&(d=$(e.target).parent().data("ctrl"),App.listAllController.set("current",d),t.get("applicationController").connectOutlet("listsOutlet",d.goTo))},toTop:function(t){MY.NavbarController.fnSetNewTab({newState:t.currentState.name,viewIx:4,transparent:!0}),App.listsStart(),t.get("applicationController").connectOutlet("listsOutlet","topLists")}}),tabAdmin:Em.Route.extend({route:"/tabAdmin",connectOutlets:function(t){MY.NavbarController.fnSetNewTab({newState:t.currentState.name,viewIx:5,transparent:!0}),oDATA.fnLoad2({url:"Main/tabAdmin",callBack:function(){App.adminStart(),console.log(".connectOutlet('adminOutlet', 'tabAdmin');"),t.get("applicationController").connectOutlet("adminOutlet","tabAdmin")}})}}),tabUserCard:Em.Route.extend({route:"/tabUserCard",connectOutlets:function(t){var e=App.userCardController.myInfo?-1:5;MY.NavbarController.fnSetNewTab({newState:t.currentState.name,viewIx:e,newOutlet:"tabAdmin"})&&t.get("applicationController").connectOutlet("adminOutlet","tabUserCard")}}),tabMyCard:Em.Route.extend({route:"/tabMyCard",connectOutlets:function(t){MY.NavbarController.fnSetNewTab({newState:t.currentState.name,viewIx:-1,newOutlet:"tabAdmin"})&&t.get("applicationController").connectOutlet("adminOutlet","tabUserCard")}}),tabChangePass:Em.Route.extend({route:"/changePass",connectOutlets:function(t){MY.NavbarController.fnSetNewTab({newState:t.currentState.name,viewIx:-1,newOutlet:"tabEmpty"})&&t.get("applicationController").connectOutlet("emptyOutlet","changeUserPass")}})})}),App.initialize(),$(function(){$("#userLink").on("click",function(){return App.userCardController.setUser({myInfo:!0}),App.router.transitionTo("tabMyCard"),!1}),$("body").hoverIntent({over:function(){var t=$(this),e=t.closest(".ExtendIt");data=e.data("ctrl"),field=data.colLabels?data.colLabels:data.Field;var i=App.Lang.tables[t.closest(".js-frm").data("ctrl").Source].Cols[field].tip,n=e.offset(),a=$('<div id="js-tip-id" style="left:'+n.left+"px;top:"+n.top+"px;width:"+e.width()+'px;">'+i+"</div>").appendTo("body");n.top-a.height()-20>$(window).scrollTop()?a.addClass("js-tip-top").offset({top:a.offset().top-a.height()-20}):a.addClass("js-tip-bottom").offset({top:a.offset().top+e.height()+a.height()}),a.fadeIn("slow")},out:function(){$("#js-tip-id").fadeOut("slow").remove()},selector:"label.js-tip"}),Em.run.next(function(){$("#tabAccidents,#tabClaims,#tabReports,#tabLists,#tabAdmin").on("focus","input:text,textarea",function(t){$(t.target).addClass("activeField")}).on("blur","input:text,textarea",function(t){$(t.target).removeClass("activeField")})})});