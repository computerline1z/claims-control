JQ=Ember.Namespace.create(),JQ.Widget=Ember.Mixin.create({didInsertElement:function(){var options=this._gatherOptions();this._gatherEvents(options);var ui=jQuery.ui[this.get("uiType")](options,this.get("element"));this.set("ui",ui)},willDestroyElement:function(){var ui=this.get("ui");if(ui){var observers=this._observers;for(var prop in observers)observers.hasOwnProperty(prop)&&this.removeObserver(prop,observers[prop]);ui._destroy()}},_gatherOptions:function(){var uiOptions=this.get("uiOptions"),options={};return uiOptions.forEach(function(key){options[key]=this.get(key);var observer=function(){var value=this.get(key);this.get("ui")._setOption(key,value)};this.addObserver(key,observer),this._observers=this._observers||{},this._observers[key]=observer},this),options},_gatherEvents:function(options){var uiEvents=this.get("uiEvents")||[],self=this;uiEvents.forEach(function(event){var callback=self[event];callback&&(options[event]=function(event,ui){callback.call(self,event,ui)})})}}),JQ.Dialog=Ember.View.extend(JQ.Widget,{init:function(){this._super(),this.dialogID&&(this.elementId=this.dialogID)},elementId:"openItemDialog",uiType:"dialog",didInsertElement:function(){this._super(),this.$().parent().css("top","10%")},uiOptions:"autoOpen width close title resizable modal position buttons".w(),autoOpen:!0,width:400,resizable:!1,modal:!0,position:"top",close:function(){$(this).dialog("destroy"),$(this).remove();var id=$(this).attr("id"),removeDialog=id!=="openItemDialog"?MY[id]:MY.dialog;removeDialog&&(removeDialog.removeOnCloseView&&removeDialog.removeOnCloseView.remove(),removeDialog.remove())},open:function(){$(this).dialog("open")}}),function($){$.fn.spinner=function(options){var opts=$.extend({},$.fn.spinner.defaults,options);return this.each(function(){var l=0,t=0,w=0,h=0,shim=0,$s,$this=$(this);if(options=="remove"||options=="close"){var $s=$this.data("spinner"),o=$this.data("opts");if(typeof $s!="undefined"){$s.remove(),$this.removeData("spinner").removeData("opts"),o.hide&&$this.css("visibility","visible"),o.onFinish.call(this);return}}$this.is("body")&&$this.height()<$(document).height()&&$this.height($(document).height()),opts.img==="spinnerBig.gif"&&(opts.height=66,opts.width=66);var pos=$this.offset();w=$this.outerWidth(),h=$this.outerHeight(),h>opts.height?shim=Math.round((h-opts.height)/2):h<opts.height&&(shim=0-Math.round((opts.height-h)/2)),t=pos.top+shim+"px";if(opts.position=="right")l=pos.left+w+10+"px";else if(opts.position=="left")l=pos.left-opts.width-10+"px";else{var add=0;if($this.is("body")){var lmargin=$("body").css("margin-left");add=parseInt(lmargin.replace("px",""),10)}l=add+pos.left+Math.round(.5*w)-Math.round(.5*opts.width)+"px"}opts.onStart.call(this),opts.hide&&$this.css("visibility","hidden"),$s=$('<img class="spinner" src="/Content/images/'+opts.img+'" style="position: absolute; left: '+l+"; top: "+t+"; width: "+opts.width+"px; height: "+opts.height+"px; z-index: "+opts.zIndex+';" />').appendTo("body"),$this.data("spinner",$s).data("opts",opts)})},$.fn.spinner.defaults={position:"right",img:"spinner.gif",height:16,width:16,zIndex:1001,hide:!1,onStart:function(){},onFinish:function(){}}}(jQuery),$("div.content:visible:first").length>0?$("div.content:visible:first").spinner({centerOnBody:!0,position:"center",img:"spinnerBig.gif"}):$("body").spinner({centerOnBody:!0,position:"center",img:"spinnerBig.gif"}),window.console||(console={}),console.log=console.log||function(){},console.warn=console.warn||function(){},console.error=console.error||function(){},console.info=console.info||function(){},jQuery.fn.log=function(msg){return msg=msg||"log",console.log("%s: %o",msg,this),this.each(function(n){id=this.id?"ID: "+this.id:"",console.log("%d: %s.%s %s",n,this.tagName,this.className,id)}),this};var MY={change:{onlyNumbers:function(input){return input.toString().replace(/[^\d.]/g,"")}}};String.prototype.toRowObject=function(fieldNamesArr){var valsArr=this.split(" ");retObj={};for(var i=0;i<valsArr.length;i++)fieldNamesArr[i]&&(retObj[fieldNamesArr[i]]=$.trim(valsArr[i]));return retObj},String.prototype.firstSmall=function(){return this.slice(0,1).toLowerCase()+this.slice(1)},String.prototype.firstBig=function(){return this.slice(0,1).toUpperCase()+this.slice(1)},Array.prototype.filterByTbl=function(p){fTbl=[],me=this;if(!me.length)return fTbl;me[0].iD||console.error("No iD for filter");var filterTbl=p.filterTbl.filter(function(item){return item[p.filterField]===p.filterValue});return filterTbl.forEach(function(filterItem){for(var i=0;i<me.length;i++)if(me[i].iD===filterItem[p.joinField]){fTbl[fTbl.length]=me[i];break}}),fTbl},Em.Object.prototype.MapArrToString=function(arrNames,mapWithNoCommas){var arrRet=[],e;for(var i=0;i<arrNames.length;i++)e=$.trim(this[arrNames[i]]),e!==""&&(arrRet[arrRet.length]=e);return mapWithNoCommas?arrRet.join(" "):arrRet.join(", ")},Em.Object.prototype.updateTo=function(newObject){for(var prop in this){if(!this.hasOwnProperty(prop))continue;newObject[prop]&&this[prop]!==newObject[prop]&&this.set(prop,newObject[prop])}},Array.prototype.FNameIndex=function(FNameVal){var ctr="";for(var i=0;i<this.length;i++)if(this[i].FName==FNameVal)return i;return ctr},Array.prototype.findIndexByVal=function(value){var ctr="";for(var i=0;i<this.length;i++)if(this[i]==value)return i;return ctr},Array.prototype.findValueByID=function(ID){for(var i=0;i<this.length;i++)if(this[i][0]===ID)return this[i];return!1},Array.prototype.findObjectByProperty=function(propertyName,propertyValue){for(var i=0;i<this.length;i++)if(this[i][propertyName]===propertyValue)return this[i]},Array.prototype.findColValuesByID=function(ID,ArrValuesCol){var ctr="";for(var i=0;i<this.length;i++)if(this[i][0]===ID){var ret="";for(var ix=0;ix<ArrValuesCol.length;ix++)ret+=this[i][ArrValuesCol[ix]]+", ";return ret.slice(0,-2)}return ctr},Array.prototype.findColValueByID=function(ID,ValueCol){var ctr="";for(var i=0;i<this.length;i++)if(this[i][0]===ID)return this[i][ValueCol];return ctr},Array.prototype.removeRowByProperty=function(propertyName,propertyValue){for(var i=0;i<this.length;i++)if(this[i][propertyName]===propertyValue)return this.splice(i,1),i;return!1},Array.prototype.removeRowByID=function(ID){var ctr="";for(var i=0;i<this.length;i++)if(this[i][0]===ID)return this.splice(i,1),i;return ctr},Array.prototype.AddArray=function(AnotherArray){for(var i=0;i<AnotherArray.length;i++)this[this.length]=AnotherArray[i]},Array.prototype.IndexOfFunc=function(fnc){for(var i=0;i<this.length;i++)if(fnc(this[i]))return i;return-1};function ArrayIndexOf(a,fnc){if(!fnc||typeof fnc!="function")return-1;if(!a||!a.length||a.length<1)return-1;for(var i=0;i<a.length;i++)if(fnc(a[i]))return i;return-1}Array.prototype.ValueInMe=function(value){for(var i=0;i<this.length;i++)if(this[i]===value)return!0;return!1},Array.prototype.findColValByColVal=function(value,Col1,Col2){for(var Row=0;Row<this.length;Row++)if(this[Row][Col1]==value)return this[Row][Col2];return""},String.prototype.endsWith=function(suffix){return this.substr(this.length-suffix.length)===suffix},String.prototype.startsWith=function(prefix){return this.substr(0,prefix.length)===prefix},Array.prototype.MapArrToString=function(arrIndexes,mapWithNoCommas){var arrRet=[],e;for(var i=0;i<arrIndexes.length;i++)e=$.trim(this[arrIndexes[i]]),e!==""&&(arrRet[arrRet.length]=e);return mapWithNoCommas?arrRet.join(" "):arrRet.join(", ")},Array.prototype.UpdateArrToNew=function(NewArr,fieldsToInt){if(fieldsToInt)for(var i=0;i<fieldsToInt.length;i++)NewArr[fieldsToInt[i]]=parseInt(NewArr[fieldsToInt[i]],10);for(var i=0;i<this.length;i++)if(this[i][0]===NewArr[0])return this[i]=NewArr,!0;return!1},Array.prototype.arrElementToInt=function(fieldsToInt){for(var i=0;i<fieldsToInt.length;i++)this[fieldsToInt[i]]=parseInt(this[fieldsToInt[i]],10)},String.prototype.IsImage=function(){var type=this.substring(this.search("\\.")+1).toUpperCase();return type==="PNG"||type==="JPG"||type==="GIF"||type==="JPEG"||type==="BMP"?!0:!1},String.prototype.format=function(){var s=this,i=arguments.length;while(i--)s=s.replace(new RegExp("\\{"+i+"\\}","gm"),arguments[i]);return s};var jscss_filesadded="";String.prototype.GetIcon=function(FileId){var pPosition=this.search("\\."),ret="<span style='display:inline-block;' class='{0} ui-button-icon-primary'>",img="img32-Help";if(pPosition>0){var type=this.substring(this.search("\\.")+1).toLowerCase();ret="<a href='/Uploads/"+FileId+"."+type+"' target='_blank'>"+ret+"</a>";if(type==="png"||type==="jpg"||type==="gif"||type==="jpg"||type==="jpeg"||type==="bmp")img="img32-Img";else if(type==="xls"||type==="xlsx")img="img32-Excel";else if(type==="pdf")img="img32-Pdf";else if(type==="ppt"||type==="pptx")img="img32-ppt";else if(type==="doc"||type==="docx")img="img32-Word"}else this==="Add"&&(img="img32-"+this.toString());return ret.format(img)};var oSIZES={DoneSizes:0};oGLOBAL.Start={fnSetNewData:function(jsResp,APar){var ExecFn=0,Replace=APar.RenderNew&&oGLOBAL.Start[APar.Ctrl]?oGLOBAL.Start[APar.Ctrl]:"";Replace?($("#"+APar.Ctrl).empty(),$("#"+APar.Ctrl).replaceWith(oGLOBAL.Start[APar.Ctrl])):!oGLOBAL.Start[APar.Ctrl];for(var p in jsResp)if(p==="Render"){var Render=jsResp[p];for(var pR in Render){if(!Render[pR])continue;$("#"+pR).html(Render[pR]);var inputForm=$("#"+pR+" div.inputForm");for(var i=0;i<inputForm.length;i++)oCONTROLS.UpdatableForm($(inputForm)[i])}}else p==="ExecFn"?ExecFn=jsResp[p]:jsResp[p]&&oDATA.SET(p,jsResp[p]);if(ExecFn)for(var pFn in ExecFn)ExecFn[pFn]&&$("#"+pFn)[ExecFn[pFn]]();if(APar.Ctrl!="tabMessages")if(APar.Ctrl=="tabAccidents"){var oTable=Tab_AccidentsList(APar.Ctrl);oGLOBAL.Start.fnApplyLayout(APar.Ctrl,oTable,20)}else APar.Ctrl!="tabClaims"&&APar.Ctrl!="tabMap"&&APar.Ctrl!="tabReports"&&APar.Ctrl=="tabLists";typeof APar.fnCallBack!="undefined"&&APar.fnCallBack(jsResp),oGLOBAL.Start.FormLoaded(undefined,APar.Ctrl),console.log("oGLOBAL.Start.fnSetNewData,#"+APar.Ctrl+" height:"+$("#"+APar.Ctrl).height())},FormLoaded:function(SERVER,Ctrl){$("img.spinner").remove()}},oGLOBAL.date={dateFormat:"yyyy.mm.dd",dateDelimiter:".",getTodayString:function(){var d=new Date;return this.checkFormat(),d.getFullYear()+this.dateDelimiter+(d.getMonth()<9?"0"+(d.getMonth()+1):d.getMonth()+1)+this.dateDelimiter+(d.getDate()<9?"0"+d.getDate():d.getDate())},getDate:function(stringDate){var pattern=new RegExp("([^-]*)"+this.dateDelimiter+"([^-]*)"+this.dateDelimiter+"([^-]*)");this.checkFormat();var DateRegexResult=stringDate.match(pattern),result=DateRegexResult?new Date(DateRegexResult[2]+"/"+DateRegexResult[3]+"/"+DateRegexResult[1]):"";return result},isDate:function(stringDate){return!isNaN(Date.parse(this.getDate(stringDate)))},firstBigger:function(date1,date2){return arguments.length===1&&(date2=this.getTodayString()),this.getDate(date1)>this.getDate(date2)},checkFormat:function(){if(this.dateFormat!=="yyyy.mm.dd")throw new Error(err+"no such format in General.js date obj.")}},oGLOBAL.helper={getData_fromDataToSave:function(DataToSave,field){return ret="",DataToSave.Fields.forEach(function(Field,i){Field===field&&(ret=DataToSave.Data[i])}),ret},executeFunctionByName:function(functionName,context){var args=Array.prototype.slice.call(arguments,2),namespaces=functionName.split("."),func=namespaces.pop();for(var i=0;i<namespaces.length;i++)context=context[namespaces[i]];return context[func].apply(context,args)},existsFunctionByName:function(functionName,context){var args=Array.prototype.slice.call(arguments,2),namespaces=functionName.split("."),func=namespaces.pop();for(var i=0;i<namespaces.length;i++){context=context[namespaces[i]];if(!context)return!1}return context[func]||!1}};var oCONTROLS={UpdatableForm_reset:function(frm){$(frm).find(".UpdateField").each(function(){var e=$(this),eOpt=e.data("ctrl"),isList=e.data("ctrl").Type==="List"?!0:!1,val=eOpt.Value;e.attr("type")==="checkbox"?e.attr("checked",val):e.is("textarea")?e.html(val):isList?$.isNumeric(val)&&(e.data("newval",val),e.val(oDATA.GET(e.data("ctrl").Source).Data.findColValuesByID(val,eOpt.iText))):e.val(val)})},UpdatableForm_toSaved:function(RecId,frm,OtherDataToSave){OtherDataToSave&&SERVER.update({Action:"Edit",DataToSave:OtherDataToSave}),RecId&&($.extend(frm.data("ctrl"),{NewRec:0,id:RecId}),frm.find("span.Control, div.Control").each(function(){var e=$(this),eOpt=e.data("ctrl");eOpt.Control==="swfUpload"&&e.children().length===0&&($.extend(e.data("ctrl"),{RecId:RecId}),e[eOpt.Control](e.data("ctrl")))})),frm.find(".UpdateField").each(function(){var e=$(this),eOpt=e.data("ctrl"),val;e.attr("type")==="checkbox"?val=e.attr("checked")?1:0:e.is("input")&&e.data("ctrl").Type==="List"?val=e.data("newval"):val=e.val(),$.extend(e.data("ctrl"),{Value:val})})},getValFromRow:function(field,row){var f=field.slice(0,1).toLowerCase()+field.slice(1);return row[f]},UpdatableForm:function(frm,row){var sTitle="",frmOpt=$(frm).data("ctrl"),me=this;row&&(frmOpt.NewRec=0,frmOpt.id=row.iD);var data=frmOpt.Source==="NoData"?"NoData":oDATA.GET(frmOpt.Source),elements=$(frm).find("div.ExtendIt, span.ExtendIt");$(frm).find("div.ExtendIt, span.ExtendIt").each(function(){var e=$(this),eOpt=e.data("ctrl"),eHTML="",ix=-1,data_ctrl={};if(!eOpt)return!0;if(typeof eOpt.Control!="undefined")return eOpt.Control==="swfUpload"&&typeof frmOpt.id=="undefined"?!0:(e[eOpt.Control](eOpt),!0);if(data!=="NoData"){var eCols=data.Cols;if(eOpt.Field){for(var i=0;i<eCols.length;i++)if(eCols[i].FName===eOpt.Field){ix=i,sTitle=data.Grid.aoColumns[i].sTitle;break}ix===-1&&console.error("Wrong Field indicated "+eOpt.Field+" in UpdatableForm(objFunc:84)!")}}sTitle=eOpt.sTitle?eOpt.sTitle:sTitle;var col={},input;data!=="NoData"&&(col=$.extend({},data.Cols[ix])),col=$.extend(!0,col,eOpt);var Type=col.Type?col.Type:col.List?"List":"";if(Type===undefined)return alert("Nesusiparsino ctrl elemento objFunc.js-UpdatableForm (n�ra Type)"),!0;var AddToClasses="ui-widget-content ";AddToClasses+=e.hasClass("NotUpdateField")?" NotUpdateField":" UpdateField",Type==="Integer"||Type==="Decimal"?AddToClasses+=" number":Type==="List"?col.Type="List":Type&&Type.search("Date")!==-1&&(AddToClasses+=" date"),col.classes=col.classes?col.classes+" "+AddToClasses:AddToClasses,typeof col.Value!="number"&&typeof col.Value!="boolean"&&(col.Value=col.Value?col.Value.replace(/'/g,'"'):"");for(var prop in col)if(prop==="List")$.extend(data_ctrl,col[prop]);else if(prop==="Value"||prop==="Validity"||prop==="AgrValidity"||prop==="Tip"||prop==="Field"||prop==="Type"||prop==="Ext"||prop==="UpdateField"||prop==="Editable")data_ctrl[prop]=col[prop];if(row){var v=me.getValFromRow(col.FName,row);v&&(data_ctrl.Value=v,col.Value=v)}data_ctrl=JSON.stringify(data_ctrl),Type==="Integer"||Type==="Decimal"?data_ctrl=data_ctrl.replace("match('integer')","match(integer)").replace("match('number')","match(number)"):Type.search("Date")!==-1&&(data_ctrl=data_ctrl.replace("match('date')","match(date)")),$.extend(col,{data_ctrl:data_ctrl},{label:{txt:sTitle,type:col.labelType}});if(Type==="Boolean"||Type==="checkbox")eHTML=oCONTROLS.chk(col),$(eHTML).prependTo(e);else if(Type==="String"||Type==="Email"||Type==="text"||Type==="textarea"||Type==="hidden"){var len=typeof col.LenMax=="undefined"?0:col.LenMax;Type==="hidden"?(eHTML+=oCONTROLS.hidden(col),input=$(eHTML).prependTo(e).parent().find("input:first")):len<101&&Type!=="textarea"?(eHTML+=oCONTROLS.txt(col),input=$(eHTML).prependTo(e).parent().find("input:first")):(eHTML+=oCONTROLS.txtarea(col),input=$(eHTML).prependTo(e).parent().find("textarea:first"))}else if(Type==="Integer"||Type==="Decimal")eHTML+=oCONTROLS.txt(col),input=$(eHTML).prependTo(e).find("input:first");else if(Type.search("Date")!==-1){var isTime=0;!col.Value&&col.Default==="Today"&&(col.Value=oGLOBAL.date.getTodayString());if(Type.search("Time")!==-1){var TimeValue=col.Value.length>=16?col.Value.substring(11,16):"00:00";isTime=1}col.Value=col.Value.substring(0,11),eHTML+=oCONTROLS.txt(col),isTime&&(eHTML+=oCONTROLS.txt({Value:TimeValue,style:"margin:0 20px;",title:"Laikas",classes:"time ui-widget-content ui-corner-all"})),input=$(eHTML).prependTo(e).parent().find("input:first")}col.List&&(input?input.ComboBox():(eHTML+=oCONTROLS.txt(col),input=$(eHTML).prependTo(e).parent().find("input").ComboBox())),col.Plugin&&$.each(col.Plugin,function(name,value){input[name](value)}),typeof input!="undefined"&&(input.val($.trim(input.val())),(Type==="Integer"||Type==="Decimal"||Type==="Date")&&input.ValidateOnBlur({Allow:Type}),typeof col.Tip!="undefined"&&input.attr("placeholder",col.Tip))})},ValidateForm:function(frm,DataToSaveAppend){$("div.validity-modal-msg").remove();var c=frm.data("ctrl"),id=parseInt(c.id,10),NewRec=parseInt(c.NewRec,10),DataTable=c.tblUpdate?c.tblUpdate:oDATA.GET(c.Source).Config.tblUpdate;!id&!NewRec&&console.error("Nėra nurodyta id formos data(ctrl)!"),$.validity.start();var DataToSave={Data:[],Fields:[],DataTable:DataTable};$.each(frm.find(".UpdateField"),function(i,v){var e=$(v),elDesc=e[0].tagName+", id-"+e.attr("id"),Value,UpdateField=e.data("ctrl").UpdateField?e.data("ctrl").UpdateField:!1;if(e.data("ctrl")===undefined)return console.error("Nerasta data(ctrl),el: "+elDesc),!0;var Type,FName=e.data("ctrl").Field,OldVal=NewRec?"":$.trim(e.data("ctrl").Value),val="";if(e.attr("type")==="checkbox")NewRec||(OldVal=!OldVal||OldVal==="False"||OldVal==="0"?0:1),val=e.attr("checked")?1:0;else{if(typeof e.data("ctrl").Type=="undefined")console.error("Nerastas elemento Tipas!");else{Type=e.data("ctrl").Type;var Validity=e.data("ctrl").Validity?e.data("ctrl").Validity:"";if(Type==="hidden")val=e.val();else if(Type.substring(0,4)=="Date"){Validity=Validity.replace(/match\(date\)/g,"match('date')"),val=$.trim(e.val()),val==="-"&&(val="");if(Validity.indexOf("require")!==-1||e.val()!==""){eval("$(this)."+Validity);if(Type.search(/time/i)>-1){var TimeCtrl=e.parent().next();TimeCtrl.require().match(/^\d{2}[:]\d{2}$/,"Turi būti laiko formatas - valandos:minutės, pvz.12:30"),val=val+" "+TimeCtrl.val()+":00"}}}else if(Type==="List")$.isNumeric(e.data("newval"))?val=e.data("newval"):(e.val(""),e.require("Reikalinga parinkti reikšmę iš sarašo.."));else{if(Type==="Decimal"||Type==="Integer")e.val(e.val().replace(/,/g,".")),Validity=Validity.replace(/match\(number\)/g,"match('number')").replace(/match\(integer\)/g,"match('integer')");val=e.val();var CheckIt=id?OldVal!=val?!0:!1:!0,Require=Validity.search(/require/i)>-1,NotEmpty=val===""?!1:!0;CheckIt&&(Require||NotEmpty)&&Validity&&eval("$(this)."+Validity)}}if(typeof e.data("ctrl").AgrValidity!="undefined"){var aVal=e.data("ctrl").AgrValidity;if(aVal.Validity==="require"){var Empty=$.map($(aVal.Selector),function(e,index){return $(e).val()?null:1});Empty.length===$(aVal.Selector).length&&e.require(aVal.Msg)}}}if(OldVal!=val||val===0&&OldVal==="")UpdateField?DataToSave[UpdateField]=val:(DataToSave.Data.push(val),DataToSave.Fields.push(FName))});if(typeof DataToSaveAppend!="undefined")for(var i=0;i<DataToSaveAppend.length;i++)DataToSave.Data.push(DataToSaveAppend[i].Data),DataToSave.Fields.push(DataToSaveAppend[i].Fields);var ValRes=$.validity.end();return ValRes.valid&&DataToSave.Data.length?(NewRec||(DataToSave.id=id),DataToSave):ValRes.valid?0:!1},lbl:function(text){return"<label class='dialog-form-label'>"+text+"</label>"},AddToProperty:function(Object,Property,Value){return Object[Property]=Object[Property]?Object[Property]+" "+Value:Value,Object},basic:function(p){return(p.attr?p.attr+" ":"")+(p.id?"id='"+p.id+"' ":"")+(p.style?'style="'+p.style+'" ':"")+(p.notabstop?"tabindex='-1' ":"")+(p.title?"title='"+p.title+"' ":"")+(p.data_ctrl?"data-ctrl='"+p.data_ctrl+"' ":"")+(p.classes?"class='"+p.classes+"' ":"")},appendLabel:function(p,t){return p.label?!p.label.txt||p.label.type==="None"?t:typeof p.label=="undefined"||p.label==="None"?t:p.label.type==="Top"?"<label class='toplabel'><span>"+p.label.txt+"</span>"+t+"</label>":"<label class='leftlabel'><span>"+p.label.txt+":</span>"+t+"</label>":t},txt:function(p){return this.appendLabel(p,"<input type='text' "+this.basic(p)+(p.Value?'value="'+$.trim(p.Value)+'" ':"")+"/>")},hidden:function(p){return this.appendLabel(p,"<input type='hidden' "+this.basic(p)+(p.Value?'value="'+$.trim(p.Value)+'" ':"")+"/>")},a:function(p){return"<a "+this.basic(p)+" href='javascript:void(0);return false;'>"+$.trim(p.Value)+"</a>"},txtarea:function(p){return this.appendLabel(p,"<textarea cols='100' rows='4' "+this.basic(p)+">"+(p.Value?p.Value:"")+"</textarea>")},chk:function(p){return typeof p.Value=="string"&&(p.Value=p.Value.search(/false/i)>-1||p.Value===""?0:1),"<label "+(p.label.classes?" class='"+p.label.classes+"'":"")+(p.attr?p.attr+" ":"")+"><input type='checkbox' "+this.basic(p)+(p.Value?"checked='checked'":"")+"/>"+(p.label.txt?p.label.txt:"")+"</label>"},img:function(p){return"<img src='"+p.src+"' alt='"+p.alt+"' onclick='"+p.onclickfn+"'/>"},ui_img:function(p){return"<span class='ui-icon "+p.name+"' style='"+p.style+";margin-top:.5em;' onclick=\""+p.onclickfn+'"/>'},txt_imgINtxt:function(pWraper,ptxt,pui_img){ptxt.classes=ptxt.classes?ptxt.classes+" InputInWraper":"InputInWraper";var w="width:"+(pWraper.width-20)+"px;";return ptxt.style=ptxt.style?ptxt.style+w:w,"<div "+this.basic(pWraper)+"width:"+pWraper.width+"px;"+"'>"+this.txt(ptxt)+this.ui_img(pui_img)+"</div>"},btnOKimg:function(title){return"<button tabindex='-1' title='"+title+"' class='ui-button ui-widget ui-state-default ui-button-icon-only ui-corner-all ui-button-icon' role='button'><span class='ui-button-icon-primary ui-icon ui-icon-circle-check'></span><span class='ui-button-text'>&nbsp;</span></button></div>"},lbltxt_inline_btnConfirm:function(id,lblTitle,txtData,txtValue,btnTitle){return"<div id="+id+"><label class='dialog-form-r'>"+lblTitle+"</label><input type='text' data-ctrl=\""+txtData+"\" value='"+txtValue+"' class='validate-dialog ui-widget-content ui-corner-left'/><button tabindex='-1' title='"+btnTitle+"' class='ui-button ui-widget ui-state-default ui-button-icon-only ui-corner-right ui-button-icon' role='button'><span class='ui-button-icon-primary ui-icon ui-icon-circle-check'></span><span class='ui-button-text'>&nbsp;</span></button></div>"},lbla_inline:function(id,lblTitle,aValue,data_ctrl){return"<div id="+id+"><label class='dialog-form-label'>"+lblTitle+'</label><a data-ctrl="'+data_ctrl+"\" href='javascript:void(0);'>"+aValue+"</a></div>"},btnTextOnly:function(p){return oCONTROLS.AddToProperty(p,"classes","ui-button ui-corner-all ui-button-text-icon-primary"),"<button "+oCONTROLS.basic(p)+'" role="button"><span class="ui-button-text">'+p.text+"</span></button>"},btnImgOnly:function(p){return oCONTROLS.AddToProperty(p,"classes","ui-button ui-corner-all ui-icon-only"),"<button "+oCONTROLS.basic(p)+'" role="button"><span class="ui-button-icon-primary ui-icon '+p.icon+'"></span></button>'},btnTextImg:function(p){return oCONTROLS.AddToProperty(p,"classes","ui-button ui-corner-all ui-button-text-icon-primary"),"<button "+oCONTROLS.basic(p)+'" role="button"><span class="ui-button-icon-primary ui-icon '+p.icon+'"></span><span class="ui-button-text">'+p.text+"</span></button>"},OptionList:function(p){var HTML="<select id='"+p.id+"' name= id='"+p.id+"'>";for(var i=0;i<p.Arr.length;i++){var Text=[];for(var I=0;I<p.TextI.length;I++)Text.push(p.Arr[i][p.TextI[I]]);if(typeof p.ReplaceArr!="undefined")for(var iobj=0;iobj<p.ReplaceArr.length;iobj++){var obj=p.ReplaceArr[iobj].obj.Data,Ix=p.ReplaceArr[iobj].Ix,txtIx=p.ReplaceArr[iobj].txtIx;for(var ix=0;ix<obj.length;ix++)if(Text[Ix]===obj[ix][0]){Text[Ix]=obj[ix][txtIx];break}}Text=Text.join(", "),p.SelectedID?HTML+='<option value="'+p.Arr[i][p.ValI]+(+p.Arr[i][0]==p.SelectedID?'" selected="selected"':'"')+">"+Text+"</option>":HTML+='<option value="'+p.Arr[i][p.ValI]+'">'+Text+"</option>"}return HTML+"</select>"},Set_Updatable_HTML:{mega_select_list:function(d){var HTML="<div tabindex='0' class='container medium' style='background-color:#d3d1ba;margin-top:0px;font-weight:bold;'><div class='left'>"+d.opt.SelectText+"<span style='cursor:pointer;color: #3366CC;text-decoration: underline;'></span></div>"+"<div class='right'><a id='aCancelSelectOpt' class='floatright' href='#'>Atšaukti</a></div></div>";HTML+="<div class='megaselectlistoptions'>";var listHTML="";for(var i=1;i<d.oDATA.emData.length;i+=3)listHTML+="<div class='megaselectlistcolumn'><ul>",listHTML+="<li 'tabindex=-1' data-val="+d.oDATA.emData[i][d.opt.val]+">"+d.oDATA.emData[i][d.opt.text]+"</li>",listHTML+="<li 'tabindex=-1' data-val="+d.oDATA.emData[i+1][d.opt.val]+">"+d.oDATA.emData[i+1][d.opt.text]+"</li>",listHTML+="<li 'tabindex=-1' data-val="+d.oDATA.emData[i+2][d.opt.val]+">"+d.oDATA.emData[i+2][d.opt.text]+"</li></ul></div>";HTML+=listHTML+"<div style='clear: both;'></div></div></hr>",$(d.ctrl).append(HTML);var Opt=d.ctrl.find("div.megaselectlistoptions");Opt.data("height",Opt.height()),d.ctrl.find("a.floatright").bind("click",function(){return d.fnCancel(),!1}),d.ctrl.find("li").bind("click",function(){$("#aCancelSelectOpt").remove(),li=$(this),d.ctrl.find("span:eq(0)").html(li.html()),d.ctrl.data("ctrl")[d.opt.FieldName]=li.data("val"),d.ctrl.attr("data-ctrl",JSON.stringify(d.ctrl.data("ctrl"))),typeof d.fnAfterOptClick=="function"&&d.fnAfterOptClick($(this)),d.ctrl.find("div.megaselectlistoptions").height("0px")}),d.ctrl.find("span").bind("click",function(){var Opt=d.ctrl.find(".megaselectlistoptions");Opt.height()==0?Opt.animate({height:Opt.data("height")+"px"}):Opt.animate({height:"0px"})})},lbltxt_inline_btnConfirm:function(d){d.ctrl.html(oCONTROLS.lbl(d.lblTitle)+oCONTROLS.txt(d.txt.Title,d.txt.Value,'{"Validity":"'+d.Data.Validity+'"}')+oCONTROLS.btnOKimg(d.btnTitle)),typeof d.fnPostInit!="undefined"&&d.fnPostInit(),d.ctrl.find("button").bind("click",function(e){return e.preventDefault(),oGLOBAL.ValidateCtrlsArr([d.ctrl.find("input")])&&(d.DataToSave.Data[0]=d.ctrl.find("input").val(),SERVER.update("Edit",d.DataToSave,d.Data.tblToUpdate,d.fnCallBack,"")),d.ctrl.block("Siunčiami duomenys.."),!1})},lbla_inline:function(d){d.ctrl.html(oCONTROLS.lbla_inline("divID"+d.DataToSave.id,d.lblTitle,d.Value,"")),d.ctrl.find("a").bind("click",function(e){return e.preventDefault(),SERVER.update("Edit",d.DataToSave,d.Data.tblToUpdate,d.fnCallBack,""),d.ctrl.block("Siunčiami duomenys.."),!1})}},dialog:{opt:{title:"",msg:"",autoOpen:!1,height:"auto",width:350,minWidth:300,modal:!0,show:"clip",hide:"clip",close:function(){oCONTROLS.dialog.destroy(this)}},destroy:function(t){$(t).dialog("destroy"),$("#dialog_form_tmp_id").remove()},Alert:function(opt){buttons={Gerai:function(){oCONTROLS.dialog.destroy(this)}},this.showDialog(opt,buttons)},Confirm:function(opt,fnCallBack){oCONTROLS.dialog.fnCallBack=fnCallBack,buttons={Taip:function(){d=oCONTROLS.dialog,d.fnCallBack(),d.destroy(this)},Ne:function(){oCONTROLS.dialog.destroy(this)}},this.showDialog(opt,buttons)},showDialog:function(opt,buttons){var o=$.extend(!0,{},this.opt,{buttons:buttons},opt),$dialog=$('<div id="dialog_form_tmp_id">').html(opt.msg).dialog(o).dialog("open")}}};$(function(){Em.run.next(function(){oGLOBAL.logFromStart("Ember finished."),oDATA.fnLoadNext()})}),$(window).load(function(){oGLOBAL.logFromStart("All finished."),$("body").spinner("remove")}),$(oGLOBAL.logFromStart("DOM ready."));var oDATA=Ember.Object.create({me:this,Obj:{},objNames:[],listTemplates:{},SET:function(objName,oINST){this.Obj[objName]=oINST,this.objNames.contains(objName)||this.objNames.push(objName)},GET:function(objName){return this.Obj[objName]?this.Obj[objName]:(console.warn("Object "+objName+" not downloaded yet."),!1)},GetRow:function(id,tbl){return this.GET(tbl).emData.findProperty("iD",id)},execWhenLoaded:function(objNames,fnExec,timeoutId){var tId=timeoutId?timeoutId:0,me=this,notExists=!1;objNames.forEach(function(objName){objName.slice(0,3)==="tmp"?Em.TEMPLATES[objName]||(console.log("template "+objName+" not exists"),notExists=!0):this.get("exists").call(this,objName)||(console.log("obj "+objName+" not exists"),notExists=!0)},me);if(notExists)return tId=setTimeout(function(){oDATA.execWhenLoaded(objNames,fnExec,tId)},200),!1;tId!==0&&clearTimeout(tId),fnExec()},emBuilder:function(p){oData=oDATA.GET(p.tblName),oData.emData||(oData.emData=[]);if(!p.newData)return;var d=p.newData,c=oData.Cols,f=[],n,i,y,cnt=oData.emData;for(i=0;i<c.length;i++)n=c[i].FName,f[f.length]=n.slice(0,1).toLowerCase()+n.slice(1);if(p.toAppend)for(i=0;i<d.length;i++){var e={};for(y=0;y<c.length;y++)e[f[y]]=d[i][y];e.visible=!0,p.toAppend.sort?oDATA.setToPlace(p.toAppend,e,cnt):cnt.pushObject(Em.Object.create(e))}else for(i=0;i<d.length;i++){var toReplace=cnt.findProperty("iD",d[i][0]);for(y=1;y<c.length;y++)toReplace.set(f[y],d[i][y])}return p.toAppend&&(oData.Data.length=0),cnt},setToPlace:function(toAppend,e,cnt){var col=toAppend.col,fn,before;toAppend.sort==="desc"?fn=function(index,item){if(item.get(col)<=e[col])return before=index,!1}:fn=function(index,item){if(item.get(col)>=e[col])return before=index,!1},$.each(cnt,fn),cnt.insertAt(before,Em.Object.create(e))},load:function(objName,execOnSuccess){if(!!this.get("exists").call(this,objName))throw new Error(objName+"  already loaded");var setter=this.get("SET"),emBuilder=this.get("emBuilder"),me=this;$.ajax({url:this.get("listUrl")[objName],dataType:"json",type:"POST",success:function(json){setter.call(me,objName,json[objName]);var emData=emBuilder.call(me,{newData:json[objName].Data,tblName:objName,toAppend:!0});execOnSuccess(emData)}})},exists:function(objName,mustBe){return typeof this.Obj[objName]!="undefined"},fnErr:function(objName,msg){throw msg?new Error(msg):new Error("No object '"+objName+"' in oDATA.listUrl;")},fnLoadNext:function(){oGLOBAL.logFromStart("Pradedu apdorot fnLoadNext"),this.fnLoad2({url:"Main/tabAccidents"}),oGLOBAL.logFromStart("Baigiau apdorot fnLoadNext")},executed:{},fnLoad2:function(p){if(!localStorage)throw new Error("No localStorage in Browser");var start=(new Date).getTime(),setter=this.get("SET"),emBuilder=this.get("emBuilder"),me=this,obj,finished=function(start,msg){console.warn("fnLoad2 started '"+p.url+"'. "+msg+". Time,ms:"+((new Date).getTime()-start)),p.callBack&&p.callBack()};if(this.executed[p.url])finished(start,"Second click no need to load.");else{var url=p.url,dataPars={ver:localStorage[url],tmp:localStorage[url]?!1:!0,obj:oDATA.GET(p.checkObj)?!1:!0};$.ajax({url:p.url,dataType:"json",type:"POST",data:dataPars,success:function(json){json.jsonObj&&$.each(json.jsonObj,function(objName,value){console.log("New jsonObj:"+objName),setter.call(me,objName,value),setter.call(me,objName,value),emBuilder.call(me,{newData:value.Data,tblName:objName,toAppend:!0})}),json.templates&&$.each(json.templates,function(objName,value){console.log("New template:"+objName),value?localStorage[objName]=value:value=localStorage[objName],value||console.error("No template "+objName),objName.slice(0,4)==="tmp2"?$("body").append('<script id="'+objName+'" type="text/x-tmpl">'+value+"</script>"):Em.TEMPLATES[objName]||(Em.TEMPLATES[objName]=Em.Handlebars.compile(value))}),json.Script?json.Script.File&&(console.log("Downloading js file - "+json.Script.File),$.ajaxSetup({cache:!0}),$.getScript(json.Script.File,function(){finished(start,"First click, script loaded.")})):finished(start,"First click, no script."),localStorage[url]=json.ver,oDATA.executed[url]=(new Date).getTime()}})}}});Ember.ResourceController=Ember.ArrayController.extend(Ember.ResourceAdapter,{init:function(){this._super();var me=this,url=me.get("url");url&&oDATA.fnLoad2({url:url,callBack:function(){me.tableName&&me.set("content",oDATA.GET(me.tableName).emData)}})},content:[],tableName:null,cols:null,config:null,grid:null,path:null,loadStatus:null,getByID:function(id){var r=this.get("content").findValueByID(id);if(!r)throw new Error("Didn't found arr value in getById, id -"+id);return r},setNewVal:function(p){Em.typeOf(p.newVal[0])!=="array"&&(p.newVal=[p.newVal]);var me=this;return p.fieldsToInt&&p.newVal.forEach(function(val,index){val.arrElementToInt(p.fieldsToInt)}),oDATA.emBuilder.call(me,{newData:p.newVal,tblName:me.tableName,toAppend:p.toAppend}),p.newVal},refreshContent:function(){this.get("content").length?alert("Not populated"):this.getAll(url)},getAll:function(url){var self=this;return this._resourceRequest({type:"POST",url:url}).done(function(json){self.set("loadStatus","ok");var tbl=json[self.get("tableName")];tbl.Data&&self.set("content",tbl.Data),tbl.cols&&self.set("cols",tbl.cols),tbl.config&&self.set("config",tbl.config),tbl.grid&&self.set("grid",tbl.grid),console.log("data loaded")})}});var SERVER={update3:function(p){updData=p.ctrl?$.extend({},p.pars,p.ctrl):p.pars,this.send(p.pars,p.CallBack,updData,p.url)},update2:function(p){if(!p.DataToSave)return!1;var me=this,CallBack={Success:function(resp,updData){if(updData.Action==="Delete")src=oDATA.GET(p.source).emData,obj=src.findProperty("iD",p.DataToSave.id),src.removeObject(obj);else{var Adding=p.Action==="Add"?!0:!1,Row=Adding?Em.Object.create({}):p.row;if(!Row)throw new Error("p.Row is empty");var oData=oDATA.GET(p.source),Cols=oData.Cols;if(!oData)throw new Error("p.oData is empty");Adding&&(Row.iD=resp.ResponseMsg.ID),Cols.forEach(function(col,i){var ok=!1,fieldName=col.FName.firstSmall();updData.DataToSave.Fields.forEach(function(updateField,i2){if(fieldName==updateField.firstSmall()){var newVal=updData.DataToSave.Data[i2];Row.set(fieldName,newVal),ok=!0;if(col.List){var updateCol=Cols.findObjectByProperty("IdField",fieldName);if(updateCol){var newVal1=oDATA.GET(col.List.Source).emData.findObjectByProperty("iD",newVal).MapArrToString(col.List.iText,!0);Row.set(fieldName,newVal1)}else console.warn("List field '"+updateField+"' without IdField")}}}),!ok&&Adding&&fieldName!=="iD"&&(col.Default?col.Default==="Today"?Row.set(fieldName,oGLOBAL.date.getTodayString()):col.Default==="UserName"?Row.set(fieldName,UserData.Name()):col.Default==="UserId"?Row.set(fieldName,UserData.Id()):Row.set(fieldName,col.Default):Row.set(fieldName,"")),console.log("col: "+fieldName+", ok: "+ok+", fieldValue:"+Row[fieldName])}),Adding?(Row.set("visible",!0),oData.emData.pushObject(Row)):oData.emData.findProperty("iD",Row.iD).updateTo(Row);var controller=updData.controller,emObject=updData.emObject?updData.emObject:"content";controller&&Adding&&App[controller][emObject].pushObject(Row)}Em.run.next(function(){$("img.spinner").remove()}),p.CallBackAfter&&p.CallBackAfter(Row,updData.Action)}};$.extend(p,{CallBack:CallBack}),this.update(p)},update:function(p){var url="/Update/"+p.Action,updData=p;SERVER.send(p.DataToSave,this.fnUpdated,updData,url)},send:function(JSONarg,CallFunc,updData,url,dataType){dataType||(dataType="json"),typeof JSONarg!="string"&&(JSONarg=JSON.stringify(JSONarg)),updData.Ctrl?$(updData.Ctrl).spinner({position:"center",img:"spinnerBig.gif"}):$("div.content:first").spinner({position:"center",img:"spinnerBig.gif"}),dataType||(dataType="json"),oGLOBAL.notify.msg("","Siunčiami duomenys.."),$.ajax({type:"POST",url:url,beforeSend:function(xhr){xhr.setRequestHeader("Content-type","application/json; charset=utf-8")},data:JSONarg,contentType:"application/json; charset=utf-8",dataType:dataType,erorr:function(msg){alert("Nepavyko prisijungti..")},success:function(d){CallFunc(d,updData)},complete:function(jqXHR,textStatus){$("img.spinner").remove()}})},fnUpdated:function(resp,updData){var titleFields=updData.source?oDATA.GET(updData.source).Config.titleFields:!1,Title;titleFields&&(Title=updData.row?updData.row.MapArrToString(titleFields,!0):"Duomenų keitimas."),DefMsg={Title:Title||updData.Title||"Duomenų keitimas",Error:{Add:"Nepavyko išsaugot naujų duomenų.",Edit:"Nepavyko pakeisti duomenų.",Delete:"Nepavyko ištrinti duomenų."},Success:{Add:"Duomenys sėkmingai pridėti.",Edit:"Duomenys sėkmingai pakeisti.",Delete:"Duomenys ištrinti."}};var Msg,Sign,Type,notExpires;return resp.ErrorMsg?(Type="Error",Sign="img32-warning",notExpires=!0):(Type="Success",Sign="img32-check",notExpires=!1),Msg=updData.Msg?updData.Msg[Type]:DefMsg[Type][updData.Action],Type==="Error"&&(Msg+=" Klaida:\n"+resp.ErrorMsg),updData.CallBack&&typeof updData.CallBack[Type]=="function"&&updData.CallBack[Type](resp,updData),oGLOBAL.notify.withIcon(DefMsg.Title,Msg,Sign,notExpires),!1}};(function(a){"use strict";var b=function(a,c){var d=/[^\w\-\.:]/.test(a)?new Function(b.arg+",tmpl","var _e=tmpl.encode"+b.helper+",_s='"+a.replace(b.regexp,b.func)+"';return _s;"):b.cache[a]=b.cache[a]||b(b.load(a));return c?d(c,b):function(a){return d(a,b)}};b.cache={},b.load=function(a){return document.getElementById(a).innerHTML},b.regexp=/([\s'\\])(?![^%]*%\})|(?:\{%(=|#)([\s\S]+?)%\})|(\{%)|(%\})/g,b.func=function(a,b,c,d,e,f){if(b)return{"\n":"\\n","\r":"\\r","	":"\\t"," ":" "}[a]||"\\"+a;if(c)return c==="="?"'+_e("+d+")+'":"'+("+d+"||'')+'";if(e)return"';";if(f)return"_s+='"},b.encReg=/[<>&"'\x00]/g,b.encMap={"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;","'":"&#39;"},b.encode=function(a){return String(a||"").replace(b.encReg,function(a){return b.encMap[a]||""})},b.arg="o",b.helper=",print=function(s,e){_s+=e&&(s||'')||_e(s);},include=function(s,d){_s+=tmpl(s,d);}",typeof define=="function"&&define.amd?define(function(){return b}):a.tmpl=b})(this),function(a){"use strict";var b=function(a,c,d){var e=document.createElement("img"),f,g;return e.onerror=c,e.onload=function(){g&&(!d||!d.noRevoke)&&b.revokeObjectURL(g),c(b.scale(e,d))},window.Blob&&a instanceof Blob||window.File&&a instanceof File?f=g=b.createObjectURL(a):f=a,f?(e.src=f,e):b.readFile(a,function(a){e.src=a})},c=window.createObjectURL&&window||window.URL&&URL.revokeObjectURL&&URL||window.webkitURL&&webkitURL;b.scale=function(a,b){b=b||{};var c=document.createElement("canvas"),d=a.width,e=a.height,f=Math.max((b.minWidth||d)/d,(b.minHeight||e)/e);return f>1&&(d=parseInt(d*f,10),e=parseInt(e*f,10)),f=Math.min((b.maxWidth||d)/d,(b.maxHeight||e)/e),f<1&&(d=parseInt(d*f,10),e=parseInt(e*f,10)),a.getContext||b.canvas&&c.getContext?(c.width=d,c.height=e,c.getContext("2d").drawImage(a,0,0,d,e),c):(a.width=d,a.height=e,a)},b.createObjectURL=function(a){return c?c.createObjectURL(a):!1},b.revokeObjectURL=function(a){return c?c.revokeObjectURL(a):!1},b.readFile=function(a,b){if(window.FileReader&&FileReader.prototype.readAsDataURL){var c=new FileReader;return c.onload=function(a){b(a.target.result)},c.readAsDataURL(a),c}return!1},typeof define=="function"&&define.amd?define(function(){return b}):a.loadImage=b}(this),function(a){"use strict";var b=a.HTMLCanvasElement&&a.HTMLCanvasElement.prototype,c=a.Blob&&function(){try{return Boolean(new Blob)}catch(a){return!1}}(),d=c&&a.Uint8Array&&function(){try{return(new Blob([new Uint8Array(100)])).size===100}catch(a){return!1}}(),e=a.BlobBuilder||a.WebKitBlobBuilder||a.MozBlobBuilder||a.MSBlobBuilder,f=(c||e)&&a.atob&&a.ArrayBuffer&&a.Uint8Array&&function(a){var b,f,g,h,i,j;a.split(",")[0].indexOf("base64")>=0?b=atob(a.split(",")[1]):b=decodeURIComponent(a.split(",")[1]),f=new ArrayBuffer(b.length),g=new Uint8Array(f);for(h=0;h<b.length;h+=1)g[h]=b.charCodeAt(h);return i=a.split(",")[0].split(":")[1].split(";")[0],c?new Blob([d?g:f],{type:i}):(j=new e,j.append(f),j.getBlob(i))};a.HTMLCanvasElement&&!b.toBlob&&(b.mozGetAsFile?b.toBlob=function(a,c,d){d&&b.toDataURL&&f?a(f(this.toDataURL(c,d))):a(this.mozGetAsFile("blob",c))}:b.toDataURL&&f&&(b.toBlob=function(a,b,c){a(f(this.toDataURL(b,c)))})),typeof define=="function"&&define.amd?define(function(){return f}):a.dataURLtoBlob=f}(this),function(factory){"use strict";typeof define=="function"&&define.amd?define(["jquery","load-image","bootstrap"],factory):factory(window.jQuery,window.loadImage)}(function($,loadImage){"use strict";$.extend($.fn.modal.defaults,{delegate:document,selector:null,filter:"*",index:0,href:null,preloadRange:2,offsetWidth:100,offsetHeight:200,canvas:!1,slideshow:0,imageClickDivision:.5});var originalShow=$.fn.modal.Constructor.prototype.show,originalHide=$.fn.modal.Constructor.prototype.hide;$.extend($.fn.modal.Constructor.prototype,{initLinks:function(){var $this=this,options=this.options,selector=options.selector||"a[data-target="+options.target+"]";this.$links=$(options.delegate).find(selector).filter(options.filter).each(function(index){$this.getUrl(this)===options.href&&(options.index=index)}),this.$links[options.index]||(options.index=0)},getUrl:function(element){return element.href||$(element).data("href")},getDownloadUrl:function(element){return $(element).data("download")},startSlideShow:function(){var $this=this;this.options.slideshow&&(this._slideShow=window.setTimeout(function(){$this.next()},this.options.slideshow))},stopSlideShow:function(){window.clearTimeout(this._slideShow)},toggleSlideShow:function(){var node=this.$element.find(".modal-slideshow");this.options.slideshow?(this.options.slideshow=0,this.stopSlideShow()):(this.options.slideshow=node.data("slideshow")||5e3,this.startSlideShow()),node.find("i").toggleClass("icon-play icon-pause")},preloadImages:function(){var options=this.options,range=options.index+options.preloadRange+1,link,i;for(i=options.index-options.preloadRange;i<range;i+=1)link=this.$links[i],link&&i!==options.index&&$("<img>").prop("src",this.getUrl(link))},loadImage:function(){var $this=this,modal=this.$element,index=this.options.index,url=this.getUrl(this.$links[index]),download=this.getDownloadUrl(this.$links[index]),oldImg;this.abortLoad(),this.stopSlideShow(),modal.trigger("beforeLoad"),this._loadingTimeout=window.setTimeout(function(){modal.addClass("modal-loading")},100),oldImg=modal.find(".modal-image").children().removeClass("in"),window.setTimeout(function(){oldImg.remove()},3e3),modal.find(".modal-title").text(this.$links[index].title),modal.find(".modal-download").prop("href",download||url),this._loadingImage=loadImage(url,function(img){$this.img=img,window.clearTimeout($this._loadingTimeout),modal.removeClass("modal-loading"),modal.trigger("load"),$this.showImage(img),$this.startSlideShow()},this._loadImageOptions),this.preloadImages()},showImage:function(img){var modal=this.$element,transition=$.support.transition&&modal.hasClass("fade"),method=transition?modal.animate:modal.css,modalImage=modal.find(".modal-image"),clone,forceReflow;modalImage.css({width:img.width,height:img.height}),modal.find(".modal-title").css({width:Math.max(img.width,380)}),transition&&(clone=modal.clone().hide().appendTo(document.body)),$(window).width()>767?method.call(modal.stop(),{"margin-top":-((clone||modal).outerHeight()/2),"margin-left":-((clone||modal).outerWidth()/2)}):modal.css({top:($(window).height()-(clone||modal).outerHeight())/2}),clone&&clone.remove(),modalImage.append(img),forceReflow=img.offsetWidth,modal.trigger("display"),transition?modal.is(":visible")?$(img).on($.support.transition.end,function(e){e.target===img&&($(img).off($.support.transition.end),modal.trigger("displayed"))}).addClass("in"):($(img).addClass("in"),modal.one("shown",function(){modal.trigger("displayed")})):($(img).addClass("in"),modal.trigger("displayed"))},abortLoad:function(){this._loadingImage&&(this._loadingImage.onload=this._loadingImage.onerror=null),window.clearTimeout(this._loadingTimeout)},prev:function(){var options=this.options;options.index-=1,options.index<0&&(options.index=this.$links.length-1),this.loadImage()},next:function(){var options=this.options;options.index+=1,options.index>this.$links.length-1&&(options.index=0),this.loadImage()},keyHandler:function(e){switch(e.which){case 37:case 38:e.preventDefault(),this.prev();break;case 39:case 40:e.preventDefault(),this.next()}},wheelHandler:function(e){e.preventDefault(),e=e.originalEvent,this._wheelCounter=this._wheelCounter||0,this._wheelCounter+=e.wheelDelta||e.detail||0;if(e.wheelDelta&&this._wheelCounter>=120||!e.wheelDelta&&this._wheelCounter<0)this.prev(),this._wheelCounter=0;else if(e.wheelDelta&&this._wheelCounter<=-120||!e.wheelDelta&&this._wheelCounter>0)this.next(),this._wheelCounter=0},initGalleryEvents:function(){var $this=this,modal=this.$element;modal.find(".modal-image").on("click.modal-gallery",function(e){var modalImage=$(this);$this.$links.length===1?$this.hide():(e.pageX-modalImage.offset().left)/modalImage.width()<$this.options.imageClickDivision?$this.prev(e):$this.next(e)}),modal.find(".modal-prev").on("click.modal-gallery",function(e){$this.prev(e)}),modal.find(".modal-next").on("click.modal-gallery",function(e){$this.next(e)}),modal.find(".modal-slideshow").on("click.modal-gallery",function(e){$this.toggleSlideShow(e)}),$(document).on("keydown.modal-gallery",function(e){$this.keyHandler(e)}).on("mousewheel.modal-gallery, DOMMouseScroll.modal-gallery",function(e){$this.wheelHandler(e)})},destroyGalleryEvents:function(){var modal=this.$element;this.abortLoad(),this.stopSlideShow(),modal.find(".modal-image, .modal-prev, .modal-next, .modal-slideshow").off("click.modal-gallery"),$(document).off("keydown.modal-gallery").off("mousewheel.modal-gallery, DOMMouseScroll.modal-gallery")},show:function(){if(!this.isShown&&this.$element.hasClass("modal-gallery")){var modal=this.$element,options=this.options,windowWidth=$(window).width(),windowHeight=$(window).height();modal.hasClass("modal-fullscreen")?(this._loadImageOptions={maxWidth:windowWidth,maxHeight:windowHeight,canvas:options.canvas},modal.hasClass("modal-fullscreen-stretch")&&(this._loadImageOptions.minWidth=windowWidth,this._loadImageOptions.minHeight=windowHeight)):this._loadImageOptions={maxWidth:windowWidth-options.offsetWidth,maxHeight:windowHeight-options.offsetHeight,canvas:options.canvas},windowWidth>767?modal.css({"margin-top":-(modal.outerHeight()/2),"margin-left":-(modal.outerWidth()/2)}):modal.css({top:($(window).height()-modal.outerHeight())/2}),this.initGalleryEvents(),this.initLinks(),this.$links.length&&(modal.find(".modal-slideshow, .modal-prev, .modal-next").toggle(this.$links.length!==1),modal.toggleClass("modal-single",this.$links.length===1),this.loadImage())}originalShow.apply(this,arguments)},hide:function(){this.isShown&&this.$element.hasClass("modal-gallery")&&(this.options.delegate=document,this.options.href=null,this.destroyGalleryEvents()),originalHide.apply(this,arguments)}}),$(function(){$(document.body).on("click.modal-gallery.data-api",'[data-toggle="modal-gallery"]',function(e){var $this=$(this),options=$this.data(),modal=$(options.target),data=modal.data("modal"),link;data||(options=$.extend(modal.data(),options)),options.selector||(options.selector="a[data-gallery=gallery]"),link=$(e.target).closest(options.selector),link.length&&modal.length&&(e.preventDefault(),options.href=link.prop("href")||link.data("href"),options.delegate=link[0]!==this?this:document,data&&$.extend(data.options,options),modal.modal(options))})})}),function(factory){"use strict";typeof define=="function"&&define.amd?define(["jquery"],factory):factory(window.jQuery)}(function($){"use strict";var counter=0;$.ajaxTransport("iframe",function(options){if(options.async&&(options.type==="POST"||options.type==="GET")){var form,iframe;return{send:function(_,completeCallback){form=$('<form style="display:none;"></form>'),form.attr("accept-charset",options.formAcceptCharset),iframe=$('<iframe src="javascript:false;" name="iframe-transport-'+(counter+=1)+'"></iframe>').bind("load",function(){var fileInputClones,paramNames=$.isArray(options.paramName)?options.paramName:[options.paramName];iframe.unbind("load").bind("load",function(){var response;try{response=iframe.contents();if(!response.length||!response[0].firstChild)throw new Error}catch(e){response=undefined}completeCallback(200,"success",{iframe:response}),$('<iframe src="javascript:false;"></iframe>').appendTo(form),form.remove()}),form.prop("target",iframe.prop("name")).prop("action",options.url).prop("method",options.type),options.formData&&$.each(options.formData,function(index,field){$('<input type="hidden"/>').prop("name",field.name).val(field.value).appendTo(form)}),options.fileInput&&options.fileInput.length&&options.type==="POST"&&(fileInputClones=options.fileInput.clone(),options.fileInput.after(function(index){return fileInputClones[index]}),options.paramName&&options.fileInput.each(function(index){$(this).prop("name",paramNames[index]||options.paramName)}),form.append(options.fileInput).prop("enctype","multipart/form-data").prop("encoding","multipart/form-data")),form.submit(),fileInputClones&&fileInputClones.length&&options.fileInput.each(function(index,input){var clone=$(fileInputClones[index]);$(input).prop("name",clone.prop("name")),clone.replaceWith(input)})}),form.append(iframe).appendTo(document.body)},abort:function(){iframe&&iframe.unbind("load").prop("src","javascript".concat(":false;")),form&&form.remove()}}}}),$.ajaxSetup({converters:{"iframe text":function(iframe){return $(iframe[0].body).text()},"iframe json":function(iframe){return $.parseJSON($(iframe[0].body).text())},"iframe html":function(iframe){return $(iframe[0].body).html()},"iframe script":function(iframe){return $.globalEval($(iframe[0].body).text())}}})}),function(factory){"use strict";typeof define=="function"&&define.amd?define(["jquery","jquery.ui.widget"],factory):factory(window.jQuery)}(function($){"use strict";$.support.xhrFileUpload=!!window.XMLHttpRequestUpload&&!!window.FileReader,$.support.xhrFormDataFileUpload=!!window.FormData,$.widget("blueimp.fileupload",{options:{namespace:undefined,dropZone:$(document),pasteZone:$(document),fileInput:undefined,replaceFileInput:!0,paramName:undefined,singleFileUploads:!0,limitMultiFileUploads:undefined,sequentialUploads:!1,limitConcurrentUploads:undefined,forceIframeTransport:!1,redirect:undefined,redirectParamName:undefined,postMessage:undefined,multipart:!0,maxChunkSize:undefined,uploadedBytes:undefined,recalculateProgress:!0,progressInterval:100,bitrateInterval:500,formData:function(form){return form.serializeArray()},add:function(e,data){data.submit()},processData:!1,contentType:!1,cache:!1},_refreshOptionsList:["namespace","fileInput","dropZone","pasteZone","multipart","forceIframeTransport"],_BitrateTimer:function(){this.timestamp=+(new Date),this.loaded=0,this.bitrate=0,this.getBitrate=function(now,loaded,interval){var timeDiff=now-this.timestamp;if(!this.bitrate||!interval||timeDiff>interval)this.bitrate=(loaded-this.loaded)*(1e3/timeDiff)*8,this.loaded=loaded,this.timestamp=now;return this.bitrate}},_isXHRUpload:function(options){return!options.forceIframeTransport&&(!options.multipart&&$.support.xhrFileUpload||$.support.xhrFormDataFileUpload)},_getFormData:function(options){var formData;return typeof options.formData=="function"?options.formData(options.form):$.isArray(options.formData)?options.formData:options.formData?(formData=[],$.each(options.formData,function(name,value){formData.push({name:name,value:value})}),formData):[]},_getTotal:function(files){var total=0;return $.each(files,function(index,file){total+=file.size||1}),total},_onProgress:function(e,data){if(e.lengthComputable){var now=+(new Date),total,loaded;if(data._time&&data.progressInterval&&now-data._time<data.progressInterval&&e.loaded!==e.total)return;data._time=now,total=data.total||this._getTotal(data.files),loaded=parseInt(e.loaded/e.total*(data.chunkSize||total),10)+(data.uploadedBytes||0),this._loaded+=loaded-(data.loaded||data.uploadedBytes||0),data.lengthComputable=!0,data.loaded=loaded,data.total=total,data.bitrate=data._bitrateTimer.getBitrate(now,loaded,data.bitrateInterval),this._trigger("progress",e,data),this._trigger("progressall",e,{lengthComputable:!0,loaded:this._loaded,total:this._total,bitrate:this._bitrateTimer.getBitrate(now,this._loaded,data.bitrateInterval)})}},_initProgressListener:function(options){var that=this,xhr=options.xhr?options.xhr():$.ajaxSettings.xhr();xhr.upload&&($(xhr.upload).bind("progress",function(e){var oe=e.originalEvent;e.lengthComputable=oe.lengthComputable,e.loaded=oe.loaded,e.total=oe.total,that._onProgress(e,options)}),options.xhr=function(){return xhr})},_initXHRData:function(options){var formData,file=options.files[0],multipart=options.multipart||!$.support.xhrFileUpload,paramName=options.paramName[0];if(!multipart||options.blob)options.headers=$.extend(options.headers,{"X-File-Name":file.name,"X-File-Type":file.type,"X-File-Size":file.size}),options.blob?multipart||(options.contentType="application/octet-stream",options.data=options.blob):(options.contentType=file.type,options.data=file);multipart&&$.support.xhrFormDataFileUpload&&(options.postMessage?(formData=this._getFormData(options),options.blob?formData.push({name:paramName,value:options.blob}):$.each(options.files,function(index,file){formData.push({name:options.paramName[index]||paramName,value:file})})):(options.formData instanceof FormData?formData=options.formData:(formData=new FormData,$.each(this._getFormData(options),function(index,field){formData.append(field.name,field.value)})),options.blob?formData.append(paramName,options.blob,file.name):$.each(options.files,function(index,file){file instanceof Blob&&formData.append(options.paramName[index]||paramName,file,file.name)})),options.data=formData),options.blob=null},_initIframeSettings:function(options){options.dataType="iframe "+(options.dataType||""),options.formData=this._getFormData(options),options.redirect&&$("<a></a>").prop("href",options.url).prop("host")!==location.host&&options.formData.push({name:options.redirectParamName||"redirect",value:options.redirect})},_initDataSettings:function(options){this._isXHRUpload(options)?(this._chunkedUpload(options,!0)||(options.data||this._initXHRData(options),this._initProgressListener(options)),options.postMessage&&(options.dataType="postmessage "+(options.dataType||""))):this._initIframeSettings(options,"iframe")},_getParamName:function(options){var fileInput=$(options.fileInput),paramName=options.paramName;return paramName?$.isArray(paramName)||(paramName=[paramName]):(paramName=[],fileInput.each(function(){var input=$(this),name=input.prop("name")||"files[]",i=(input.prop("files")||[1]).length;while(i)paramName.push(name),i-=1}),paramName.length||(paramName=[fileInput.prop("name")||"files[]"])),paramName},_initFormSettings:function(options){if(!options.form||!options.form.length)options.form=$(options.fileInput.prop("form")),options.form.length||(options.form=$(this.options.fileInput.prop("form")));options.paramName=this._getParamName(options),options.url||(options.url=options.form.prop("action")||location.href),options.type=(options.type||options.form.prop("method")||"").toUpperCase(),options.type!=="POST"&&options.type!=="PUT"&&(options.type="POST"),options.formAcceptCharset||(options.formAcceptCharset=options.form.attr("accept-charset"))},_getAJAXSettings:function(data){var options=$.extend({},this.options,data);return this._initFormSettings(options),this._initDataSettings(options),options},_enhancePromise:function(promise){return promise.success=promise.done,promise.error=promise.fail,promise.complete=promise.always,promise},_getXHRPromise:function(resolveOrReject,context,args){var dfd=$.Deferred(),promise=dfd.promise();return context=context||this.options.context||promise,resolveOrReject===!0?dfd.resolveWith(context,args):resolveOrReject===!1&&dfd.rejectWith(context,args),promise.abort=dfd.promise,this._enhancePromise(promise)},_chunkedUpload:function(options,testOnly){var that=this,file=options.files[0],fs=file.size,ub=options.uploadedBytes=options.uploadedBytes||0,mcs=options.maxChunkSize||fs,slice=file.webkitSlice||file.mozSlice||file.slice,upload,n,jqXHR,pipe;return!(this._isXHRUpload(options)&&slice&&(ub||mcs<fs))||options.data?!1:testOnly?!0:ub>=fs?(file.error="uploadedBytes",this._getXHRPromise(!1,options.context,[null,"error",file.error])):(n=Math.ceil((fs-ub)/mcs),upload=function(i){return i?upload(i-=1).pipe(function(){var o=$.extend({},options);return o.blob=slice.call(file,ub+i*mcs,ub+(i+1)*mcs),o.chunkIndex=i,o.chunksNumber=n,o.chunkSize=o.blob.size,that._initXHRData(o),that._initProgressListener(o),jqXHR=($.ajax(o)||that._getXHRPromise(!1,o.context)).done(function(){o.loaded||that._onProgress($.Event("progress",{lengthComputable:!0,loaded:o.chunkSize,total:o.chunkSize}),o),options.uploadedBytes=o.uploadedBytes+=o.chunkSize}),jqXHR}):that._getXHRPromise(!0,options.context)},pipe=upload(n),pipe.abort=function(){return jqXHR.abort()},this._enhancePromise(pipe))},_beforeSend:function(e,data){this._active===0&&(this._trigger("start"),this._bitrateTimer=new this._BitrateTimer),this._active+=1,this._loaded+=data.uploadedBytes||0,this._total+=this._getTotal(data.files)},_onDone:function(result,textStatus,jqXHR,options){this._isXHRUpload(options)||this._onProgress($.Event("progress",{lengthComputable:!0,loaded:1,total:1}),options),options.result=result,options.textStatus=textStatus,options.jqXHR=jqXHR,this._trigger("done",null,options)},_onFail:function(jqXHR,textStatus,errorThrown,options){options.jqXHR=jqXHR,options.textStatus=textStatus,options.errorThrown=errorThrown,this._trigger("fail",null,options),options.recalculateProgress&&(this._loaded-=options.loaded||options.uploadedBytes||0,this._total-=options.total||this._getTotal(options.files))},_onAlways:function(jqXHRorResult,textStatus,jqXHRorError,options){this._active-=1,options.textStatus=textStatus,jqXHRorError&&jqXHRorError.always?(options.jqXHR=jqXHRorError,options.result=jqXHRorResult):(options.jqXHR=jqXHRorResult,options.errorThrown=jqXHRorError),this._trigger("always",null,options),this._active===0&&(this._trigger("stop"),this._loaded=this._total=0,this._bitrateTimer=null)},_onSend:function(e,data){var that=this,jqXHR,slot,pipe,options=that._getAJAXSettings(data),send=function(resolve,args){return that._sending+=1,options._bitrateTimer=new that._BitrateTimer,jqXHR=jqXHR||(resolve!==!1&&that._trigger("send",e,options)!==!1&&(that._chunkedUpload(options)||$.ajax(options))||that._getXHRPromise(!1,options.context,args)).done(function(result,textStatus,jqXHR){that._onDone(result,textStatus,jqXHR,options)}).fail(function(jqXHR,textStatus,errorThrown){that._onFail(jqXHR,textStatus,errorThrown,options)}).always(function(jqXHRorResult,textStatus,jqXHRorError){that._sending-=1,that._onAlways(jqXHRorResult,textStatus,jqXHRorError,options);if(options.limitConcurrentUploads&&options.limitConcurrentUploads>that._sending){var nextSlot=that._slots.shift(),isPending;while(nextSlot){isPending=nextSlot.state?nextSlot.state()==="pending":!nextSlot.isRejected();if(isPending){nextSlot.resolve();break}nextSlot=that._slots.shift()}}}),jqXHR};return this._beforeSend(e,options),this.options.sequentialUploads||this.options.limitConcurrentUploads&&this.options.limitConcurrentUploads<=this._sending?(this.options.limitConcurrentUploads>1?(slot=$.Deferred(),this._slots.push(slot),pipe=slot.pipe(send)):pipe=this._sequence=this._sequence.pipe(send,send),pipe.abort=function(){var args=[undefined,"abort","abort"];return jqXHR?jqXHR.abort():(slot&&slot.rejectWith(pipe,args),send(!1,args))},this._enhancePromise(pipe)):send()},_onAdd:function(e,data){var that=this,result=!0,options=$.extend({},this.options,data),limit=options.limitMultiFileUploads,paramName=this._getParamName(options),paramNameSet,paramNameSlice,fileSet,i;if(!options.singleFileUploads&&!limit||!this._isXHRUpload(options))fileSet=[data.files],paramNameSet=[paramName];else if(!options.singleFileUploads&&limit){fileSet=[],paramNameSet=[];for(i=0;i<data.files.length;i+=limit)fileSet.push(data.files.slice(i,i+limit)),paramNameSlice=paramName.slice(i,i+limit),paramNameSlice.length||(paramNameSlice=paramName),paramNameSet.push(paramNameSlice)}else paramNameSet=paramName;return data.originalFiles=data.files,$.each(fileSet||data.files,function(index,element){var newData=$.extend({},data);return newData.files=fileSet?element:[element],newData.paramName=paramNameSet[index],newData.submit=function(){return newData.jqXHR=this.jqXHR=that._trigger("submit",e,this)!==!1&&that._onSend(e,this),this.jqXHR},result=that._trigger("add",e,newData)}),result},_replaceFileInput:function(input){var inputClone=input.clone(!0);$("<form></form>").append(inputClone)[0].reset(),input.after(inputClone).detach(),$.cleanData(input.unbind("remove")),this.options.fileInput=this.options.fileInput.map(function(i,el){return el===input[0]?inputClone[0]:el}),input[0]===this.element[0]&&(this.element=inputClone)},_handleFileTreeEntry:function(entry,path){var that=this,dfd=$.Deferred(),errorHandler=function(e){e&&!e.entry&&(e.entry=entry),dfd.resolve([e])},dirReader;return path=path||"",entry.isFile?entry.file(function(file){file.relativePath=path,dfd.resolve(file)},errorHandler):entry.isDirectory?(dirReader=entry.createReader(),dirReader.readEntries(function(entries){that._handleFileTreeEntries(entries,path+entry.name+"/").done(function(files){dfd.resolve(files)}).fail(errorHandler)},errorHandler)):dfd.resolve([]),dfd.promise()},_handleFileTreeEntries:function(entries,path){var that=this;return $.when.apply($,$.map(entries,function(entry){return that._handleFileTreeEntry(entry,path)})).pipe(function(){return Array.prototype.concat.apply([],arguments)})},_getDroppedFiles:function(dataTransfer){dataTransfer=dataTransfer||{};var items=dataTransfer.items;return items&&items.length&&(items[0].webkitGetAsEntry||items[0].getAsEntry)?this._handleFileTreeEntries($.map(items,function(item){return item.webkitGetAsEntry?item.webkitGetAsEntry():item.getAsEntry()})):$.Deferred().resolve($.makeArray(dataTransfer.files)).promise()},_getSingleFileInputFiles:function(fileInput){fileInput=$(fileInput);var entries=fileInput.prop("webkitEntries")||fileInput.prop("entries"),files,value;if(entries&&entries.length)return this._handleFileTreeEntries(entries);files=$.makeArray(fileInput.prop("files"));if(!files.length){value=fileInput.prop("value");if(!value)return $.Deferred().resolve([]).promise();files=[{name:value.replace(/^.*\\/,"")}]}return $.Deferred().resolve(files).promise()},_getFileInputFiles:function(fileInput){return fileInput instanceof $&&fileInput.length!==1?$.when.apply($,$.map(fileInput,this._getSingleFileInputFiles)).pipe(function(){return Array.prototype.concat.apply([],arguments)}):this._getSingleFileInputFiles(fileInput)},_onChange:function(e){var that=e.data.fileupload,data={fileInput:$(e.target),form:$(e.target.form)};that._getFileInputFiles(data.fileInput).always(function(files){data.files=files,that.options.replaceFileInput&&that._replaceFileInput(data.fileInput),that._trigger("change",e,data)!==!1&&that._onAdd(e,data)})},_onPaste:function(e){var that=e.data.fileupload,cbd=e.originalEvent.clipboardData,items=cbd&&cbd.items||[],data={files:[]};$.each(items,function(index,item){var file=item.getAsFile&&item.getAsFile();file&&data.files.push(file)});if(that._trigger("paste",e,data)===!1||that._onAdd(e,data)===!1)return!1},_onDrop:function(e){e.preventDefault();var that=e.data.fileupload,dataTransfer=e.dataTransfer=e.originalEvent.dataTransfer,data={};that._getDroppedFiles(dataTransfer).always(function(files){data.files=files,that._trigger("drop",e,data)!==!1&&that._onAdd(e,data)})},_onDragOver:function(e){var that=e.data.fileupload,dataTransfer=e.dataTransfer=e.originalEvent.dataTransfer;if(that._trigger("dragover",e)===!1)return!1;dataTransfer&&(dataTransfer.dropEffect="copy"),e.preventDefault()},_initEventHandlers:function(){var ns=this.options.namespace;this._isXHRUpload(this.options)&&(this.options.dropZone.bind("dragover."+ns,{fileupload:this},this._onDragOver).bind("drop."+ns,{fileupload:this},this._onDrop),this.options.pasteZone.bind("paste."+ns,{fileupload:this},this._onPaste)),this.options.fileInput.bind("change."+ns,{fileupload:this},this._onChange)},_destroyEventHandlers:function(){var ns=this.options.namespace;this.options.dropZone.unbind("dragover."+ns,this._onDragOver).unbind("drop."+ns,this._onDrop),this.options.pasteZone.unbind("paste."+ns,this._onPaste),this.options.fileInput.unbind("change."+ns,this._onChange)},_setOption:function(key,value){var refresh=$.inArray(key,this._refreshOptionsList)!==-1;refresh&&this._destroyEventHandlers(),$.Widget.prototype._setOption.call(this,key,value),refresh&&(this._initSpecialOptions(),this._initEventHandlers())},_initSpecialOptions:function(){var options=this.options;options.fileInput===undefined?options.fileInput=this.element.is('input[type="file"]')?this.element:this.element.find('input[type="file"]'):options.fileInput instanceof $||(options.fileInput=$(options.fileInput)),options.dropZone instanceof $||(options.dropZone=$(options.dropZone)),options.pasteZone instanceof $||(options.pasteZone=$(options.pasteZone))},_create:function(){var options=this.options;$.extend(options,$(this.element[0].cloneNode(!1)).data()),options.namespace=options.namespace||this.widgetName,this._initSpecialOptions(),this._slots=[],this._sequence=this._getXHRPromise(!0),this._sending=this._active=this._loaded=this._total=0,this._initEventHandlers()},destroy:function(){this._destroyEventHandlers(),$.Widget.prototype.destroy.call(this)},enable:function(){var wasDisabled=!1;this.options.disabled&&(wasDisabled=!0),$.Widget.prototype.enable.call(this),wasDisabled&&this._initEventHandlers()},disable:function(){this.options.disabled||this._destroyEventHandlers(),$.Widget.prototype.disable.call(this)},add:function(data){var that=this;if(!data||this.options.disabled)return;data.fileInput&&!data.files?this._getFileInputFiles(data.fileInput).always(function(files){data.files=files,that._onAdd(null,data)}):(data.files=$.makeArray(data.files),this._onAdd(null,data))},send:function(data){if(data&&!this.options.disabled){if(data.fileInput&&!data.files){var that=this,dfd=$.Deferred(),promise=dfd.promise(),jqXHR,aborted;return promise.abort=function(){return aborted=!0,jqXHR?jqXHR.abort():(dfd.reject(null,"abort","abort"),promise)},this._getFileInputFiles(data.fileInput).always(function(files){if(aborted)return;data.files=files,jqXHR=that._onSend(null,data).then(function(result,textStatus,jqXHR){dfd.resolve(result,textStatus,jqXHR)},function(jqXHR,textStatus,errorThrown){dfd.reject(jqXHR,textStatus,errorThrown)})}),this._enhancePromise(promise)}data.files=$.makeArray(data.files);if(data.files.length)return this._onSend(null,data)}return this._getXHRPromise(!1,data&&data.context)}})}),function(factory){"use strict";typeof define=="function"&&define.amd?define(["jquery","load-image","canvas-to-blob","./jquery.fileupload"],factory):factory(window.jQuery,window.loadImage)}(function($,loadImage){"use strict";$.widget("blueimpFP.fileupload",$.blueimp.fileupload,{options:{process:[],add:function(e,data){$(this).fileupload("process",data).done(function(){data.submit()})}},processActions:{load:function(data,options){var that=this,file=data.files[data.index],dfd=$.Deferred();return window.HTMLCanvasElement&&window.HTMLCanvasElement.prototype.toBlob&&($.type(options.maxFileSize)!=="number"||file.size<options.maxFileSize)&&(!options.fileTypes||options.fileTypes.test(file.type))?loadImage(file,function(canvas){data.canvas=canvas,dfd.resolveWith(that,[data])},{canvas:!0}):dfd.rejectWith(that,[data]),dfd.promise()},resize:function(data,options){if(data.canvas){var canvas=loadImage.scale(data.canvas,options);if(canvas.width!==data.canvas.width||canvas.height!==data.canvas.height)data.canvas=canvas,data.processed=!0}return data},save:function(data,options){if(!data.canvas||!data.processed)return data;var that=this,file=data.files[data.index],name=file.name,dfd=$.Deferred(),callback=function(blob){blob.name||(file.type===blob.type?blob.name=file.name:file.name&&(blob.name=file.name.replace(/\..+$/,"."+blob.type.substr(6)))),data.files[data.index]=blob,dfd.resolveWith(that,[data])};return data.canvas.mozGetAsFile?callback(data.canvas.mozGetAsFile(/^image\/(jpeg|png)$/.test(file.type)&&name||(name&&name.replace(/\..+$/,"")||"blob")+".png",file.type)):data.canvas.toBlob(callback,file.type),dfd.promise()}},_processFile:function(files,index,options){var that=this,dfd=$.Deferred().resolveWith(that,[{files:files,index:index}]),chain=dfd.promise();return that._processing+=1,$.each(options.process,function(i,settings){chain=chain.pipe(function(data){return that.processActions[settings.action].call(this,data,settings)})}),chain.always(function(){that._processing-=1,that._processing===0&&that.element.removeClass("fileupload-processing")}),that._processing===1&&that.element.addClass("fileupload-processing"),chain},process:function(data){var that=this,options=$.extend({},this.options,data);return options.process&&options.process.length&&this._isXHRUpload(options)&&$.each(data.files,function(index,file){that._processingQueue=that._processingQueue.pipe(function(){var dfd=$.Deferred();return that._processFile(data.files,index,options).always(function(){dfd.resolveWith(that)}),dfd.promise()})}),this._processingQueue},_create:function(){$.blueimp.fileupload.prototype._create.call(this),this._processing=0,this._processingQueue=$.Deferred().resolveWith(this).promise()}})}),function(factory){"use strict";typeof define=="function"&&define.amd?define(["jquery","tmpl","load-image","./jquery.fileupload-fp"],factory):factory(window.jQuery,window.tmpl,window.loadImage)}(function($,tmpl,loadImage){"use strict";var parentWidget=($.blueimpFP||$.blueimp).fileupload;$.widget("blueimpUI.fileupload",parentWidget,{options:{autoUpload:!1,maxNumberOfFiles:undefined,maxFileSize:undefined,minFileSize:undefined,acceptFileTypes:/.+$/i,previewSourceFileTypes:/^image\/(gif|jpeg|png)$/,previewSourceMaxFileSize:5e6,previewMaxWidth:80,previewMaxHeight:80,previewAsCanvas:!0,uploadTemplateId:"template-upload",downloadTemplateId:"template-download",filesContainer:undefined,prependFiles:!1,dataType:"json",add:function(e,data){var that=$(this).data("fileupload"),options=that.options,files=data.files;$(this).fileupload("process",data).done(function(){that._adjustMaxNumberOfFiles(-files.length),data.maxNumberOfFilesAdjusted=!0,data.files.valid=data.isValidated=that._validate(files),data.context=that._renderUpload(files).data("data",data),options.filesContainer[options.prependFiles?"prepend":"append"](data.context),that._renderPreviews(files,data.context),that._forceReflow(data.context),that._transition(data.context).done(function(){that._trigger("added",e,data)!==!1&&(options.autoUpload||data.autoUpload)&&data.autoUpload!==!1&&data.isValidated&&data.submit()})})},send:function(e,data){var that=$(this).data("fileupload");if(!data.isValidated){data.maxNumberOfFilesAdjusted||(that._adjustMaxNumberOfFiles(-data.files.length),data.maxNumberOfFilesAdjusted=!0);if(!that._validate(data.files))return!1}return data.context&&data.dataType&&data.dataType.substr(0,6)==="iframe"&&data.context.find(".progress").addClass(!$.support.transition&&"progress-animated").attr("aria-valuenow",100).find(".bar").css("width","100%"),that._trigger("sent",e,data)},done:function(e,data){var that=$(this).data("fileupload"),template;data.context?data.context.each(function(index){var file=$.isArray(data.result)&&data.result[index]||{error:"emptyResult"};file.error&&that._adjustMaxNumberOfFiles(1),that._transition($(this)).done(function(){var node=$(this);template=that._renderDownload([file]).replaceAll(node),that._forceReflow(template),that._transition(template).done(function(){data.context=$(this),that._trigger("completed",e,data)})})}):($.isArray(data.result)&&($.each(data.result,function(index,file){data.maxNumberOfFilesAdjusted&&file.error?that._adjustMaxNumberOfFiles(1):!data.maxNumberOfFilesAdjusted&&!file.error&&that._adjustMaxNumberOfFiles(-1)}),data.maxNumberOfFilesAdjusted=!0),template=that._renderDownload(data.result).appendTo(that.options.filesContainer),that._forceReflow(template),that._transition(template).done(function(){data.context=$(this),that._trigger("completed",e,data)}))},fail:function(e,data){var that=$(this).data("fileupload"),template;data.maxNumberOfFilesAdjusted&&that._adjustMaxNumberOfFiles(data.files.length),data.context?data.context.each(function(index){if(data.errorThrown!=="abort"){var file=data.files[index];file.error=file.error||data.errorThrown||!0,that._transition($(this)).done(function(){var node=$(this);template=that._renderDownload([file]).replaceAll(node),that._forceReflow(template),that._transition(template).done(function(){data.context=$(this),that._trigger("failed",e,data)})})}else that._transition($(this)).done(function(){$(this).remove(),that._trigger("failed",e,data)})}):data.errorThrown!=="abort"?(data.context=that._renderUpload(data.files).appendTo(that.options.filesContainer).data("data",data),that._forceReflow(data.context),that._transition(data.context).done(function(){data.context=$(this),that._trigger("failed",e,data)})):that._trigger("failed",e,data)},progress:function(e,data){if(data.context){var progress=parseInt(data.loaded/data.total*100,10);data.context.find(".progress").attr("aria-valuenow",progress).find(".bar").css("width",progress+"%")}},progressall:function(e,data){var $this=$(this),progress=parseInt(data.loaded/data.total*100,10),globalProgressNode=$this.find(".fileupload-progress"),extendedProgressNode=globalProgressNode.find(".progress-extended");extendedProgressNode.length&&extendedProgressNode.html($this.data("fileupload")._renderExtendedProgress(data)),globalProgressNode.find(".progress").attr("aria-valuenow",progress).find(".bar").css("width",progress+"%")},start:function(e){var that=$(this).data("fileupload");that._transition($(this).find(".fileupload-progress")).done(function(){that._trigger("started",e)})},stop:function(e){var that=$(this).data("fileupload");that._transition($(this).find(".fileupload-progress")).done(function(){$(this).find(".progress").attr("aria-valuenow","0").find(".bar").css("width","0%"),$(this).find(".progress-extended").html("&nbsp;"),that._trigger("stopped",e)})},destroy:function(e,data){var that=$(this).data("fileupload");data.url&&($.ajax(data),that._adjustMaxNumberOfFiles(1)),that._transition(data.context).done(function(){$(this).remove(),that._trigger("destroyed",e,data)})}},_enableDragToDesktop:function(){var link=$(this),url=link.prop("href"),name=link.prop("download"),type="application/octet-stream";link.bind("dragstart",function(e){try{e.originalEvent.dataTransfer.setData("DownloadURL",[type,name,url].join(":"))}catch(err){}})},_adjustMaxNumberOfFiles:function(operand){typeof this.options.maxNumberOfFiles=="number"&&(this.options.maxNumberOfFiles+=operand,this.options.maxNumberOfFiles<1?this._disableFileInputButton():this._enableFileInputButton())},_formatFileSize:function(bytes){return typeof bytes!="number"?"":bytes>=1e9?(bytes/1e9).toFixed(2)+" GB":bytes>=1e6?(bytes/1e6).toFixed(2)+" MB":(bytes/1e3).toFixed(2)+" KB"},_formatBitrate:function(bits){return typeof bits!="number"?"":bits>=1e9?(bits/1e9).toFixed(2)+" Gbit/s":bits>=1e6?(bits/1e6).toFixed(2)+" Mbit/s":bits>=1e3?(bits/1e3).toFixed(2)+" kbit/s":bits+" bit/s"},_formatTime:function(seconds){var date=new Date(seconds*1e3),days=parseInt(seconds/86400,10);return days=days?days+"d ":"",days+("0"+date.getUTCHours()).slice(-2)+":"+("0"+date.getUTCMinutes()).slice(-2)+":"+("0"+date.getUTCSeconds()).slice(-2)},_formatPercentage:function(floatValue){return(floatValue*100).toFixed(2)+" %"},_renderExtendedProgress:function(data){return this._formatBitrate(data.bitrate)+" | "+this._formatTime((data.total-data.loaded)*8/data.bitrate)+" | "+this._formatPercentage(data.loaded/data.total)+" | "+this._formatFileSize(data.loaded)+" / "+this._formatFileSize(data.total)},_hasError:function(file){return file.error?file.error:this.options.maxNumberOfFiles<0?"maxNumberOfFiles":!this.options.acceptFileTypes.test(file.type)&&!this.options.acceptFileTypes.test(file.name)?"acceptFileTypes":this.options.maxFileSize&&file.size>this.options.maxFileSize?"maxFileSize":typeof file.size=="number"&&file.size<this.options.minFileSize?"minFileSize":null},_validate:function(files){var that=this,valid=!!files.length;return $.each(files,function(index,file){file.error=that._hasError(file),file.error&&(valid=!1)}),valid},_renderTemplate:function(func,files){if(!func)return $();var result=func({files:files,formatFileSize:this._formatFileSize,options:this.options});return result instanceof $?result:$(this.options.templatesContainer).html(result).children()},_renderPreview:function(file,node){var that=this,options=this.options,dfd=$.Deferred();return(loadImage&&loadImage(file,function(img){node.append(img),that._forceReflow(node),that._transition(node).done(function(){dfd.resolveWith(node)}),$.contains(document.body,node[0])||dfd.resolveWith(node)},{maxWidth:options.previewMaxWidth,maxHeight:options.previewMaxHeight,canvas:options.previewAsCanvas})||dfd.resolveWith(node))&&dfd},_renderPreviews:function(files,nodes){var that=this,options=this.options;return nodes.find(".preview span").each(function(index,element){var file=files[index];options.previewSourceFileTypes.test(file.type)&&($.type(options.previewSourceMaxFileSize)!=="number"||file.size<options.previewSourceMaxFileSize)&&(that._processingQueue=that._processingQueue.pipe(function(){var dfd=$.Deferred();return that._renderPreview(file,$(element)).done(function(){dfd.resolveWith(that)}),dfd.promise()}))}),this._processingQueue},_renderUpload:function(files){return this._renderTemplate(this.options.uploadTemplate,files)},_renderDownload:function(files){return this._renderTemplate(this.options.downloadTemplate,files).find("a[download]").each(this._enableDragToDesktop).end()},_startHandler:function(e){e.preventDefault();var button=$(this),template=button.closest(".template-upload"),data=template.data("data");data&&data.submit&&!data.jqXHR&&data.submit()&&button.prop("disabled",!0)},_cancelHandler:function(e){e.preventDefault();var template=$(this).closest(".template-upload"),data=template.data("data")||{};data.jqXHR?data.jqXHR.abort():(data.errorThrown="abort",e.data.fileupload._trigger("fail",e,data))},_deleteHandler:function(e){e.preventDefault();var button=$(this);e.data.fileupload._trigger("destroy",e,{context:button.closest(".template-download"),url:button.attr("data-url"),type:button.attr("data-type")||"DELETE",dataType:e.data.fileupload.options.dataType})},_forceReflow:function(node){return $.support.transition&&node.length&&node[0].offsetWidth},_transition:function(node){var dfd=$.Deferred();return $.support.transition&&node.hasClass("fade")?node.bind($.support.transition.end,function(e){e.target===node[0]&&(node.unbind($.support.transition.end),dfd.resolveWith(node))}).toggleClass("in"):(node.toggleClass("in"),dfd.resolveWith(node)),dfd},_initButtonBarEventHandlers:function(){var fileUploadButtonBar=this.element.find(".fileupload-buttonbar"),filesList=this.options.filesContainer,ns=this.options.namespace;fileUploadButtonBar.find(".start").bind("click."+ns,function(e){e.preventDefault(),filesList.find(".start button").click()}),fileUploadButtonBar.find(".cancel").bind("click."+ns,function(e){e.preventDefault(),filesList.find(".cancel button").click()}),fileUploadButtonBar.find(".delete").bind("click."+ns,function(e){e.preventDefault(),filesList.find(".delete input:checked").siblings("button").click(),fileUploadButtonBar.find(".toggle").prop("checked",!1)}),fileUploadButtonBar.find(".toggle").bind("change."+ns,function(e){filesList.find(".delete input").prop("checked",$(this).is(":checked"))})},_destroyButtonBarEventHandlers:function(){this.element.find(".fileupload-buttonbar button").unbind("click."+this.options.namespace),this.element.find(".fileupload-buttonbar .toggle").unbind("change."+this.options.namespace)},_initEventHandlers:function(){parentWidget.prototype._initEventHandlers.call(this);var eventData={fileupload:this};this.options.filesContainer.delegate(".start button","click."+this.options.namespace,eventData,this._startHandler).delegate(".cancel button","click."+this.options.namespace,eventData,this._cancelHandler).delegate(".delete button","click."+this.options.namespace,eventData,this._deleteHandler),this._initButtonBarEventHandlers()},_destroyEventHandlers:function(){var options=this.options;this._destroyButtonBarEventHandlers(),options.filesContainer.undelegate(".start button","click."+options.namespace).undelegate(".cancel button","click."+options.namespace).undelegate(".delete button","click."+options.namespace),parentWidget.prototype._destroyEventHandlers.call(this)},_enableFileInputButton:function(){this.element.find(".fileinput-button input").prop("disabled",!1).parent().removeClass("disabled")},_disableFileInputButton:function(){this.element.find(".fileinput-button input").prop("disabled",!0).parent().addClass("disabled")},_initTemplates:function(){var options=this.options;options.templatesContainer=document.createElement(options.filesContainer.prop("nodeName")),tmpl&&(options.uploadTemplateId&&(options.uploadTemplate=tmpl(options.uploadTemplateId)),options.downloadTemplateId&&(options.downloadTemplate=tmpl(options.downloadTemplateId)))},_initFilesContainer:function(){var options=this.options;options.filesContainer===undefined?options.filesContainer=this.element.find(".files"):options.filesContainer instanceof $||(options.filesContainer=$(options.filesContainer))},_stringToRegExp:function(str){var parts=str.split("/"),modifiers=parts.pop();return parts.shift(),new RegExp(parts.join("/"),modifiers)},_initRegExpOptions:function(){var options=this.options;$.type(options.acceptFileTypes)==="string"&&(options.acceptFileTypes=this._stringToRegExp(options.acceptFileTypes)),$.type(options.previewSourceFileTypes)==="string"&&(options.previewSourceFileTypes=this._stringToRegExp(options.previewSourceFileTypes))},_initSpecialOptions:function(){parentWidget.prototype._initSpecialOptions.call(this),this._initFilesContainer(),this._initTemplates(),this._initRegExpOptions()},_create:function(){parentWidget.prototype._create.call(this),this._refreshOptionsList.push("filesContainer","uploadTemplateId","downloadTemplateId"),$.blueimpFP||(this._processingQueue=$.Deferred().resolveWith(this).promise(),this.process=function(){return this._processingQueue})},enable:function(){var wasDisabled=!1;this.options.disabled&&(wasDisabled=!0),parentWidget.prototype.enable.call(this),wasDisabled&&(this.element.find("input, button").prop("disabled",!1),this._enableFileInputButton())},disable:function(){this.options.disabled||(this.element.find("input, button").prop("disabled",!0),this._disableFileInputButton()),parentWidget.prototype.disable.call(this)}})}),App=Em.Application.create(),App.ApplicationController=Em.Controller.extend(),App.ApplicationView=Em.View.extend({templateName:"tmpApplication"}),App.NavbarController=Em.Controller.extend({currentState:null,fnSetNewTab:function(newState,viewIx,newOutlet){var controller=this,lastState=this.get("currentState");lastState?($("#ulMainMenu a.selected").removeClass("selected").addClass("notactive"),controller.get("currentOutlet")==="tabEmpty"&&$("tabEmpty").empty(),$("body").find("div.validity-tooltip").remove()):controller.set("currentOutlet","tabAccidents"),Em.run.next(function(){$("#"+controller.get("currentOutlet")).addClass("hidden"),viewIx>-1&&$("#ulMainMenu a:eq("+viewIx+")").removeClass("notactive").addClass("selected ui-corner-top"),newOutlet||(newOutlet=newState),$("#"+newOutlet).removeClass("hidden"),controller.set("currentState",newState).set("currentOutlet",newOutlet)})}}),MY.NavbarController=App.NavbarController.create(),App.NavbarView=Em.View.extend({templateName:"tmpNavbar"}),App.mainMenuView=Em.View.extend({didInsertElement:function(){if(typeof this.get("viewIx")!="number")return!1;$("#ulMainMenu a.selected").removeClass("selected").addClass("notactive"),$("#ulMainMenu a:eq("+this.get("viewIx")+")").removeClass("notactive").addClass("selected ui-corner-top")}}),function(){var w=window,$=w.jQuery,App=w.App,Em=w.Em;$.widget("ui.UploadFiles",{options:{uploadTemplateId:"tmp2templateUpload",downloadTemplateId:"tmp2templateDownload",formTemplate:"tmpUploadForm",showPhoto:!0,docsController:"treeDocController",url:"Files/Start",fileuploaddone:function(){return console.log("opa")},categoryOpts:{editList:!0},ListType:"List",Source:"tblDocTypes",iVal:"iD",iText:["name"]},_create:function(){var form;return form="",Em.View.create({templateName:this.options.formTemplate,showPhoto:this.options.showPhoto}).appendTo(this.element),Em.run.next(this,function(){return form=this.element.find("form").data("opts",this.options),form.fileupload(this.options)}),Em.run.next(this,function(){return form.bind("fileuploadadded",function(e,data){var inputCat,opts,tr;return tr=data.context,data.form.find(".submitButtons").removeClass("hidden"),inputCat=tr.find("input[name='category[]']"),opts=data.form.data("opts"),(data.paramName="docs[]")?inputCat.ComboBoxCategory(opts):console.log("paveikslai")}).bind("fileuploadadd",function(e,data){var ext;return data.files[0].paramName=data.paramName,ext=data.files[0].name.split(".").pop().substring(0,3),ext==="xls"||ext==="doc"||ext==="pdf"?data.files[0].extension=ext:data.files[0].extension="unknown",data.files[0].type2=data.files[0].type.split("/")[0]}).bind("fileuploadsubmit",function(e,data){var GroupID,RefID,catInput,f,optsAccident,tr;return tr=data.context,f=data.files[0],optsAccident=data.form.data("opts").categoryOpts.accident,catInput=tr.find("input[name='category[]']"),GroupID,RefID=catInput.data("refID"),RefID=RefID?RefID:null,catInput.length?(GroupID=catInput.data("categoryID"),GroupID=GroupID?GroupID:5):GroupID=1,data.formData={FileName:f.name,FileSize:f.size,DocTypeID:catInput.data("newval"),RefID:RefID,GroupID:GroupID,Description:tr.find("textarea[name='description[]']").val(),AccidentID:optsAccident?optsAccident.iD:null}}).bind("fileuploaddone",function(e,data){var docsContr,newDoc,newDocInAccident;if(!data.result.success)return console.log("erroras");console.log("Upload result for file '"+data.files[0].name+"':"),console.log(data.result),newDoc=Em.Object.create(data.result.tblDoc),oDATA.GET("tblDocs").emData.pushObject(newDoc),data.result.tblDocsInAccidents&&(newDocInAccident=Em.Object.create(data.result.tblDocsInAccidents),oDATA.GET("tblDocsInAccidents").emData.pushObject(newDocInAccident)),data.context.remove();if(!data.form.find("table tbody tr").length)return data.form.find(".submitButtons, table").addClass("hidden"),docsContr=data.form.data("opts").docsController,App[docsContr].refreshDocs()}).find(".fileinput-button").on("click",function(){return $(this).closest("form").find("table").removeClass("hidden").end().find("button.cancel").on("click",function(){return $(this).closest("form").find(".submitButtons, table").addClass("hidden"),console.log("Removing tr"),console.log($(this).closest("form").find("table tbody tr")),$(this).closest("form").find("table tbody tr").remove()})})})}}),App.editDocsController=Em.Object.create({getOpts:function(t){var form;return form=t.closest("ul").parent().find("form"),form.length||(form=t.closest("ul").closest("table").parent().parent().find("form:first")),form.data("opts")},editDoc:function(e){var t;return t=$(e.target).parent().parent(),e.context.set("editMode",!0),Em.run.next(this,function(){return t.find("input.docType").ComboBoxCategory(this.getOpts(t))})},cancelSaveDoc:function(e){var input;return input=$(e.target).parent().parent().find("input.docType"),input.autocomplete("destroy").removeData("autocomplete"),e.context.set("editMode",!1)},SaveEditedDoc:function(e){var cont,controller,desc,doc,docID,docTypeID,docTypeVal,t;return t=$(e.target).parent().parent(),desc=t.find("input.description").val(),docTypeID=t.find("input.docType").data("newval"),controller=App[this.getOpts(t).docsController],docTypeVal=t.find("input.docType").val(),docID=e.context.docID,doc=oDATA.GET("tblDocs").emData.findProperty("iD",docID),docTypeID=docTypeID?docTypeID:doc.docTypeID,e.context.set("description",desc).set("docType",docTypeVal),cont=e.context,SERVER.update2({Action:"Edit",Ctrl:t,source:"tblDocs",row:doc,DataToSave:{id:docID,Data:[docTypeID,desc],Fields:["docTypeID","description"],DataTable:"tblDocs"},CallBackAfter:function(Row){return controller.refreshDocs()}})},deleteDoc:function(e){var c,controller,t;return t=$(e.target).parent().parent(),c=e.context,controller=App[this.getOpts(t).docsController],oCONTROLS.dialog.Confirm({title:"Dokumento pašalinimas",msg:"Ištrinti dokumentą '"+c.docName+"'?"},function(){return SERVER.update2({Action:"Delete",Ctrl:t,source:"tblDocs",DataToSave:{id:c.docID,DataTable:"tblDocs"},Msg:{Title:"Duokumento pašalinimas",Success:"Dokumentas '"+c.docName+"' pašalintas.",Error:"Nepavyko pašalinti dokumento '"+c.docName+"'."},CallBackAfter:function(Row){return controller.refreshDocs()}})})}})}.call(this),Handlebars.registerHelper("highlight",function(prop,options){var value=Ember.getPath(this,prop);return new Handlebars.SafeString('<span class="highlight">'+value+"</span>")}),Handlebars.registerHelper("checkOut",function(prop,options){var value=Ember.getPath(this,prop);return console.log("opa"),new Handlebars.SafeString('<span class="highlight">'+value+"</span>")}),Handlebars.registerHelper("updatableField",function(prop,options){if(this.content.length===0)return!1;var err="updatableField helper ",h=prop.hash?prop.hash:options.hash,f=h.Field;if(!f)throw new Error(err+"did not found Field");var v=this.content[0][f];typeof v=="undefined"&&console.error("Field "+f+" has no value in updatableField helper");if(!f)throw new Error(err+"did not found value for Field"+f);typeof v=="string"&&(v='"'+v.replace(/'/g,"")+'"');var cl=h.classes?h.classes:"",st=h.style?"style='"+h.style+"'":"",id=h.id;id=id?'"id":"'+id+'",':"";var lblT=h.labelType;lblT=lblT?'"labelType":"'+lblT+'",':"";var attr=h.attr;attr=attr?'"attr":"'+attr+'",':"";var List=h.List;List=List?'"List":'+List+",":"";var Editable=h.Editable;Editable=Editable?'"Editable":'+Editable+",":"";var retString=" class='ExtendIt "+h.classes+"' "+st+' data-ctrl=\'{"Value":'+(v===""?'""':v)+',"Field":"'+f.firstBig()+'","classes":"UpdateField",'+id+lblT+attr+List+Editable;return retString.charAt(retString.length-1)===","&&(retString=retString.slice(0,-1)),h.tag?retString="<"+h.tag+retString+"}'></"+h.tag+">":retString="<div"+retString+"}'></div>",new Handlebars.SafeString(retString)}),Handlebars.registerHelper("eachArr",function(context,block){var ret="";for(var i=0,j=context.length;i<j;i++)ret+=block(context[i]);return ret}),Handlebars.registerHelper("each11",function(context,options){var ret="";for(var i=0,j=context.length;i<j;i++)ret+=options.fn(context[i]);return ret}),Handlebars.registerHelper("compare",function(lvalue,operator,rvalue,options){var operators,result;if(arguments.length<3)throw new Error("Handlerbars Helper 'compare' needs 2 parameters");options===undefined&&(options=rvalue,rvalue=operator,operator="===");if(lvalue.slice(0,4)==="this"){var v=lvalue.slice(5);lvalue=this.content[0][v];if(lvalue===undefined)throw new Error("Handlerbars Helper 'compare' doesn't know field "+v)}if(rvalue.slice(0,4)==="this"){var v=rvalue.slice(5);rvalue=this.content[0][v];if(rvalue===undefined)throw new Error("Handlerbars Helper 'compare' doesn't know field "+v)}typeof lvalue=="string"&&lvalue.match("content")&&(lvalue=lvalue.replace("content","this.content"),lvalue=eval(lvalue)),operators={"==":function(l,r){return l==r},"===":function(l,r){return l===r},"!=":function(l,r){return l!=r},"!==":function(l,r){return l!==r},"<":function(l,r){return l<r},">":function(l,r){return l>r},"<=":function(l,r){return l<=r},">=":function(l,r){return l>=r},"typeof":function(l,r){return typeof l==r}};if(!operators[operator])throw new Error("Handlerbars Helper 'compare' doesn't know the operator "+operator);return result=operators[operator](lvalue,rvalue),result?options.fn(this):options.inverse(this)}),App.SearchField=Ember.View.extend({context:null,tagName:"form",template:Em.Handlebars.compile('<input {{action "valueDidChange" on="keyUp" target="parentView"}} type="text" class="searchField" placeholder="Ieškoti.."/><div class="divSearch"><span {{action "clear" target="parentView"}} class="spanToClearText">x</span></div>'),clear:function(e){$(e.target).closest("form").find("input").val(""),this.get("valueDidChange").call(this,"")},valueDidChange:function(e){var f=e?$(e.target).val():"",context=this.get("context");controller=this.get("controller"),controller&&App[controller].set("filterValue",f.toLowerCase())}}),App.AccidentViewObj=Em.View.extend({didInserElement:function(){console.log("I loaded one accident")},templateName:"tmpAccidentRowObj",tagName:""}),function(){var w=window,App=w.App,Em=w.Em,oGLOBAL=w.oGLOBAL,oDATA=w.oDATA,oCONTROLS=w.oCONTROLS,MY=w.MY,panelFilterIsActive,textFilterIsActive;App.tabAccidentsView=App.mainMenuView.extend({content:null,viewIx:0,templateName:"tmpAccidentsMain",didInsertElement:function(){}}),App.AccidentView=Em.View.extend({templateName:"tmpAccidentRow",tagName:""}),App.SelectedAccidentView=Em.View.extend({templateName:"tmpAccident_Claims",init:function(){var ArrView=[],objView=[],ArrClaims,ArrClaims2,i,iterator;console.log("init selected accident"),this._super(),ArrClaims=this.get("claims_C").replace(new RegExp("{{(.*?)}}","gm"),"").split("#||"),ArrClaims2=this.get("claims_C2").split("#||");if(ArrClaims[0]!==""){iterator=ArrClaims.length-1,i=-1;while(i++<iterator)ArrView[i]={Claims:ArrClaims[i].split("#|"),Claims2:ArrClaims2[i].split("#|")},objView[i]={finished:ArrClaims[i][0]==="2"?!0:!1,no:ArrView[i].Claims[1],type:ArrView[i].Claims[2],autoNo:ArrView[i].Claims[3],insurer:ArrView[i].Claims[4],loss:ArrView[i].Claims[5],Claims2:ArrView[i].Claims2,accidentID:this.get("iD"),accidentDate:this.date}}return App.thisAccidentController.set("content",objView),App.thisAccidentController.set("accidentID",this.get("iD"))},tbodyClick:function(e){var ClaimW,d,tr;return tr=$(e.target).closest("tr"),ClaimW=$("#ClaimWraper"),ClaimW.length>0&&(MY.tabAccidents.SelectedClaimView.remove(),ClaimW.remove()),tr.parent().find("tr.selectedClaim").removeClass("selectedClaim title"),d=e.context,MY.tabAccidents.SelectedClaimView=App.SelectedClaimView.create({rowContext:{Claims2:d.Claims2,newClaim:!1,LossAmount:d.loss,InsuranceType:d.type,accidentID:d.accidentID,accidentDate:d.accidentDate},elementId:"ClaimDetailsContent",contentBinding:"App.claimEditController.content"}),tr.addClass("selectedClaim title").after("<tr><td id='ClaimWraper' colspan='7' class='selectedClaim content'></td></tr>"),MY.tabAccidents.SelectedClaimView.appendTo("#ClaimWraper"),Em.run.next(function(){return $("#ClaimDetailsContent").slideDown()}),!1},newClaim:function(e){var d,nTr;return nTr=$(e.target).closest("div.tr")[0],$(nTr).replaceWith('<div id=\'divNewClaimCard\' data-ctrl=\'{"id":"0","NewRec":"1","Source":"tblClaims","ClaimTypeID":"0"}\'></div>'),d={ctrl:$("#divNewClaimCard"),oDATA:oDATA.GET("tblClaimTypes"),opt:{val:"iD",text:"name",FieldName:"ClaimTypeID",SelectText:"Pasirinkite žalos tipą:"},fnAfterOptClick:function(T){return $("#divNewClaimCard").find("#divClaimCardDetails,div.frmbottom").remove(),MY.tabAccidents.NewClaimView&&(MY.tabAccidents.NewClaimView.remove(),$("#newClaimDetailsContent").remove()),MY.tabAccidents.NewClaimView=App.SelectedClaimView.create({rowContext:{newClaim:!0,accidentID:App.thisAccidentController.get("accidentID")},elementId:"newClaimDetailsContent",contentBinding:"App.newClaimController.content"}),MY.tabAccidents.NewClaimView.appendTo("#divNewClaimCard"),Em.run.next(function(){return $("#newClaimDetailsContent").slideDown()}),!1,{fnCancel:function(){return $("#accidentsTable").find("div.selectedAccident").trigger("click")}}},fnCancel:function(){return $("#accidentsTable").find("div.selectedAccident").trigger("click")}},oCONTROLS.Set_Updatable_HTML.mega_select_list(d),!1},elementId:"AccDetailsContent",contentBinding:"App.thisAccidentController.content",destroyElement:function(){if(MY.tabAccidents.SelectedClaimView)return MY.tabAccidents.SelectedClaimView.remove()}}),App.SelectedClaimView=Em.View.extend({didInsertElement:function(){var IClaim,c,fnCheckIsInjured,frm;return c=this.content[0],frm=c.NewClaim?"#divNewClaimCard":"#divClaimCard",oCONTROLS.UpdatableForm(frm),c.TypeID===2&&(IClaim=$("#InsuranceClaimAmount").parent(),IClaim.find("span").html("Planuojama žalos suma asmeniui"),$("#LossAmount").parent().find("span").html("Planuojama žalos suma turtui"),fnCheckIsInjured=function(){return this.attr("checked")?IClaim.css("display","block").find("input").data("ctrl").Validity=IClaim.find("input").data("ctrl").Validity.replace("require().",""):IClaim.css("display","none").find("input").val("").data("ctrl").Validity="require()."+IClaim.find("input").data("ctrl").Validity},fnCheckIsInjured.call($("#IsInjuredPersons")),$("#IsInjuredPersons").on("click",function(){return fnCheckIsInjured.call($("#IsInjuredPersons"))})),$("#inputDays, #inputPerDay").on("keyup",function(){return $("#inputSum").val($("#inputDays").val()*$("#inputPerDay").val())})},init:function(){var C2,Claim,TypeID,d;return this._super(),d=this.get("rowContext"),d.newClaim?(TypeID=$("#divNewClaimCard").data("ctrl").ClaimTypeID,Claim={ID:0,VehicleID:0,InsPolicyID:"",InsuranceClaimAmount:0,InsurerClaimID:"",IsTotalLoss:0,IsInjuredPersons:0,Days:5,PerDay:500,LossAmount:TypeID===6?2500:0,NewClaim:!0,TypeID:TypeID},App.newClaimController.set("content",[Claim]),console.log("init new Claim.Type - "+TypeID)):(C2=d.Claims2,TypeID=oDATA.GET("tblClaimTypes").emData.findProperty("name",d.InsuranceType).iD,Claim={ID:C2[0],VehicleID:C2[1],InsPolicyID:C2[2],InsuranceClaimAmount:C2[3],InsurerClaimID:C2[4],IsTotalLoss:C2[5],IsInjuredPersons:parseInt(C2[6],10),Days:C2[7],PerDay:C2[8],LossAmount:d.LossAmount,NewClaim:!1,TypeID:TypeID},App.claimEditController.set("content",[Claim]))},SaveClaim:function(e){var Action,DataToSave,Msg,frm,newClaim,opt;newClaim=this.rowContext.newClaim,newClaim?(frm=$("#divNewClaimCard"),Action="Add",Msg={Title:"Naujos žalos sukūrimas",Success:"Nauja žala sukurta.",Error:"Nepavyko išsaugot naujos žalos."}):(frm=$("#divClaimCard"),Action="Edit",Msg={Title:"Žalos redagavimas",Success:"Žalos duomenys pakeisti.",Error:"Nepavyko pakeisti žalos duomenų."}),DataToSave=oCONTROLS.ValidateForm(frm);if(DataToSave)return newClaim&&(DataToSave.Fields.push("ClaimTypeID"),DataToSave.Data.push(e.view.content[0].TypeID),DataToSave.Fields.push("AccidentID"),DataToSave.Data.push(e.view.rowContext.accidentID)),DataToSave.Ext=e.view.rowContext.accidentID,opt={Action:Action,DataToSave:DataToSave,CallBack:{Success:function(resp){var newRow,tr;return newRow=resp.ResponseMsg.Ext.replace(/#\|#\|/g,":::").split("|#|"),newRow[13]=newRow[13].replace(/:::/g,"#|#|"),App.accidentsController.get("setNewVal").call(App.accidentsController,{newVal:newRow,toAppend:!1,fieldsToInt:[0,1,5,6,7,8]})[0],tr=$("#accidentsTable").find("div.selectedAccident"),tr.trigger("click")}},Msg:Msg},SERVER.update(opt)},CancelSaveClaim:function(e){return $("#accidentsTable").find("div.selectedAccident").trigger("click")},DeleteClaim:function(e){var context,oData;return oData=oDATA.GET("tblClaims"),context=e.context.rowContext,console.log("Žalos ID: "+context.Claims2[0]),oCONTROLS.dialog.Confirm({title:"",msg:"Ištrinti pasirinktą žalą?"},function(){return SERVER.update({Action:"Delete",DataToSave:{id:context.Claims2[0],DataTable:oData.Config.tblUpdate,Ext:context.accidentID},Msg:{Title:"Duomenų ištrynimas",Success:"Pasirinkta žala buvo pašalinta.",Error:"Nepavyko pašalinti šios žalos"},CallBack:{Success:function(resp,updData){var newRow;return newRow=resp.ResponseMsg.Ext.replace(/#\|#\|/g,":::").split("|#|"),newRow[13]=newRow[13].replace(/:::/g,"#|#|"),App.accidentsController.get("setNewVal").call(App.accidentsController,{newVal:newRow,toAppend:!1,fieldsToInt:[0,1,5,6,7,8]})[0],oData.Data.removeRowByID(parseInt(updData.DataToSave.id,10)),$("#accidentsTable").find("div.selectedAccident").trigger("click")}}})})},templateName:"tmpClaimEdit"}),App.accidentsController=Em.ResourceController.create({url:"Accident/AccidentsList",tableName:"proc_Accidents",fields:{},animationSpeed:400,setAnimationSpeed:function(e){var n;return n=parseInt($(e.target).val(),10),$.isNumeric(n)?this.set("animationSpeed",n):alert("turi būti skaičius")},removeClaims:function(AddWr){AddWr.parent().find("div.dividers").remove();if(AddWr.length>0)return MY.tabAccidents.AcccidentdetailsView.remove(),AddWr.remove();if(MY.tabAccidents.AcccidentdetailsView)return MY.tabAccidents.AcccidentdetailsView.destroy(),MY.tabAccidents.AcccidentdetailsView=null,$("div.dividers").remove()},tbodyClick:function(e){var AddWr,parent,tr;tr=$(e.target).closest("div.tr"),this.setfilteredPolicies(e.context.date),AddWr=$("#AccDetailsWraper"),parent=tr.parent();if(tr.hasClass("selectedAccident")&&!e.isTrigger){if(parent.find("div.dividers").length)return this.removeClaims(AddWr),!1}else parent.find("div.selectedAccident").removeClass("selectedAccident"),this.removeClaims(AddWr);return tr.hasClass("selectedAccident")||tr.addClass("selectedAccident"),MY.tabAccidents.AcccidentdetailsView=App.SelectedAccidentView.create(e.context),tr.after("<div id='AccDetailsWraper'></div><div class='dividers'></div>").prev().before("<div class='dividers'></div>"),MY.tabAccidents.AcccidentdetailsView.appendTo("#AccDetailsWraper"),e.isTrigger?Em.run.next(function(){return $("#AccDetailsContent, div.dividers").show()}):Em.run.next(function(){return $("#AccDetailsContent, div.dividers").slideDown(App.accidentsController.animationSpeed)}),!1},setfilteredPolicies:function(accidentDate){var proc_InsPolicies_forThisAccident,thisAccidentPolicies;return thisAccidentPolicies=$.map(oDATA.GET("proc_InsPolicies").Data,function(i){return oGLOBAL.date.firstBigger(i[4],accidentDate)?[i]:null}),proc_InsPolicies_forThisAccident=$.extend({},oDATA.GET("proc_InsPolicies"),{Data:thisAccidentPolicies}),oDATA.SET("proc_InsPolicies_forThisAccident",proc_InsPolicies_forThisAccident)},editAccident:function(e){return this.openAccident(e.context.no)},addNewAccident:function(){return this.openAccident(null)},openAccident:function(AccNo){var ctrlEdit;return $("#tabAccidents").removeClass("colmask"),$("#divAccidentsList").hide(),ctrlEdit=$("#divAccidentEdit").show(),ctrlEdit.spinner({position:"center",img:"spinnerBig.gif"}),oGLOBAL.LoadAccident_Card(AccNo),$("body").spinner("remove"),!1},filterDidChange:function(thisObj,filterName){var filterValue;return console.log("filterDidChange"),filterValue=filterName==="All"?void 0:thisObj[filterName],filterName==="filterValue"?this.textFilterIsActive=filterValue===""?!1:!0:(this.panelFilterIsActive=this.chkDocs||this.chkOpen||this.chkData||this.chkClaim?!0:!1,this.filterByPanel=this.get_filterByPanel()),this.filterItems(filterName,filterValue,thisObj),Em.run.next(function(){var tbl;tbl=$("#accidentsTable");if(!tbl.find("div.selectedAccident").length)return tbl.find("div.dividers").remove()})}.observes("chkDocs","chkOpen","chkData","chkClaim","filterValue")},textFilterIsActive=!1,panelFilterIsActive=!1,{filterFromVisible:!1,filterCols:["accType","driver","shortNote","userName","place","claims_C"],filterValue:null,chkDocs:null,chkOpen:null,chkData:null,chkClaim:null,filterByField:function(row){var cols,fnFilter,i,me,ret,_i,_ref;if(row.filterToHide)return!1;me=this,ret=!1,cols=JSON.parse(JSON.stringify(me.filterCols)),fnFilter=function(i){return row[cols[i]].toLowerCase().indexOf(me.filterValue)>-1?!0:!1},console.log("---Start filtering----");for(i=_i=0,_ref=cols.length;_i<_ref;i=_i+=1){if(fnFilter(i)){ret=!0,console.log("true - "+row[cols[i]]);break}console.log("false - "+row[cols[i]])}return console.log("---End filtering----"),ret||(row.filterToHide=!0),ret},get_filterByPanel:function(){var fn;return fn="",this.chkOpen&&(fn+=this.chkOpen==="chkWithOpen"?"if (row.cNo_NotF===0) return false;":"if (row.cNo_NotF>0) return false;"),this.chkDocs&&(fn+=this.chkDocs==="chkWithDocs"?"if (row.docNo===0) return false;":"if (row.docNo>0) return false;"),this.chkData&&(fn+=this.chkData==="12month"?"if (row.daysFrom>365) return false;":"if (row.date.indexOf("+this.chkData+")===-1) return false;"),this.chkClaim&&(fn+="if (row.claims_TypeID.indexOf('"+this.chkClaim+"')===-1) return false;"),fn+="return true;",new Function("row",fn)},filterByPanel:null,filterItems:function(filterName,filterValue,thisObj){var fnFilter,_this=this;return filterName==="filterValue"?(filterValue===""?fnFilter=this.panelFilterIsActive?function(row){return row.filterToHide=!1,_this.filterByPanel(row)}:function(row){return row.filterToHide=!1,!0}:this.panelFilterIsActive?fnFilter=function(row){var result;return result=_this.filterByField(row)?_this.filterByPanel(row):!1,result}:fnFilter=function(row){return _this.filterByField(row)},console.log("Filtro pradžia - tekstas---------------")):(!this.textFilterIsActive&&!this.panelFilterIsActive?fnFilter=function(row){return!0}:fnFilter=function(row){return row.filterToHide?!1:_this.filterByPanel(row)},console.log("Filtro pradžia - kiti filtrai---------------")),this.content.forEach(function(row){var res;return res=fnFilter(row),row.set("visible",res)})}}),App.thisAccidentController=Em.ResourceController.create({content:[],tableName:"?"}),App.claimEditController=Em.ResourceController.create({tableName:"?"}),App.newClaimController=Em.ResourceController.create({tableName:"?"}),App.sidePanelController=Em.ResourceController.create({tableName:"?",chkHandler:function(lbl,option){var newVal;return lbl.parent().find("label").not(lbl).removeClass("ui-state-active"),newVal=lbl.hasClass("ui-state-active")?lbl.attr("for").replace("chk_claimTypes","").replace("chk_",""):null,App.accidentsController.set(option,newVal)},init:function(){var _this=this;return this._super(),oDATA.execWhenLoaded(["tblClaimTypes"],function(){return _this.set("years",oDATA.GET("proc_Years").emData.map(function(item){return item.chkId="chk_"+item.year,item})),_this.set("claimTypes",oDATA.GET("tblClaimTypes").emData.map(function(item){return item.chkId="chk_claimTypes"+item.iD,item})),_this.claimTypes.findProperty("iD",0).visible=!1,Em.run.next(_this,function(){var me;return me=this,$("#chkYears").buttonsetv().on("click",function(e){var lbl;return e.preventDefault(),lbl=$(e.target).closest("label"),me.chkHandler(lbl,"chkData"),!1}),$("#chkClaimsTypes").buttonsetv().on("click",function(e){var lbl;return lbl=$(e.target).closest("label"),me.chkHandler(lbl,"chkClaim"),!1})})})},years:[],claimTypes:[]}),App.SidePanelView=Em.View.extend({templateName:"tmpSidePanel",didInsertElement:function(){return this._super(),Em.run.next(function(){var c;return c=$("#sidePanel").closest("div.col2"),$.browser.msie?c.scrollelement():c.jScroll(),$("#chkOpen").buttonset().on("click",function(e){var chk,newVal;return chk=$(e.target).closest("label").prev(),newVal=chk.next().hasClass("ui-state-active")?chk.attr("id"):null,$("#chkOpen").find("label").not(chk.next()).removeClass("ui-state-active").end().prev().not(chk).removeAttr("checked"),App.accidentsController.set("chkOpen",newVal),e.preventDefault()}),$("#chkDocs").buttonset().on("click",function(e){var chk,newVal;return chk=$(e.target).closest("label").prev(),newVal=chk.next().hasClass("ui-state-active")?chk.attr("id"):null,$("#chkDocs").find("label").not(chk.next()).removeClass("ui-state-active").end().prev().not(chk).removeAttr("checked"),App.accidentsController.set("chkDocs",newVal),e.preventDefault()})})},showAll:function(){return $("#chkOpen,#chkDocs").find("label").removeClass("ui-state-active").end().prev().removeAttr("checked"),$("#sidePanel").find("input:checkbox").removeAttr("checked").parent().next().next().find("span.ui-checkbox-icon").removeClass("ui-icon ui-icon-check").attr("aria-checked","false"),App.accidentsController.chkOpen=null,App.accidentsController.chkDocs=null,App.accidentsController.chkData=null,App.accidentsController.chkClaim=null,App.accidentsController.filterDidChange(this,"All")}}),MY.tabAccidents={}}.call(this),function(){var clsEditableForm;clsEditableForm=function(){var fnResetForm,fnSaveChanges;function clsEditableForm(options){var Action,AddToTitle,Config,Row,id,ix,oData,opt;$("body").css("cursor","wait"),opt={DialogFormId:"divDialogForm",fnAddNewForm:"Dialog",CallBackAfter:0,aRowData:0,Title:0},$.extend(opt,options),id=opt.aRowData!=null?opt.aRowData.iD:0,oData=oDATA.GET(opt.objData),Action=opt.Action,oData==null&&alert("Neradau objekto "+opt.objData+" clsEditableForm klaseje"),Row={Cols:oData.Cols,Grid:oData.Grid,Data:opt.aRowData},id&&Row.Data==null&&(Row.Data=oData.emData.findProperty("iD",id)),opt.Title||(Config=oData.Config,opt.Title=Action==="Add"?Config.Msg.AddNew:Config.Msg.Edit,Config.Msg.AddToTitle&&Action==="Edit"&&(AddToTitle=function(){var _i,_len,_ref,_results;_ref=Config.Msg.AddToTitle,_results=[];for(_i=0,_len=_ref.length;_i<_len;_i++)ix=_ref[_i],_results.push(Row.Data[ix]);return _results}(),opt.Title+=" - "+AddToTitle.join(" "))),this.fnLoadEditableForm(opt,id,oData,Row),$("body").css("cursor","default")}return clsEditableForm.prototype.fnLoadEditableForm=function(opt,id,oData,Row){var Config,dlgEditableOpt,form,_html;return Config=$.extend(!0,{},{Source:opt.objData},oData.Config),!opt.form||opt.form==="Dialog"?(dlgEditableOpt={autoOpen:!1,minWidth:"35em",minHeight:"40em",width:"50em",modal:!0,title:opt.Title,draggable:!0,buttons:{"Išsaugoti pakeitimus":function(){return fnSaveChanges(opt,oData,Row)},"Ištrinti":function(){return $(this).dialog("close")},"Atšaukti":function(){return $(this).dialog("close")}},close:function(){return $("div.validity-tooltip").remove(),$(this).remove()},dragStart:function(){return $("div.validity-tooltip").remove()}},_html=opt.RenderHTML?opt.RenderHTML:this.fnGenerateHTML(Row,id,Config,opt),$("#"+opt.DialogFormId).parent().dialog("destroy"),$("<div id='"+opt.DialogFormId+"'></div>").html(_html).dialog(dlgEditableOpt).dialog("open")):(_html=opt.RenderHTML?opt.RenderHTML:this.fnGenerateHTML(Row,id,Config,opt),$(_html).append('<button style="float:right;" title="Atšaukti">Atšaukti</button>').find("button:last").button().click(function(){return fnResetForm(opt)}).end().append('<button style="float:right;" title="Išsaugoti">Išsaugoti</button>').find("button:last").button().click(function(){return fnSaveChanges(opt,oData,Row)}).end().appendTo(opt.form).append('<div style="clear:both;"></div>').prepend("<h3>"+opt.Title+"</h3>")),oCONTROLS.UpdatableForm($("#divEditableForm")),form=$("#"+opt.DialogFormId).parent(),form.find("button:contains('Išsaugoti')").attr("disabled","disabled").addClass("ui-state-disabled"),form.find("input, textarea").bind("click keyup",function(){return form.find("button:contains('Išsaugoti')").removeAttr("disabled").removeClass("ui-state-disabled")}),form.find("div.ExtendIt button").click(function(){return form.find("button:contains('Išsaugoti')").removeAttr("disabled").removeClass("ui-state-disabled")}),form.find("button:contains('Ištrinti')").css("display","none")},fnResetForm=function(opt){return opt.target&&opt.target.css("display","block"),opt.form.empty()},fnSaveChanges=function(opt,oData,Row){var DataToSave;DataToSave=oCONTROLS.ValidateForm($("#divEditableForm"));if(DataToSave)return SERVER.update({Action:opt.Action,DataToSave:DataToSave,CallBack:{Success:function(resp,updData){return opt.Action==="Add"&&(Row.Data=Em.Object.create({}),Row.Data.iD=resp.ResponseMsg.ID),Row.Cols.forEach(function(col,i){var Field,fieldName,id,infoRow,ok,source;return ok=!1,fieldName=col.FName.slice(0,1).toLowerCase()+col.FName.slice(1),updData.DataToSave.Fields.forEach(function(updateField,i2){if(col.FName===updateField)return Row.Data.set(fieldName,updData.DataToSave.Data[i2]),ok=!0},!ok&&opt.Action==="Add"&&fieldName!=="iD"?col.IdField?(infoRow=Row.Cols[col.IdField],source=infoRow.List.Source,Field=infoRow.FName,id=oGLOBAL.helper.getData_fromDataToSave(updData.DataToSave,Field),Row.Data.set(fieldName,oDATA.GET(source).emData.findProperty("iD",id).MapArrToString(infoRow.List.iText,!1))):col.Default?col.Default==="Today"?Row.Data.set(fieldName,oGLOBAL.date.getTodayString()):col.Default==="UserName"?Row.Data.set(fieldName,UserData.Name()):col.Default==="UserId"?Row.Data.set(fieldName,UserData.Id()):Row.Data[fieldName]=col.Default:(Row.Data[fieldName]="",Row.Data.set(fieldName,"")):void 0),console.log("col: "+col.FName+", ok: "+ok+", fieldValue:"+Row.Data[fieldName])}),opt.Action==="Add"&&oDATA.GET(opt.objData).emData.pushObject(Row.Data),opt.CallBackAfter&&opt.CallBackAfter(Row.Data,opt),!opt.form||opt.form==="Dialog"?$("#"+opt.DialogFormId).dialog("close"):fnResetForm(opt)}},Msg:"",BlockCtrl:$("#divEditableForm")});if(DataToSave===0)return $("#"+opt.DialogFormId).dialog("close")},clsEditableForm.prototype.fnGenerateHTML=function(Row,id,Config,opt){var Append,Head,Length,colVal,html,i,inewVals,n,t,val;Length=Row.Cols.length,i=0,html="",Head="",inewVals=0,opt.newVals&&(opt.newVals.vals=opt.newVals.vals instanceof Array?opt.newVals.vals:opt.newVals.vals.split(" "));while(i<Length)Append="",n=Row.Cols[i].FName,n=n.slice(0,1).toLowerCase()+n.slice(1),colVal=Row.Data[n],Row.Grid.aoColumns[i].sTitle!=null&&!Row.Cols[i].IdField&&!Row.Cols[i].NotEditable&&(colVal!=null&&colVal?typeof colVal=="number"?val=colVal:(t=Row.Cols[i].Type?Row.Cols[i].Type:"",val=t==="String"||t==="Email"||t.substring(0,4)==="Date"?'"'+colVal.replace(/"/g,"\\u0027")+'"':colVal):opt.newVals!=null?n===opt.newVals.cols[inewVals]?(val=opt.newVals.vals[inewVals]?'"'+opt.newVals.vals[inewVals].replace(/"/g,"\\u0027")+'"':'""',inewVals++):val='""':val='""',Append+='"Value":'+val+",",html+="<div class='ExtendIt' data-ctrl='{"+Append+'"Field":"'+Row.Cols[i].FName+'","classes":"UpdateField","labelType":"Left"}\'></div>'),i++;return id!=null?Head='"NewRec":0,"id":'+id+",":Head='"NewRec":1,',Head+='"Source":"'+Config.Source+'","tblUpdate":"'+Config.tblUpdate+'"',"<div id='divEditableForm' class='inputform' style='margin:0 2em;' data-ctrl='{"+Head+"}'>"+html+"</div>"},clsEditableForm}(),window.oGLOBAL.clsEditableForm=clsEditableForm}.call(this),function(){var w=window,$=w.jQuery,App=w.App,Em=w.Em;App.create_docsTypesController=function(categoryOpts){return App.docsTypesController=Em.ResourceController.create({init:function(){var c,catOpts,cats,docTypes,me;this._super(),me=this,docTypes=oDATA.GET("tblDocTypes").emData,c=[],this.set("docTypes",docTypes),categoryOpts=categoryOpts?categoryOpts:this.categoryOpts;if(categoryOpts)return this.set("categoryOpts",categoryOpts),catOpts=categoryOpts,cats=oDATA.GET("tblDocGroup").emData,catOpts.driver&&cats.findProperty("iD",3).set("name",catOpts.driver.title),cats.forEach(function(catItem,i){var newItem;return newItem={categoryId:catItem.iD,title:catItem.name},i=catItem.iD,console.log("catItem.iD: "+i+", catItem.name: "+catItem.name),i!==1&&i!==5&&(newItem.isTree="isTree"),newItem.isGroup="isGroup",i!==4&&(newItem.isSelectable=!0),i===4?(newItem.items=catOpts.vehicles.map(function(item){return{isGroup:"isGroup",refID:item.iD,categoryId:4,title:item.title,isTree:"isTree",isSelectable:!0}}),newItem.items.forEach(function(vehicle){return vehicle.items=me.setDocTypes(docTypes,catItem.iD,vehicle.refID)})):newItem.items=me.setDocTypes(docTypes,catItem.iD),c[c.length]=newItem}),this.set("content",c)},setDocTypes:function(docTypes,groupID,refID){fnMap;var fnMap;return refID?fnMap=function(item){return{categoryId:item.iD,title:item.name,refID:refID}}:fnMap=function(item){return{categoryId:item.iD,title:item.name}},docTypes.filter(function(type){return type.docGroupID===groupID}).map(fnMap)},content:[],docTypes:[],filterTypes:function(){var dt;return console.log("Start filterTypes fn"),dt=this.get("docTypes"),this.set("docTypes_accident",dt.filterProperty("docGroupID",2)),this.set("docTypes_driver",dt.filterProperty("docGroupID",3)),this.set("docTypes_vehicle",dt.filterProperty("docGroupID",4))}.observes("docTypes.length")})},$.widget("ui.Tree",{options:{treeId:"dynamicTree",docViewForTreeId:"docViewForTree",formTemplate:"tmpUploadForm",docsUpdateCallBack:null,categoryOpts:{},docsTypesController:"docsTypesController",TreeDocController:"treeDocController"},_create:function(){return $('<table width="100%;"><tr style="vertical-align:top"><td style="width:28em"><div id="'+this.options.treeId+'" style="border-right: 1px solid #ddd;"></div></td>'+'<td style="vertical-align:top;padding:10px;"><div id="'+this.options.docViewForTreeId+'"></div></td></tr></table>').appendTo(this.element),App.docsTypesController?App.docsTypesController.content.length||App.docsTypesController.set("categoryOpts",this.options.categoryOpts).init():App.create_docsTypesController(this.options.categoryOpts),App.DocTreeView=Em.View.extend(this.DocTreeViewOpt),this.TreeViewOpts.opts=this.options,this.TreeDocControllerOpts.opts=this.options,this.DocTreeViewOpt.opts=this.options,App.TreeView=Em.View.extend(this.TreeViewOpts),App[this.options.TreeDocController]=Em.Object.create(this.TreeDocControllerOpts),Em.View.create({templateName:"tmpDocsTree"}).appendTo("#"+this.options.treeId),this.docViewForTreeOpts.controller=App[this.options.TreeDocController],this.docViewForTreeOpts.opts=this.options,Em.View.create(this.docViewForTreeOpts).appendTo("#"+this.options.docViewForTreeId)},DocTreeViewOpt:{templateName:"tmpDocsNodes",tagName:"",opts:null,didInsertElement:function(){return $("li.treeItem").droppable({accept:"#gallery > li",accept:"#"+this.opts.docViewForTreeId+" li",over:function(event,dragged){var subbranch,subbranches,targetBranch;$(this).hasClass("isTree")||$(this).addClass("treeItemHover"),subbranches=$("ul",this);if(subbranches.size()>0){subbranch=subbranches.eq(0);if(subbranch.css("display")==="none")return targetBranch=subbranch.get(0),window.setTimeout(function(){return $(targetBranch).show(),$("img.expandImage",targetBranch.parentNode).eq(0).attr("src","Content/less/images/toggle_minus.png")},200)}},out:function(){return $(this).removeClass("treeItemHover")},drop:function(event,dropped){var opts,subbranch,textElement;$(this).removeClass("treeItemHover"),subbranch=$("ul",this);if(subbranch.size()===0)return textElement=$(this).find("span.textHolder").eq(0),opts=$(this).closest("tr").find("td:eq(1) ul").data("opts"),App[opts.TreeDocController].deleteDocument(dropped.draggable,this)}})}},TreeViewOpts:{docs:null,opts:null,templateName:"tmpDocsCategory",tagName:"",classNames:[],getDocs:function(event){var account,ctx,currentDocs,docTypes,fnFilter,fnGetDocType,fnGetIcon,fnGetUser,isPhoto,showDocs,t,url,users;return App.treeDocController.set("selectedCategoryId",event.view.bindingContext.categoryId),$("#"+this.opts.treeId).find("span").removeClass("ui-state-highlight"),t=$(event.target),(t.is("li")?t.find("span:first"):t.closest("span")).addClass("ui-state-highlight"),console.log("categoryId: "+event.view.bindingContext.categoryId),console.log("context: "),console.log(this._context),currentDocs=[],ctx=this._context,fnFilter,ctx.isGroup?ctx.refID?fnFilter=function(doc){return doc.groupID===ctx.categoryId&&doc.refID===ctx.refID}:fnFilter=function(doc){return doc.groupID===ctx.categoryId}:ctx.refID?fnFilter=function(doc){return doc.docTypeID===ctx.categoryId&&doc.refID===ctx.refID}:fnFilter=function(doc){return doc.docTypeID===ctx.categoryId},currentDocs=App[this.opts.TreeDocController].AllDocs.filter(fnFilter),currentDocs.forEach(function(doc){return console.log("iD: "+doc.iD+", docName: "+doc.docName+", docTypeID:"+doc.docTypeID+", groupID:"+doc.groupID)}),account=oDATA.GET("userData").emData[0].account,url="Uploads/"+account,users=oDATA.GET("tblUsers").emData,docTypes=oDATA.GET("tblDocTypes").emData,fnGetIcon=function(ext){return ext=ext.slice(0,3),"img32-doc_"+(ext==="xls"||ext==="doc"||ext==="pdf"?ext:"unknown")},fnGetUser=function(userID){var u;return u=users.find(function(user){return user.iD===userID}),u.firstName+" "+u.surname},fnGetDocType=function(typeID){return docTypes.find(function(type){return type.iD===typeID}).name},isPhoto=ctx.isGroup&&ctx.categoryId===1?!0:!1,showDocs=currentDocs.map(function(doc){var file,user;return user=fnGetUser(doc.userID),file="/"+doc.iD+"."+doc.fileType,Em.Object.create({docID:doc.iD,hasThumb:doc.hasThumb,urlThumb:url+"/Thumbs"+file,urlDoc:url+file,docType:fnGetDocType(doc.docTypeID),description:doc.description,docName:doc.docName,userName:user,fileDate:doc.fileDate,fileName:doc.docName+"."+doc.fileType,fileIcon:doc.hasThumb?"img32-doc_unknown":fnGetIcon(doc.fileType),docDetails:isPhoto?"":"Įkėlė "+user+" "+doc.fileDate+", dydis - "+Math.ceil(doc.fileSize/1e4)/100+"Mb"})}),App[this.opts.TreeDocController].set("isPhoto",isPhoto),console.log("showDocs:"),console.log(showDocs),App[this.opts.TreeDocController].set("docs",showDocs),!1},expandCollapse:function(event){var action,node,subbranch;node=event.target;if(node.src.indexOf("spacer")===-1)return subbranch=$("ul",node.parentNode),action="hide",subbranch.eq(0).css("display")==="none"&&(action="show"),$(subbranch).each(function(){return action==="show"?($(this).show(),$(this).parent().find("img.expandImage").attr("src","Content/less/images/toggle_minus.png")):($(this).hide(),$(this).parent().find("img.expandImage").attr("src","Content/less/images/toggle_plus.png"))})}},TreeDocControllerOpts:{init:function(){return this._super(),this.refreshDocs()},refreshDocs:function(){var cats,docs;return docs=oDATA.GET("tblDocs").emData,cats=this.opts.categoryOpts,cats.accident?this.AllDocs=docs.filterByTbl({filterTbl:oDATA.GET("tblDocsInAccidents").emData,joinField:"docID",filterField:"accidentID",filterValue:cats.accident.iD}):this.AllDocs=docs,Em.run.next(this,function(){var selected,t;return this.AllDocs.filter(function(doc){return doc.groupID===5}).length?$("#"+this.opts.treeId).find("ul>li:last").trigger("click"):(t=$("#"+this.opts.treeId),selected=t.find("span.ui-state-highlight"),selected.length?selected.trigger("click"):t.find("li:first span").trigger("click"))})},docs:[],opts:null,AllDocs:[],selectedCategoryId:null,deleteDocument:function(docElement,selectedNode){var Data,Fields,doc,docID,docType,isGroup,newGroupID,newTypeName,newdocTypeID,opts,refID,sN;return sN=$(selectedNode),refID=sN.data("ref-id"),isGroup=sN.hasClass("isGroup"),docID=docElement.data("doc-id"),newdocTypeID=$(selectedNode).data("category-id"),docType=oDATA.GET("tblDocTypes").emData.find(function(types){return types.iD===newdocTypeID}),newGroupID=docType.docGroupID,newTypeName=docType.name,isGroup&&(newdocTypeID===1&&(newGroupID=1,newdocTypeID=0),newdocTypeID===5&&(newGroupID=5,newdocTypeID=11)),console.log("docID:"+docID+", new type:"+newdocTypeID+", new group:"+newGroupID),Data=new Array(newdocTypeID,newGroupID),Fields=new Array("DocTypeID","GroupID"),refID&&(Data.push(refID),Fields.push("RefID")),doc=this.AllDocs.findProperty("iD",docID),opts=this.opts,SERVER.update2({Action:"Edit",Ctrl:$("#"+opts.treeId),source:"tblDocs",row:doc,DataToSave:{id:docID,Data:Data,Fields:Fields,DataTable:"tblDocs"},Msg:{Title:"Duokumento tipo priskyrimas",Success:"Dokumentas '"+doc.docName+"' priskirtas tipui '"+newTypeName+"'.",Error:"Nepavyko pakeisti dokumento '"+doc.docName+"' tipo."},CallBackAfter:function(Row){}}),docElement.fadeOut()}},docViewForTreeOpts:{opts:null,templateName:"tmpDocsView",tagName:"ul",classNames:["gallery","ui-helper-reset","ui-helper-clearfix"],didInsertElement:function(){return this.$().data("opts",this.opts),this.$().sortable({revert:!0,opacity:.2,refreshPositions:!0}),this.$().disableSelection()}}})}.call(this),function(){var $=window.jQuery;$.widget("ui.ComboBox",{options:{ListType:"List",Editable:{Add:!1,Edit:!1},selectFirst:!1,Value:"",mapWithNoCommas:!1,addNewIfNotExists:!1},_create:function(){var OptVal,data,fnEditItem,fnSetData,id,input,opt,val;return input=$(this.element[0]),input.length===0&&console.error("Input not found for ComboBox!"),opt=$.extend(!0,this.options,input.data("ctrl")),opt.Source==="proc_Drivers"&&(opt.mapWithNoCommas=!0),fnEditItem=function(id,newVals){var Action,pars,template;return id=parseInt(id,10),Action=id?"Edit":"Add",template=opt.Source==="proc_InsPolicies_forThisAccident"?"tmp_InsPolicies":opt.Source.replace("proc_","tmp_"),pars={source:opt.Source,template:template,row:id?oDATA.GET(opt.Source).emData.findProperty("iD",id):0,Action:id?"Edit":"Add",newVals:newVals?{vals:newVals,cols:opt.iText}:null,CallBackAfter:function(Row){return dialogFrm.dialog("close")}},App.listAllController.openItem(pars)},data=void 0,OptVal=parseInt(opt.Value,10),fnSetData=function(){opt.data?data=opt.data():data=$.map(oDATA.GET(opt.Source).emData,function(a){return a.iD===OptVal&&input.val(a.MapArrToString(opt.iText,opt.mapWithNoCommas)),{id:a[opt.iVal],label:a.MapArrToString(opt.iText,opt.mapWithNoCommas)}});if(opt.Editable.Add)return data[data.length]={id:-1,value:"Pridėti naują",label:"Pridėti naują"}},fnSetData(),$(input).on("keyup",function(){return $(this).parent().find("span.ui-menu-icon").remove()}).data("newval",opt.Value).autocomplete({selectFirst:opt.selectFirst,delay:0,minLength:this.options.ListType==="None"?2:0,autoFocus:!0,fnRefresh:function(){return fnSetData()},source:function(request,response){return response($.ui.autocomplete.filter(data,request.term))},select:function(event,ui){if(typeof ui.item.id=="function")return ui.item.id(),!1;if(ui.item.id===-1)return $(event.target).data("ctrl").Source==="tblVehicleMakes"?App.listAllController.set("addMakeMode",!0):fnEditItem(0),!1;if($(event.srcElement).hasClass("ui-menu-icon"))return input.data("autocomplete").fnClickOnBtn({id:ui.item.id,elm:$(event.srcElement),fromInput:!1}),!1;if(ui.item){!$(event.target).parent().find("span.ui-menu-icon").length&&opt.appendToList&&$(event.target).parent().append(opt.appendToList),ui.item.id!==$(this).data("newval")&&($(this).data("newval",ui.item.id).val(ui.item.value),opt.fnChangeCallBack&&MY.execByName(opt.fnChangeCallBack,MY,this,ui.item));if(ui.item.refID)return $(this).data("refID",ui.item.refID),$(this).data("categoryID",ui.item.categoryID),!1}},change:function(event,ui){var t;if(!ui.item)return fnEditItem(0,input.val()),opt.fnChangeCallBack&&MY.execByName(opt.fnChangeCallBack,MY,this,null),t=$(this),t.data("newval",""),opt.Type==="List"&&t.val(""),typeof input.data("autocomplete")!="undefined"&&(input.data("autocomplete").term=""),!1},close:function(event,ui){return!1},open:function(){var acData,termTemplate;opt.Editable.Add&&$("ul.ui-autocomplete:visible").find("a:last").addClass("actionLink");if(opt.ListType==="None"||opt.ListType==="Combo")return acData=$(this).data("autocomplete"),termTemplate='<span style="color:red">%s</span>',acData.menu.element.find("a").each(function(){var me,regex;return me=$(this),regex=new RegExp(acData.term,"gi"),me.html(me.text().replace(regex,function(matched){return termTemplate.replace("%s",matched)}))})},blur:function(){return alert("nu blur")}}),opt.addNewIfNotExists&&input.on("blur",function(){return alert("opa")}),opt.Editable.Edit&&(val=input.data("newval")),$(".ui-autocomplete-input").live("autocompleteopen",function(){var autocomplete,menu;autocomplete=$(this).data("autocomplete"),menu=autocomplete.menu;if(!autocomplete.options.selectFirst)return;return menu.activate($.Event({type:"mouseenter"}),menu.element.children().first())}),opt.Editable.Edit&&(id=$(this).data("newval"),id=id?id:0,opt.appendToList="<span title='redaguoti..' class='ui-icon ui-icon-pencil ui-menu-icon'>&nbsp;</span>",input.after(opt.appendToList),input.data("autocomplete").fnClickOnBtn=function(p){var Action,c,msg,oData;return Action=p.elm.hasClass("ui-icon-pencil")?"Edit":"Delete",oData=oDATA.GET(opt.Source),p.elm.hasClass("ui-icon-pencil")?fnEditItem(p.id):(val=oData.Data.findValueByID(p.id).MapArrToString(input.data("ctrl").iText,!0),c=oData.Config.Msg.Delete,msg=c+' <b>"'+val+'"</b>?',oCONTROLS.dialog.Confirm({title:c,msg:msg},function(){return SERVER.update({Action:"Delete",DataToSave:{id:p.id,DataTable:oData.Config.tblUpdate},Msg:{Title:"Duomenų ištrynimas",Success:oData.Config.Msg.GenName+" "+val+" buvo pašalintas.",Error:oData.Config.Msg.Delete+" "+val+" nepavyko."},CallBack:{Success:function(resp,updData){return data.findObjectByProperty("id",p.id).label===input.val()&&input.val("").parent().find("span.ui-menu-icon").remove(),oData.Data.removeRowByID(p.id),data.removeRowByProperty("id",p.id),input.autocomplete("search",input.val())}}})}))},input.parent().on("click","span.ui-menu-icon",function(){var e;return e=$(this),id=e.parent().find("input").data("newval"),input.data("autocomplete").fnClickOnBtn({id:id,elm:e,fromInput:!0})})),opt.ListType!=="None"&&this.addButton({title:"Parodyti visus",icon:"ui-icon-triangle-1-s",fn:function(){if(input.autocomplete("widget").is(":visible")){input.autocomplete("close");return}return input.autocomplete("search",""),input.focus(),!1},NoCorners:opt.Editable.Add?!0:!1},input),opt.ListType==="List"?(input.attr("readonly",!0),input.click(function(){return input.autocomplete("widget").is(":visible")?(input.autocomplete("close"),!1):(input.autocomplete("search",""),input.focus(),!1)})):input.click(function(){return this.select()})},addButton:function(p,input){this.button=$("<button style='margin:0 0 0 -2.2em;height:"+input.outerHeight()+"px;'>&nbsp;</button>").attr("tabIndex",-1).attr("title",p.title).insertAfter(input).button({icons:{primary:p.icon},text:!1}).click(function(){return p.fn(),!1}).removeClass("ui-corner-all").find("span").attr("class","");if(p.icon==="img18-plus")return this.button.removeClass("ui-button-icon-primary ui-icon").css("margin","-2px 0 0 -8px")},destroy:function(){return $.Widget.prototype.destroy.call(this)}}),$.widget("ui.ComboBoxCategory",$.ui.ComboBox,{_create:function(){var categoryOpts,editList,emCategories,fnGetData,opts,renderGroup,widget;return opts=this.options,opts.element=this.element,categoryOpts=opts.categoryOpts,categoryOpts.showCategories?emCategories=categoryOpts.showCategories:emCategories=oDATA.GET("tblDocGroup").emData,fnGetData=function(){var emTypes;return emTypes=oDATA.GET("tblDocTypes").emData,$.map.call(this,emTypes,function(a){return{id:a[opts.iVal],label:a.MapArrToString(opts.iText,opts.mapWithNoCommas),categoryID:a.docGroupID}})},editList=function(opts){var dialogID;return dialogID="dialog"+ +(new Date),MY[dialogID]=JQ.Dialog.create({dialogID:dialogID,title:"Dokumentų tipai (visi)",title2:"Dokumentų tipai",saveData:function(p){var Source,docGroupID;return Source=App.docsTypesController.docTypes,docGroupID=p.row.docGroupID,$.extend(p,{Ctrl:$("#"+this.dialogID),source:"tblDocTypes",CallBackAfter:function(Row){return p.Action==="Edit"&&Source.findProperty("iD",Row.iD).set("edit",!1),p.Action==="Add"&&MY.dialog.set("addNewType"+Row.docGroupID,!1),App.docsTypesController.init(),opts.element.closest("table").find("input").autocomplete("option","source",opts.data()),console.log("New Row"),console.log(Row)}}),SERVER.update2(p),!1},editDocType:function(e){return e.context.set("edit",e.context.name)},cancelDocType:function(e){return e.context.set("edit",!1)},saveDocType:function(e){var Msg,input,row,type,val;return type=e.context.name,input=$(e.target).prev(),val=input.val(),row=e.context,row.name=val,type.length>2?(Msg={Title:this.title2,Success:"Dokumento tipas '"+type+"' pakeistas.",Error:"Nepavyko pakeisti tipo '"+type+"'."},this.saveData({DataToSave:{id:row.iD,Data:[row.name],Fields:["Name"],DataTable:"tblDocTypes"},Msg:Msg,row:row,Action:"Edit"})):e.context.set("name",e.context.edit).set("edit",!1)},deleteDocType:function(e){var me,type;return type=e.context.name,me=this,oCONTROLS.dialog.Confirm({title:this.title2,msg:"Ištrinti tipą '"+type+"'?"},function(){var Msg,row;return Msg={Title:me.title2,Success:"Dokumento tipas '"+type+"' ištrintas.",Error:"Nepavyko ištrinti tipo '"+type+"'."},row=e.context,me.saveData({DataToSave:{id:row.iD,DataTable:"tblDocTypes"},Msg:Msg,row:row,Action:"Delete"})})},addNewDocType:function(e){return this.set("addNewType"+$(e.target).data("category-id"),!0)},cancelNewDocType:function(e){return this.set("addNewType"+$(e.target).data("category-id"),!1)},saveNewDocType:function(e){var Msg,docGroupID,input,val;return input=$(e.target).prev(),val=input.val(),docGroupID=input.data("category-id"),Msg={Title:this.title2,Success:"Dokumento tipas '"+val+"' pridėtas.",Error:"Nepavyko pridėt tipo '"+val+"'"},this.saveData({DataToSave:{Data:[val,docGroupID],Fields:["Name","DocGroupID"],DataTable:"tblDocTypes"},Msg:Msg,row:[val,docGroupID],Action:"Add"})},closeDialog:function(e){return $("#"+this.dialogID).dialog("close"),!1},width:600,templateName:"tmpDocTypes"}).append()},$.extend(!0,this.options,{data:fnGetData,editList:editList}),this._super(),renderGroup=function(me,ul,myCategory,docTypes,categoryID){var currentTypes;return currentTypes=docTypes.filter(function(type){return type.categoryID===categoryID}),myCategory.forEach(function(category){return ul.append("<li class='ui-autocomplete-category'>"+category.title+"</li>"),currentTypes.setEach("refID",category.iD),currentTypes.forEach(function(type,i){return me._renderItemData(ul,type)})})},widget=this,this.element.data("autocomplete")._renderMenu=function(ul,docTypes){var currentCategoryID,me;me=this,currentCategoryID="",emCategories.forEach(function(catItem,i){if(catItem.iD!==0){if(catItem.iD===1)return me._renderItemData(ul,{id:0,label:"Nuotrauka",value:"Nuotrauka",categoryID:1,refID:categoryOpts.accident.iD});if(catItem.iD===3&&categoryOpts.driver)return renderGroup(me,ul,[categoryOpts.driver],docTypes,3);if(catItem.iD===4&&categoryOpts.vehicles)return renderGroup(me,ul,categoryOpts.vehicles,docTypes,4);if(catItem.iD===2&&categoryOpts.accident)return renderGroup(me,ul,[categoryOpts.accident],docTypes,2)}});if(categoryOpts.editList)return me._renderItemData(ul,{id:function(target){return widget.options.editList(widget.options)},label:"Redaguoti sarašą",value:"Redaguoti sarašą"}),ul.find("li:last a").addClass("actionLink")}}})}.call(this),function($){$.fn.extend({ValidateOnBlur:function(options){var defaults={ValidArray:[],Allow:"Integer",Trim:!0},opt=$.extend(defaults,options);return this.each(function(){var t=$(this);t.blur(function(){var inputVal=t.val(),re=/^(\s*)([\W\w]*)(\b\s*$)/;re.test(inputVal)&&(inputVal=inputVal.replace(re,"$2"));if(opt.ValidArray.length){var idx=jQuery.inArray(inputVal,ValidArray);if(idx===-1){t.val("");return}}else if(opt.Allow==="Integer"){re=/\D*(\d+)\D*/;if(!re.test(inputVal)){t.val("");return}inputVal=inputVal.replace(re,"$1")}else if(opt.Allow==="Decimal"){inputVal=inputVal.replace(",","."),re=/\D*(\d\d*\.\d+|\d+)\D*/;if(!re.test(inputVal)){t.val("");return}inputVal=inputVal.replace(re,"$1")}else if(opt.Allow==="Date"||opt.Allow==="DateCtrl"||opt.Allow==="DateNotLessCtrl"||opt.Allow==="DateNotMoreCtrl")inputVal=inputVal.replace("-",".").replace("/",".").replace("\\",".");else if(opt.Allow==="Year"||opt.Allow==="YearNotMore"||opt.Allow==="YearNotLess"){inputVal=inputVal.replace(".","-").replace("/","-").replace("\\","-"),re=/\.*(19|20\d{2})\.*/,re.test(inputVal)&&(inputVal=inputVal.replace(re,"$1")),$.isNumeric(inputVal)&&opt.Allow==="YearNotMore"&&parseInt(inputVal,10)>=(new Date).getFullYear()&&(inputVal=(new Date).getFullYear());if(!$.isNumeric(inputVal)||opt.Allow!=="YearNotLess"){t.val("");return}parseInt(inputVal,10)<=(new Date).getFullYear()&&(inputVal=(new Date).getFullYear())}t.val(inputVal)})})}})}(jQuery),jQuery(function($){$.datepicker.regional.lt={closeText:"Uždaryti",prevText:"&#x3c;Atgal",nextText:"Pirmyn&#x3e;",currentText:"Šiandien",monthNames:["Sausis","Vasaris","Kovas","Balandis","Gegužė","Birželis","Liepa","Rugpjūtis","Rugsėjis","Spalis","Lapkritis","Gruodis"],monthNamesShort:["Sau","Vas","Kov","Bal","Geg","Bir","Lie","Rugp","Rugs","Spa","Lap","Gru"],dayNames:["sekmadienis","pirmadienis","antradienis","trečiadienis","ketvirtadienis","penktadienis","šeštadienis"],dayNamesShort:["sek","pir","ant","tre","ket","pen","šeš"],dayNamesMin:["Se","Pr","An","Tr","Ke","Pe","Še"],weekHeader:"Sv",dateFormat:"yy.mm.dd",firstDay:1,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},$.datepicker.setDefaults($.datepicker.regional.lt),$.datepicker.setDefaults({duration:"fast",changeMonth:!0,changeYear:!0,showOtherMonths:!0})}),function($){$.fn.extend({tblSortable:function(options){var defaults={cols:[],controller:null,sortedCol:1},opt=$.extend(defaults,options);return this.each(function(){$(this).find("th").each(function(index){opt.cols[index]&&($(this).addClass("clickable").on("click",function(e){var $e=$(e.target),classes=$e.find("span").attr("class"),newClass,n="ui-icon-carat-1-n",s="ui-icon-carat-1-s",ns="ui-icon-carat-2-n-s";if(classes.indexOf(ns)>-1)newClass=s;else if(classes.indexOf(n)>-1)newClass=s;else{if(!(classes.indexOf(s)>-1))throw new Error("no needed class found");newClass=n}$e.closest("tr").find("span."+n).toggleClass(n+" "+ns),$e.closest("tr").find("span."+s).toggleClass(s+" "+ns),$e.find("span").toggleClass(ns+" "+newClass);var c=App[opt.controller];newClass===s?c.set("sortAscending",!0):c.set("sortAscending",!1),c.set("sortProperties",[opt.cols[index]]),c.set("content",c.get("arrangedContent"))}).append('<span class="ui-icon ui-icon-carat-2-n-s ui-tblHead-icon"></span>'),index===opt.sortedCol&&$(this).trigger("click"))})})}})}(jQuery),function($){$.fn.scrollelement=function(options){var defaults={animate:!1,duration:"1000",easing:"linear",complete:function(){},offset:0},options=$.extend(defaults,options);return this.each(function(){var element=$(this),offset=element.offset().top-options.offset,toScroll=0;$(window).scroll(function(){var scroll=$(window).scrollTop();scroll>offset?toScroll=offset+(scroll-offset):toScroll=offset,options.animate==1?element.stop().animate({"margin-top":toScroll+"px"},options.duration,options.easing,options.complete):element.stop().offset({top:toScroll})})})}}(jQuery),function($){$.fn.jScroll=function(options){var opts=$.extend({},$.fn.jScroll.defaults,options);return this.each(function(){var $element=$(this),$window=$(window),locator=new location($element);$window.scroll(function(){$element.stop().animate(locator.getMargin($window),opts.speed)})});function location($element){this.min=$element.offset().top,this.originalMargin=parseInt($element.css("margin-top"),10)||0,this.getMargin=function($window){var max=$element.parent().height()-$element.outerHeight(),margin=this.originalMargin;return $window.scrollTop()>=this.min&&(margin=margin+opts.top+$window.scrollTop()-this.min),margin>max&&(margin=max),{marginTop:margin+"px"}}}},$.fn.jScroll.defaults={speed:"fast",top:0}}(jQuery),function($){$.fn.buttonsetv=function(){$(":radio, :checkbox",this).wrap("<div/>");var ret=$(this).buttonset();return $("label:first",this).removeClass("ui-corner-left").addClass("ui-corner-top"),$("label:last",this).removeClass("ui-corner-right").addClass("ui-corner-bottom"),$("label:first",this).css("border-bottom","none"),$("label:last",this).css("border-bottom","solid 1px #ccc"),mw=0,ret}}(jQuery),jQuery.loadScript=function(url,arg1,arg2){var cache=!1,callback=null;$.isFunction(arg1)?(callback=arg1,cache=arg2||cache):(cache=arg1||cache,callback=arg2||callback);var load=!0;jQuery('script[type="text/javascript"]').each(function(){return load=url!=$(this).attr("src")}),load?jQuery.ajax({type:"GET",url:url,success:callback,dataType:"script",cache:cache}):jQuery.isFunction(callback)&&callback.call(this)},function(a,e){function d(b,c,h){var d=[];return(b.reduction||b).filter(a.validity.settings.elementSupport).each(function(){c(this)?d.push(this):i(this,g(h,{field:o(this)}))}),b.reduction=a(d),b}function f(){a.validity.isValidating()&&(a.validity.report.errors++,a.validity.report.valid=!1)}function i(b,c){f(),a.validity.out.raise(a(b),c)}function j(b,c){f(),a.validity.out.raiseAggregate(b,c)}function k(b){var a=0;return b.each(function(){var b=parseFloat(this.value);a+=isNaN(b)?0:b}),a}function g(b,a){for(var h in a)a.hasOwnProperty(h)&&(b=b.replace(RegExp("#\\{"+h+"\\}","g"),a[h]));return n(b)}function o(b){var b=a(b),c=b.prop("id"),h=a.validity.settings.defaultFieldName;if(b.prop("title").length)h=b.prop("title");else if(/^([A-Z0-9][a-z]*)+$/.test(c))h=c.replace(/([A-Z0-9])[a-z]*/g," $&");else if(/^[a-z0-9]+(_[a-z0-9]+)*$/.test(c)){b=c.split("_");for(c=0;c<b.length;++c)b[c]=n(b[c]);h=b.join(" ")}return a.trim(h)}function n(b){return b.substring?b.substring(0,1).toUpperCase()+b.substring(1,b.length):b}var p;a.validity={settings:a.extend({outputMode:"tooltip",scrollTo:!1,modalErrorsClickable:!0,defaultFieldName:"This field",elementSupport:":text, :password, textarea, select, :radio, :checkbox",argToString:function(b){return b.getDate?b.getMonth()+1+"/"+b.getDate()+"/"+b.getFullYear():b},debugPrivates:!1},{}),patterns:{integer:/^\d+$/,date:/^((0?\d)|(1[012]))\/([012]?\d|30|31)\/\d{1,4}$/,email:/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i,usd:/^\$?((\d{1,3}(,\d{3})*)|\d+)(\.(\d{2})?)?$/,url:/^(https?|ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i,number:/^[+-]?(\d+(\.\d*)?|\.\d+)([Ee]-?\d+)?$/,zip:/^\d{5}(-\d{4})?$/,phone:/^[2-9]\d{2}-\d{3}-\d{4}$/,guid:/^(\{?([0-9a-fA-F]){8}-(([0-9a-fA-F]){4}-){3}([0-9a-fA-F]){12}\}?)$/,time12:/^((0?\d)|(1[12])):[0-5]\d?\s?[aApP]\.?[mM]\.?$/,time24:/^(20|21|22|23|[01]\d|\d)(([:][0-5]\d){1,2})$/,nonHtml:/^[^<>]*$/},messages:{require:"#{field} is required.",match:"#{field} is in an invalid format.",integer:"#{field} must be a positive, whole number.",date:"#{field} must be formatted as a date. (mm/dd/yyyy)",email:"#{field} must be formatted as an email.",usd:"#{field} must be formatted as a US Dollar amount.",url:"#{field} must be formatted as a URL.",number:"#{field} must be formatted as a number.",zip:"#{field} must be formatted as a zipcode ##### or #####-####.",phone:"#{field} must be formatted as a phone number ###-###-####.",guid:"#{field} must be formatted as a guid like {3F2504E0-4F89-11D3-9A0C-0305E82C3301}.",time24:"#{field} must be formatted as a 24 hour time: 23:00.",time12:"#{field} must be formatted as a 12 hour time: 12:00 AM/PM",lessThan:"#{field} must be less than #{max}.",lessThanOrEqualTo:"#{field} must be less than or equal to #{max}.",greaterThan:"#{field} must be greater than #{min}.",greaterThanOrEqualTo:"#{field} must be greater than or equal to #{min}.",range:"#{field} must be between #{min} and #{max}.",tooLong:"#{field} cannot be longer than #{max} characters.",tooShort:"#{field} cannot be shorter than #{min} characters.",nonHtml:"#{field} cannot contain HTML characters.",alphabet:"#{field} contains disallowed characters.",minCharClass:"#{field} cannot have more than #{min} #{charClass} characters.",maxCharClass:"#{field} cannot have less than #{min} #{charClass} characters.",equal:"Values don't match.",distinct:"A value was repeated.",sum:"Values don't add to #{sum}.",sumMax:"The sum of the values must be less than #{max}.",sumMin:"The sum of the values must be greater than #{min}.",radioChecked:"The selected value is not valid.",generic:"Invalid."},out:{start:function(){this.defer("start")},end:function(b){this.defer("end",b)},raise:function(b,a){this.defer("raise",b,a)},raiseAggregate:function(b,a){this.defer("raiseAggregate",b,a)},defer:function(b){var c=a.validity,c=c.outputs[c.settings.outputMode];c[b].apply(c,Array.prototype.slice.call(arguments,1))}},charClasses:{alphabetical:/\w/g,numeric:/\d/g,alphanumeric:/[A-Za-z0-9]/g,symbol:/[^A-Za-z0-9]/g},outputs:{},__private:e,setup:function(b){this.settings=a.extend(this.settings,b),this.__private=this.settings.debugPrivates?p:e},report:null,isValidating:function(){return!!this.report},start:function(){this.out.start(),this.report={errors:0,valid:!0}},end:function(){var b=this.report||{errors:0,valid:!0};return this.report=null,this.out.end(b),b},clear:function(){this.start(),this.end()}},a.fn.extend({validity:function(b){return this.each(function(){if(this.tagName.toLowerCase()=="form"){var c=null;typeof b=="string"?c=function(){a(b).require()}:a.isFunction(b)&&(c=b),b&&a(this).bind("submit",function(){return a.validity.start(),c(),a.validity.end().valid})}})},require:function(b){return d(this,function(b){return a(b).val().length},b||a.validity.messages.require)},match:function(b,c){return c||(c=a.validity.messages.match,typeof b=="string"&&a.validity.messages[b]&&(c=a.validity.messages[b])),typeof b=="string"&&(b=a.validity.patterns[b]),d(this,a.isFunction(b)?function(a){return!a.value.length||b(a.value)}:function(a){return b.global&&(b.lastIndex=0),!a.value.length||b.test(a.value)},c)},range:function(b,c,h){return d(this,b.getTime&&c.getTime?function(a){return a=new Date(a.value),a>=new Date(b)&&a<=new Date(c)}:b.substring&&c.substring&&Big?function(a){return a=new Big(a.value),a.greaterThanOrEqualTo(new Big(b))&&a.lessThanOrEqualTo(new Big(c))}:function(a){return a=parseFloat(a.value),a>=b&&a<=c},h||g(a.validity.messages.range,{min:a.validity.settings.argToString(b),max:a.validity.settings.argToString(c)}))},greaterThan:function(b,c){return d(this,b.getTime?function(a){return new Date(a.value)>b}:b.substring&&Big?function(a){return(new Big(a.value)).greaterThan(new Big(b))}:function(a){return parseFloat(a.value)>b},c||g(a.validity.messages.greaterThan,{min:a.validity.settings.argToString(b)}))},greaterThanOrEqualTo:function(b,c){return d(this,b.getTime?function(a){return new Date(a.value)>=b}:b.substring&&Big?function(a){return(new Big(a.value)).greaterThanOrEqualTo(new Big(b))}:function(a){return parseFloat(a.value)>=b},c||g(a.validity.messages.greaterThanOrEqualTo,{min:a.validity.settings.argToString(b)}))},lessThan:function(b,c){return d(this,b.getTime?function(a){return new Date(a.value)<b}:b.substring&&Big?function(a){return(new Big(a.value)).lessThan(new Big(b))}:function(a){return parseFloat(a.value)<b},c||g(a.validity.messages.lessThan,{max:a.validity.settings.argToString(b)}))},lessThanOrEqualTo:function(b,c){return d(this,b.getTime?function(a){return new Date(a.value)<=b}:b.substring&&Big?function(a){return(new Big(a.value)).lessThanOrEqualTo(new Big(b))}:function(a){return parseFloat(a.value)<=b},c||g(a.validity.messages.lessThanOrEqualTo,{max:a.validity.settings.argToString(b)}))},maxLength:function(b,c){return d(this,function(a){return a.value.length<=b},c||g(a.validity.messages.tooLong,{max:b}))},minLength:function(b,c){return d(this,function(a){return a.value.length>=b},c||g(a.validity.messages.tooShort,{min:b}))},alphabet:function(b,c){var h=[];return d(this,function(a){for(var c=0;c<a.value.length;++c)if(b.indexOf(a.value.charAt(c))==-1)return h.push(a.value.charAt(c)),!1;return!0},c||g(a.validity.messages.alphabet,{chars:h.join(", ")}))},minCharClass:function(b,c,h){return typeof b=="string"&&(b=b.toLowerCase(),a.validity.charClasses[b]&&(b=a.validity.charClasses[b])),d(this,function(a){return(a.value.match(b)||[]).length>=c},h||g(a.validity.messages.minCharClass,{min:c,charClass:b}))},maxCharClass:function(b,c,h){return typeof b=="string"&&(b=b.toLowerCase(),a.validity.charClasses[b]&&(b=a.validity.charClasses[b])),d(this,function(a){return(a.value.match(b)||[]).length<=c},h||g(a.validity.messages.maxCharClass,{max:c,charClass:b}))},nonHtml:function(b){return d(this,function(b){return a.validity.patterns.nonHtml.test(b.value)},b||a.validity.messages.nonHtml)},equal:function(b,c){var d=(this.reduction||this).filter(a.validity.settings.elementSupport),e=function(a){return a},f=a.validity.messages.equal;if(d.length){a.isFunction(b)?(e=b,typeof c=="string"&&(f=c)):typeof b=="string"&&(f=b);var g=a.map(d,function(a){return e(a.value)}),i=g[0],m=!0,l;for(l in g)g[l]!=i&&(m=!1);m||(j(d,f),this.reduction=a([]))}return this},distinct:function(b,c){var d=(this.reduction||this).filter(a.validity.settings.elementSupport),e=function(a){return a},f=a.validity.messages.distinct,g=[],i=!0;if(d.length){a.isFunction(b)?(e=b,typeof c=="string"&&(f=c)):typeof b=="string"&&(f=b);for(var m=a.map(d,function(a){return e(a.value)}),l=0;l<m.length;++l)if(m[l].length){for(var k=0;k<g.length;++k)g[k]==m[l]&&(i=!1);g.push(m[l])}i||(j(d,f),this.reduction=a([]))}return this},sum:function(b,c){var d=(this.reduction||this).filter(a.validity.settings.elementSupport);return d.length&&b!=k(d)&&(j(d,c||g(a.validity.messages.sum,{sum:b})),this.reduction=a([])),this},sumMax:function(b,c){var d=(this.reduction||this).filter(a.validity.settings.elementSupport);return d.length&&b<k(d)&&(j(d,c||g(a.validity.messages.sumMax,{max:b})),this.reduction=a([])),this},sumMin:function(b,c){var d=(this.reduction||this).filter(a.validity.settings.elementSupport);return d.length&&b<k(d)&&(j(d,c||g(a.validity.messages.sumMin,{min:b})),this.reduction=a([])),this},radioChecked:function(b,c){var d=(this.reduction||this).filter(a.validity.settings.elementSupport);d.is(":radio")&&d.find(":checked").val()!=b&&j(d,c||a.validity.messages.radioChecked)},radioNotChecked:function(b,c){var d=(this.reduction||this).filter(a.validity.settings.elementSupport);d.is(":radio")&&d.filter(":checked").val()==b&&j(d,c||a.validity.messages.radioChecked)},checkboxChecked:function(b){var c=(this.reduction||this).filter(a.validity.settings.elementSupport);c.is(":checkbox")&&!c.is(":checked")&&j(c,b||a.validity.messages.radioChecked)},assert:function(b,c){var e=this.reduction||this;if(e.length){if(a.isFunction(b))return d(this,b,c||a.validity.messages.generic);b||(j(e,c||a.validity.messages.generic),this.reduction=a([]))}return this},fail:function(a){return this.assert(!1,a)}}),p={validate:d,addToReport:f,raiseError:i,raiseAggregateError:j,numericSum:k,format:g,infer:o,capitalize:n}}(jQuery),function(a){a.validity.outputs.tooltip={tooltipClass:"validity-tooltip",start:function(){a("."+a.validity.outputs.tooltip.tooltipClass).remove()},end:function(){},raise:function(e,d){var f=e.offset();f.left+=e.width()+18,f.top+=8,a('<div class="validity-tooltip">'+d+'<div class="validity-tooltip-outer"><div class="validity-tooltip-inner"></div></div></div>').click(function(){e.focus(),a(this).fadeOut()}).css(f).hide().appendTo("body").fadeIn()},raiseAggregate:function(a,d){a.length&&this.raise(a.filter(":last"),d)}}}(jQuery),function(a){function e(a){return a.attr("id").length?a.attr("id"):a.attr("name")}a.validity.outputs.label={cssClass:"error",start:function(){a("."+a.validity.settings.cssClass).remove()},end:function(d){!d.valid&&a.validity.settings.scrollTo&&(location.hash=a("."+a.validity.outputs.label.cssClass+":eq(0)").attr("for"))},raise:function(d,f){var i="."+a.validity.outputs.label.cssClass+"[for='"+e(d)+"']";a(i).length?a(i).text(f):a("<label/>").attr("for",e(d)).addClass(a.validity.outputs.label.cssClass).text(f).click(function(){d.length&&d[0].select()}).insertAfter(d)},raiseAggregate:function(d,e){d.length&&this.raise(a(d.get(d.length-1)),e)}}}(jQuery),function(a){a.validity.outputs.modal={start:function(){a(".validity-modal-msg").remove()},end:function(e){!e.valid&&a.validity.settings.scrollTo&&(location.hash=a(".validity-modal-msg:eq(0)").attr("id"))},raise:function(e,d){if(e.length){var f=e.offset();e.get(0),f={left:parseInt(f.left+e.width()+4,10)+"px",top:parseInt(f.top-10,10)+"px"},a("<div/>").addClass("validity-modal-msg").css(f).text(d).click(a.validity.settings.modalErrorsClickable?function(){a(this).remove()}:null).appendTo("body")}},raiseAggregate:function(e,d){e.length&&this.raise(a(e.get(e.length-1)),d)}}}(jQuery),function(a){var e=[];a.validity.outputs.summary={start:function(){a(".validity-erroneous").removeClass("validity-erroneous"),e=[]},end:function(){a(".validity-summary-container").hide().find("ul").html("");if(e.length){for(var d=0;d<e.length;++d)a("<li/>").text(e[d]).appendTo(".validity-summary-container ul");a(".validity-summary-container").show(),a.validity.settings.scrollTo&&(location.hash=a(".validity-erroneous:eq(0)").attr("id"))}},raise:function(a,f){e.push(f),a.addClass("validity-erroneous")},raiseAggregate:function(a,e){this.raise(a,e)},container:function(){document.write('<div class="validity-summary-container">The form didn\'t submit for the following reason(s):<ul></ul></div>')}}}(jQuery),$.extend($.validity.messages,{require:"Šis langelis turi būti užpildytas",match:"Netinkamo formato laukas #{field}",integer:"#{field} turi būti teigiamas, sveikas skaičius",dateUS:"#{field} must be formatted as US date (mm/dd/yyyy).",date:"#{field} turi būt datos formato - (yyyy/mm/dd)",email:"#{field} turi būt e-pašto formato.",emailList:"#{field} turi būti e-pašto formato ir atskirtas ';'.",usd:"#{field} must be formatted as a US Dollar amount.",url:"#{field} must be formatted as a URL.",number:"#{field} turi būti numerio formato.",zip:"#{field} must be formatted as a zipcode ##### or #####-####.",phone:"#{field} must be formatted as a phone number ###-###-####.",guid:"#{field} must be formatted as a guid like {3F2504E0-4F89-11D3-9A0C-0305E82C3301}.",time24:"#{field} must be formatted as a 24 hour time: 23:00.",time12:"#{field} must be formatted as a 12 hour time: 12:00 AM/PM",lessThan:"#{field} turi būti mažiau negu #{max}.",lessThanOrEqualTo:"#{field} turi būti mažiau arba lygu #{max}.",greaterThan:"#{field} turi būti daugiau negu #{min}.",greaterThanOrEqualTo:"#{field} turi būti daugiau arba lygu #{min}.",range:"#{field} turi būti tarp #{min} ir #{max}.",tooLong:"#{field} negali būti ilgesnis negu #{max} raidžių.",tooShort:"#{field} negali būti ilgesnis negu #{min} raidžių.",nonHtml:"#{field} negali turėti HTML raidžių.",alphabet:"#{field} turi būti tik raidės.",minCharClass:"#{field} cannot have more than #{min} #{charClass} characters.",maxCharClass:"#{field} cannot have less than #{min} #{charClass} characters.",equal:"Values don't match.",distinct:"A value was repeated.",sum:"Values don't add to #{sum}.",sumMax:"The sum of the values must be less than #{max}.",sumMin:"The sum of the values must be greater than #{min}.",radioChecked:"The selected value is not valid.",textWithPoint:"Turi būti raidė, skaičius - arba _",textOrNumber:"Turi būti raidės arba skaičiai",generic:"Neteisinga."}),$.extend($.validity.patterns,{date:/^(19|20)[0-9]{2}[\s\.\/-]((0?\d)|(1[012]))[\s\.\/-]([012]?\d|30|31)$/,number:/^[+-]?(\d+(\.\d*)?|\.\d+)([Ee]-?\d+)?$/,textWithPoint:/^[A-Za-z0-9\-\.\_]+$/,textOrNumber:/^[A-Za-z0-9]+$/}),$.extend($.validity.settings,{defaultFieldName:"Šis laukas"}),function(d){d.widget("ech.notify",{options:{speed:300,expires:1500,stack:"below",custom:!1,queue:!1},_create:function(){var a=this;this.templates={},this.keys=[],this.element.addClass("ui-notify").children().addClass("ui-notify-message ui-notify-message-style").each(function(b){b=this.id||b,a.keys.push(b),a.templates[b]=d(this).removeAttr("id").wrap("<div></div>").parent().html()}).end().empty().show()},create:function(a,b,c){return"object"==typeof a&&(c=b,b=a,a=null),a=this.templates[a||this.keys[0]],c&&c.custom&&(a=d(a).removeClass("ui-notify-message-style").wrap("<div></div>").parent().html()),this.openNotifications=this.openNotifications||0,(new d.ech.notify.instance(this))._create(b,d.extend({},this.options,c),a)}}),d.extend(d.ech.notify,{instance:function(a){this.__super=a,this.isOpen=!1}}),d.extend(d.ech.notify.instance.prototype,{_create:function(a,b,c){this.options=b;var e=this,c=c.replace(/#(?:\{|%7B)(.*?)(?:\}|%7D)/g,function(b,c){return c in a?a[c]:""}),c=this.element=d(c),f=c.find(".ui-notify-close");return"function"==typeof this.options.click&&c.addClass("ui-notify-click").bind("click",function(a){e._trigger("click",a,e)}),f.length&&f.bind("click",function(){return e.close(),!1}),this.__super.element.queue("notify",function(){e.open(),"number"==typeof b.expires&&0<b.expires&&setTimeout(d.proxy(e.close,e),b.expires)}),(!this.options.queue||this.__super.openNotifications<=this.options.queue-1)&&this.__super.element.dequeue("notify"),this},close:function(){var a=this.options.speed;return this.element.fadeTo(a,0).slideUp(a,d.proxy(function(){this._trigger("close"),this.isOpen=!1,this.element.remove(),this.__super.openNotifications-=1,this.__super.element.dequeue("notify")},this)),this},open:function(){if(this.isOpen||!1===this._trigger("beforeopen"))return this;var a=this;return this.__super.openNotifications+=1,this.element["above"===this.options.stack?"prependTo":"appendTo"](this.__super.element).css({display:"none",opacity:""}).fadeIn(this.options.speed,function(){a._trigger("open"),a.isOpen=!0}),this},widget:function(){return this.element},_trigger:function(a,b,c){return this.__super._trigger.call(this,a,b,c)}})}(jQuery),$(function(){$container=$("#container").notify(),oGLOBAL.message=function create(title,message){var notify=function create(template,vars,opts){return $container.notify("create",template,vars,opts)},n=$("#container").notify();notify("default",{title:title,text:message},{click:function(e,instance){n.close()}})},oGLOBAL.notify={notifyIt:function create(template,vars,opts){return $container.notify("create",template,vars,opts)},msg:function(title,message){var notify=this.notifyIt;$("#container").notify(),notify("default",{title:title,text:message},{click:function(e,instance){instance.close()}})},withIcon:function(title,message,icon,notExpires){var notify=this.notifyIt;$("#container").notify(),expire=notExpires?!1:1500,notify("withIcon",{title:title,text:message,icon:icon},{expires:expire,click:function(e,instance){instance.close()}})}}}),function(){var w=window,App=w.App,Em=w.Em,oGLOBAL=w.oGLOBAL,oDATA=w.oDATA,oCONTROLS=w.oCONTROLS,MY=w.MY,docsViewOpts;App.listsStart=function(){return App.topNewController.vehicles.clear(),App.topNewController.drivers.clear(),App.topNewController.insPolicies.clear(),App.topNewController.drivers.pushObjects(oDATA.GET("proc_topDrivers").emData.slice(0,3)),App.topNewController.vehicles.pushObjects(oDATA.GET("proc_topVehicles").emData.slice(0,3)),App.topNewController.insPolicies.pushObjects(oDATA.GET("proc_topInsPolicies").emData.slice(0,3)),oDATA.execWhenLoaded(["proc_Vehicles","proc_Drivers","proc_InsPolicies"],function(){return App.listAllController.set("vehicles",oDATA.GET("proc_Vehicles").emData),App.listAllController.set("drivers",oDATA.GET("proc_Drivers").emData),App.listAllController.set("insPolicies",oDATA.GET("proc_InsPolicies").emData)})},App.topNewController=Em.ResourceController.create({vehicles:[],drivers:[],insPolicies:[],tableName:"?"}),App.DriverView=Em.View.extend({templateName:"tmpDriverRow",tagName:""}),App.VehicleView=Em.View.extend({templateName:"tmpVehicleRow",tagName:""}),App.InsPolicyView=Em.View.extend({templateName:"tmpInsPolicyRow",tagName:""}),App.listAllController=Em.ResourceController.create({current:"",clicked:"",endDate:"",editItem:"",filterValue:"",addMakeMode:"",valueDidChange:function(){return this.filterItems()}.observes("filterValue"),openItem:function(pars){var config,title;return this.set("dateIsEdited",!1),App.docsTypesController||App.create_docsTypesController(),config=oDATA.GET(pars.source).Config,title=pars.row?config.Msg.GenName+" "+pars.row.MapArrToString(config.titleFields,!0):config.Msg.AddNew,!pars.row&&pars.newVals&&(pars.row=pars.newVals.vals.toRowObject(pars.newVals.cols)),console.log("JQ.Dialog.create"),console.log(MY.dialog),MY.dialog&&MY.dialog.remove(),MY.dialog&&MY.dialog.remove(),Em.run.next(this,function(){return MY.dialog=JQ.Dialog.create({controllerBinding:"App.listAllController",controller:pars.me,pars:pars,init:function(){return this._super(),console.log("init"),this.templateName=pars.template,this.title=title},cancelAddNewMake:function(){return App.listAllController.set("addMakeMode",!1)},saveAddNewMake:function(e){var autoComplete,ctrl,div,newVal;return div=$(e.target).parent(),newVal=div.prev().find("input").val(),ctrl=$(e.target).parent().parent(),autoComplete=div.next().next().find("input"),newVal&&SERVER.update2({Action:"Add",Ctrl:ctrl,source:"tblVehicleMakes",row:"",DataToSave:{Data:[newVal],Fields:["Name"],DataTable:"tblVehicleMakes"},CallBackAfter:function(Row){return autoComplete.autocomplete("option").fnRefresh(),console.log(Row)}}),App.listAllController.set("addMakeMode",!1)},goToEditDate:function(){return App.listAllController.set("dateIsEdited",!0),Em.run.next(this,function(){return $("#dialogEndDateInput").datepicker({minDate:"-3y",maxDate:"0"}).trigger("focus")})},saveDate:function(){var newDate,obj;return newDate=$(event.target).parent().parent().find("input").val(),oGLOBAL.date.isDate(newDate)||(newDate=""),obj=$("#dialogContent").data("ctrl"),SERVER.update2({Action:"Edit",Ctrl:$("#openItemDialog"),source:obj.Source,row:this.pars.row,DataToSave:{id:obj.id,Data:[newDate],Fields:["EndDate"],DataTable:obj.tblUpdate},CallBackAfter:function(Row){return $("#tabLists").find("div.ui-tabs").find("li.ui-tabs-selected a").trigger("click")}}),console.log("išsaugoti "+newDate),this.pars.me.endDate=newDate,App.listAllController.set("dateIsEdited",!1).set("endDate",newDate)},didInsertElement:function(){var categoryOpts,dialogContent,dialogFrm,groupID,me,name,refID;categoryOpts=!1,this._super(),dialogFrm=$("#openItemDialog"),dialogContent=$("#dialogContent"),me=this;if(pars.emObject==="vehicles"||pars.source==="proc_Vehicles")name="TP "+pars.row.make+", "+pars.row.model+", "+pars.row.plate+" dokumentai",categoryOpts={showCategories:[{iD:4,name:name}],vehicles:[{iD:pars.row.iD,title:name}]};if(pars.emObject==="drivers"||pars.source==="proc_Drivers")name="Vairuotojo '"+pars.row.firstName+" "+pars.row.lastName+"' dokumentai",categoryOpts={showCategories:[{iD:3,name:name}],driver:{iD:pars.row.iD,title:name}};return categoryOpts&&(dialogFrm.find("div.uploadDocsContainer").UploadFiles({categoryOpts:categoryOpts,showPhoto:!1,docsController:"dialogDocController"}),refID=pars.row.iD,groupID=pars.emObject==="vehicles"?4:3,App.dialogDocController.setDocs(refID,groupID),this.removeOnCloseView=Em.View.create(docsViewOpts).appendTo("#dialoguploadDocsContainer")),$("#btnSaveItem").on("click",function(){var DataToSave;return DataToSave=oCONTROLS.ValidateForm(dialogContent),$.extend(pars,{DataToSave:DataToSave,Ctrl:$("#tabLists"),CallBackAfter:function(Row){dialogFrm.dialog("close");if(Row.iD)return App[pars.controller][pars.emObject].findProperty("iD",Row.iD).set("docs","(0)"),$("#tabLists").find("div.ui-tabs").find("li.ui-tabs-selected a").trigger("click")}}),SERVER.update2(pars),!1}),$("#aCancelItem").on("click",function(){return dialogFrm.dialog("close"),!1}),this.templateName==="tmp_InsPolicies"&&this.$().tabs().css("margin","-5px 1px 0 1px"),oCONTROLS.UpdatableForm(dialogContent,pars.row)},width:700,templateName:"dialog-content"}).append()})},addNew:function(e){var pars;return pars=$(e.target).parent().data("ctrl"),console.log("addNew"),console.log(pars),$.extend(pars,{row:0,Action:"Add",me:this,CallBackAfter:function(Row){}}),this.set("endDate",""),this.set("editItem",!1),this.openItem(pars)},edit:function(e){var context,endDate,pars;return console.log("edit"),console.log(e.target),console.log(e.view._context),context=e.view._context,pars=$(e.target).closest("table").next().data("ctrl"),pars=pars?pars:this.current,$.extend(pars,{row:context,Action:"Edit",me:this}),endDate=pars.row.endDate?pars.row.endDate:"",this.set("endDate",endDate),this.set("editItem",!0),console.log("going to open items"),this.openItem(pars)},filterByField:function(){var fn;return fn=this.filterValue?"var ret=false,cols="+JSON.stringify(this.current.filterCols)+";console.log('Filtering by val:"+this.filterValue+"'); for(var i=0; i < cols.length; i++){console.log(row[cols[i]]+', '+(row[cols[i]].toLowerCase().indexOf('"+this.filterValue+"')>-1));		if (row[cols[i]].toLowerCase().indexOf('"+this.filterValue+"')>-1){ret=true; break;}} console.log('filterByval rez: '+ret);return ret;":"return true;",new Function("row",fn)},filterByTab:function(){var fn,mark;if(this.current.emObject==="drivers")mark=this.clicked==="NotWorking"?"!":"",fn="var ret=true; if ($.trim(row.endDate)) {ret=oGLOBAL.date.firstBigger(row.endDate);} console.log('endDate: '+row.endDate+', '+ret);return "+mark+"ret";else{if(this.current.emObject!=="vehicles")throw new Error("filterByTab has no such emObject");mark=this.clicked==="NotWorking"?"!":"",fn="var ret=true; if ($.trim(row.endDate)) {ret=oGLOBAL.date.firstBigger(row.endDate);} console.log('endDate: '+row.endDate+', '+ret);return "+mark+"ret"}return new Function("row",fn)},filterItems:function(){var fn,_this=this;return this.current.emObject==="insPolicies"?fn=function(row){var v;return v=_this.filterByField()(row),row.set("visible",v)}:fn=function(row){var v;return v=_this.filterByTab()(row)?_this.filterByField()(row):!1,row.set("visible",v)},App.listAllController[this.current.emObject].forEach(fn)},showTabs:function(e){var t;return t=$(e.target),t.closest("ul").find("li").removeClass("ui-tabs-selected ui-state-active"),t.closest("li").addClass("ui-tabs-selected ui-state-active")},filterWorking:function(e){return this.set("clicked","Working"),this.showTabs(e),this.filterItems()},filterNotWorking:function(e){return this.set("clicked","NotWorking"),this.showTabs(e),this.filterItems()},vehicles:[],drivers:[],insPolicies:[],tableName:"?"}),App.TopListsView=App.mainMenuView.extend({templateName:"tmpListsTop",viewIx:4}),App.AllDriversView=App.mainMenuView.extend({init:function(){return this._super(),App.listAllController.set("content",oDATA.GET("proc_Drivers").emData)},templateName:"tmpAllDrivers",viewIx:4,didInsertElement:function(){var view;return this._super(),view=$("#tabLists"),view.find("div.ui-tabs").find("li:first a").trigger("click"),view.find("table.zebra-striped").tblSortable({cols:["firstName","lastName","dateExpierence","drivingCategory","phone","docs"],controller:"listAllController",sortedCol:1})}}),App.AllInsPoliciesView=App.mainMenuView.extend({init:function(){return this._super(),App.listAllController.set("content",oDATA.GET("proc_InsPolicies").emData)},templateName:"tmpAllInsPolicies",viewIx:4,didInsertElement:function(){return $("#tabLists").find("table.zebra-striped").tblSortable({cols:["claimType","insurerName","policyNumber","endDate","isuredName"],controller:"listAllController",sortedCol:0})}}),App.AllVehiclesView=App.mainMenuView.extend({init:function(){return this._super(),App.listAllController.set("content",oDATA.GET("proc_Vehicles").emData)},templateName:"tmpAllVehicles",viewIx:4,didInsertElement:function(){var view;return this._super(),view=$("#tabLists"),view.find("div.ui-tabs").find("li:first a").trigger("click"),view.find("table.zebra-striped").tblSortable({cols:["plate","type","make","model","year","docs"],controller:"listAllController",sortedCol:0})}}),App.dialogDocController=Em.ResourceController.create({refID:null,groupID:null,docs:[],refreshDocs:function(){return this.setDocs(this.refID,this.groupID)},setDocs:function(refID,groupID){var account,docTypes,docs,fnGetDocType,fnGetIcon,fnGetUser,url,users;return refID?(this.refID=refID,this.groupID=groupID):(refID=this.refID,groupID=this.groupID),account=oDATA.GET("userData").emData[0].account,url="Uploads/"+account,users=oDATA.GET("tblUsers").emData,docTypes=oDATA.GET("tblDocTypes").emData,fnGetIcon=function(ext){return ext=ext.slice(0,3),"img32-doc_"+(ext==="xls"||ext==="doc"||ext==="pdf"?ext:"unknown")},fnGetUser=function(userID){var u;return u=users.find(function(user){return user.iD===userID}),u.firstName+" "+u.surname},fnGetDocType=function(typeID){return docTypes.find(function(type){return type.iD===typeID}).name},docs=oDATA.GET("tblDocs").emData.filter(function(doc){return doc.refID===refID&&doc.groupID===groupID}).map(function(doc){var file,user;return user=fnGetUser(doc.userID),file="/"+doc.iD+"."+doc.fileType,Em.Object.create({docID:doc.iD,hasThumb:doc.hasThumb,urlThumb:url+"/Thumbs"+file,urlDoc:url+file,docType:fnGetDocType(doc.docTypeID),description:doc.description,docName:doc.docName,userName:user,fileDate:doc.fileDate,fileName:doc.docName+"."+doc.fileType,fileIcon:doc.hasThumb?"img32-doc_unknown":fnGetIcon(doc.fileType),docDetails:"Įkėlė "+user+" "+doc.fileDate+", dydis - "+Math.ceil(doc.fileSize/1e4)/100+"Mb"})}),this.set("docs",docs)}}),docsViewOpts={opts:null,templateName:"tmpDocsView",tagName:"ul",classNames:["gallery","ui-helper-reset","ui-helper-clearfix"],controller:App.dialogDocController,didInsertElement:function(){return this._super(),this.$().data("opts",this.opts)}}}.call(this),oGLOBAL.LoadAccident_Card=function(AccidentNo){"use strict";var UpdateServer,DefaultTime,fnChangeCheck,fnChange,LoadScript;return SERVER.send("{'AccidentNo':"+AccidentNo+"}",oGLOBAL.Start.fnSetNewData,{Ctrl:"divAccidentEdit",RenderNew:1,fnCallBack:function(){LoadScript()}},"/Accident/GetAccident","json"),LoadScript=function(){$("#btnMapTown").button({disabled:!0}).click(function(){return oGLOBAL.mapFn.GetMapFromTown(),!1});var frmOpts=$("#AccidentForm").data("ctrl"),tabOpts={};frmOpts.NewRec&&(tabOpts.disabled=[1]),$("#accidentTab").tabs(tabOpts).on("tabsactivate",function(event,ui){if(ui.newTab.index()===1){var accidentForm=ui.oldPanel,docsForm=ui.newPanel,uploadForm=$("#uploadDocsToAccident");uploadForm.html()!==""&&accidentForm.data("ctrl").id!==docsForm.data("ctrl").id&&uploadForm.empty(),uploadForm.html()===""&&(App.docsAccident({accidentForm:accidentForm,docsForm:docsForm,uploadForm:uploadForm}),docsForm.data("ctrl").id=accidentForm.data("ctrl").id)}}),$("#LongNote").bind("keyup",function(){}),$("#btnSave").button().click(function(){var DataToSave=oCONTROLS.ValidateForm($("#AccidentForm")),Action,Msg;if(DataToSave){if(oGLOBAL.AccidentForm.NewRec){if(oGLOBAL.AccidentForm.Lat?0:1)return oCONTROLS.dialog.Alert({msg:"Pažymėkite įvykio vietą pelės spragtelėjimu žemėlapyje..",title:"Naujo įvykio įvedimas"}),!1;DataToSave.Data.push(oGLOBAL.AccidentForm.Lat),DataToSave.Fields.push("Lat"),DataToSave.Data.push(oGLOBAL.AccidentForm.Lng),DataToSave.Fields.push("Lng"),DataToSave.Data.push(oGLOBAL.AccidentForm.Country),DataToSave.Fields.push("LocationCountry"),DataToSave.Data.push(oGLOBAL.AccidentForm.District),DataToSave.Fields.push("LocationDistrict"),DataToSave.Data.push(oGLOBAL.AccidentForm.Address),DataToSave.Fields.push("LocationAddress"),Msg={Title:"Naujo įvykio įvedimas",Success:"Naujas įvykis pridėtas",Error:"Nepavyko pridėti naujo įvykio."},Action="Add"}else Msg={Title:"Įvykio duomenų keitimas",Success:"Duomenys sėkmingai pakeisti",Error:"Nepavyko pakeisti duomenų."},Action="Edit";SERVER.update({Action:Action,DataToSave:DataToSave,CallBack:{Success:function(resp){var newRow=resp.ResponseMsg.Ext.replace(/#\|#\|/g,":::").split("|#|");newRow[13]=newRow[13].replace(/:::/g,"#|#|");var no=parseInt(newRow[1],10),toAppend=Action==="Edit"?!1:{sort:"desc",col:"date"};App.accidentsController.get("setNewVal").call(App.accidentsController,{newVal:newRow,toAppend:toAppend,fieldsToInt:[0,1,5,6,7,8]})[0],oGLOBAL.AccidentForm.NewRec&&($("#btnReturnToAccidents").trigger("click"),Em.run.next({newNo:no},function(){var tr=$("#accidentsTable").find("div.accident").find("div.td:nth(0):contains("+this.newNo+")").parent().addClass("selectedAccident");$("#accidentsTable").find("div.selectedAccident").trigger("click"),Em.run.next(function(){$("#AccDetailsContent").find("button").trigger("click"),Em.run.next(function(){var scroolTop=tr.offset().top-$(window).height()/2+100;$("html, body").animate({scrollTop:scroolTop},"slow")})})}))}},Msg:Msg})}return!1}),$("#btnCancel").click(function(){return oGLOBAL.LoadAccident_Card(AccidentNo),!1}),$("#btnReturnToAccidents").click(function(e){e.preventDefault(),$("#tabAccidents").addClass("colmask"),$("#divAccidentsList").show();var ctrlEdit=$("#divAccidentEdit").empty().hide()}),$("#inputChooseTown").bind("keypress",function(){$(this).val().length>1?$("#btnMapTown").button("enable"):$("#btnMapTown").button("disable")});var Dif=$("#divAccidentEdit").height()-$("h2").outerHeight(!0)-$("#ulWhiteMenu").outerHeight(!0)-$("#AccidentForm").outerHeight(!0);Dif>0&&$("div.HalfDivleft1").height($("div.HalfDivleft1").height()+Dif);var MapHeight=$("#AccidentForm").outerHeight(!1)-$("#divMapHead").outerHeight(!1);$("#divMap").height(MapHeight).width("100%"),oGLOBAL.AccidentForm=$("#AccidentForm").data("ctrl"),oGLOBAL.mapFn.loadGMap(),oGLOBAL.mapFn.fnSetAddress($("#txtPlace").html())},!1},oGLOBAL.map=null,oGLOBAL.Ggeocoder=null,oGLOBAL.AccidentForm={},oGLOBAL.mapFn={GetMapFromTown:function(){"use strict";var Town=$("#inputChooseTown").val();oGLOBAL.Ggeocoder.getLocations(Town,oGLOBAL.mapFn.addAddressToMap)},SetAddress:function(latlng){latlng&&oGLOBAL.Ggeocoder.getLocations(latlng,function(addresses){addresses.Status.code!==200?oGLOBAL.map.SetAddress="Adresas nerastas":(oGLOBAL.map.SetAddress=oGLOBAL.mapFn.fnGetAddress(addresses.Placemark),oGLOBAL.map.openInfoWindow(latlng,oGLOBAL.map.SetAddress))})},fnGetAddress:function(p){var len=p.length,btn,address=p[0].address,district=len>3?p[3].address:"",address1=len>1?p[1].address:"",address2=len>2?p[2].address:"",ArrAddr=address.split(", "),ArrDistr=district.split(", "),ArrAddr1=address1.split(", "),ArrAddr2=address2.split(", "),Last=ArrAddr.length>1?ArrAddr.length-2:0;return oGLOBAL.AccidentForm.Country=ArrAddr[ArrAddr.length-1],oGLOBAL.AccidentForm.District=(ArrDistr[0]?ArrDistr[0]:ArrAddr.length>1?ArrAddr[ArrAddr.length-2]:"").replace("'",""),ArrAddr[Last].search(ArrDistr[0])>-1&&Last--,Last===-1?oGLOBAL.AccidentForm.Address="":(ArrAddr[Last].search(ArrAddr1[0])===-1&&(ArrAddr[Last]+=", "+ArrAddr1[0]),ArrAddr[Last].search(ArrAddr2[0])===-1&&(ArrAddr[Last]+=", "+ArrAddr2[0]),address=ArrAddr.splice(0,Last+1),oGLOBAL.AccidentForm.Address=address?address.join(", ").replace("'",""):""),(oGLOBAL.AccidentForm.Address?oGLOBAL.AccidentForm.Address+", ":"")+oGLOBAL.AccidentForm.District+", "+oGLOBAL.AccidentForm.Country},fnSetAddress:function(place){var p=oGLOBAL.AccidentForm;place="<a target='_blank' href='https://maps.google.com/maps?q="+p.Lat+","+p.Lng+"("+place+")'>"+place+"<a>",$("#txtPlace").html(place),$("#divSearchMap").css("display","none")},Mapclicked:function(overlay,latlng){"use strict";latlng&&(oGLOBAL.AccidentForm.Lat=latlng.y,oGLOBAL.AccidentForm.Lng=latlng.x,oGLOBAL.Ggeocoder.getLocations(latlng,function(addresses){if(addresses.Status.code!==200)oCONTROLS.dialog.Alert({msg:"Nepavyko rasti šios vietos adreso - "+latlng.toUrlValue(),title:"Nepavyko rasti adreso"});else{var place=oGLOBAL.mapFn.fnGetAddress(addresses.Placemark);oGLOBAL.map.openInfoWindow(latlng,place),oGLOBAL.mapFn.fnSetAddress(place),oGLOBAL.AccidentForm.NewRec||$("#ConfirmNewMapData").length||($('<a id="ConfirmNewMapData" href="javascript:void(0);return false;">Patvirtinti</a>').insertAfter("#btnEditMap").button(),$("#ConfirmNewMapData").click(function(){var DataToSave={Data:[],Fields:[],DataTable:$("#AccidentForm").data("ctrl").Source};DataToSave.Data.push(oGLOBAL.AccidentForm.Lat),DataToSave.Fields.push("Lat"),DataToSave.Data.push(oGLOBAL.AccidentForm.Lng),DataToSave.Fields.push("Lng"),DataToSave.Data.push(oGLOBAL.AccidentForm.Country),DataToSave.Fields.push("LocationCountry"),DataToSave.Data.push(oGLOBAL.AccidentForm.District),DataToSave.Fields.push("LocationDistrict"),DataToSave.Data.push(oGLOBAL.AccidentForm.Address),DataToSave.Fields.push("LocationAddress"),DataToSave.id=$("#AccidentForm").data("ctrl").id,SERVER.update({Action:"Edit",DataToSave:DataToSave,CallBack:{Success:function(resp){oGLOBAL.map.clearOverlays(),latlng=new GLatLng(oGLOBAL.AccidentForm.Lat,oGLOBAL.AccidentForm.Lng),oGLOBAL.map.setCenter(latlng,8);var marker=new GMarker(latlng);oGLOBAL.map.addOverlay(marker),oGLOBAL.mapFn.SetAddress(latlng);var M=GEvent.addListener(marker,"click",function(){oGLOBAL.map.openInfoWindow(latlng,oGLOBAL.map.SetAddress)});$("#btnEditMap").attr("title","Keisti įvykio vietą").html("Keisti").data("caption","Change"),$("#ConfirmNewMapData").remove();var newRow=resp.ResponseMsg.Ext.replace(/#\|#\|/g,":::").split("|#|");newRow[13]=newRow[13].replace(/:::/g,"#|#|"),App.accidentsController.get("setNewVal").call(App.accidentsController,{newVal:newRow,toAppend:!1,fieldsToInt:[0,1,5,6,7,8]})[0]}},Msg:{Title:"Įvykio vietos keitimas",Success:"Įvykio vieta pakeista.",Error:"Nepavyko pakeist įvykio vietos."}})}))}}))},loadGoogleMapScript:function(callback){"use strict";if(typeof GMap2=="function"){callback();return}var script=document.createElement("script");script.setAttribute("src","http://maps.google.com/maps?file=api&amp;v=2&amp;sensor=true&amp;key=AIzaSyBmiyz9zmTD_hY7qT7Degr0o7tqAzjKQos&async=2&callback=oGLOBAL.mapFn.loadGMap"),script.setAttribute("type","text/javascript"),document.documentElement.firstChild.appendChild(script)},addAddressToMap:function(response){oGLOBAL.map.clearOverlays();if(response&&response.Status.code!==200)alert("Neradau tokios vietovės - "+decodeURIComponent(response.name));else{var place=response.Placemark[0],point=new GLatLng(place.Point.coordinates[1],place.Point.coordinates[0]),Address=place.address.split(", "),Sub=typeof place.AddressDetails.Country.SubAdministrativeArea=="undefined"?"":"<b>Apskritis:</b> "+place.AddressDetails.Country.SubAdministrativeArea.SubAdministrativeAreaName+"<br>",Adm=Address.length<3?"":"<b>Adm. centras:</b> "+Address[1]+"<br>";oGLOBAL.map.setCenter(point,5),oGLOBAL.map.openInfoWindowHtml(point,"<b>Vietovardis:</b> "+Address[0]+"<br>"+Adm+Sub+"<b>Šalis:</b> "+place.AddressDetails.Country.CountryName+" ("+place.AddressDetails.Country.CountryNameCode+")")}},loadGMap:function(){var EditMap=function(){oGLOBAL.map.EventMapclicked=GEvent.addListener(oGLOBAL.map,"click",oGLOBAL.mapFn.Mapclicked);var latlng=oGLOBAL.map.getCenter();latlng.y=latlng.y-.3,latlng.Xd=latlng.y,oGLOBAL.map.openInfoWindow(latlng,"Suraskite ir pažymėkite įvykio vietą žemėlapyje")};if(GBrowserIsCompatible()){oGLOBAL.map=new GMap2(document.getElementById("divMap"));if(!oGLOBAL.AccidentForm.NewRec){var latlng=new GLatLng(oGLOBAL.AccidentForm.Lat,oGLOBAL.AccidentForm.Lng);oGLOBAL.map.setCenter(latlng,8),oGLOBAL.map.setUIToDefault(),oGLOBAL.Ggeocoder=new GClientGeocoder;var marker=new GMarker(latlng);oGLOBAL.map.addOverlay(marker),oGLOBAL.mapFn.SetAddress(latlng);var M=GEvent.addListener(marker,"click",function(){oGLOBAL.map.openInfoWindow(latlng,oGLOBAL.map.SetAddress)});$("#btnEditMap").click(function(){var t=$(this);$("#divSearchMap").toggle(),t.data("caption")==="Change"?(EditMap(),t.attr("title","Atšaukti įvykio vietos keitimą").html("Atšaukti").data("caption","Cancel")):(oGLOBAL.map.EventMapclicked&&GEvent.removeListener(oGLOBAL.map.EventMapclicked),t.attr("title","Keisti įvykio vietą").html("Keisti").data("caption","Change"),oGLOBAL.mapFn.fnSetAddress(oGLOBAL.map.SetAddress),$("#ConfirmNewMapData").length&&$("#ConfirmNewMapData").remove(),oGLOBAL.map.openInfoWindow(latlng,oGLOBAL.map.SetAddress))})}else oGLOBAL.map.setCenter(new GLatLng(54.682961,25.2740478),4),oGLOBAL.map.setUIToDefault(),oGLOBAL.Ggeocoder=new GClientGeocoder,EditMap()}}},console.log("accidentCard loaded"),function(){var w=window,App=w.App,Em=w.Em,oGLOBAL=w.oGLOBAL,oDATA=w.oDATA,oCONTROLS=w.oCONTROLS,MY=w.MY;App.TabUserCardView=Em.View.extend({didInsertElement:function(){var SaveOk,ctrl,frm;this._super(),$("#userInfoTab").tabs(),frm=$("#InfoDataForm"),ctrl=App.userCardController,ctrl.content.length?frm.data("ctrl",{NewRec:0,id:ctrl.content[0].iD,Source:"tblUsers"}):frm.data("ctrl",{NewRec:1,id:0,Source:"tblUsers"}),oCONTROLS.UpdatableForm(frm),SaveOk=App.userCardController.SaveOk;if(SaveOk)return $("#savePasswordNote").html(SaveOk).show().delay(2e3).fadeOut(),SaveOk=null},templateName:"tmpUserCard",controllerBinding:"App.userCardController",changeMyPassword:function(){return App.router.transitionTo("tabChangePass")},sendUserPasswordForm:function(){return App.userCardController.set("passwordReset",!0)},sendUserPassword:function(e){return SERVER.update3({pars:{email:App.userCardController.content[0].email},ctrl:$(e.target).parent(),CallBack:function(resp){return resp.ErrorMsg?$("#savePasswordNote").html("Nepavyko išsiųsti, klaida: "+resp.ErrorMsg).show().delay(2e3).fadeOut():$("#savePasswordNote").html(resp.ResponseMsg).show().delay(2e3).fadeOut(),App.userCardController.set("passwordReset",!1)},url:"/Account/RecoverPassword2"})},emailText:function(){return alert("Laiško tekstas")},cancelSendUserPassword:function(){return App.userCardController.set("passwordReset",!1)},saveUserCard:function(){var Action,DataToSave,frm,opt;frm=$("#InfoDataForm"),DataToSave=oCONTROLS.ValidateForm(frm),Action=frm.data("ctrl").NewRec?"Add":"Edit";if(DataToSave)return opt={Action:Action,DataToSave:DataToSave,row:App.userCardController.content[0],source:"tblUsers",Ctrl:frm},{CallBackAfter:function(Row,Action){var name;name=Row.firstName+" "+Row.surname,name!==oDATA.GET("userData").emData[0].userName&&(oDATA.GET("userData").emData[0].userName=name,$("#userLink").html(name));if(Action==="Add")return this.setUser({myInfo:!1,User:Row}),App.router.transitionTo("tabUserCard")}},SERVER.update2(opt)},saveUserRights:function(){return alert("saveUserRights")},goToAdminTab:function(){return App.router.transitionTo("tabAdmin"),!1}}),App.userCardController=Em.ArrayController.create({init:function(){return console.log("init")},setUser:function(p){var id;this.set("myInfo",p.myInfo?!0:!1).set("passwordReset",!1),this.content.length&&this.content.removeAt(0),p.myInfo&&(id=p.User=oDATA.GET("userData").emData[0].userID,p.User=oDATA.GET("tblUsers").emData.findProperty("iD",id));if(p.User)return this.content.pushObject(p.User)},myInfo:!0,passwordReset:!1,content:[],addNewUser:function(e){return this.setUser({myInfo:!1}),App.router.transitionTo("tabUserCard"),!1},editUser:function(e){return this.setUser({myInfo:!1,User:e.view._context}),App.router.transitionTo("tabUserCard"),!1}}),App.ChangeUserPassView=Em.View.extend({saveNewPass:function(){var newPass,newPsw,newPsw2,ok,oldPass,oldPsw,t;t=this.$(),oldPass=t.find("input:eq(0)"),newPass=t.find("input:gt(0)"),$.validity.start(),oldPass.require("Įveskite esamą slaptažodį"),newPass.require("Įveskite naują slaptažodį").minLength(3,"Įveskite ne mažiau 3 raidžių").match("textOrNumber"),newPsw=$.trim(newPass.eq(0).val()),newPsw2=$.trim(newPass.eq(1).val()),oldPsw=$.trim(oldPass.val()),ok=function(){return newPsw===newPsw2},newPass.assert(ok,"Nesutampa slaptažodžiai");if($.validity.end().valid)return SERVER.update3({pars:{OldPassword:oldPsw,NewPassword:newPsw,UserId:0},CallBack:function(resp){return resp.ErrorMsg?$("#changePaswordError").html(resp.ErrorMsg):(App.userCardController.set("SaveOk",resp.ResponseMsg),App.router.transitionTo("tabUserCard"),!1),console.log(resp)},url:"/Account/NewPassword2"})},cancelNewPass:function(){return App.router.transitionTo("tabUserCard"),!1},templateName:"tmpChangeUsrPass"})}.call(this),function(){var w=window,App=w.App,Em=w.Em,oGLOBAL=w.oGLOBAL,oDATA=w.oDATA,oCONTROLS=w.oCONTROLS,MY=w.MY;App.docsAccident=function(p){var accidentID,driver,driverID,driverTitle,frmObj,isNew,settings,vehicles;return frmObj=p.accidentForm.data("ctrl"),isNew=frmObj.NewRec===1?!0:!1,accidentID=isNew?null:frmObj.id,driver=$("#lstDrivers"),driverID=isNew?null:driver.data("ctrl").Value,driverTitle="Vairuotojo '"+driver.val()+"' dokumentai",vehicles=isNew?null:frmObj.vehicles,settings={categoryOpts:{accident:{iD:accidentID,title:"Įvykio dokumentai"},driver:{iD:driverID,title:driverTitle},vehicles:vehicles}},oDATA.execWhenLoaded(["tmpUploadForm","tmpDocsTree"],function(){return $("#uploadDocsToAccident").UploadFiles(settings),$("#uploadDocsToAccident").next().Tree({categoryOpts:settings.categoryOpts})})}}.call(this),App.ClaimsView=App.mainMenuView.extend({templateName:"tmpClaims",viewIx:1}),App.MapView=App.mainMenuView.extend({templateName:"tmpMap",viewIx:2}),App.ReportsView=App.mainMenuView.extend({templateName:"tmpReports",viewIx:3}),App.Router=Em.Router.extend({executed:{},enableLogging:!1,location:"hash",root:Em.Route.extend({viewAccidents:Em.State.transitionTo("tabAccidents"),viewClaims:Em.State.transitionTo("tabClaims"),viewMap:Em.State.transitionTo("tabMap"),viewReports:Ember.State.transitionTo("tabReports"),viewLists:Ember.State.transitionTo("tabLists"),viewAdmin:Ember.State.transitionTo("tabAdmin"),tabAccidents:Em.Route.extend({route:"/",connectOutlets:function(router,context){MY.NavbarController.fnSetNewTab(router.currentState.name,0),$("#divAccidentsList").find("div.col2").css("top","0")}}),tabClaims:Em.Route.extend({route:"/claims",connectOutlets:function(router,context){MY.NavbarController.fnSetNewTab(router.currentState.name,1)}}),tabMap:Em.Route.extend({route:"/map",connectOutlets:function(router,context){MY.NavbarController.fnSetNewTab(router.currentState.name,2)}}),tabReports:Em.Route.extend({route:"/reports",connectOutlets:function(router,context){MY.NavbarController.fnSetNewTab(router.currentState.name,3)}}),tabLists:Em.Route.extend({route:"/tabLists",connectOutlets:function(router,context){MY.NavbarController.fnSetNewTab(router.currentState.name,4),oDATA.fnLoad2({url:"Main/tabLists",checkFn:"App.listsStart",callBack:function(){App.listsStart(),router.get("applicationController").connectOutlet("listsOutlet","topLists")}})},toListAll:function(router,context){d=$(context.target).parent().data("ctrl"),App.listAllController.set("current",d),router.get("applicationController").connectOutlet("listsOutlet",d.goTo)},toTop:function(router,context){App.listsStart(),router.get("applicationController").connectOutlet("listsOutlet","topLists")}}),tabAdmin:Em.Route.extend({route:"/tabAdmin",connectOutlets:function(router,context){MY.NavbarController.fnSetNewTab(router.currentState.name,5),oDATA.fnLoad2({url:"Main/tabAdmin",callBack:function(){App.adminStart(),console.log(".connectOutlet('adminOutlet', 'tabAdmin');"),router.get("applicationController").connectOutlet("adminOutlet","tabAdmin")}})}}),tabUserCard:Em.Route.extend({route:"/tabUserCard",connectOutlets:function(router,context){var ix=App.userCardController.myInfo?-1:5;MY.NavbarController.fnSetNewTab(router.currentState.name,ix,"tabAdmin"),router.get("applicationController").connectOutlet("adminOutlet","tabUserCard")}}),tabChangePass:Em.Route.extend({route:"/changePass",connectOutlets:function(router,context){MY.NavbarController.fnSetNewTab(router.currentState.name,-1,"tabEmpty"),router.get("applicationController").connectOutlet("emptyOutlet","changeUserPass")}})})}),App.initialize(),$(function(){$("#userLink").on("click",function(e){return App.userCardController.setUser({myInfo:!0}),App.router.transitionTo("tabUserCard"),!1}),Em.run.next(function(){$("#tabAccidents,#tabClaims,#tabReports,#tabLists,#tabAdmin").on("focus","input:text,textarea",function(e){$(e.target).addClass("activeField")}).on("blur","input:text,textarea",function(e){$(e.target).removeClass("activeField")})})})